import{u as G,r as v,j as e,B as I,ac as Q,ay as ee,a7 as _,aT as se,aU as te,aV as ae,aG as Z,aW as le,aX as re,aY as ne,aZ as ie,a as X,a_ as q,a$ as W,f as oe,b0 as de,b1 as L,b2 as ce,b3 as M,b4 as O,b5 as me,b6 as xe,b7 as he,b8 as ue,b9 as ge,aC as $,aa as F,ba as pe,bb as be,bc as H,bd as fe,be as je,F as P,aR as J,bf as Ne,D as ye,b as we,ao as ve,bg as Y,aA as Ce,bh as ke,aM as Pe,aD as Ee,aQ as Te,bi as Se,bj as Ae,bk as De,bl as Ue}from"./index-CV0oviIo.js";import{f as Ie,r as K}from"./fileHelpers-B8PrZ_Ea.js";import{C as R}from"./Chart-CJoefmIt.js";const Oe=({client:g})=>{const b=G(),[N,d]=v.useState(!1),[n,y]=v.useState(null),[x,j]=v.useState({name:"",email:"",phone:"",position:"",department:""}),E=(g==null?void 0:g.contacts)||[],D=async s=>{s.preventDefault();try{n?(await b(le({clientId:g.id,contactId:n.id,contact:x})).unwrap(),y(null)):(await b(re({clientId:g.id,contact:x})).unwrap(),d(!1)),j({name:"",email:"",phone:"",position:"",department:""})}catch(i){console.error("Failed to save contact:",i)}},U=s=>{y(s),j({name:s.name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",department:s.department||""})},a=async s=>{if(window.confirm("Are you sure you want to delete this contact?"))try{await b(ie({clientId:g.id,contactId:s})).unwrap()}catch(i){console.error("Failed to delete contact:",i)}},l=async s=>{try{await b(ne({clientId:g.id,contactId:s})).unwrap()}catch(i){console.error("Failed to set primary contact:",i)}},t=()=>{d(!1),y(null),j({name:"",email:"",phone:"",position:"",department:""})};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Contacts"}),e.jsx(I,{label:"Add Contact",icon:e.jsx(Q,{}),onClick:()=>d(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"})]}),(N||n)&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6 border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:n?"Edit Contact":"Add New Contact"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 icon-center",children:e.jsx(ee,{className:"tm-icon"})})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:x.name,onChange:s=>j({...x,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:x.email,onChange:s=>j({...x,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:x.phone,onChange:s=>j({...x,phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),e.jsx("input",{type:"text",value:x.position,onChange:s=>j({...x,position:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsx("input",{type:"text",value:x.department,onChange:s=>j({...x,department:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(I,{label:"Cancel",onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"}),e.jsx(I,{label:n?"Update Contact":"Add Contact",type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"})]})]})]}),e.jsx("div",{className:"space-y-4",children:E.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No contacts added yet"})]}):E.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(_,{className:"tm-icon text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),s.isPrimary&&e.jsx(se,{className:"tm-icon text-yellow-500"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[s.email&&e.jsx("p",{children:s.email}),s.phone&&e.jsx("p",{children:s.phone}),(s.position||s.department)&&e.jsx("p",{children:[s.position,s.department].filter(Boolean).join(", ")})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!s.isPrimary&&e.jsx("button",{onClick:()=>l(s.id||s._id),className:"text-yellow-500 hover:text-yellow-600 p-1 icon-center",title:"Set as primary contact",children:e.jsx(te,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>U(s),className:"text-blue-500 hover:text-blue-600 p-1 icon-center",title:"Edit contact",children:e.jsx(ae,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>a(s.id||s._id),className:"text-red-500 hover:text-red-600 p-1 icon-center",title:"Delete contact",children:e.jsx(Z,{className:"tm-icon"})})]})]},s.id||s._id))})]})},Le=({client:g})=>{const b=X(),N=G(),d=v.useRef(null),[n,y]=v.useState(!1),x=(g==null?void 0:g.documents)||[],j=t=>{if(!t)return e.jsx(O,{className:"tm-icon text-gray-400"});const s=t.toLowerCase();return s.includes("pdf")?e.jsx(O,{className:"tm-icon text-red-500"}):s.includes("image")?e.jsx(me,{className:"tm-icon text-green-500"}):s.includes("word")||s.includes("doc")?e.jsx(xe,{className:"tm-icon text-blue-500"}):s.includes("excel")||s.includes("xls")?e.jsx(he,{className:"tm-icon text-green-600"}):e.jsx(O,{className:"tm-icon text-gray-400"})},E=t=>Ie(t),D=async t=>{const s=Array.from(t.target.files);if(s.length!==0){y(!0);try{for(const i of s){const f=new FormData;f.append("document",i),f.append("entityType","CLIENT"),f.append("entityId",g.id);const h=L(),p=await fetch("/api/documents/upload",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:f});if(!p.ok)throw new Error(`Upload failed: ${p.status}`);const c=await p.json();await N(ce({clientId:g.id,document:{id:c.data.documentId,file_name:c.data.fileName,file_type:c.data.mimeType,file_size:c.data.fileSize,file_url:c.data.publicUrl,uploaded_at:new Date().toISOString()}})).unwrap()}g!=null&&g.id&&await N(M(g.id)).unwrap()}catch(i){console.error("Failed to upload document:",i),alert("Upload failed: "+i.message)}finally{y(!1),d.current&&(d.current.value="")}}},U=async t=>{try{const s=t.file_url||t.publicUrl;if(!s){alert("No file URL available");return}const i=K(s),f=L(),h=await fetch(i,{method:"GET",headers:f?{Authorization:`Bearer ${f}`}:{}});if(!h.ok)throw new Error(`Failed to download (${h.status})`);const p=await h.blob(),c=window.URL.createObjectURL(p),m=document.createElement("a");m.href=c,m.download=t.file_name||t.fileName||"document",document.body.appendChild(m),m.click(),document.body.removeChild(m),setTimeout(()=>window.URL.revokeObjectURL(c),5e3)}catch(s){console.error("Download failed",s),alert("Download failed: "+(s.message||s))}},a=async t=>{try{const s=t.file_url||t.publicUrl;if(!s){alert("No file URL available");return}const i=K(s),f=L(),h=await fetch(i,{method:"GET",headers:f?{Authorization:`Bearer ${f}`}:{}});if(!h.ok)throw new Error(`Failed to fetch document (${h.status})`);const p=await h.blob(),c=window.URL.createObjectURL(p);window.open(c,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(c),5e3)}catch(s){console.error("View failed",s),alert("Unable to open document: "+(s.message||s))}},l=async t=>{if(window.confirm("Are you sure you want to delete this document?"))try{await N(ue({clientId:g.id,documentId:t})).unwrap()}catch(s){console.error("Failed to delete document:",s)}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>b(-1),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 font-medium transition",title:"Go back to previous page",children:[e.jsx(q,{className:"tm-icon"}),"Back"]}),e.jsx("div",{className:"flex-1",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Documents"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"file",ref:d,onChange:D,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",className:"hidden"}),e.jsx(I,{label:n?"Uploading...":"Upload Documents",icon:e.jsx(W,{}),onClick:()=>{var t;return(t=d.current)==null?void 0:t.click()},disabled:n,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg disabled:opacity-50"})]})]}),e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(W,{className:"tm-icon mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg mb-2",children:"No documents uploaded yet"}),e.jsx("p",{className:"text-sm",children:'Click "Upload Documents" to add files'})]}):x.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[j(t.file_type||t.mimeType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.file_name||t.fileName||"Unnamed Document"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Type: ",t.file_type||t.mimeType||"Unknown"]}),t.file_size&&e.jsxs("p",{children:["Size: ",E(t.file_size)]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a(t),className:"text-blue-500 hover:text-blue-600 p-2 icon-center",title:"View document",children:e.jsx(oe,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>U(t),className:"text-green-500 hover:text-green-600 p-2 icon-center",title:"Download document",children:e.jsx(de,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>l(t.id||t.documentId||t._id),className:"text-red-500 hover:text-red-600 p-2 icon-center",title:"Delete document",children:e.jsx(Z,{className:"tm-icon"})})]})]},t.id||t.documentId||t._id))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Supported File Types"}),e.jsx("p",{className:"text-sm text-blue-700",children:"You can upload PDF, Word documents (.doc, .docx), Excel files (.xls, .xlsx), and images (.jpg, .jpeg, .png). Maximum file size: 10MB per file."})]})]})},Re=({client:g,projects:b=[],dashboard:N={}})=>{const d=v.useMemo(()=>{const l=[];return Array.isArray(b)&&b.forEach(t=>{Array.isArray(t.tasks)&&t.tasks.forEach(s=>{l.push({...s,projectName:t.name,projectId:t.id})})}),l},[b]),n=v.useMemo(()=>{const l=d.length,t=d.filter(m=>{var u,T;return((u=m.status)==null?void 0:u.toLowerCase())==="completed"||((T=m.stage)==null?void 0:T.toUpperCase())==="COMPLETED"}).length,s=d.filter(m=>{var u,T;return((u=m.status)==null?void 0:u.toLowerCase())==="pending"||((T=m.stage)==null?void 0:T.toUpperCase())==="PENDING"}).length,i=d.filter(m=>{var u,T;return((u=m.stage)==null?void 0:u.toUpperCase())==="IN PROGRESS"||((T=m.stage)==null?void 0:T.toUpperCase())==="IN_PROGRESS"}).length,f=d.filter(m=>{var u;return((u=m.priority)==null?void 0:u.toUpperCase())==="HIGH"}).length,h=d.filter(m=>{var u;return((u=m.priority)==null?void 0:u.toUpperCase())==="MEDIUM"}).length,p=d.filter(m=>{var u;return((u=m.priority)==null?void 0:u.toUpperCase())==="LOW"}).length,c=d.reduce((m,u)=>m+(u.time_alloted||u.estimated_hours||0),0);return{total:l,completed:t,pending:s,inProgress:i,highPriority:f,mediumPriority:h,lowPriority:p,totalHours:c}},[d]),y=v.useMemo(()=>b.map(l=>{const t=Array.isArray(l.tasks)?l.tasks:[],s=t.filter(h=>{var p,c;return((p=h.status)==null?void 0:p.toLowerCase())==="completed"||((c=h.stage)==null?void 0:c.toUpperCase())==="COMPLETED"}).length,i=t.filter(h=>{var p,c;return((p=h.status)==null?void 0:p.toLowerCase())==="pending"||((c=h.stage)==null?void 0:c.toUpperCase())==="PENDING"}).length,f=t.filter(h=>{var p,c;return((p=h.stage)==null?void 0:p.toUpperCase())==="IN PROGRESS"||((c=h.stage)==null?void 0:c.toUpperCase())==="IN_PROGRESS"}).length;return{name:l.name,id:l.id,totalTasks:t.length,completed:s,pending:i,inProgress:f,progressPercentage:t.length>0?Math.round(s/t.length*100):0}}),[b]),x=n.total>0,j=b.length>0,E=l=>{var i,f;const t=(i=l.status)==null?void 0:i.toLowerCase(),s=(f=l.stage)==null?void 0:f.toUpperCase();return t==="completed"||s==="COMPLETED"?"COMPLETED":t==="pending"||s==="PENDING"||s==="TODO"?"PENDING":s==="IN PROGRESS"||s==="IN_PROGRESS"?"IN_PROGRESS":"UNKNOWN"},D=v.useMemo(()=>{const l=d.filter(i=>E(i)==="PENDING").length,t=d.filter(i=>E(i)==="IN_PROGRESS").length,s=d.filter(i=>E(i)==="COMPLETED").length;return[{name:"To Do",value:l,color:"#F59E0B"},{name:"In Progress",value:t,color:"#38BDF8"},{name:"Completed",value:s,color:"#34D399"}]},[d]),U=v.useMemo(()=>[{name:"High",value:n.highPriority,color:"#FB7185"},{name:"Medium",value:n.mediumPriority,color:"#A78BFA"},{name:"Low",value:n.lowPriority,color:"#22C55E"}],[n]),a=v.useMemo(()=>y.map(l=>({name:l.name.substring(0,12),value:l.progressPercentage,color:"#8B5CF6"})),[y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Tasks"}),e.jsx("div",{className:"p-2 rounded-lg bg-sky-50",children:e.jsx(ge,{className:"w-5 h-5 text-sky-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:n.total}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Across ",b.length," projects"]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Completed"}),e.jsx("div",{className:"p-2 rounded-lg bg-emerald-50",children:e.jsx($,{className:"w-5 h-5 text-emerald-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:n.completed}),e.jsx("div",{className:"mt-3 bg-emerald-100 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full",style:{width:`${n.total>0?n.completed/n.total*100:0}%`}})})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"In Progress"}),e.jsx("div",{className:"p-2 rounded-lg bg-violet-50",children:e.jsx(F,{className:"w-5 h-5 text-violet-600"})})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:n.inProgress}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:[n.pending," pending"]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Total Hours"}),e.jsx("div",{className:"p-2 rounded-lg bg-amber-50",children:e.jsx(pe,{className:"w-5 h-5 text-amber-600"})})]}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[n.totalHours,"h"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Allocated time"})]})]}),x?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-sky-600"}),"Task Status Distribution"]}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsx(R,{type:"pie",data:D,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{font:{size:13},padding:15,usePointStyle:!0}}}}})})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-rose-500"}),"Priority Distribution"]}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsx(R,{type:"bar",data:U,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}})})]})]}):null,j&&a.length>0&&e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-violet-600"}),"Project Progress Overview"]}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsx(R,{type:"bar",data:a,options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"x",plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(l){return l+"%"},font:{size:11}}},x:{ticks:{font:{size:12}}}}}})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{label:"Completed",value:n.completed,icon:$,bgColor:"bg-emerald-50",textColor:"text-emerald-700",borderColor:"border-emerald-200"},{label:"In Progress",value:n.inProgress,icon:F,bgColor:"bg-sky-50",textColor:"text-sky-700",borderColor:"border-sky-200"},{label:"Pending",value:n.pending,icon:je,bgColor:"bg-amber-50",textColor:"text-amber-700",borderColor:"border-amber-200"}].map((l,t)=>{const s=l.icon;return e.jsxs("div",{className:P("p-4 rounded-xl border shadow-sm",l.bgColor,l.borderColor),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:P("text-sm font-medium",l.textColor),children:l.label}),e.jsx("div",{className:P("p-2 rounded-lg bg-white/70"),children:e.jsx(s,{className:P("w-4 h-4",l.textColor)})})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.value})]},t)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[N.assignedManager&&e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-violet-600"}),"Assigned Manager"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-violet-50 rounded-full flex items-center justify-center flex-shrink-0 border border-violet-100",children:e.jsx(J,{className:"w-8 h-8 text-violet-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900 text-lg",children:N.assignedManager.name}),e.jsx("p",{className:"text-sm text-slate-500",children:"Project Manager"})]})]})]}),e.jsxs("div",{className:"bg-white/90 backdrop-blur p-6 rounded-2xl shadow-sm border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-emerald-600"}),"Projects Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Projects"}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:b.length})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Total Tasks"}),e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:n.total})]})]})]})]}),!x&&e.jsxs("div",{className:"bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl p-12 text-center",children:[e.jsx(H,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Analytics Data Available"}),e.jsx("p",{className:"text-gray-600",children:"Tasks and projects assigned to this client will appear here with detailed visualizations"})]})]})},w={OVERVIEW:"overview",CONTACTS:"contacts",DOCUMENTS:"documents",ANALYTICS:"analytics"},Ge=()=>{const g=X(),b=ye(),N=b.clientId||b.id||b.clientId,d=G(),[n,y]=v.useState(w.OVERVIEW),x=we(r=>r.clients),{status:j,error:E,selectedClient:D,currentClient:U}=x||{},a=D||U||((x==null?void 0:x.clients)||[]).find(r=>((r==null?void 0:r.id)||(r==null?void 0:r._id)||(r==null?void 0:r.public_id)||(r==null?void 0:r.client_id))==N);v.useEffect(()=>{N&&d(M(N))},[N,d]);const l=(a==null?void 0:a.projects)||[],t=l.reduce((r,C)=>{const S=Array.isArray(C==null?void 0:C.tasks)?C.tasks:[];return r.total+=S.length,S.forEach(o=>{const k=(o.stage||"").toString().toUpperCase(),A=(o.status||"").toString().toUpperCase();(A==="COMPLETED"||k==="COMPLETED")&&(r.completed+=1),(A==="PENDING"||k==="PENDING"||k==="TODO")&&(r.pending+=1),(k==="IN PROGRESS"||k==="IN_PROGRESS")&&(r.inProgress+=1)}),r},{total:0,completed:0,pending:0,inProgress:0}),s=(a==null?void 0:a.dashboard)||{},i=s.projectCount??l.length,f=s.taskCount??t.total,h=s.completedTasks??t.completed,p=s.pendingTasks??t.pending,c=[{_id:"1",label:"TOTAL PROJECTS",total:i,icon:e.jsx(De,{}),bg:"bg-[#7c3aed]",thought:"Active Projects"},{_id:"2",label:"TOTAL TASKS",total:f,icon:e.jsx(Y,{}),bg:"bg-[#1d4ed8]",thought:"Assigned Overall"},{_id:"3",label:"COMPLETED TASKS",total:h,icon:e.jsx(Ue,{}),bg:"bg-[#0f766e]",thought:"Well Done"},{_id:"4",label:"PENDING TASKS",total:p,icon:e.jsx(F,{}),bg:"bg-[#f59e0b]",thought:"Remaining"}],m=({label:r,count:C,bg:S,icon:o,thought:k})=>e.jsxs("div",{className:"w-full h-32 bg-white p-5 shadow-md rounded-md flex items-center justify-between",children:[e.jsxs("div",{className:"h-full flex flex-1 flex-col justify-between",children:[e.jsx("p",{className:"text-base text-gray-600",children:r}),e.jsx("span",{className:"text-2xl font-semibold",children:C}),e.jsx("span",{className:"text-sm text-gray-400",children:k})]}),e.jsx("div",{className:P("w-10 h-10 rounded-full flex items-center justify-center text-white",S),children:o})]}),u=()=>{switch(n){case w.OVERVIEW:return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:c.map(({icon:r,bg:C,label:S,total:o,thought:k},A)=>e.jsx(m,{icon:r,bg:C,label:S,count:o,thought:k},A))}),s.assignedManager&&e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Assigned Manager"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(J,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.assignedManager.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manager"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Company"}),e.jsx("p",{className:"font-medium text-gray-900",children:(a==null?void 0:a.company)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-medium text-gray-900",children:(a==null?void 0:a.email)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"font-medium text-gray-900",children:(a==null?void 0:a.phone)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium text-gray-900",children:[a==null?void 0:a.district,a==null?void 0:a.state,a==null?void 0:a.pincode].filter(Boolean).join(", ")||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Projects & Tasks"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i," projects"]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No projects assigned yet"})]}):e.jsx("div",{className:"space-y-4",children:l.map((r,C)=>{const S=Array.isArray(r==null?void 0:r.tasks)?r.tasks:[];return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:r.name||"Untitled Project"}),e.jsx("p",{className:"text-xs text-gray-500",children:r.status||"Unknown Status"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[S.length," tasks"]})]}),S.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No tasks for this project"}):e.jsx("div",{className:"space-y-3",children:S.map((o,k)=>{var B,z,V;const A=Array.isArray(o.subtasks)?o.subtasks:[];return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:o.title||o.name||"Untitled Task"}),e.jsxs("div",{className:"flex gap-2",children:[o.priority&&e.jsx("span",{className:P("text-xs px-2 py-0.5 rounded",o.priority.toLowerCase()==="high"&&"bg-red-100 text-red-700",o.priority.toLowerCase()==="medium"&&"bg-yellow-100 text-yellow-700",o.priority.toLowerCase()==="low"&&"bg-green-100 text-green-700"),children:o.priority}),o.status&&e.jsx("span",{className:P("text-xs px-2 py-0.5 rounded",(o.status.toLowerCase()==="completed"||((B=o.stage)==null?void 0:B.toLowerCase())==="completed")&&"bg-green-100 text-green-700",(o.status.toLowerCase()==="in progress"||((z=o.stage)==null?void 0:z.toLowerCase())==="in progress")&&"bg-blue-100 text-blue-700",(o.status.toLowerCase()==="pending"||((V=o.stage)==null?void 0:V.toLowerCase())==="pending")&&"bg-gray-100 text-gray-700"),children:o.status})]})]}),o.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:o.description}),e.jsx("div",{className:"text-xs text-gray-500",children:A.length>0?e.jsxs("span",{children:[A.length," subtask",A.length!==1?"s":""]}):e.jsx("span",{children:"No subtasks"})})]},o.id||o.public_id||o._id||k)})})]},r.id||r.public_id||C)})})]})]});case w.CONTACTS:return e.jsx(Oe,{client:a,contacts:(a==null?void 0:a.contacts)||[]});case w.DOCUMENTS:return e.jsx(Le,{client:a,documents:(a==null?void 0:a.documents)||[]});case w.ANALYTICS:return e.jsx(Re,{client:a,tasks:(a==null?void 0:a.tasks)||[],projects:l,dashboard:s});default:return null}};if(j==="loading")return e.jsx("div",{children:"Loading..."});if(j==="failed")return e.jsxs("div",{children:["Error: ",E||"Failed to load dashboard"]});const T=()=>{N&&d(M(N))};return e.jsxs("div",{className:"h-full py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>g(-1),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 font-medium transition mb-4",title:"Go back to previous page",children:[e.jsx(q,{className:"tm-icon"}),"Back"]}),e.jsx(ve,{title:`Client: ${(a==null?void 0:a.name)||"..."}`,subtitle:"Client workspace overview",onRefresh:T,refreshing:j==="loading",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>y(w.OVERVIEW),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",n===w.OVERVIEW?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(Y,{className:"tm-icon"}),"Overview"]}),e.jsxs("button",{onClick:()=>y(w.CONTACTS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",n===w.CONTACTS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(Ce,{className:"tm-icon"}),"Contacts"]}),e.jsxs("button",{onClick:()=>y(w.DOCUMENTS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",n===w.DOCUMENTS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(O,{className:"tm-icon"}),"Documents"]}),e.jsxs("button",{onClick:()=>y(w.ANALYTICS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",n===w.ANALYTICS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(ke,{className:"tm-icon"}),"Analytics"]})]})})]}),u()]})};export{Ge as default};
