import{u as z,a as A,b,c as $,d as q,s as K,g as I,r as o,j as e,B as W,h as G,i as j,v as H}from"./index-DiCoRx4R.js";import{u as J}from"./index.esm-Cj1Qfi2w.js";import"./Textbox-cyjLHX8O.js";import{g as Q}from"./index-pGm2xic7.js";const se=()=>{var C,E;const w=z(),m=A(),{register:O,handleSubmit:L,setFocus:X,watch:Y,setValue:N}=J(),i=b($),k=b(q),F=b(K),x=b(t=>t.auth.tempToken),l=I(),h=((C=l==null?void 0:l.state)==null?void 0:C.tempToken)||((E=l==null?void 0:l.state)==null?void 0:E.temp)||null,[g,T]=o.useState(60),[y,D]=o.useState(!1),[c,v]=o.useState(["","","","","",""]),u=o.useRef([]),[S,p]=o.useState(null);o.useEffect(()=>{!x&&!h&&m("/log-in")},[x,h,m]),o.useEffect(()=>{let t;return g>0?t=setTimeout(()=>T(g-1),1e3):D(!0),()=>clearTimeout(t)},[g]);const B=(t,n)=>{var a;if(!/^\d*$/.test(n))return;const s=[...c];s[t]=n,v(s),n&&t<5&&((a=u.current[t+1])==null||a.focus()),N("otp",s.join(""))},P=(t,n)=>{var s;n.key==="Backspace"&&!c[t]&&t>0&&((s=u.current[t-1])==null||s.focus())},V=t=>{var s;t.preventDefault();const n=t.clipboardData.getData("text").slice(0,6);if(/^\d+$/.test(n)){const a=n.split(""),r=[...c];a.forEach((d,f)=>{f<6&&(r[f]=d)}),v(r),N("otp",r.join("")),(s=u.current[Math.min(a.length,5)])==null||s.focus()}},R=t=>{var a,r;const n=((r=(a=t&&(t.message||t.payload||t))==null?void 0:a.toString)==null?void 0:r.call(a))||String(t),s=n.toLowerCase();return s.includes("expired")||s.includes("otp expired")?"OTP expired — please resend and try the new code.":s.includes("invalid")||s.includes("invalid token")||s.includes("invalid otp")?"Invalid code — check the digits and try again.":s.includes("too many")||s.includes("attempts")?"Too many attempts — please wait a moment and request a new code.":n||"Failed to verify code"},M=async t=>{var a;const s={tempToken:x||h,otp:t.otp};p(null);try{const r=await w(H(s)).unwrap(),d=(r==null?void 0:r.user)||((a=r==null?void 0:r.data)==null?void 0:a.user)||null,f=Q(d||F);m(f,{replace:!0})}catch(r){const d=R(r);p(d),j.error(d)}},U=()=>{const t=x||h;p(null),w(G({tempToken:t})).unwrap().then(()=>{var n;j.success("A new verification code was sent"),T(60),D(!1),v(["","","","","",""]),(n=u.current[0])==null||n.focus()}).catch(n=>{const s=R(n);p(s),j.error(s)})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl shadow-lg mb-6",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Two-Factor Verification"}),e.jsx("p",{className:"text-gray-600",children:"We've sent a verification code to your email"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Enter the 6-digit code to continue"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-200",children:e.jsxs("form",{onSubmit:L(M),className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-4 text-center",children:"Enter verification code"}),e.jsx("div",{className:"flex justify-center gap-3 mb-2",children:c.map((t,n)=>e.jsx("input",{ref:s=>u.current[n]=s,type:"text",inputMode:"numeric",maxLength:"1",value:t,onChange:s=>B(n,s.target.value),onKeyDown:s=>P(n,s),onPaste:V,className:"w-14 h-14 text-2xl font-bold text-center bg-gray-50 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all duration-200",disabled:i==="loading",autoFocus:n===0},n))}),e.jsx("input",{type:"hidden",...O("otp",{required:"Verification code is required",validate:t=>t.length===6||"Please enter all 6 digits"})})]}),(S||i==="failed"&&k)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-red-700 text-sm",children:S||k})]})}),e.jsx(W,{type:"submit",disabled:i==="loading"||c.join("").length!==6,className:`w-full py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-200 ${i==="loading"||c.join("").length!==6?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl"}`,children:i==="loading"?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-3"}),"Verifying..."]}):"Verify & Continue"}),e.jsx("div",{className:"pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:y?"Didn't receive the code?":e.jsxs(e.Fragment,{children:["Resend code in"," ",e.jsxs("span",{className:"font-bold text-blue-600",children:["0:",g.toString().padStart(2,"0")]})]})}),e.jsx("button",{type:"button",onClick:U,disabled:!y||i==="loading",className:`text-sm font-medium transition-colors duration-200 ${y?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,children:"Resend verification code"})]})})]})}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"This extra step shows it's really you trying to sign in"}),e.jsx("button",{type:"button",onClick:()=>m("/log-in"),className:"mt-4 text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200",children:"← Back to login"})]})]})})};export{se as default};
