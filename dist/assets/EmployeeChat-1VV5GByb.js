import{b as x,r as i,H as g,i as u,j as o}from"./index-CT2igMlm.js";import{C as k,a as S,b as C,c as I}from"./ChatStates-Dk_kPiab.js";import"./index-pGm2xic7.js";const b=()=>{const{user:t}=x(e=>e.auth),[r,m]=i.useState([]),[d,j]=i.useState(null),[y,h]=i.useState(!0),l=i.useCallback(async()=>{try{h(!0);let e=[];try{const s=await g("api/employee/my-tasks");s!=null&&s.success&&(s!=null&&s.data)&&s.data.length>0&&(e=s.data)}catch{const n=[`api/tasks?assigned_to=${t==null?void 0:t.id}`,`api/tasks?assignedTo=${t==null?void 0:t.id}`,`api/tasks?user_id=${t==null?void 0:t.id}`,`api/tasks?userId=${t==null?void 0:t.id}`,`api/tasks?employee_id=${t==null?void 0:t.id}`,"api/employee/tasks"];for(const c of n)try{const a=await g(c);if(a!=null&&a.success&&(a!=null&&a.data)&&a.data.length>0){e=a.data;break}}catch{continue}}if(e&&e.length>0){const s=new Map;e.forEach(c=>{if(c.project){const a=c.project.publicId||c.project.id,f=c.project.name||c.project.title||"Unknown Project";a&&!s.has(a)&&s.set(a,{id:a,_id:a,name:f,title:f})}});const n=Array.from(s.values());m(n),n.length>0&&j(n[0].id)}else console.warn("No tasks found for employee"),m([])}catch(e){console.error("Error fetching projects:",e),u.error((e==null?void 0:e.message)||"Failed to load projects")}finally{h(!1)}},[t==null?void 0:t.id]);if(i.useEffect(()=>{t!=null&&t.id&&l()},[t==null?void 0:t.id,l]),y)return o.jsx(k,{});if(!r.length)return o.jsx(S,{title:"No projects found",description:"You haven't been assigned to any projects yet.",helperText:"Once tasks are assigned to you, you'll see chat channels here."});const p=r.find(e=>(e._id||e.id)===d);return o.jsx(C,{title:"Team Communication",projects:r,selectedProjectId:d,onSelectProject:j,onRefresh:l,user:t,children:p?o.jsx(I,{projectId:d,projectName:p.name||p.title,authToken:localStorage.getItem("tm_access_token"),currentUserId:(t==null?void 0:t._id)||(t==null?void 0:t.id),currentUserName:t==null?void 0:t.name}):o.jsx("div",{className:"flex items-center justify-center h-full",children:o.jsxs("div",{className:"text-center",children:[o.jsx(MessageCircle,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),o.jsx("p",{className:"text-gray-500",children:"Select a project to start chatting"})]})})})};export{b as default};
