import{r as l,b as ue,s as pe,a$ as b,ce as ee,cf as se,u as be,j as e,G as ye,an as je,cg as fe,a3 as f,H as Ne,i as d}from"./index-7TXHU69M.js";const{Settings:te,Database:ae,ShieldCheck:$,Bell:re,Globe2:ie,KeyRound:ne,Save:ve,Loader2:A,CheckCircle2:H,XCircle:le,QrCode:we,Smartphone:Se,AlertTriangle:M,History:ke,Copy:q}=ye,Ce=()=>{const[i,N]=l.useState(!1),[h,g]=l.useState(!1),[v,y]=l.useState("initial"),[T,R]=l.useState(""),[w,S]=l.useState(""),[x,O]=l.useState(""),[o,_]=l.useState([]),B=async()=>{try{const a=await f("/api/auth/2fa/status",{method:"GET"});N((a==null?void 0:a.enabled)||!1)}catch(a){console.error("Failed to check 2FA status:",a)}},I=async()=>{try{g(!0);const a=await f("/api/auth/2fa/setup",{method:"POST"});a!=null&&a.qrCode&&(a!=null&&a.secret)&&(R(a.qrCode),S(a.secret),y("setup"),d.success("Scan QR code to set up 2FA"))}catch(a){d.error(a.message||"Failed to setup 2FA")}finally{g(!1)}},V=async()=>{if(!x||x.length!==6){d.error("Please enter a valid 6-digit code");return}try{g(!0);const a=await f("/api/auth/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:x,secret:w})});if(a!=null&&a.success){const u=await f("/api/auth/2fa/backup-codes",{method:"GET"});_((u==null?void 0:u.codes)||[]),y("backup"),N(!0),d.success("2FA enabled successfully!")}}catch(a){d.error(a.message||"Verification failed")}finally{g(!1)}},U=async()=>{if(window.confirm("Are you sure you want to disable 2FA? This will reduce your account security."))try{g(!0),await f("/api/auth/2fa/disable",{method:"POST"}),N(!1),y("initial"),d.success("2FA disabled successfully")}catch(a){d.error(a.message||"Failed to disable 2FA")}finally{g(!1)}},F=a=>{navigator.clipboard.writeText(a),d.success("Copied to clipboard!")},P=()=>{const a=o.join(`
`),u=new Blob([a],{type:"text/plain"}),E=URL.createObjectURL(u),p=document.createElement("a");p.href=E,p.download="2fa-backup-codes.txt",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(E),d.success("Backup codes downloaded")};return l.useEffect(()=>{B()},[]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Add an extra layer of security using TOTP authenticator apps"})]})]}),e.jsx("div",{className:`px-4 py-2 rounded-full text-sm font-medium ${i?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-800 border border-gray-200"}`,children:i?"Enabled":"Disabled"})]}),v==="initial"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-lg shadow-sm",children:e.jsx($,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Enhanced Account Security"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Two-factor authentication adds an extra layer of security to your account. When enabled, you'll need to enter both your password and a verification code from an authenticator app when signing in."}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsx(M,{className:"text-yellow-500"}),e.jsx("span",{children:"Recommended for all accounts with sensitive data"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded",children:e.jsx(Se,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"Authenticator Apps"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Use Google Authenticator, Authy, Microsoft Authenticator, or any TOTP-compatible app"})]}),e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded",children:e.jsx(H,{className:"w-5 h-5 text-green-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"How It Works"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["1. Scan QR code",e.jsx("br",{}),"2. Enter 6-digit code",e.jsx("br",{}),"3. Save backup codes"]})]}),e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded",children:e.jsx(we,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"Always Available"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Works offline - no SMS or email required. Codes refresh every 30 seconds."})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-gray-200",children:[i?e.jsx("button",{onClick:U,disabled:h,className:"inline-flex items-center gap-2 px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),"Disabling..."]}):"Disable 2FA"}):e.jsx("button",{onClick:I,disabled:h,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),"Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),"Enable 2FA"]})}),e.jsx("button",{className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Learn More About 2FA"})]})]}),v==="setup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Complete setup within 5 minutes"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The QR code will expire. If it does, you'll need to start the setup process again."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Step 1: Scan QR Code"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-6 flex items-center justify-center",children:T?e.jsx("img",{src:T,alt:"2FA QR Code",className:"w-64 h-64"}):e.jsx("div",{className:"w-64 h-64 bg-gray-100 rounded flex items-center justify-center",children:e.jsx(A,{className:"w-8 h-8 text-gray-400 animate-spin"})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Step 2: Enter Verification Code"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:x,onChange:a=>O(a.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none text-center text-2xl tracking-widest",maxLength:6}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enter the 6-digit code from your authenticator app"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:V,disabled:h||x.length!==6,className:"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin inline mr-2"}),"Verifying..."]}):"Verify and Enable"}),e.jsx("button",{onClick:()=>y("initial"),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Setup Instructions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Install Authenticator App"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Install Google Authenticator, Authy, Microsoft Authenticator, or any TOTP app on your phone."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Scan QR Code"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Open your authenticator app and scan the QR code above, or enter the secret key manually."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Enter Code"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Enter the 6-digit code from your authenticator app in the verification field."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Save Backup Codes"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"After verification, you'll receive backup codes. Save them in a secure place."})]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Can't scan QR code?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Enter this secret key manually in your app:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-gray-100 px-3 py-2 rounded text-sm font-mono break-all",children:w}),e.jsx("button",{onClick:()=>F(w),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors",title:"Copy secret key",children:e.jsx(q,{})})]})]})]})]})]}),v==="backup"&&o.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Two-Factor Authentication Enabled Successfully!"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your account is now protected with 2FA. Please save your backup codes."})]})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Backup Codes"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Save these codes in a secure place. Each code can be used once if you lose access to your authenticator app."})]}),e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(q,{}),"Download Codes"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:o.map((a,u)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center font-mono",children:a},u))}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800",children:"Important Security Notice"}),e.jsxs("ul",{className:"text-sm text-red-700 mt-1 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Save these codes in a secure, offline location"}),e.jsx("li",{children:"Do not store them in plain text files or emails"}),e.jsx("li",{children:"Each code can only be used once"}),e.jsx("li",{children:"Generate new codes if you lose them"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>F(o.join(`
`)),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(q,{}),"Copy All Codes"]}),e.jsx("button",{onClick:()=>y("initial"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Done"})]})]})]})]})},Fe=()=>{var K,z,X;const[i,N]=l.useState(null),[h,g]=l.useState(!0),[v,y]=l.useState(null),[T,R]=l.useState(!1),[w,S]=l.useState(null),[x,O]=l.useState("general"),o=ue(pe);l.useEffect(()=>{try{const s=b(),t=ee();console.debug("[Settings] tokens:",{access:s?"present":null,refresh:t?"present":null}),s&&se(s,t||null,"local")}catch(s){console.warn("Settings token diagnostic failed",s)}},[]);const[_,B]=l.useState(!1),[I,V]=l.useState([]),[U,F]=l.useState(!1),[P,a]=l.useState(null),u=be(),E=async()=>{try{g(!0);const s=((o==null?void 0:o.role)||"").toString().toLowerCase();let t="/api/admin/settings";s.includes("manager")?t="/api/manager/settings":s.includes("employee")?t="/api/employee/settings":s.includes("client")&&(t="/api/client/settings");const r=await f(t,{method:"GET"});N((r==null?void 0:r.data)||r||{}),y(null)}catch(s){y(s.message||"Failed to load settings")}finally{g(!1)}};l.useEffect(()=>{E()},[]);const p=async()=>{try{F(!0),a(null);const s=((o==null?void 0:o.role)||"").toLowerCase();let t="/api/employee/audit-logs?limit=25&page=1";s==="admin"?t="/api/admin/audit-logs?limit=25&page=1":s==="manager"&&(t="/api/manager/audit-logs?limit=25&page=1");const r=await Ne(t.replace(/^\//,"")),n=(r==null?void 0:r.data)??r,L=Array.isArray(n==null?void 0:n.logs)?n.logs:Array.isArray(n)?n:[];V(L)}catch(s){console.error("Failed to load audit logs",s),a(s.message||"Failed to load audit logs")}finally{F(!1)}};l.useEffect(()=>{p()},[o]);const k=(s,t,r)=>{N(n=>({...n,[s]:{...n[s],[t]:r}}))},ce=async()=>{try{R(!0),S(null);const s=((o==null?void 0:o.role)||"").toString().toLowerCase();let t="/api/admin/settings";s.includes("manager")?t="/api/manager/settings":s.includes("employee")?t="/api/employee/settings":s.includes("client")&&(t="/api/client/settings"),await f(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),S("success"),d.success("Settings saved successfully!"),setTimeout(()=>S(null),3e3)}catch(s){S("error"),d.error(s.message||"Failed to save settings")}finally{R(!1)}},C=({title:s,icon:t,children:r,sectionKey:n})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6 overflow-hidden",children:[e.jsxs("button",{onClick:()=>O(x===n?null:n),className:"w-full flex items-center justify-between p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(t,{className:"text-blue-600 w-5 h-5"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transform transition-transform ${x===n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),x===n&&e.jsx("div",{className:"px-6 pb-6 border-t border-gray-100",children:r})]}),D=({checked:s,onChange:t,label:r,description:n})=>e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r}),n&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:n})]}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${s?"bg-blue-600":"bg-gray-300"}`,onClick:()=>t(!s),children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s?"translate-x-6":"translate-x-1"}`})})]}),J=({label:s,value:t,onChange:r,type:n="text",placeholder:L,description:G})=>e.jsxs("div",{className:"space-y-2 py-4 border-b border-gray-100 last:border-b-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:s}),G&&e.jsx("p",{className:"text-sm text-gray-500",children:G}),e.jsx("input",{type:n,value:t||"",onChange:W=>r(W.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:L})]});return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-4 md:p-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-64 mb-6"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((s,t)=>e.jsx("div",{className:"h-48 bg-gray-300 rounded-lg"},t))})]})})}):v?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-8 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-8",children:[e.jsx(le,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error Loading Settings"}),e.jsx("p",{className:"text-red-600",children:v}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(je,{title:"System Settings",subtitle:"Configure your system preferences and security settings",onRefresh:()=>{E(),p()},refreshing:h||U,children:e.jsxs("div",{className:"flex flex-col items-end gap-3 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2",children:["Token status: ",e.jsx("strong",{children:b()?"Present":"Missing"})]}),b()&&e.jsxs("div",{className:"mb-2 text-xs text-gray-500",children:["Token: ",_?b():b()?`${b().slice(0,8)}...${b().slice(-6)}`:""]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx("button",{onClick:()=>{const s=b(),t=ee();s?(se(s,t||null,"local"),console.debug("[Settings] reattached token to axios defaults")):console.warn("[Settings] no access token found to attach")},className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded text-sm",children:"Reattach Token"}),b()&&e.jsx("button",{onClick:()=>B(s=>!s),className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded text-sm",children:_?"Hide Token":"Show Token"}),e.jsx("button",{onClick:()=>u(fe()),className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded text-sm",children:"Refresh Token"}),e.jsx("button",{onClick:()=>p(),className:"px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700",children:"Retry Audit Fetch"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[w==="success"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Saved!"})]}),w==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:"Failed to save"})]}),e.jsx("button",{onClick:ce,disabled:T,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:T?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4"}),"Save Changes"]})})]})]})}),e.jsx(Ce,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Settings Sections"}),e.jsx("nav",{className:"space-y-2",children:[{key:"general",label:"General Settings",icon:te},{key:"database",label:"Database Config",icon:ae},{key:"security",label:"Security",icon:$},{key:"notifications",label:"Notifications",icon:re},{key:"api",label:"API Settings",icon:ie}].map(s=>e.jsxs("button",{onClick:()=>O(s.key),className:`w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${x===s.key?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(s.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.key))}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Settings Version"}),e.jsxs("p",{className:"text-sm",children:["v",(i==null?void 0:i.version)||"1.0.0"]})]})]})})]})}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(C,{title:"General Settings",icon:te,sectionKey:"general",children:e.jsx("div",{className:"space-y-1",children:Object.entries((i==null?void 0:i.general)||{}).map(([s,t])=>e.jsx(J,{label:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),value:t,onChange:r=>k("general",s,r)},s))})}),e.jsx(C,{title:"Database Configuration",icon:ae,sectionKey:"database",children:e.jsx("div",{className:"space-y-1",children:Object.entries((i==null?void 0:i.database)||{}).map(([s,t])=>e.jsx("div",{className:"py-4 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t?"Active":"Inactive"})]})},s))})}),e.jsx(C,{title:"Security Settings",icon:$,sectionKey:"security",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(D,{checked:((K=i==null?void 0:i.security)==null?void 0:K.password_expiry)||!1,onChange:s=>k("security","password_expiry",s),label:"Password Expiry",description:"Require users to change passwords periodically"}),e.jsx(D,{checked:((z=i==null?void 0:i.security)==null?void 0:z.login_notifications)||!1,onChange:s=>k("security","login_notifications",s),label:"Login Notifications",description:"Send email notifications for new logins"}),e.jsx(D,{checked:((X=i==null?void 0:i.security)==null?void 0:X.session_timeout)||!1,onChange:s=>k("security","session_timeout",s),label:"Session Timeout",description:"Automatically log out inactive users"})]})}),e.jsx(C,{title:"Notification Settings",icon:re,sectionKey:"notifications",children:e.jsx("div",{className:"space-y-1",children:Object.entries((i==null?void 0:i.notifications)||{}).map(([s,t])=>e.jsx(D,{checked:t,onChange:r=>k("notifications",s,r),label:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase())},s))})}),e.jsx(C,{title:"API Settings",icon:ie,sectionKey:"api",children:e.jsx("div",{className:"space-y-4",children:Object.entries((i==null?void 0:i.api)||{}).map(([s,t])=>e.jsx(J,{label:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),value:t,onChange:r=>k("api",s,r),type:s.toLowerCase().includes("key")||s.toLowerCase().includes("secret")?"password":"text"},s))})}),e.jsx(C,{title:"Audit Logs",icon:ke,sectionKey:"auditLogs",children:e.jsx("div",{className:"space-y-3",children:U?e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsx(A,{className:"animate-spin"}),"Loading audit logs..."]}):P?e.jsx("div",{className:"text-sm text-red-600",children:P}):I.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No audit logs available."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"px-3 py-2",children:"Time"}),e.jsx("th",{className:"px-3 py-2",children:"Actor"}),e.jsx("th",{className:"px-3 py-2",children:"Action"}),e.jsx("th",{className:"px-3 py-2",children:"Entity"}),e.jsx("th",{className:"px-3 py-2",children:"Details"}),e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:I.slice(0,100).map((s,t)=>{const r=s.id||s._id||t,n=s.timestamp||s.created_at||s.time||s.date||"",L=s.actor||s.user&&(s.user.name||s.user.email)||s.username||"",G=s.action||s.verb||"",W=s.entity||s.resource||"",m=s.details||{},j=(m==null?void 0:m.file_url)||(m==null?void 0:m.url)||(m==null?void 0:m.fileUrl),Q=c=>c==null?"":typeof c=="string"?c:typeof c=="number"||typeof c=="boolean"?String(c):typeof c=="object"?c.name||c.title||c.id||c._id||JSON.stringify(c):String(c),oe=Q(n),de=Q(L),xe=Q(G),me=Q(W);return e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:oe}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:de}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:xe}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:me}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:JSON.stringify(m)}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:e.jsx("div",{className:"flex items-center gap-2",children:j&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{try{const c=localStorage.getItem("accessToken")||localStorage.getItem("tm_access_token"),he=localStorage.getItem("tenantId")||"default";if((j.startsWith(window.location.origin)||j.startsWith("/"))&&c){const Y=await fetch(j,{headers:{Authorization:`Bearer ${c}`,"x-tenant-id":he}});if(Y.ok){const ge=await Y.blob(),Z=window.URL.createObjectURL(ge);window.open(Z,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(Z),1e4);return}}window.open(j,"_blank")}catch(c){console.error("Preview audit file error",c),window.open(j,"_blank")}},className:"text-blue-600 hover:underline text-sm",children:"Preview"}),e.jsx("a",{href:j,target:"_blank",rel:"noreferrer",className:"text-gray-600 text-sm",children:"Download"})]})})})]},r)})})]})})})})]})]})]})})};export{Fe as default};
