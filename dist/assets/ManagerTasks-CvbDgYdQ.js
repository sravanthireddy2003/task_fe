import{u as Oe,b as Me,s as Le,r as l,a4 as D,e as g,ap as Re,j as e,ao as He,G as Fe}from"./index-CV0oviIo.js";import{b as x,g as T}from"./taskHelpers-CsgoO_-X.js";import{V as $e}from"./ViewToggle-CoYvpou8.js";import{C as fe}from"./Card-uFx0Sqpg.js";const{RefreshCw:I,AlertCircle:H,Calendar:je,User:F,Plus:qe,Filter:Ge,Lock:ye,Clock:Ne,AlertTriangle:Ke,CheckCircle:Ve}=Fe,ts=()=>{var be;const Y=Oe(),$=Me(Le);$!=null&&$.resources;const[p,A]=l.useState([]),[f,q]=l.useState(!0),[Z,U]=l.useState(null),[h,ve]=l.useState([]),[ee,se]=l.useState(!0),[We,te]=l.useState([]),[ze,ae]=l.useState(!1),[Je,Be]=l.useState(!1),[d,j]=l.useState({title:"",description:"",priority:"MEDIUM",stage:"TODO",taskDate:"",assignedUsers:[],projectId:"",timeAlloted:8}),[G,re]=l.useState(!1),[n,le]=l.useState(""),[a,v]=l.useState(null),[_,we]=l.useState([]),[Qe,ne]=l.useState(!0),[w,ie]=l.useState(""),[K,de]=l.useState(!1),[Ce,E]=l.useState(!1),[O,ke]=l.useState("all"),[V,De]=l.useState("list"),[ce,oe]=l.useState(!1),[u,W]=l.useState(null),[b,z]=l.useState(!1),xe=["TODO","IN_PROGRESS","REVIEW","COMPLETED","ON_HOLD"],M=s=>s?s.public_id||s.id||s._id||s.internalId||s.project_id:null,k=s=>{var t;return s?s.name||s.title||`Project ${(t=M(s))==null?void 0:t.slice(0,8)}...`:"Unknown Project"},Ae=s=>{var t;return s&&(((t=s.client)==null?void 0:t.name)||s.client_name)||"No Client"},L=s=>{if(!s)return"Unknown";const t=s.status||s.project_status;return{ACTIVE:"Active",IN_PROGRESS:"In Progress",COMPLETED:"Completed",ON_HOLD:"On Hold",PENDING:"Pending",active:"Active",in_progress:"In Progress",completed:"Completed",on_hold:"On Hold",pending:"Pending"}[t]||t||"Unknown"},_e=s=>!s||s.length===0?{valid:!1,error:"Task must be assigned to one employee"}:s.length>1?{valid:!1,error:"Only one employee can be assigned to a task"}:{valid:!0,error:null},S=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",Ee=s=>s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",me=s=>Array.isArray(s.assignedUsers)&&s.assignedUsers.length?s.assignedUsers.map(t=>t.name).join(", "):Array.isArray(s.assigned_to)&&s.assigned_to.length?s.assigned_to.join(", "):"Unassigned",R=l.useMemo(()=>O==="all"?p:p.filter(s=>{const t=x(s).toUpperCase(),r=O.toUpperCase();return t===r}),[p,O]),J=()=>{const s={pending:0,in_progress:0,completed:0,on_hold:0,request_approved:0,locked:0};return p.forEach(t=>{const r=x(t).toLowerCase();r==="request approved"?s.request_approved++:r==="locked"?s.locked++:s.hasOwnProperty(r)&&s[r]++}),s},C=l.useCallback(async(s="")=>{if(!s){A([]),U(null),z(!1),q(!1);return}q(!0),z(!1);try{const t=await D(`/api/tasks?projectId=${encodeURIComponent(s)}`);if(t&&t.success===!1&&t.message&&(t.message.includes("Project is closed")||t.message.includes("Tasks are locked"))){z(!0),U(t.message),A([]),v(null);return}if(t&&t.error)throw t.error.includes("assigned_to")&&console.warn("Backend assignment error:",t.error),new Error(t.error||"Failed to load tasks");const r=Array.isArray(t==null?void 0:t.data)?t.data:[],m=h.find(c=>[c.public_id,c.id,c._id,c.internalId,c.project_id].includes(s)),i=r.map(c=>!c.project_id&&!c.projectId&&!c.project?{...c,project_id:s,projectId:s,project:m||{name:k(m),id:s}}:c);A(i),U(null)}catch(t){U(t.message||"Failed to load tasks for the project"),g.error(t.message||"Failed to load tasks")}finally{q(!1)}},[h]),ge=l.useCallback(async()=>{ne(!0);try{const s=await D("/api/manager/employees/all"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;we(Array.isArray(t)?t:[])}catch{}finally{ne(!1)}},[]),ue=l.useCallback(async()=>{se(!0);try{const s=await D("/api/manager/projects"),t=Array.isArray(s==null?void 0:s.data)?s.data:s,m=(Array.isArray(t)?t:[]).filter(i=>{var c;return!((c=i.project_status_info)!=null&&c.is_closed)});ve(m)}catch{g.error("Failed to load projects")}finally{se(!1)}},[]),Se=l.useCallback(async()=>{ae(!0);try{const s=await Y(Re("MANAGER")).unwrap(),t=(s==null?void 0:s.approvals)||(s==null?void 0:s.data)||[];te(Array.isArray(t)?t:[])}catch(s){console.error("Failed to load pending approvals:",s),te([])}finally{ae(!1)}},[Y]),B=l.useCallback(s=>{if(!s||h.length===0){W(null);return}const t=h.find(r=>[r.public_id,r.id,r._id,r.internalId,r.project_id].some(i=>i&&i.toString()===s.toString()))||null;W(t)},[h]);l.useEffect(()=>{if(h.length>0&&!n){const s=h[0],t=M(s);t&&le(t)}},[h]),l.useEffect(()=>{ue(),Se()},[ue]),l.useEffect(()=>{n&&(C(n),B(n))},[C,n,B]),l.useEffect(()=>{v(null)},[n]),l.useEffect(()=>{ge()},[ge]);const pe=s=>{le(s),v(null),A([]),s?B(s):W(null)},Pe=async s=>{var r,m,i,c,y;if(s.preventDefault(),!d.title||!n){g.error("Title and project are required");return}const t=_e(d.assignedUsers);if(!t.valid){g.error(t.error);return}re(!0);try{const o=h.find(P=>[P.public_id,P.id,P._id,P.internalId,P.project_id].includes(n)),X=d.assignedUsers[0],Ie={title:d.title,description:d.description,priority:d.priority,stage:d.stage,taskDate:d.taskDate?new Date(d.taskDate).toISOString():void 0,timeAlloted:Number(d.timeAlloted)||0,projectId:n,client_id:((r=o==null?void 0:o.client)==null?void 0:r.public_id)||((m=o==null?void 0:o.client)==null?void 0:m.id)||(o==null?void 0:o.client_id),assigned_to:X},N=await D("api/projects/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ie)});if(N&&N.error){if(N.error.includes("assigned_to")&&N.error.includes("exactly one")){g.error("Error: Task must be assigned to exactly one user");return}throw new Error(N.error||"Unable to create task")}const Ue=(N==null?void 0:N.message)||"Task created successfully";g.success(Ue),j({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:n}),E(!1),C(n)}catch(o){if(console.error("Error creating task:",o),o.response&&o.response.message&&o.response.message.includes("successfully"))g.success(o.response.message||"Task created successfully"),j({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:n}),E(!1),C(n);else{const X=((c=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:c.message)||(o==null?void 0:o.message)||((y=o==null?void 0:o.data)==null?void 0:y.message)||"Unable to create task";g.error(X)}}finally{re(!1)}},he=()=>{if(!n){g.error("Please select a project first");return}E(!0)},Q=async s=>{if(!s)return;const t=s.id||s.public_id||s._id||s.internalId;if(!t){v(s);return}oe(!0);try{const r=await D("/api/tasks/selected-details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:[t]})});if(r&&r.error)throw new Error(r.error||"Failed to fetch task details");const m=(r==null?void 0:r.data)??r,i=Array.isArray(m)?m[0]:m;v(i||s)}catch(r){console.error("Failed to load task details:",r),g.error((r==null?void 0:r.message)||"Failed to load task details"),v(s)}finally{oe(!1)}},Te=async()=>{var t,r,m;if(!a||!w)return;const s=a.id||a.public_id||a._id;if(!s){g.error("Task ID not found");return}de(!0);try{const i=await D(`/api/tasks/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({assigned_to:w})});if(i&&i.error)throw new Error(i.error||"Failed to reassign task");g.success("Task reassigned successfully"),A(c=>c.map(y=>(y.id||y.public_id||y._id)===s?{...y,assigned_to:[w]}:y)),a&&(a.id||a.public_id||a._id)===s&&v(c=>c?{...c,assigned_to:[w]}:null),ie(""),n&&C(n)}catch(i){console.error("Failed to reassign task:",i);const c=((r=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:r.message)||(i==null?void 0:i.message)||((m=i==null?void 0:i.data)==null?void 0:m.message)||"Failed to reassign task";g.error(c)}finally{de(!1)}};return e.jsxs("div",{className:"p-8 bg-gray-50 min-h-screen",children:[e.jsx(He,{title:"Tasks",subtitle:"Manage and track all your tasks",onRefresh:()=>n&&C(n),refreshing:f,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n||"",onChange:s=>pe(s.target.value),disabled:ee,className:"border border-gray-300 rounded-lg px-4 py-2 pr-8 bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none min-w-[200px]",children:[e.jsx("option",{value:"",children:"Select a project"}),h.map(s=>{const t=M(s),r=k(s);return e.jsx("option",{value:t,children:r},t)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),e.jsx($e,{mode:V,onChange:De,className:"ml-1"}),n&&!f&&Array.isArray(p)&&p.length>0&&e.jsxs("button",{onClick:he,disabled:!n||f||b,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${!n||f||b?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[b?e.jsx(ye,{className:"tm-icon"}):e.jsx(qe,{className:"tm-icon"}),b?"Locked":"Add Task"]})]})}),f&&n&&e.jsxs("div",{className:"flex items-center justify-center p-4 mb-6 bg-blue-50 rounded-lg",children:[e.jsx(I,{className:"tm-icon mr-2 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Loading tasks..."})]}),(Z||b)&&!f&&e.jsxs("div",{className:"flex items-start gap-3 p-4 mb-6 bg-red-50 border border-red-200 rounded-xl text-red-800 animate-fadeIn",children:[e.jsx(Ke,{className:"tm-icon-md flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:b?"Project Locked":"Error"}),e.jsx("p",{className:"text-red-700 mt-1",children:Z}),b&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"This project is currently closed or pending approval. Creating or modifying tasks is disabled."})]})]}),n&&u&&e.jsx("div",{className:"bg-white rounded-xl border p-6 mb-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("div",{className:"text-blue-600 font-bold text-lg",children:k(u).charAt(0)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:k(u)}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"tm-icon text-gray-500"}),e.jsxs("span",{className:"text-gray-700",children:["Client: ",e.jsx("span",{className:"font-medium",children:Ae(u)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${L(u)==="Active"||L(u)==="In Progress"?"bg-green-500":L(u)==="Completed"?"bg-blue-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-gray-700",children:["Status: ",e.jsx("span",{className:"font-medium",children:L(u)})]})]})]})]})]}),u.description&&e.jsx("p",{className:"text-gray-600 mb-4",children:u.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:p.length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:J().pending})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:J().in_progress})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:J().completed})]})]})]}),e.jsx("div",{className:"flex flex-col gap-3 md:w-auto w-full"})]})}),n&&p.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"tm-icon text-gray-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Filters:"})]}),e.jsxs("select",{value:O,onChange:s=>ke(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:f,children:[e.jsx("option",{value:"all",children:"All Status"}),xe.map(s=>e.jsx("option",{value:s,children:T(s)},s)),e.jsx("option",{value:"Request Approved",children:"Request Approved"}),e.jsx("option",{value:"LOCKED",children:"Locked"})]})]}),!n&&!ee&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(H,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Project"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please select a project from the dropdown above to view and manage tasks."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:h.slice(0,5).map(s=>{const t=M(s),r=k(s);return e.jsx("button",{onClick:()=>pe(t),className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",children:r},t)})})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:`${a?"lg:w-3/5":"flex-1"}`,children:[n&&!f&&p.length===0&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(H,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Tasks Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No tasks found for this project. Create your first task or try refreshing."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:he,disabled:b,className:`px-4 py-2 rounded-lg transition-colors flex items-center gap-2 ${b?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[b?e.jsx(ye,{className:"tm-icon"}):null,b?"Project Locked":"Create First Task"]}),e.jsx("button",{onClick:()=>C(n),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors border border-gray-300",children:"Refresh"})]})]}),n&&!f&&p.length>0&&V==="list"&&e.jsx("div",{className:"tm-list-container",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left",children:"Task"}),e.jsx("th",{className:"p-4 text-left",children:"Assigned To"}),e.jsx("th",{className:"p-4 text-left",children:"Status"}),e.jsx("th",{className:"p-4 text-left",children:"Priority"}),e.jsx("th",{className:"p-4 text-left",children:"Due Date"}),e.jsx("th",{className:"p-4 text-left",children:"Estimated Hours"})]})}),e.jsx("tbody",{children:R.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:[e.jsx(H,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks found for the selected filters"})]})}):R.map(s=>{const t=(a==null?void 0:a.id)===s.id||(a==null?void 0:a.public_id)===s.public_id,r=x(s);return e.jsxs("tr",{onClick:()=>Q(s),className:`border-b transition-colors cursor-pointer ${t?"bg-gray-50":"hover:bg-gray-50"}`,children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.title||s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:s.description})]}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:me(a||s)})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r==="LOCKED"?"bg-red-100 text-red-800":r==="COMPLETED"||r==="Completed"?"bg-green-100 text-green-800":r==="IN_PROGRESS"||r==="In Progress"?"bg-blue-100 text-blue-800":r==="ON_HOLD"||r==="On Hold"?"bg-red-100 text-red-800":r==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:T(r)})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:S(s.taskDate||s.dueDate)})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"tm-icon text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[s.estimatedHours||s.timeAlloted||0,"h"]})]})})]},s.id||s.public_id||s._id||s.internalId)})})]})}),n&&!f&&p.length>0&&V==="grid"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.length===0?e.jsxs(fe,{className:"col-span-full text-center",children:[e.jsx(H,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"No tasks found for the selected filters"})]}):R.map(s=>{const t=x(s);return e.jsxs(fe,{onClick:()=>Q(s),role:"button",className:"cursor-pointer",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description})]})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t==="LOCKED"?"bg-red-100 text-red-800":t==="COMPLETED"||t==="Completed"?"bg-green-100 text-green-800":t==="IN_PROGRESS"||t==="In Progress"?"bg-blue-100 text-blue-800":t==="ON_HOLD"||t==="On Hold"?"bg-red-100 text-red-800":t==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:T(t)}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:me(s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:S(s.taskDate||s.dueDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"tm-icon text-gray-400"}),e.jsxs("span",{children:[s.estimatedHours||s.timeAlloted||0," hours estimated"]})]})]})]},s.id||s.public_id||s._id||s.internalId)})})]}),a&&e.jsx("div",{className:"lg:w-2/5",children:e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm sticky top-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.title}),e.jsx("span",{className:`rounded-full border px-3 py-1 text-xs font-semibold ${x(a)==="LOCKED"?"bg-red-100 text-red-800 border-red-200":x(a)==="COMPLETED"||x(a)==="Completed"?"bg-green-100 text-green-800 border-green-200":x(a)==="IN_PROGRESS"||x(a)==="In Progress"?"bg-blue-100 text-blue-800 border-blue-200":x(a)==="ON_HOLD"||x(a)==="On Hold"?"bg-red-100 text-red-800 border-red-200":x(a)==="Request Approved"?"bg-purple-100 text-purple-800 border-purple-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:T(x(a))})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((be=a.project)==null?void 0:be.name)&&`Project: ${a.project.name}`}),(x(a)==="COMPLETED"||x(a)==="Completed")&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-xs mt-1",children:["Total working hours: ",e.jsx("span",{className:"font-bold",children:a.total_time_hhmmss||"0h 0m"})]}),e.jsx("p",{className:"text-xs mt-1",children:"This task is locked and cannot be modified further."})]}),x(a)==="LOCKED"&&e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”’ Task Locked - Pending Approval"}),e.jsx("p",{className:"text-xs",children:"Task is locked pending manager approval for reassignment request."})]}),x(a)==="Request Approved"&&e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-purple-50 p-3 text-sm text-purple-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Reassignment Approved"}),e.jsx("p",{className:"text-xs",children:"Employee reassignment request has been approved."})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Due ",S(a.taskDate||a.dueDate)]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>Q(a),disabled:ce,className:"flex items-center gap-2 px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(I,{className:`w-4 h-4 ${ce?"animate-spin":""}`}),"Refresh Task"]})}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:a.description})]}),a.assignedUsers&&a.assignedUsers.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Assigned To"}),e.jsx("div",{className:"mt-2 space-y-2",children:a.assignedUsers.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name||s.email||"Unknown User"})]},s.id||s.public_id||t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Reassign Task"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("select",{value:w,onChange:s=>ie(s.target.value),disabled:_.length===0||x(a)==="COMPLETED"||x(a)==="LOCKED",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Select employee"}),_.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("button",{onClick:Te,disabled:K||!w||_.length===0||x(a)==="COMPLETED"||x(a)==="LOCKED",className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm ${K||!w||_.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:K?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Reassigning..."]}):"Reassign Task"})]})]}),a.checklist&&a.checklist.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Checklist"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[a.checklist.filter(s=>s.status==="Completed").length," / ",a.checklist.length," completed"]})]}),e.jsx("ul",{className:"space-y-3",children:a.checklist.map((s,t)=>{const r=s.id||s.public_id||`${t}`,m=s.status==="Completed";return e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsx("div",{className:"flex items-center justify-between gap-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(Ve,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${m?"text-gray-400 line-through":"text-gray-900"}`,children:s.title||"Untitled item"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due ",S(s.dueDate)]}),s.completedAt&&e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["Completed ",S(s.completedAt)]})]})]})})},r)})})]}),a.activities&&a.activities.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:a.activities.slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.description||s.action}),e.jsx("p",{className:"text-xs text-gray-500",children:Ee(s.createdAt||s.timestamp)})]})]},s.id||t))})]}),a.time_tracking&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Time Tracking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Estimated"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.estimatedHours||a.timeAlloted||0,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Worked"}),e.jsx("p",{className:"text-sm font-medium",children:a.total_time_hhmmss||"0h 0m"})]})]})]})]})})})]}),Ce&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center font-semibold",children:"âž•"}),"Create New Task"]}),e.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("form",{onSubmit:Pe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{required:!0,value:d.title,onChange:s=>j({...d,title:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:s=>j({...d,description:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Task description (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Project"}),e.jsxs("div",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 font-medium",children:[u?k(u):"Selected Project"," âœ“"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Project selected from dropdown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Priority"}),e.jsxs("select",{value:d.priority,onChange:s=>j({...d,priority:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Status"}),e.jsx("select",{value:d.stage,onChange:s=>j({...d,stage:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:xe.map(s=>e.jsx("option",{value:s,children:T(s)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Estimated Hours"}),e.jsx("input",{type:"number",min:"0",step:"0.5",value:d.timeAlloted,onChange:s=>j({...d,timeAlloted:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 8"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:d.taskDate,onChange:s=>j({...d,taskDate:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Assign To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:d.assignedUsers[0]||"",onChange:s=>{const t=s.target.value;j({...d,assignedUsers:t?[t]:[]})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select an employee"}),_.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only one employee can be assigned"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>E(!1),disabled:G,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:G,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:G?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"tm-icon animate-spin"}),"Creating..."]}):"Create Task"})]})]})]})})]})};export{ts as default};
