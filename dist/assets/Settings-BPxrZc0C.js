import{r as l,b as xe,s as me,b1 as he,cn as ge,co as ue,u as pe,j as e,G as be,ao as ye,a4 as z,H as je,e as p}from"./index-CV0oviIo.js";import{S as fe}from"./SelectList-BIPjPLMm.js";const{Settings:X,Database:Z,ShieldCheck:I,Bell:ee,Globe2:se,KeyRound:te,Save:Ne,Loader2:w,CheckCircle2:M,XCircle:ae,QrCode:ve,Smartphone:we,AlertTriangle:G,History:Se,Copy:Q}=be,Ae=()=>{const[r,y]=l.useState(!1),[m,h]=l.useState(!1),[j,u]=l.useState("initial"),[S,T]=l.useState(""),[A,f]=l.useState(""),[g,L]=l.useState(""),[c,V]=l.useState([]),W=async()=>{y(!1)},F=async()=>{h(!0),T("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=="),f("DUMMY_SECRET_FOR_DEVELOPMENT"),u("setup"),p.success("Scan QR code to set up 2FA"),h(!1)},P=async()=>{if(!g||g.length!==6){p.error("Please enter a valid 6-digit code");return}h(!0),V([]),u("backup"),y(!0),p.success("2FA enabled successfully!"),h(!1)},R=async()=>{window.confirm("Are you sure you want to disable 2FA? This will reduce your account security.")&&(h(!0),y(!1),u("initial"),p.success("2FA disabled successfully"),h(!1))},C=d=>{navigator.clipboard.writeText(d),p.success("Copied to clipboard!")},_=()=>{const d=c.join(`
`),N=new Blob([d],{type:"text/plain"}),k=URL.createObjectURL(N),o=document.createElement("a");o.href=k,o.download="2fa-backup-codes.txt",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(k),p.success("Backup codes downloaded")};return l.useEffect(()=>{W()},[]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsx(te,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Two-Factor Authentication (2FA)"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Add an extra layer of security using TOTP authenticator apps"})]})]}),e.jsx("div",{className:`px-4 py-2 rounded-full text-sm font-medium ${r?"bg-green-100 text-green-800 border border-green-200":"bg-gray-100 text-gray-800 border border-gray-200"}`,children:r?"Enabled":"Disabled"})]}),j==="initial"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-lg shadow-sm",children:e.jsx(I,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Enhanced Account Security"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Two-factor authentication adds an extra layer of security to your account. When enabled, you'll need to enter both your password and a verification code from an authenticator app when signing in."}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsx(G,{className:"text-yellow-500"}),e.jsx("span",{children:"Recommended for all accounts with sensitive data"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded",children:e.jsx(we,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"Authenticator Apps"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Use Google Authenticator, Authy, Microsoft Authenticator, or any TOTP-compatible app"})]}),e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded",children:e.jsx(M,{className:"w-5 h-5 text-green-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"How It Works"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["1. Scan QR code",e.jsx("br",{}),"2. Enter 6-digit code",e.jsx("br",{}),"3. Save backup codes"]})]}),e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 hover:shadow-sm transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded",children:e.jsx(ve,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h5",{className:"font-semibold text-gray-900",children:"Always Available"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Works offline - no SMS or email required. Codes refresh every 30 seconds."})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-gray-200",children:[r?e.jsx("button",{onClick:R,disabled:m,className:"inline-flex items-center gap-2 px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Disabling..."]}):"Disable 2FA"}):e.jsx("button",{onClick:F,disabled:m,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Setting up..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4"}),"Enable 2FA"]})}),e.jsx("button",{className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Learn More About 2FA"})]})]}),j==="setup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Complete setup within 5 minutes"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"The QR code will expire. If it does, you'll need to start the setup process again."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Step 1: Scan QR Code"}),e.jsx("div",{className:"bg-white border border-gray-300 rounded-lg p-6 flex items-center justify-center",children:S?e.jsx("img",{src:S,alt:"2FA QR Code",className:"w-64 h-64"}):e.jsx("div",{className:"w-64 h-64 bg-gray-100 rounded flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 text-gray-400 animate-spin"})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Step 2: Enter Verification Code"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:g,onChange:d=>L(d.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none text-center text-2xl tracking-widest",maxLength:6}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Enter the 6-digit code from your authenticator app"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:P,disabled:m||g.length!==6,className:"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin inline mr-2"}),"Verifying..."]}):"Verify and Enable"}),e.jsx("button",{onClick:()=>u("initial"),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Setup Instructions"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Install Authenticator App"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Install Google Authenticator, Authy, Microsoft Authenticator, or any TOTP app on your phone."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Scan QR Code"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Open your authenticator app and scan the QR code above, or enter the secret key manually."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Enter Code"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Enter the 6-digit code from your authenticator app in the verification field."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"font-semibold text-blue-600",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Save Backup Codes"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"After verification, you'll receive backup codes. Save them in a secure place."})]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Can't scan QR code?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Enter this secret key manually in your app:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-gray-100 px-3 py-2 rounded text-sm font-mono break-all",children:A}),e.jsx("button",{onClick:()=>C(A),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors",title:"Copy secret key",children:e.jsx(Q,{})})]})]})]})]})]}),j==="backup"&&c.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Two-Factor Authentication Enabled Successfully!"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Your account is now protected with 2FA. Please save your backup codes."})]})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Backup Codes"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Save these codes in a secure place. Each code can be used once if you lose access to your authenticator app."})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Q,{}),"Download Codes"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:c.map((d,N)=>e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center font-mono",children:d},N))}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800",children:"Important Security Notice"}),e.jsxs("ul",{className:"text-sm text-red-700 mt-1 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Save these codes in a secure, offline location"}),e.jsx("li",{children:"Do not store them in plain text files or emails"}),e.jsx("li",{children:"Each code can only be used once"}),e.jsx("li",{children:"Generate new codes if you lose them"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("button",{onClick:()=>C(c.join(`
`)),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(Q,{}),"Copy All Codes"]}),e.jsx("button",{onClick:()=>u("initial"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Done"})]})]})]})]})},Ce=["Asia/Kolkata","UTC","America/New_York","Europe/London","Asia/Tokyo","Australia/Sydney","America/Los_Angeles"],Le=()=>{var J,K,Y;const[r,y]=l.useState(null),[m,h]=l.useState(!0),[j,u]=l.useState(null),[S,T]=l.useState(!1),[A,f]=l.useState(null),[g,L]=l.useState("general"),c=xe(me);l.useEffect(()=>{try{const s=he(),t=ge();console.debug("[Settings] tokens:",{access:s?"present":null,refresh:t?"present":null}),s&&ue(s,t||null,"local")}catch(s){console.warn("Settings token diagnostic failed",s)}},[]);const[V,W]=l.useState(!1),[F,P]=l.useState([]),[R,C]=l.useState(!1),[_,d]=l.useState(null);pe();const N=async()=>{try{h(!0);const s=((c==null?void 0:c.role)||"").toString().toLowerCase();let t="/api/admin/settings";s.includes("manager")?t="/api/manager/settings":s.includes("employee")?t="/api/employee/settings":s.includes("client")&&(t="/api/client/settings");const a=await z(t,{method:"GET"});y((a==null?void 0:a.data)||a||{}),u(null)}catch(s){u(s.message||"Failed to load settings")}finally{h(!1)}};l.useEffect(()=>{N()},[]);const k=async()=>{try{C(!0),d(null);const s=((c==null?void 0:c.role)||"").toLowerCase();let t="/api/employee/audit-logs?limit=25&page=1";s==="admin"?t="/api/admin/audit-logs?limit=25&page=1":s==="manager"&&(t="/api/manager/audit-logs?limit=25&page=1");const a=await je(t.replace(/^\//,"")),i=(a==null?void 0:a.data)??a,E=Array.isArray(i==null?void 0:i.logs)?i.logs:Array.isArray(i)?i:[];P(E)}catch(s){console.error("Failed to load audit logs",s),d(s.message||"Failed to load audit logs")}finally{C(!1)}};l.useEffect(()=>{k()},[c]);const o=(s,t,a)=>{y(i=>({...i,[s]:{...i[s],[t]:a}}))},re=async()=>{try{T(!0),f(null);const s=((c==null?void 0:c.role)||"").toString().toLowerCase();let t="/api/admin/settings";s.includes("manager")?t="/api/manager/settings":s.includes("employee")?t="/api/employee/settings":s.includes("client")&&(t="/api/client/settings"),await z(t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),f("success"),p.success("Settings saved successfully!"),setTimeout(()=>f(null),3e3)}catch(s){f("error"),p.error(s.message||"Failed to save settings")}finally{T(!1)}},v=({title:s,icon:t,children:a,sectionKey:i})=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6 overflow-hidden",children:[e.jsxs("button",{onClick:()=>L(g===i?null:i),className:"w-full flex items-center justify-between p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(t,{className:"text-blue-600 w-5 h-5"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transform transition-transform ${g===i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),g===i&&e.jsx("div",{className:"px-6 pb-6 border-t border-gray-100",children:a})]}),U=({checked:s,onChange:t,label:a,description:i})=>e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a}),i&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:i})]}),e.jsx("button",{type:"button",className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${s?"bg-blue-600":"bg-gray-300"}`,onClick:()=>t(!s),children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s?"translate-x-6":"translate-x-1"}`})})]}),$=({label:s,value:t,onChange:a,type:i="text",placeholder:E,description:O})=>e.jsxs("div",{className:"space-y-2 py-4 border-b border-gray-100 last:border-b-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:s}),O&&e.jsx("p",{className:"text-sm text-gray-500",children:O}),e.jsx("input",{type:i,value:t||"",onChange:B=>a(B.target.value),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:E})]});return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-4 md:p-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-64 mb-6"}),e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((s,t)=>e.jsx("div",{className:"h-48 bg-gray-300 rounded-lg"},t))})]})})}):j?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-8 flex items-center justify-center",children:e.jsx("div",{className:"max-w-md text-center",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-8",children:[e.jsx(ae,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error Loading Settings"}),e.jsx("p",{className:"text-red-600",children:j}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx(ye,{title:"System Settings",subtitle:"Configure your system preferences and security settings",onRefresh:()=>{N(),k()},refreshing:m||R,children:e.jsx("div",{className:"flex flex-col items-end gap-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center gap-3",children:[A==="success"&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{children:"Saved!"})]}),A==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Failed to save"})]}),e.jsx("button",{onClick:re,disabled:S,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4"}),"Save Changes"]})})]})})}),e.jsx(Ae,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 sticky top-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Settings Sections"}),e.jsx("nav",{className:"space-y-2",children:[{key:"general",label:"General Settings",icon:X},{key:"database",label:"Database Config",icon:Z},{key:"security",label:"Security",icon:I},{key:"notifications",label:"Notifications",icon:ee},{key:"api",label:"API Settings",icon:se}].map(s=>e.jsxs("button",{onClick:()=>L(s.key),className:`w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${g===s.key?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(s.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.key))}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-600",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Settings Version"}),e.jsxs("p",{className:"text-sm",children:["v",(r==null?void 0:r.version)||"1.0.0"]})]})]})})]})}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(v,{title:"General Settings",icon:X,sectionKey:"general",children:e.jsx("div",{className:"space-y-4",children:Object.entries((r==null?void 0:r.general)||{}).map(([s,t])=>{const a=s.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase());return s==="timezone"?e.jsx("div",{className:"py-4 border-b border-gray-100 last:border-b-0",children:e.jsx(fe,{label:a,lists:Ce,selected:t,setSelected:i=>o("general",s,i)})},s):e.jsx($,{label:a,value:t,onChange:i=>o("general",s,i)},s)})})}),e.jsx(v,{title:"Database Configuration",icon:Z,sectionKey:"database",children:e.jsx("div",{className:"space-y-1",children:Object.entries((r==null?void 0:r.database)||{}).map(([s,t])=>e.jsx("div",{className:"py-4 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:t})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${t?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t?"Active":"Inactive"})]})},s))})}),e.jsx(v,{title:"Security Settings",icon:I,sectionKey:"security",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(U,{checked:((J=r==null?void 0:r.security)==null?void 0:J.password_expiry)||!1,onChange:s=>o("security","password_expiry",s),label:"Password Expiry",description:"Require users to change passwords periodically"}),e.jsx(U,{checked:((K=r==null?void 0:r.security)==null?void 0:K.login_notifications)||!1,onChange:s=>o("security","login_notifications",s),label:"Login Notifications",description:"Send email notifications for new logins"}),e.jsx(U,{checked:((Y=r==null?void 0:r.security)==null?void 0:Y.session_timeout)||!1,onChange:s=>o("security","session_timeout",s),label:"Session Timeout",description:"Automatically log out inactive users"})]})}),e.jsx(v,{title:"Notification Settings",icon:ee,sectionKey:"notifications",children:e.jsx("div",{className:"space-y-1",children:Object.entries((r==null?void 0:r.notifications)||{}).map(([s,t])=>e.jsx(U,{checked:t,onChange:a=>o("notifications",s,a),label:s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())},s))})}),e.jsx(v,{title:"API Settings",icon:se,sectionKey:"api",children:e.jsx("div",{className:"space-y-4",children:Object.entries((r==null?void 0:r.api)||{}).map(([s,t])=>e.jsx($,{label:s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),value:t,onChange:a=>o("api",s,a),type:s.toLowerCase().includes("key")||s.toLowerCase().includes("secret")?"password":"text"},s))})}),e.jsx(v,{title:"Audit Logs",icon:Se,sectionKey:"auditLogs",children:e.jsx("div",{className:"space-y-3",children:R?e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[e.jsx(w,{className:"animate-spin"}),"Loading audit logs..."]}):_?e.jsx("div",{className:"text-sm text-red-600",children:_}):F.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No audit logs available."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-600",children:[e.jsx("th",{className:"px-3 py-2",children:"Time"}),e.jsx("th",{className:"px-3 py-2",children:"Actor"}),e.jsx("th",{className:"px-3 py-2",children:"Action"}),e.jsx("th",{className:"px-3 py-2",children:"Entity"}),e.jsx("th",{className:"px-3 py-2",children:"Details"}),e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:F.slice(0,100).map((s,t)=>{const a=s.id||s._id||t,i=s.timestamp||s.created_at||s.time||s.date||"",E=s.actor||s.user&&(s.user.name||s.user.email)||s.username||"",O=s.action||s.verb||"",B=s.entity||s.resource||"",x=s.details||{},b=(x==null?void 0:x.file_url)||(x==null?void 0:x.url)||(x==null?void 0:x.fileUrl),D=n=>n==null?"":typeof n=="string"?n:typeof n=="number"||typeof n=="boolean"?String(n):typeof n=="object"?n.name||n.title||n.id||n._id||JSON.stringify(n):String(n),ie=D(i),le=D(E),ne=D(O),ce=D(B);return e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:ie}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:le}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:ne}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:ce}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:JSON.stringify(x)}),e.jsx("td",{className:"px-3 py-2 align-top text-gray-700",children:e.jsx("div",{className:"flex items-center gap-2",children:b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:async()=>{try{const n=localStorage.getItem("accessToken")||localStorage.getItem("tm_access_token"),oe=localStorage.getItem("tenantId")||"default";if((b.startsWith(window.location.origin)||b.startsWith("/"))&&n){const H=await fetch(b,{headers:{Authorization:`Bearer ${n}`,"x-tenant-id":oe}});if(H.ok){const de=await H.blob(),q=window.URL.createObjectURL(de);window.open(q,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(q),1e4);return}}window.open(b,"_blank")}catch(n){console.error("Preview audit file error",n),window.open(b,"_blank")}},className:"text-blue-600 hover:underline text-sm",children:"Preview"}),e.jsx("a",{href:b,target:"_blank",rel:"noreferrer",className:"text-gray-600 text-sm",children:"Download"})]})})})]},a)})})]})})})})]})]})]})})};export{Le as default};
