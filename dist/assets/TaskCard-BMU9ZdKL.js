import{r as x,n as $,w as je,U as L,y as k,bU as Ne,bV as we,p as _,R as oe,bW as Se,q as pe,bX as A,C as q,I as Z,bY as J,bZ as fe,b_ as Ie,b$ as ge,c0 as _e,x as y,c1 as De,M as ce,c2 as Ce,T as Re,O as de,t as Te,c3 as Ee,u as B,j as e,B as T,c4 as Pe,b as O,c5 as he,X as Me,H as Oe,a2 as H,a as Ue,G as Fe,c6 as be,a5 as $e,c7 as Q,c8 as Ae,K as Le,F as W,c9 as ke,ca as qe,b9 as Be,ac as Ge,aO as Ke,cb as He,cc as Qe,cd as We}from"./index-CT2igMlm.js";import{h as ue}from"./moment-C5S46NFB.js";import{u as ee}from"./index.esm-C1ReRk4T.js";import{M as te,_ as se}from"./ModalWrapper-D6fPS2SN.js";import{T as P}from"./Textbox-DRXkpxqB.js";import{C as ze}from"./Dialogs-8_BNYYRj.js";import{s as Ve,c as C,u as Xe,f as Ye,S as z,I as F}from"./SelectList-BV2Jzj8v.js";import{a as me,B as xe}from"./index-pGm2xic7.js";function Je({container:t,accept:r,walk:c,enabled:l=!0}){let i=x.useRef(r),d=x.useRef(c);x.useEffect(()=>{i.current=r,d.current=c},[r,c]),$(()=>{if(!t||!l)return;let o=je(t);if(!o)return;let a=i.current,s=d.current,m=Object.assign(b=>a(b),{acceptNode:a}),g=o.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,m,!1);for(;g.nextNode();)s(g.currentNode)},[t,l,i,d])}var Ze=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Ze||{}),et=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(et||{}),tt=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItem=5]="RegisterItem",t[t.UnregisterItem=6]="UnregisterItem",t))(tt||{});function V(t,r=c=>c){let c=t.activeItemIndex!==null?t.items[t.activeItemIndex]:null,l=Te(r(t.items.slice()),d=>d.dataRef.current.domRef.current),i=c?l.indexOf(c):null;return i===-1&&(i=null),{items:l,activeItemIndex:i}}let st={1(t){return t.menuState===1?t:{...t,activeItemIndex:null,menuState:1}},0(t){return t.menuState===0?t:{...t,__demoMode:!1,menuState:0}},2:(t,r)=>{var c;let l=V(t),i=Ye(r,{resolveItems:()=>l.items,resolveActiveIndex:()=>l.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...t,...l,searchQuery:"",activeItemIndex:i,activationTrigger:(c=r.trigger)!=null?c:1}},3:(t,r)=>{let c=t.searchQuery!==""?0:1,l=t.searchQuery+r.value.toLowerCase(),i=(t.activeItemIndex!==null?t.items.slice(t.activeItemIndex+c).concat(t.items.slice(0,t.activeItemIndex+c)):t.items).find(o=>{var a;return((a=o.dataRef.current.textValue)==null?void 0:a.startsWith(l))&&!o.dataRef.current.disabled}),d=i?t.items.indexOf(i):-1;return d===-1||d===t.activeItemIndex?{...t,searchQuery:l}:{...t,searchQuery:l,activeItemIndex:d,activationTrigger:1}},4(t){return t.searchQuery===""?t:{...t,searchQuery:"",searchActiveItemIndex:null}},5:(t,r)=>{let c=V(t,l=>[...l,{id:r.id,dataRef:r.dataRef}]);return{...t,...c}},6:(t,r)=>{let c=V(t,l=>{let i=l.findIndex(d=>d.id===r.id);return i!==-1&&l.splice(i,1),l});return{...t,...c,activationTrigger:1}}},re=x.createContext(null);re.displayName="MenuContext";function G(t){let r=x.useContext(re);if(r===null){let c=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(c,G),c}return r}function rt(t,r){return pe(r.type,st,t,r)}let at=x.Fragment;function nt(t,r){let{__demoMode:c=!1,...l}=t,i=x.useReducer(rt,{__demoMode:c,menuState:c?0:1,buttonRef:x.createRef(),itemsRef:x.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:d,itemsRef:o,buttonRef:a},s]=i,m=k(r);Ne([a,o],(j,N)=>{var u;s({type:1}),we(N,Ee.Loose)||(j.preventDefault(),(u=a.current)==null||u.focus())},d===0);let g=_(()=>{s({type:1})}),b=x.useMemo(()=>({open:d===0,close:g}),[d,g]),h={ref:m};return oe.createElement(re.Provider,{value:i},oe.createElement(Se,{value:pe(d,{0:A.Open,1:A.Closed})},q({ourProps:h,theirProps:l,slot:b,defaultTag:at,name:"Menu"})))}let it="button";function lt(t,r){var c;let l=Z(),{id:i=`headlessui-menu-button-${l}`,...d}=t,[o,a]=G("Menu.Button"),s=k(o.buttonRef,r),m=ge(),g=_(u=>{switch(u.key){case y.Space:case y.Enter:case y.ArrowDown:u.preventDefault(),u.stopPropagation(),a({type:0}),m.nextFrame(()=>a({type:2,focus:C.First}));break;case y.ArrowUp:u.preventDefault(),u.stopPropagation(),a({type:0}),m.nextFrame(()=>a({type:2,focus:C.Last}));break}}),b=_(u=>{switch(u.key){case y.Space:u.preventDefault();break}}),h=_(u=>{if(Ce(u.currentTarget))return u.preventDefault();t.disabled||(o.menuState===0?(a({type:1}),m.nextFrame(()=>{var v;return(v=o.buttonRef.current)==null?void 0:v.focus({preventScroll:!0})})):(u.preventDefault(),a({type:0})))}),j=x.useMemo(()=>({open:o.menuState===0}),[o]),N={ref:s,id:i,type:Re(t,o.buttonRef),"aria-haspopup":"menu","aria-controls":(c=o.itemsRef.current)==null?void 0:c.id,"aria-expanded":o.menuState===0,onKeyDown:g,onKeyUp:b,onClick:h};return q({ourProps:N,theirProps:d,slot:j,defaultTag:it,name:"Menu.Button"})}let ot="div",ct=de.RenderStrategy|de.Static;function dt(t,r){var c,l;let i=Z(),{id:d=`headlessui-menu-items-${i}`,...o}=t,[a,s]=G("Menu.Items"),m=k(a.itemsRef,r),g=Ie(a.itemsRef),b=ge(),h=_e(),j=h!==null?(h&A.Open)===A.Open:a.menuState===0;x.useEffect(()=>{let n=a.itemsRef.current;n&&a.menuState===0&&n!==(g==null?void 0:g.activeElement)&&n.focus({preventScroll:!0})},[a.menuState,a.itemsRef,g]),Je({container:a.itemsRef.current,enabled:a.menuState===0,accept(n){return n.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:n.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(n){n.setAttribute("role","none")}});let N=_(n=>{var w,I;switch(b.dispose(),n.key){case y.Space:if(a.searchQuery!=="")return n.preventDefault(),n.stopPropagation(),s({type:3,value:n.key});case y.Enter:if(n.preventDefault(),n.stopPropagation(),s({type:1}),a.activeItemIndex!==null){let{dataRef:f}=a.items[a.activeItemIndex];(I=(w=f.current)==null?void 0:w.domRef.current)==null||I.click()}fe(a.buttonRef.current);break;case y.ArrowDown:return n.preventDefault(),n.stopPropagation(),s({type:2,focus:C.Next});case y.ArrowUp:return n.preventDefault(),n.stopPropagation(),s({type:2,focus:C.Previous});case y.Home:case y.PageUp:return n.preventDefault(),n.stopPropagation(),s({type:2,focus:C.First});case y.End:case y.PageDown:return n.preventDefault(),n.stopPropagation(),s({type:2,focus:C.Last});case y.Escape:n.preventDefault(),n.stopPropagation(),s({type:1}),J().nextFrame(()=>{var f;return(f=a.buttonRef.current)==null?void 0:f.focus({preventScroll:!0})});break;case y.Tab:n.preventDefault(),n.stopPropagation(),s({type:1}),J().nextFrame(()=>{De(a.buttonRef.current,n.shiftKey?ce.Previous:ce.Next)});break;default:n.key.length===1&&(s({type:3,value:n.key}),b.setTimeout(()=>s({type:4}),350));break}}),u=_(n=>{switch(n.key){case y.Space:n.preventDefault();break}}),v=x.useMemo(()=>({open:a.menuState===0}),[a]),D={"aria-activedescendant":a.activeItemIndex===null||(c=a.items[a.activeItemIndex])==null?void 0:c.id,"aria-labelledby":(l=a.buttonRef.current)==null?void 0:l.id,id:d,onKeyDown:N,onKeyUp:u,role:"menu",tabIndex:0,ref:m};return q({ourProps:D,theirProps:o,slot:v,defaultTag:ot,features:ct,visible:j,name:"Menu.Items"})}let ut=x.Fragment;function mt(t,r){let c=Z(),{id:l=`headlessui-menu-item-${c}`,disabled:i=!1,...d}=t,[o,a]=G("Menu.Item"),s=o.activeItemIndex!==null?o.items[o.activeItemIndex].id===l:!1,m=x.useRef(null),g=k(r,m);$(()=>{if(o.__demoMode||o.menuState!==0||!s||o.activationTrigger===0)return;let f=J();return f.requestAnimationFrame(()=>{var E,U;(U=(E=m.current)==null?void 0:E.scrollIntoView)==null||U.call(E,{block:"nearest"})}),f.dispose},[o.__demoMode,m,s,o.menuState,o.activationTrigger,o.activeItemIndex]);let b=Ve(m),h=x.useRef({disabled:i,domRef:m,get textValue(){return b()}});$(()=>{h.current.disabled=i},[h,i]),$(()=>(a({type:5,id:l,dataRef:h}),()=>a({type:6,id:l})),[h,l]);let j=_(()=>{a({type:1})}),N=_(f=>{if(i)return f.preventDefault();a({type:1}),fe(o.buttonRef.current)}),u=_(()=>{if(i)return a({type:2,focus:C.Nothing});a({type:2,focus:C.Specific,id:l})}),v=Xe(),D=_(f=>v.update(f)),n=_(f=>{v.wasMoved(f)&&(i||s||a({type:2,focus:C.Specific,id:l,trigger:0}))}),w=_(f=>{v.wasMoved(f)&&(i||s&&a({type:2,focus:C.Nothing}))}),I=x.useMemo(()=>({active:s,disabled:i,close:j}),[s,i,j]);return q({ourProps:{id:l,ref:g,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,disabled:void 0,onClick:N,onFocus:u,onPointerEnter:D,onMouseEnter:D,onPointerMove:n,onMouseMove:n,onPointerLeave:w,onMouseLeave:w},theirProps:d,slot:I,defaultTag:ut,name:"Menu.Item"})}let xt=L(nt),pt=L(lt),ft=L(dt),gt=L(mt),M=Object.assign(xt,{Button:pt,Items:ft,Item:gt});const ve=({open:t,setOpen:r,id:c})=>{const{register:l,handleSubmit:i,formState:{errors:d}}=ee(),o=B(),a=async s=>{const m={id:c,title:s.title,due_date:s.date,tag:s.tag};console.log(c),o(Pe(m)),r(!1)};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:r,children:e.jsxs("form",{onSubmit:i(a),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"ADD SUB-TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-6",children:[e.jsx(P,{placeholder:"Sub-Task title",type:"text",name:"title",label:"Title",className:"w-full rounded",register:l("title",{required:"Title is required!"}),error:d.title?d.title.message:""}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:l("date",{required:"Date is required!"}),error:d.date?d.date.message:""}),e.jsx(P,{placeholder:"Tag",type:"text",name:"tag",label:"Tag",className:"w-full rounded",register:l("tag",{required:"Tag is required!"}),error:d.tag?d.tag.message:""})]})]}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(T,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Add Task"}),e.jsx(T,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>r(!1),label:"Cancel"})]})]})})})},X=["TODO","IN PROGRESS","COMPLETED"],Y=["HIGH","MEDIUM","LOW"],ht=({open:t,setOpen:r,taskId:c})=>{var ae,ne,ie,le;const l=B(),{register:i,handleSubmit:d,setValue:o,formState:{errors:a},reset:s}=ee(),m=O(p=>he(p,c)),g=O(Me),[b,h]=x.useState([]),[j,N]=x.useState(X[0]),[u,v]=x.useState(Y[2]),[D,n]=x.useState(""),[w,I]=x.useState([]),[f,E]=x.useState(!1);x.useEffect(()=>{var p;m&&(h(m.assigned_to||[]),N(m.stage||X[0]),v(m.priority||Y[2]),n(m.client_id||""),o("title",m.title||""),o("date",((p=m.taskDate)==null?void 0:p.split("T")[0])||""),o("time_alloted",m.time_alloted||""),o("description",m.description||""))},[m,o]),x.useEffect(()=>{(async()=>{try{const S=await Oe("api/clients");I(S)}catch(S){console.error("Error fetching clients:",S)}})()},[]);const U=p=>{h(p.map(S=>S._id))},K=g.filter(p=>b.includes(p._id)),ye=async p=>{if(!c){alert("Task ID is missing. Please try again.");return}const S={stage:j,title:p.title,priority:u,description:p.description,assigned_to:b,client_id:D,taskDate:new Date(p.date).toISOString(),time_alloted:p.time_alloted};E(!0);try{const R=await l(H({id:c,updatedTaskData:S}));H.fulfilled.match(R)?(r(!1),s()):H.rejected.match(R)&&alert(`Update failed: ${R.payload||R.error}`)}catch(R){console.error("Update error:",R),alert("Failed to update task")}finally{E(!1)}};return m?e.jsx(te,{open:t,setOpen:r,children:e.jsxs("form",{onSubmit:d(ye),children:[e.jsx(se.Title,{className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-4",children:[e.jsx(z,{label:"Select Client",lists:w.map(p=>p.name),selected:D&&((ae=w.find(p=>p._id===D))==null?void 0:ae.name)||"",setSelected:p=>{const S=w.find(R=>R.name===p);n(S?S._id:"")}}),e.jsx(P,{placeholder:"Task Title",type:"text",name:"title",label:"Task Title",className:"w-full rounded",register:i("title",{required:"Title is required"}),error:(ne=a.title)==null?void 0:ne.message}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(z,{label:"Priority Level",lists:Y,selected:u,setSelected:v})}),e.jsx("div",{className:"w-1/2",children:e.jsx(z,{label:"Task Stage",lists:X,selected:j,setSelected:N})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(P,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:i("date",{required:"Date is required"}),error:(ie=a.date)==null?void 0:ie.message})}),e.jsx("div",{className:"w-1/2",children:e.jsx(P,{placeholder:"Time Alloted",type:"number",name:"time_alloted",label:"Time Alloted",className:"w-full rounded",register:i("time_alloted",{valueAsNumber:!0,min:{value:0,message:"Must be a positive number"}}),error:(le=a.time_alloted)==null?void 0:le.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Users"}),e.jsx(F,{value:K,onChange:U,multiple:!0,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs(F.Button,{className:"relative w-full cursor-default rounded-lg border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("span",{className:"block truncate",children:K.length>0?K.map(p=>p.name).join(", "):"Select users"}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400",children:"▼"})]}),e.jsx(F.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:g.map(p=>e.jsx(F.Option,{value:p,className:({active:S})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${S?"bg-indigo-600 text-white":"text-gray-900"}`,children:({selected:S})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${S?"font-medium":"font-normal"}`,children:p.name||"Unnamed User"}),S&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-green-600",children:"✓"})]})},p._id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter task description (optional)",className:"w-full rounded border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",rows:"3",...i("description")})]}),e.jsxs("div",{className:"bg-gray-50 py-4 sm:flex sm:flex-row-reverse gap-4",children:[e.jsx(T,{label:f?"Updating...":"Update",type:"submit",className:`${f?"opacity-50 cursor-not-allowed":""} bg-green-600 px-8 text-sm font-semibold text-white hover:bg-green-700 sm:w-auto`,disabled:f}),e.jsx(T,{type:"button",className:"bg-white px-5 text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>r(!1),label:"Cancel"})]})]})]})}):null},{FolderOpen:bt,MoreVertical:vt,Plus:yt,Trash2:jt}=Fe,Nt=({task:t})=>{const[r,c]=x.useState(!1),[l,i]=x.useState(!1),[d,o]=x.useState(!1),[a,s]=x.useState(null),m=Ue(),g=B(),b=()=>{a!==null&&(g($e({id:a})),s(null),o(!1))},h=u=>{s(u),o(!0)},j=()=>{const u=(t==null?void 0:t._id)||(t==null?void 0:t.task_id);u?m(`/task/${u}`):console.error("No valid task ID available for navigation")},N=[{label:"Open Task",icon:e.jsx(bt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:j},{label:"Edit",icon:e.jsx(yt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:()=>{t!=null&&t.task_id?i(!0):console.error("No task ID available for editing")}}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs(M,{as:"div",className:"relative inline-block text-left",children:[e.jsx(M.Button,{className:"inline-flex w-full justify-center rounded-md px-4 py-2 text-sm font-medium text-gray-600",children:e.jsx(vt,{className:"tm-icon"})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsxs(M.Items,{className:"absolute right-0 z-50 mt-2 w-56 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",children:[e.jsx("div",{className:"px-1 py-1 space-y-2",children:N.map(u=>e.jsx(M.Item,{children:({active:v})=>e.jsxs("button",{onClick:u.onClick,className:`${v?"bg-blue-500 text-white":"text-gray-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[u.icon,u.label]})},u.label))}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(M.Item,{children:({active:u})=>e.jsxs("button",{onClick:()=>h((t==null?void 0:t._id)||(t==null?void 0:t.task_id)),className:`${u?"bg-blue-500 text-white":"text-red-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[e.jsx(jt,{className:"tm-icon mr-2 text-red-400","aria-hidden":"true"}),"Delete"]})})})]})})]})}),l&&(t==null?void 0:t.task_id)&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(ht,{open:l,setOpen:i,taskId:t.task_id},t.task_id)})}),e.jsx(ve,{open:r,setOpen:c}),e.jsx(ze,{open:d,setOpen:o,onClick:b})]})},wt=({user:t})=>e.jsx("div",{className:"px-4",children:e.jsx(Q,{className:"relative",children:({open:r})=>e.jsxs(e.Fragment,{children:[e.jsx(Q.Button,{className:"group inline-flex items-center outline-none",children:e.jsx("span",{children:me(t==null?void 0:t.user_name)})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(Q.Panel,{className:"absolute left-1/2 z-10 mt-3 w-80 max-w-sm -translate-x-1/2 transform px-4 sm:px-0 ",children:e.jsxs("div",{className:"flex items-center gap-4 rounded-lg shadow-lg bg-white p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full text-white flex items-center justify-center text-2xl ",children:e.jsx("span",{className:"text-center font-bold",children:me(t==null?void 0:t.user_name)})}),e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-black text-xl font-bold",children:t==null?void 0:t.user_name}),e.jsx("span",{className:"text-blue-500",children:(t==null?void 0:t.user_role)??"email@example.com"})]})]})})})]})})}),St=({openStage:t,setOpenStage:r,id:c,onStatusUpdate:l})=>{const{register:i,handleSubmit:d,formState:{errors:o}}=ee(),a=s=>{s.status&&(l(s.status),r(!1))};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:r,children:e.jsxs("form",{onSubmit:d(a),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK STATUS"}),e.jsx("div",{className:"mt-2 flex flex-col gap-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"status",className:"font-semibold",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"w-full rounded border-gray-300",...i("status",{required:"Status is required!"}),children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"IN PROGRESS",children:"IN PROGRESS"}),e.jsx("option",{value:"COMPLETED",children:"COMPLETED"}),e.jsx("option",{value:"TODO",children:"TODO"})]}),o.status&&e.jsx("span",{className:"text-red-600",children:o.status.message})]})}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(T,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Update Status"}),e.jsx(T,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>r(!1),label:"Cancel"})]})]})})})},It={HIGH:e.jsx(Qe,{className:"w-4 h-4"}),MEDIUM:e.jsx(He,{className:"w-4 h-4"}),LOW:e.jsx(Ke,{className:"w-4 h-4"})},Ot=({taskId:t})=>{var N,u,v,D;const r=O(n=>he(n,t)),c=B(),{user:l}=O(n=>n.auth),[i,d]=x.useState(!1),[o,a]=x.useState(!1),[s,m]=x.useState(r),g=O(Ae);x.useEffect(()=>{r!=null&&r.task_id&&(c(Le(r.task_id)),m(r))},[c,r==null?void 0:r.task_id]);const b=async n=>{const w=(r==null?void 0:r.task_id)??(r==null?void 0:r.id)??(r==null?void 0:r._id);if(w)try{await c(We({id:w.toString(),data:{stage:n}})).unwrap()&&m(f=>({...f,stage:n}))}catch(I){console.error("Update failed:",I),m(f=>({...f}))}},h=n=>{switch(n==null?void 0:n.toLowerCase()){case"todo":case"to do":return"bg-gray-100 text-gray-800 border-gray-200";case"in progress":case"in_progress":return"bg-primary-100 text-primary-800 border-primary-200";case"review":return"bg-warning-100 text-warning-800 border-warning-200";case"completed":case"done":return"bg-success-100 text-success-800 border-success-200";case"blocked":return"bg-error-100 text-error-800 border-error-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=n=>{switch(n==null?void 0:n.toLowerCase()){case"high":return"text-error-600";case"medium":return"text-warning-600";case"low":return"text-success-600";default:return"text-gray-600"}};return r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full h-fit card cursor-pointer",children:[e.jsxs("div",{className:"w-full flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:W("px-2 py-1 text-xs font-medium rounded-full border",h(s==null?void 0:s.stage)),children:(s==null?void 0:s.stage)||"To Do"}),e.jsxs("div",{className:W("flex items-center gap-1 text-sm font-medium",j(s==null?void 0:s.priority)),children:[e.jsx("span",{className:"text-base",children:It[s==null?void 0:s.priority]}),e.jsx("span",{className:"uppercase",children:(s==null?void 0:s.priority)||"N/A"})]})]}),l&&e.jsx(Nt,{task:s})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 line-clamp-2 mb-1",children:(s==null?void 0:s.title)||"Untitled Task"}),(s==null?void 0:s.description)&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["Created ",s!=null&&s.createdAt?ue(s.createdAt).fromNow():"recently"]}),(s==null?void 0:s.due_date)&&e.jsxs("span",{className:"text-warning-600 font-medium",children:["Due ",ue(s.due_date).fromNow()]})]}),e.jsx("div",{className:"w-full border-t border-gray-100 my-3"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:((N=s==null?void 0:s.activities)==null?void 0:N.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:((u=s==null?void 0:s.assets)==null?void 0:u.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsxs("span",{children:["0/",(g==null?void 0:g.length)||0]})]})]}),e.jsxs("div",{className:"flex flex-row-reverse",children:[(v=s==null?void 0:s.assigned_users)==null?void 0:v.slice(0,3).map((n,w)=>{var I;return e.jsx("div",{className:W("w-8 h-8 rounded-full text-white flex items-center justify-center text-sm -mr-2 border-2 border-white",xe[w%((I=xe)==null?void 0:I.length)]),children:e.jsx(wt,{user:n})},(n==null?void 0:n._id)||w)}),((D=s==null?void 0:s.assigned_users)==null?void 0:D.length)>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-medium -mr-2 border-2 border-white",children:["+",s.assigned_users.length-3]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{onClick:()=>d(!0),variant:"secondary",size:"sm",icon:Ge,label:"Add Subtask",className:"flex-1"}),e.jsx(T,{onClick:()=>a(!0),variant:"secondary",size:"sm",label:"Update Status",className:"flex-1"})]})]}),e.jsx(ve,{open:i,setOpen:d,id:(s==null?void 0:s.task_id)??(s==null?void 0:s.id)??(s==null?void 0:s._id)}),e.jsx(St,{openStage:o,setOpenStage:a,id:(s==null?void 0:s.task_id)??(s==null?void 0:s.id)??(s==null?void 0:s._id),onStatusUpdate:b})]}):e.jsx("div",{className:"w-full h-fit card",children:"Task not found."})};export{Ot as T};
