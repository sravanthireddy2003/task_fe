import{r as x,j as e,a6 as gt,a7 as pt,a8 as ht,a9 as bt,aa as ft,ab as yt,ac as Oe,ad as Nt,ae as jt,i as u,u as Ge,b as Fe,s as He,af as wt,ag as vt,ah as _t,a as Ct,a4 as z,G as St,L as Tt,ai as Dt,_ as Rt,aj as Et,ak as It,al as kt,am as Pt,an as Ot}from"./index-BNLOVeat.js";import{i as pe,a as Z,g as ce}from"./taskHelpers-CsgoO_-X.js";import{u as At,C as qt,a as $t,S as Lt,v as Mt,b as Ut,c as Ae,D as Gt,d as Ft,e as Ht,s as Vt,K as Bt,P as Wt}from"./sortable.esm-DpjogZn2.js";const Ve=({task:r,onClick:i,isDragging:b=!1,userRole:V,reassignmentRequests:A={}})=>{const[f,I]=x.useState(r.total_duration||0);x.useEffect(()=>{let c;const a=r.status||r.stage,_=!!(r.timer_running||a==="In Progress"&&(r.started_at||r.timer_started_at)),T=r.timer_started_at||r.started_at||null,j=r.total_duration||r.total_time_seconds||r.timeSpent||0;if(_&&T){const Y=new Date(T).getTime();c=setInterval(()=>{const q=Date.now(),ae=Math.floor((q-Y)/1e3);I((j||0)+ae)},1e3)}else I(j||0);return()=>clearInterval(c)},[r.status,r.stage,r.total_duration,r.total_time_seconds,r.timeSpent,r.started_at,r.timer_started_at,r.timer_running]);const{attributes:S,listeners:$,setNodeRef:y,transform:w,transition:v,isDragging:L}=At({id:r.id||r._id||r.public_id}),E={transform:qt.Transform.toString(w),transition:v},k=c=>{switch(c==null?void 0:c.toLowerCase()){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},H=c=>c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):null,R=(c=>{const a=c.assignedUsers||c.assigned_users||[];return Array.isArray(a)?a:[]})(r);r.id||r._id||r.public_id;const U=r.lock_info||{},P=r.task_status||{},G=U.request_status||P.request_status||null,F=G==="PENDING",Q=G==="APPROVE"||G==="APPROVED",D=G==="DENY"||G==="DENIED"||G==="REJECTED",h=(r.status||"").toLowerCase()==="completed",p=c=>{const a=Math.floor(c/3600),_=Math.floor(c%3600/60),T=c%60;return a>0?`${a}h ${_}m ${T}s`:`${_}m ${T}s`};return e.jsxs("div",{ref:y,style:E,...S,...F||h?{}:{...$},className:`bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow ${b||L?"opacity-50":""} ${h?"border-green-300 bg-green-50 opacity-75 cursor-not-allowed":""} ${F?"border-orange-300 bg-orange-50 opacity-75 cursor-not-allowed":"cursor-pointer"}`,onClick:F||h?void 0:i,children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:r.title||r.name||"Untitled Task"}),r.description&&e.jsx("p",{className:"text-body-small text-gray-600 mb-3 line-clamp-2",children:r.description}),r.project&&e.jsxs("div",{className:"text-meta mb-2",children:["ðŸ“ ",r.project.name||r.project.title||"Project"]}),r.priority&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(gt,{className:`w-3 h-3 ${k(r.priority)}`}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${k(r.priority)}`,children:r.priority})]}),R.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(pt,{className:"w-3 h-3 text-gray-400"}),e.jsxs("div",{className:"flex -space-x-1",children:[R.slice(0,3).map((c,a)=>e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white",title:c.name||c.email||"User",children:(c.name||c.email||"U").charAt(0).toUpperCase()},c.id||c._id||a)),R.length>3&&e.jsxs("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 text-xs font-medium border-2 border-white",children:["+",R.length-3]})]})]}),r.due_date&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(ht,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-caption",children:["Due ",H(r.due_date)]})]}),h?e.jsxs("div",{className:"flex items-center gap-2 mt-3 p-2 bg-green-100 rounded-lg",children:[e.jsx(bt,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-caption font-semibold text-green-700",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-caption text-green-600",children:["Total: ",r.total_time_hhmmss||p(r.total_time_seconds||0)]})]})]}):(f>0||(r.status||r.stage)==="In Progress")&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:`w-3 h-3 ${(r.status||r.stage)==="In Progress"?"text-blue-500 animate-pulse":"text-gray-400"}`}),e.jsx("span",{className:`text-caption font-medium ${(r.status||r.stage)==="In Progress"?"text-blue-600":"text-gray-600"}`,children:p(f)})]}),r.checklist&&r.checklist.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(yt,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-caption",children:[r.checklist.filter(c=>c.status==="Completed").length,"/",r.checklist.length," items"]})]}),F&&e.jsx("div",{className:"mt-2 text-xs text-orange-700 bg-orange-100 px-2 py-1 rounded",children:"Reassignment Pending"}),Q&&e.jsx("div",{className:"mt-2 text-xs text-green-700 bg-green-100 px-2 py-1 rounded",children:"Reassignment Approved"}),D&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"Reassignment Denied"}),h&&e.jsx("div",{className:"mt-2 text-xs text-green-700 bg-green-100 px-2 py-1 rounded font-semibold",children:"âœ“ Completed - No Further Changes"})]})},Kt=({id:r,title:i,tasks:b,onTaskClick:V,userRole:A,reassignmentRequests:f={},onAddTask:I})=>{const{setNodeRef:S,isOver:$}=$t({id:r}),w=(v=>{switch(v){case"PENDING":case"To Do":return{borderColor:"border-amber-200",bgColor:"bg-amber-50/30",headerBg:"bg-gradient-to-r from-amber-500 to-amber-600",headerText:"text-white",accentColor:"text-amber-600"};case"In Progress":return{borderColor:"border-blue-200",bgColor:"bg-blue-50/30",headerBg:"bg-gradient-to-r from-blue-500 to-blue-600",headerText:"text-white",accentColor:"text-blue-600"};case"On Hold":return{borderColor:"border-orange-200",bgColor:"bg-orange-50/30",headerBg:"bg-gradient-to-r from-orange-500 to-orange-600",headerText:"text-white",accentColor:"text-orange-600"};case"Review":return{borderColor:"border-purple-200",bgColor:"bg-purple-50/30",headerBg:"bg-gradient-to-r from-purple-500 to-purple-600",headerText:"text-white",accentColor:"text-purple-600"};case"Completed":return{borderColor:"border-emerald-200",bgColor:"bg-emerald-50/30",headerBg:"bg-gradient-to-r from-emerald-500 to-emerald-600",headerText:"text-white",accentColor:"text-emerald-600"};default:return{borderColor:"border-slate-200",bgColor:"bg-slate-50/30",headerBg:"bg-gradient-to-r from-slate-500 to-slate-600",headerText:"text-white",accentColor:"text-slate-600"}}})(i);return e.jsxs("div",{ref:S,className:`flex-shrink-0 w-80 rounded-xl border-2 transition-all duration-200 shadow-sm hover:shadow-md ${$?"border-blue-400 bg-blue-50/50 shadow-lg scale-[1.02]":`${w.borderColor} ${w.bgColor}`}`,children:[e.jsxs("div",{className:`${w.headerBg} ${w.headerText} p-4 rounded-t-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-h4 font-semibold tracking-tight",children:i}),e.jsx("div",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsx("span",{className:"text-caption font-medium",children:b.length})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[I&&e.jsx("button",{onClick:()=>I(i),className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-colors group",title:"Add task",children:e.jsx(Oe,{className:"tm-icon text-white group-hover:scale-110 transition-transform"})}),e.jsx("button",{className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:e.jsx(Nt,{className:"tm-icon text-white"})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-white/80",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60"}),e.jsxs("span",{className:"text-caption",children:[b.filter(v=>v.priority==="high").length," high priority"]})]}),b.some(v=>v.due_date)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60"}),e.jsxs("span",{className:"text-caption",children:[b.filter(v=>{if(!v.due_date)return!1;const k=new Date(v.due_date)-new Date,H=Math.ceil(k/(1e3*60*60*24));return H<=3&&H>=0}).length," due soon"]})]})]})]}),e.jsxs("div",{className:"p-4 max-h-[65vh] overflow-y-auto space-y-3",children:[e.jsx(Lt,{items:b.map(v=>v.id||v._id||v.public_id),strategy:Mt,children:b.map(v=>e.jsx(Ve,{task:v,onClick:()=>V(v),userRole:A,reassignmentRequests:f},v.id||v._id||v.public_id))}),b.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-3",children:e.jsx(Oe,{className:"tm-icon text-slate-400"})}),e.jsx("p",{className:"text-caption text-slate-500 mb-1",children:"No tasks yet"}),e.jsx("p",{className:"text-meta text-slate-400",children:"Drop tasks here or create new ones"})]})]})]})},zt=r=>{const i=(r==null?void 0:r.id)||(r==null?void 0:r.public_id)||(r==null?void 0:r.internal_id);return typeof i=="string"&&/^\d+$/.test(i)?parseInt(i,10):i},Yt=({tasks:r=[],kanbanData:i,onUpdateTask:b,onStartTask:V,onPauseTask:A,onResumeTask:f,onCompleteTask:I,onLoadTasks:S,userRole:$="employee",projectId:y=null,reassignmentRequests:w={},isTaskReadOnly:v=()=>!1})=>{const[L,E]=x.useState(null),[k,H]=x.useState(null),[B,R]=x.useState(!1),U=Ut(Ae(Wt),Ae(Bt,{coordinateGetter:Vt})),P=x.useMemo(()=>{console.log("KanbanBoard columns useMemo:",{kanbanData:i,tasks:r});const D={"To Do":r.filter(h=>{const p=(h.status||h.stage||"").toUpperCase();return p==="PENDING"||p==="TO_DO"||p==="TODO"}),"In Progress":r.filter(h=>{const p=(h.status||h.stage||"").toUpperCase();return p==="IN_PROGRESS"||p==="IN PROGRESS"}),"On Hold":r.filter(h=>{const p=(h.status||h.stage||"").toUpperCase();return p==="ON_HOLD"||p==="ON HOLD"}),Review:r.filter(h=>(h.status||h.stage||"").toUpperCase()==="REVIEW"),Completed:r.filter(h=>{const p=(h.status||h.stage||"").toUpperCase();return p==="COMPLETED"||p==="COMPLETE"})};return i&&Array.isArray(i)&&i.length>0&&i.forEach(h=>{const p=(h.status||"").toUpperCase();let c="To Do";p==="PENDING"||p==="TO_DO"?c="To Do":p==="IN_PROGRESS"?c="In Progress":p==="ON_HOLD"?c="On Hold":p==="REVIEW"?c="Review":p==="COMPLETED"&&(c="Completed"),h.tasks&&Array.isArray(h.tasks)&&h.tasks.forEach(a=>{r.some(T=>T.id===a.id||T._id===a._id||T.public_id===a.public_id)||(D[c]=[...D[c],a])})}),D},[r,i]),G=D=>{const{active:h}=D,p=r.find(_=>_.id===h.id||_._id===h.id||_.public_id===h.id);if(!p)return;if(p.is_locked===!0){u.error("This task is locked and cannot be moved until your manager responds.");return}if(p.status==="Completed"){u.error("Completed tasks cannot be moved. Task is locked.");return}const c=p.id||p._id||p.public_id,a=w[c];if((a==null?void 0:a.status)==="PENDING"){u.error("You have submitted a reassignment request. Task is locked until manager responds.");return}E(p)},F=async D=>{const{active:h,over:p}=D;if(E(null),!p)return;const c=h.id,a=p.id,_=r.find(q=>q.id===c||q._id===c||q.public_id===c);if(!_)return;if(_.is_locked===!0){u.error("This task is locked and cannot be moved until your manager responds.");return}if(_.status==="Completed"){u.error("Completed tasks cannot be moved. Task is locked.");return}if(v(_)){u.error("You have readonly access to this task and cannot move it.");return}let T=null;if(Object.keys(P).includes(a))T=a;else for(const[q,ae]of Object.entries(P))if(ae.findIndex(X=>X.id===a||X._id===a||X.public_id===a)!==-1){T=q;break}if(!T)return;const j=_.status||_.stage,Y=zt(_);try{T==="In Progress"?j==="PENDING"||j==="Pending"||j==="To Do"||j==="PENDING"||j==="TO_DO"||j==="TO DO"?await V(Y):j==="On Hold"||j==="ON_HOLD"?await f(Y):u.error(`Cannot move from ${j} to In Progress`):T==="On Hold"?j==="In Progress"||j==="IN_PROGRESS"?await A(Y):u.error(`Cannot move from ${j} to On Hold`):T==="Review"?j==="In Progress"||j==="IN_PROGRESS"?await I(Y):u.error(`Cannot move from ${j} to Review`):T==="To Do"&&(j==="In Progress"||j==="IN_PROGRESS"||j==="On Hold"||j==="ON_HOLD"?u.error("Moving back to To Do is not currently supported"):u.error(`Cannot move from ${j} to To Do`))}catch(q){u.error((q==null?void 0:q.message)||"Failed to update task status"),console.error("Drag end error:",q)}},Q=D=>{H(D),R(!0)};return e.jsx("div",{className:"h-full w-full",children:e.jsxs(Gt,{sensors:U,collisionDetection:Ft,onDragStart:G,onDragEnd:F,children:[e.jsx("div",{className:"flex h-full gap-6 overflow-x-auto pb-6",children:Object.entries(P).map(([D,h])=>e.jsx(Kt,{id:D,title:D,tasks:h,onTaskClick:Q,userRole:$,reassignmentRequests:w},D))}),jt.createPortal(e.jsx(Ht,{children:L?e.jsx(Ve,{task:L,isDragging:!0,userRole:$,reassignmentRequests:w}):null}),document.body)]})})},Jt=({task:r,projectId:i,onSuccess:b})=>{var B;const V=Ge(),A=Fe(He),[f,I]=x.useState(!1),[S,$]=x.useState(!1),[y,w]=x.useState(""),v=((B=A==null?void 0:A.role)==null?void 0:B.toLowerCase())==="employee",L=((r==null?void 0:r.status)||(r==null?void 0:r.stage)||"").toString().toUpperCase(),E=L==="IN_PROGRESS"||L==="IN PROGRESS"||L==="INPROGRESS",k=(()=>{if(!r||!A)return!1;const R=r.assignedUsers||r.assigned_users||r.assigned_to||[];if(Array.isArray(R)){const U=R.find(P=>String(P.id||P._id||P.internalId||P.public_id)===String(A.id||A._id||A.internal_id||A.public_id));return(U==null?void 0:U.readOnly)===!0}return!1})();if(!v||!E)return null;const H=async()=>{if(!y.trim()){u.error("Please provide a reason for completion request");return}if(k){u.error("You have read-only access to this task and cannot request completion");return}I(!0);try{const R=await V(_t({taskId:r.id||r._id,projectId:i,reason:y.trim()})).unwrap();u.success("Task completion requested successfully"),$(!1),w(""),b&&b({...r,status:"REVIEW"})}catch(R){u.error(R||"Failed to request task completion")}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{k||$(!0)},disabled:f||k,title:k?"You have read-only access to this task":"",className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white ${k?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} disabled:bg-blue-400 rounded-md transition-colors`,children:[f?e.jsx(wt,{className:"w-4 h-4 animate-spin"}):e.jsx(vt,{className:"w-4 h-4"}),"Request Completion"]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Task Completion"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide a reason for requesting completion approval:"}),e.jsx("textarea",{value:y,onChange:R=>w(R.target.value),placeholder:"Explain why this task is ready for completion...",className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,maxLength:500}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:f||!y.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 rounded-md",children:f?"Submitting...":"Submit Request"})]})]})})]})},{AlertCircle:Qt,CheckCircle:qe,Play:Xt,Pause:Zt,RotateCcw:es,Clock:$e,Kanban:Le,List:Me,CheckSquare:ts,User:ss,Calendar:rs,RefreshCw:se,Filter:as,ChevronDown:ns}=St,C=r=>{if(!r)return"";if(typeof r=="string"||typeof r=="number")return String(r);const i=r.id||r.public_id||r.internal_id||r.internalId||r._id;return i!=null?String(i):""},re=r=>{if(!r)return"â€”";const i=new Date(r);return Number.isNaN(i.getTime())?r:i.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},ls=r=>{if(!r)return"";const i=new Date(r);return Number.isNaN(i.getTime())?"":i.toISOString().split("T")[0]},M=r=>{const i=(r==null?void 0:r.id)||(r==null?void 0:r.public_id)||(r==null?void 0:r.internal_id);return typeof i=="string"&&/^\d+$/.test(i)?parseInt(i,10):i},Ue=r=>typeof r=="string"&&/^\d+$/.test(r)?parseInt(r,10):r,he=r=>{if(!r)return"bg-gray-100 text-gray-800 border-gray-200";switch(r.toUpperCase()){case"TODO":case"TO DO":case"PENDING":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"IN_PROGRESS":case"IN PROGRESS":return"bg-blue-100 text-blue-800 border-blue-200";case"REVIEW":return"bg-purple-100 text-purple-800 border-purple-200";case"COMPLETED":return"bg-green-100 text-green-800 border-green-200";case"ON_HOLD":case"ON HOLD":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},os=r=>{switch((r||"MEDIUM").toUpperCase()){case"HIGH":return"bg-red-100 text-red-800 border-red-200";case"MEDIUM":return"bg-amber-100 text-amber-800 border-amber-200";case"LOW":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-amber-100 text-amber-800 border-amber-200"}},ys=()=>{var De,Re,Ee;Ct();const r=Ge(),i=Fe(He),b=(De=i==null?void 0:i.role)==null?void 0:De.toLowerCase(),[V,A]=x.useState([]),f=x.useCallback(t=>{if(!t)return!1;if(t.readOnly===!0)return!0;if(t.assignedUsers&&Array.isArray(t.assignedUsers)){const s=t.assignedUsers.find(n=>n.id===(i==null?void 0:i.id)||n._id===(i==null?void 0:i._id)||n.public_id===(i==null?void 0:i.public_id)||n.internalId===(i==null?void 0:i.internal_id));if((s==null?void 0:s.readOnly)===!0)return!0}return pe(t)||Z(t)||K(t)==="pending"},[i]),I=x.useCallback(async t=>{const s=typeof t=="object"?M(t):t;if(!s)return u.error("Task not found"),{ok:!1};try{const n=await z(`/api/tasks/${s}`),o=(n==null?void 0:n.data)||n;return f(o)?(u.error("Task is under review. No actions are allowed."),{ok:!1,latestTask:o}):{ok:!0,latestTask:o}}catch(n){return u.error("Failed to validate task state"),console.error("ensureTaskWritable error:",n),{ok:!1}}},[f]),[S,$]=x.useState(""),[y,w]=x.useState([]),[v,L]=x.useState([]),[E,k]=x.useState(!0),[H,B]=x.useState(null),[R,U]=x.useState("list"),[P,G]=x.useState({title:"",dueDate:""}),[F,Q]=x.useState(""),[D,h]=x.useState({title:"",dueDate:""}),[p,c]=x.useState(!1),[a,_]=x.useState(null),[T,j]=x.useState(null),[Y,q]=x.useState({}),[ae,Be]=x.useState(!1),[X,ue]=x.useState({}),[is,We]=x.useState({}),[ds,Ke]=x.useState(null),[ne,ze]=x.useState([]),[me,Ye]=x.useState(""),[xe,be]=x.useState(!1),[le,Je]=x.useState("all"),[Qe,fe]=x.useState(0),[cs,us]=x.useState(!1),[ms,xs]=x.useState(""),[gs,Xe]=x.useState(!1),[ps,ge]=x.useState({}),[Ze,oe]=x.useState({}),et=["all","PENDING","IN_PROGRESS","COMPLETED","ON_HOLD","TO DO","REVIEW"];x.useEffect(()=>{const t=setInterval(()=>{oe(s=>{const n={...s};return Object.keys(n).forEach(o=>{n[o]&&(n[o]=n[o]+1)}),n})},1e3);return()=>clearInterval(t)},[]);const tt=(t,s=0)=>{const n=t+s,o=Math.floor(n/3600),d=Math.floor(n%3600/60),g=n%60;return`${o.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`},st=t=>{const s=(t==null?void 0:t.total_time_hours)||0,n=(t==null?void 0:t.total_time_hhmmss)||"00:00:00",[o,d,g]=n.split(":").map(Number);return o*3600+d*60+g+s*3600},rt=async()=>{try{const t=await z("/api/projects?dropdown=1"),s=(t==null?void 0:t.data)||t||[];if(Array.isArray(s)&&(A(s),s.length>0&&!S)){const n=s[0].projectId||s[0].id||s[0]._id||s[0].public_id;$(n)}}catch(t){console.error("Failed to load projects:",t)}},at=async t=>{if(t){k(!0),B(null);try{const s=await r(Rt({project_id:t})).unwrap(),n=Array.isArray(s)?s:(s==null?void 0:s.data)||[],o=(s==null?void 0:s.kanban)||[];if(Array.isArray(n)){w(n),L(o);const d={};n.forEach(l=>{const m=C(l);m&&l.checklist&&l.checklist.length>0&&(d[m]=l.checklist)}),q(d);const g={};n.forEach(l=>{const m=C(l);m&&l.lock_info&&l.lock_info.is_locked&&(g[m]={id:l.lock_info.request_id,taskId:l.id||l.internal_id,status:l.lock_info.request_status||"PENDING",requested_at:l.lock_info.requested_at,responded_at:l.lock_info.responded_at,requester_name:l.lock_info.requester_name})}),ue(g)}else w([]),L([])}catch(s){B((s==null?void 0:s.message)||"Failed to load tasks"),w([])}finally{k(!1)}}},ee=async t=>{try{const s=M(t);if(!s){console.warn("Invalid task ID for timeline:",t);return}const n=await r(Ot(s)).unwrap();if(n){const o=C(t);We(d=>({...d,[o]:n}))}}catch(s){console.error("Failed to load task timeline:",s)}},nt=async()=>{try{const t=await z("/api/manager/employees/all"),s=Array.isArray(t==null?void 0:t.data)?t.data:t;ze(Array.isArray(s)?s:[])}catch(t){console.error("Failed to load employees:",t)}},lt=async()=>{k(!0),B(null);try{const s=await z("/api/employee/my-tasks")||{},n=Array.isArray(s.data)?s.data:Array.isArray(s)?s:[],o=Array.isArray(s.kanban)?s.kanban:[];if(Array.isArray(n)){w(n),L(o);const d={};n.forEach(l=>{const m=C(l);m&&Array.isArray(l.checklist)&&l.checklist.length>0&&(d[m]=l.checklist)}),q(d);const g={};n.forEach(l=>{const m=C(l),N=l.lock_info||l.task_status||{};m&&(N.is_locked||l.is_locked)&&(g[m]={id:N.request_id||N.requestId||null,taskId:l.id||l.internal_id||l.public_id||l._id||l.internalId,status:N.request_status||N.status||"PENDING",requested_at:N.requested_at||N.requestedAt||null,responded_at:N.responded_at||N.respondedAt||null,requester_name:N.requester_name||N.requesterName||null})}),ue(g)}else w([]),L([])}catch(t){B((t==null?void 0:t.message)||"Failed to load tasks"),w([])}finally{k(!1)}};x.useEffect(()=>{rt(),b!=="employee"&&nt()},[]),x.useEffect(()=>{const t=setTimeout(()=>{if(b==="employee"){lt();return}S&&at(Ue(S))},100);return()=>clearTimeout(t)},[S,b,Qe]);const ye=x.useMemo(()=>le==="all"?y:y.filter(t=>{const s=(t.status||t.stage||"").toUpperCase(),n=le.toUpperCase();return n==="TO DO"?s==="TO DO"||s==="PENDING"||s==="TODO":n==="IN_PROGRESS"||n==="IN PROGRESS"?s==="IN_PROGRESS"||s==="IN PROGRESS":n==="ON_HOLD"||n==="ON HOLD"?s==="ON_HOLD"||s==="ON HOLD"||s==="On Hold":s===n}),[y,le]),Ne=()=>{const t={pending:0,in_progress:0,completed:0,on_hold:0,review:0,to_do:0};return y.forEach(s=>{const n=(s.status||"").toLowerCase();if(n==="pending"||n==="to do")t.pending++;else if(n==="in progress"||n==="in_progress")t.in_progress++;else if(n==="completed")t.completed++;else if(n==="on hold"||n==="on_hold")t.on_hold++;else if(n==="review")t.review++;else{const o=(s.stage||"").toLowerCase();t.pending++}}),t},je=x.useMemo(()=>{const t=Ne(),s=[],n=Date.now();return y.forEach(o=>{const d=new Date(o.taskDate||o.dueDate||o.due_date||null),l=(o.status||"").toLowerCase()==="completed";!Number.isNaN(d.getTime())&&d.getTime()<n&&!l&&s.push(o)}),{total:y.length,overdue:s.length,stageCounters:t}},[y]),te=(t,s)=>{w(n=>{const o=n.findIndex(m=>C(m)===t);if(o===-1)return n;const d=n[o],g={...d,...s,status:s.status||d.status||d.stage,stage:s.stage||d.stage||d.status},l=[...n];return l[o]=g,l}),a&&C(a)===t&&_(n=>({...n,...s}))},W=()=>{fe(t=>t+1)},we=async t=>{try{if(!(await I(t)).ok)return;const n=typeof t=="object"?M(t):t,o=typeof t=="object"?t:y.find(l=>M(l)===t);if(!n){u.error("Task not found");return}const d=await r(Pt(n)).unwrap();u.success("Task started");const g={status:"IN_PROGRESS",started_at:(d==null?void 0:d.started_at)||new Date().toISOString(),is_locked:!1};ge(l=>({...l,[n]:!0})),oe(l=>({...l,[n]:0})),te(C(o),g),o&&ee(o),setTimeout(()=>W(),500)}catch(s){u.error((s==null?void 0:s.message)||"Failed to start task"),console.error("Start task error:",s)}},ve=async t=>{try{if(!(await I(t)).ok)return;const n=typeof t=="object"?M(t):t,o=typeof t=="object"?t:y.find(l=>M(l)===t);if(!n){u.error("Task not found");return}const d=await r(kt(n)).unwrap();u.success("Task paused"),ge(l=>({...l,[n]:!1})),oe(l=>{const m={...l};return delete m[n],m});const g={status:"ON_HOLD",is_locked:!1};te(C(o),g),o&&ee(o),setTimeout(()=>W(),500)}catch(s){u.error((s==null?void 0:s.message)||"Failed to pause task"),console.error("Pause task error:",s)}},_e=async t=>{try{if(!(await I(t)).ok)return;const n=typeof t=="object"?M(t):t,o=typeof t=="object"?t:y.find(l=>M(l)===t);if(!n){u.error("Task not found");return}const d=await r(It(n)).unwrap();u.success("Task resumed"),ge(l=>({...l,[n]:!0})),oe(l=>({...l,[n]:0}));const g={status:"IN_PROGRESS",is_locked:!1};te(C(o),g),o&&ee(o),setTimeout(()=>W(),500)}catch(s){u.error((s==null?void 0:s.message)||"Failed to resume task"),console.error("Resume task error:",s)}},Ce=async t=>{const s=typeof t=="object"?t:y.find(o=>M(o)===t);if((await I(t)).ok)try{if(((s==null?void 0:s.status)||(s==null?void 0:s.stage)||"").toString().toUpperCase()==="REVIEW"){u.error("Task is in review and cannot be completed directly");return}const d=typeof t=="object"?M(t):t;if(!d){u.error("Task not found");return}const g=Ue((s==null?void 0:s.projectId)||(s==null?void 0:s.project_id)||S),l=await r(Et({taskId:d,projectId:g})).unwrap();u.success("Review requested â€” sent for manager approval");const m={status:"REVIEW",is_locked:!1,lock_info:{is_locked:!1,request_status:"PENDING"}};te(C(s),m),a&&C(a)===C(s)&&_(N=>({...N,...m})),ee(s),setTimeout(()=>W(),500)}catch(o){u.error((o==null?void 0:o.message)||"Failed to request task completion"),console.error("Request task completion error:",o)}},ot=async t=>{if(t.preventDefault(),!a){u.error("Select a task before adding checklist items");return}if(!P.title.trim()){u.error("Checklist title is required");return}c(!0);try{if(!(await I(a)).ok)return;const o={taskId:M(a),title:P.title.trim(),dueDate:P.dueDate||void 0},d=await z("/api/employee/subtask",{method:"POST",body:JSON.stringify(o)}),g=d.data;u.success((d==null?void 0:d.message)||"Checklist item added"),G({title:"",dueDate:""});const l=C(a);w(m=>m.map(N=>C(N)===l?{...N,checklist:[...N.checklist||[],g]}:N)),a&&_(m=>({...m,checklist:[...m.checklist||[],g]}))}catch(s){u.error((s==null?void 0:s.message)||"Unable to add checklist item")}finally{c(!1)}},it=t=>{const s=(t==null?void 0:t.id)||(t==null?void 0:t.public_id);s&&(Q(s),h({title:t.title||"",dueDate:ls(t.dueDate)}))},Se=()=>{Q(""),h({title:"",dueDate:""})},dt=async()=>{if(!(!F||!a)){if(!D.title.trim()){u.error("Checklist title cannot be empty");return}c(!0);try{if(!(await I(a)).ok)return;const s=M(a),n={title:D.title.trim(),dueDate:D.dueDate||void 0,taskId:s},o=await z(`/api/employee/subtask/${F}`,{method:"PUT",body:JSON.stringify(n)}),d=o.data;u.success((o==null?void 0:o.message)||"Checklist item updated"),Se();const g=C(a);w(l=>l.map(m=>C(m)===g?{...m,checklist:(m.checklist||[]).map(N=>(N.id||N.public_id)===F?d:N)}:m)),a&&_(l=>({...l,checklist:(l.checklist||[]).map(m=>(m.id||m.public_id)===F?d:m)}))}catch(t){u.error((t==null?void 0:t.message)||"Unable to update checklist item")}finally{c(!1)}}},ct=async t=>{const s=(t==null?void 0:t.id)||(t==null?void 0:t.public_id);if(!(!s||!a)&&window.confirm("Remove this checklist item?")){c(!0);try{if(!(await I(a)).ok)return;const o=await z(`/api/employee/subtask/${s}`,{method:"DELETE"});u.success((o==null?void 0:o.message)||"Checklist item removed");const d=C(a);w(g=>g.map(l=>C(l)===d?{...l,checklist:(l.checklist||[]).filter(m=>(m.id||m.public_id)!==s)}:l)),a&&_(g=>({...g,checklist:(g.checklist||[]).filter(l=>(l.id||l.public_id)!==s)}))}catch(n){u.error((n==null?void 0:n.message)||"Unable to delete checklist item")}finally{c(!1)}}},ut=async t=>{const s=(t==null?void 0:t.id)||(t==null?void 0:t.public_id);if(!(!s||!a)){c(!0);try{const n=await z(`/api/employee/subtask/${s}/complete`,{method:"POST"}),o=n.data;u.success((n==null?void 0:n.message)||"Checklist marked complete");const d=C(a);w(g=>g.map(l=>{if(C(l)===d){const m=(l.checklist||[]).map(N=>(N.id||N.public_id)===s?o:N);return{...l,checklist:m}}return l})),a&&_(g=>({...g,checklist:(g.checklist||[]).map(l=>(l.id||l.public_id)===s?o:l)}))}catch(n){u.error((n==null?void 0:n.message)||"Unable to update checklist status")}finally{c(!1)}}},mt=t=>{Ke(t),ee(t),Xe(!0)},xt=async()=>{if(T){if(f(T)){u.error("Task is under review. No actions are allowed.");return}be(!0);try{const t=M(T),s=await z(`/api/tasks/${t}/request-reassignment`,{method:"POST",body:JSON.stringify({reason:T.reassignReason||"Requesting reassignment"})});s.success?(u.success(s.message||"Reassignment request sent"),fe(n=>n+1),j(null)):u.error(s.error||"Failed to request reassignment")}catch(t){u.error(t.message||"Failed to request reassignment")}finally{be(!1)}}},Te=V.find(t=>(t.id||t._id||t.public_id)===S),ie=x.useMemo(()=>a?a.checklist||[]:[],[a]);a!=null&&a.project||((Re=a==null?void 0:a.meta)==null||Re.project),x.useMemo(()=>{if(!a)return"â€”";const t=a.taskDate||a.dueDate;return t?re(t):"â€”"},[a]);const J=x.useMemo(()=>Ne(),[y]),K=t=>{var d;if(!t)return null;const s=t.lock_info||{},n=t.task_status||{},o=s.request_status||n.request_status||((d=X[C(t)])==null?void 0:d.status)||null;return o==="PENDING"?"pending":o==="APPROVE"||o==="APPROVED"?"approved":o==="DENY"||o==="DENIED"||o==="REJECTED"?"denied":null},O=t=>(t.status||"").toLowerCase()==="completed";return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:b==="employee"?"My Tasks":"Tasks"}),e.jsx("p",{className:"text-gray-600",children:b==="employee"?"Track your assignments and keep checklists aligned with manager expectations.":"Manage and track all tasks across projects."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[b!=="employee"&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:S||"",onChange:t=>$(t.target.value),className:"border border-gray-300 rounded-lg px-4 py-2 pr-8 bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none min-w-[200px]",children:[e.jsx("option",{value:"",children:"Select a project"}),V.map(t=>{const s=t.public_id||t.id||t._id;return e.jsx("option",{value:s,children:t.name},s)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(ns,{className:"w-4 h-4"})})]}),b==="employee"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>U("list"),className:`px-3 py-2 rounded-lg border ${R==="list"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Me,{className:"tm-icon mr-2 inline"}),"List"]}),e.jsxs("button",{onClick:()=>U("kanban"),className:`px-3 py-2 rounded-lg border ${R==="kanban"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Le,{className:"tm-icon mr-2 inline"}),"Kanban"]})]}),e.jsx("button",{onClick:W,disabled:E||b!=="employee"&&!S,className:`p-2 rounded-lg border ${E||b!=="employee"&&!S?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-blue-600 hover:bg-blue-50 border-blue-200"}`,title:"Refresh tasks",children:e.jsx(se,{className:`w-5 h-5 ${E?"animate-spin":""}`})})]})]}),(b==="employee"||S&&y.length>0)&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3 mb-6",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Total"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:je.total}),e.jsx("p",{className:"text-xs text-gray-500",children:"Current assignments"})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-amber-500",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-500",children:je.overdue}),e.jsx("p",{className:"text-xs text-gray-500",children:"Need immediate attention"})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-blue-500",children:"In progress"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-500",children:J.in_progress}),e.jsx("p",{className:"text-xs text-gray-500",children:"Work you are handling"})]})]}),(b==="employee"&&y.length>0||S&&y.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-yellow-100 text-yellow-800 font-semibold shadow-sm border border-yellow-200",children:["Pending: ",J.pending]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-blue-100 text-blue-800 font-semibold shadow-sm border border-blue-200",children:["In Progress: ",J.in_progress]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-green-100 text-green-800 font-semibold shadow-sm border border-green-200",children:["Completed: ",J.completed]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-red-100 text-red-800 font-semibold shadow-sm border border-red-200",children:["On Hold: ",J.on_hold]}),J.review>0&&e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-purple-100 text-purple-800 font-semibold shadow-sm border border-purple-200",children:["Review: ",J.review]})]}),S&&y.length>0&&Te&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:[Te.name," - Tasks (",y.length,")"]}),e.jsx("p",{className:"text-gray-600",children:"Showing tasks for selected project"})]}),(b==="employee"&&y.length>0||S&&y.length>0)&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Filters:"})]}),e.jsxs("select",{value:le,onChange:t=>Je(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:E,children:[e.jsx("option",{value:"all",children:"All Status"}),et.filter(t=>t!=="all").map(t=>e.jsx("option",{value:t,children:ce(t)},t))]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("span",{className:"text-gray-700 font-medium text-sm",children:"View:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>U("list"),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${R==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-1"}),"List"]}),e.jsxs("button",{onClick:()=>U("kanban"),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${R==="kanban"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Le,{className:"w-4 h-4 inline mr-1"}),"Kanban"]})]})]})]}),b!=="employee"&&!S&&!E&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(Qt,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Project"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please select a project from the dropdown above to view and manage tasks."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:V.slice(0,5).map(t=>{const s=t.public_id||t.id||t._id;return e.jsx("button",{onClick:()=>$(s),className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",children:t.name},s)})})]}),R==="kanban"?e.jsx(Yt,{tasks:ye,kanbanData:v,onStartTask:we,onPauseTask:ve,onResumeTask:_e,onCompleteTask:Ce,onLoadTasks:W,userRole:b,projectId:S,reassignmentRequests:X,isTaskReadOnly:f}):e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.8fr)_minmax(0,1.2fr)]",children:[e.jsxs("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Assigned tasks"}),e.jsx("p",{className:"text-xs text-gray-500",children:E?"Refreshing tasksâ€¦":`${y.length} total tasks`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("button",{type:"button",onClick:W,disabled:E||b!=="employee"&&!S,className:"rounded-full border border-gray-200 bg-gray-50 px-3 py-1 hover:bg-gray-100 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(se,{className:`w-3 h-3 ${E?"animate-spin":""}`}),"Refresh"]}),b==="employee"&&e.jsx(Tt,{to:"/employee/tasks",className:"text-blue-600 hover:underline",children:"Full task view"})]})]}),E?e.jsx("div",{className:"mt-6 text-sm text-gray-500",children:"Loading tasksâ€¦"}):H?e.jsxs("div",{className:"mt-6 text-sm text-red-500",children:["Error: ",H]}):y.length===0?e.jsx("div",{className:"mt-6 text-sm text-gray-500",children:"No tasks assigned yet."}):e.jsx("div",{className:"mt-4 space-y-3",children:ye.map(t=>{var ke,Pe;const s=C(t),n=s===C(a),o=K(t),d=o==="pending",g=o==="approved",l=o==="denied",m=O(t),N=t.checklist?t.checklist.filter(de=>de.status==="Completed").length:0,Ie=t.checklist?t.checklist.length:0;return e.jsxs("button",{type:"button",disabled:d||m||Z(t),onClick:()=>_(t),className:`w-full rounded-2xl border px-4 py-3 text-left shadow-sm transition ${m?"border-green-300 bg-green-50 opacity-75 cursor-not-allowed":d?"border-orange-300 bg-orange-50 opacity-75 cursor-not-allowed":`hover:border-blue-300 hover:bg-blue-50 ${n?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900 truncate",children:t.title||"Untitled task"}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Priority: ",e.jsx("span",{className:`font-medium ${os(t.priority)}`,children:t.priority||"Medium"})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Status: ",e.jsx("span",{className:`font-medium ${he(t.status||t.stage)}`,children:ce(t.status||t.stage)})]})]}),t.taskDate&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(rs,{className:"w-3 h-3"}),e.jsxs("span",{children:[re(t.taskDate)," (",t.dayName||"Unknown day",")"]})]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500 flex flex-col gap-1",children:[t.assignedUsers&&t.assignedUsers.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ss,{className:"w-3 h-3"}),e.jsx("span",{children:t.assignedUsers.map(de=>de.name||de.email).join(", ")})]}),t.client&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Client: ",t.client.name||t.client.company]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsxs("span",{children:["Est: ",t.timeAlloted||t.estimatedHours||0,"h"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Actual: ",tt(st(t),Ze[s]||0)]})}),((ke=t.summary)==null?void 0:ke.dueStatus)&&e.jsx("div",{className:`text-xs font-medium ${t.summary.dueStatus==="overdue"?"text-red-600":"text-orange-600"}`,children:t.summary.dueStatus==="overdue"?"Overdue":"Due Soon"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs font-semibold",children:[e.jsx("span",{className:`rounded-full border px-3 py-0.5 ${he(t.status||t.stage)}`,children:ce(t.status||t.stage)}),e.jsx("span",{className:"rounded-full border border-gray-200 px-3 py-0.5 text-gray-600",children:((Pe=t.client)==null?void 0:Pe.name)||"Client not available"}),Ie>0&&e.jsxs("span",{className:"rounded-full border border-blue-200 bg-blue-50 px-3 py-0.5 text-blue-600 flex items-center gap-1",children:[e.jsx(ts,{className:"w-3 h-3"}),N,"/",Ie]}),m&&e.jsx("span",{className:"rounded-full border border-green-200 bg-green-50 px-3 py-0.5 text-green-600 font-medium",children:"âœ“ No Further Changes"}),d&&e.jsx("span",{className:"rounded-full border border-orange-200 bg-orange-50 px-3 py-0.5 text-orange-600 font-medium",children:"ðŸ”’ Reassignment Pending"}),g&&e.jsx("span",{className:"rounded-full border border-green-200 bg-green-50 px-3 py-0.5 text-green-600 font-medium",children:"âœ… Reassignment Approved"}),l&&e.jsx("span",{className:"rounded-full border border-red-200 bg-red-50 px-3 py-0.5 text-red-600 font-medium",children:"âŒ Reassignment Denied"})]})]},s||t.title)})})]}),e.jsx("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.title}),e.jsx("span",{className:`rounded-full border px-3 py-1 text-xs font-semibold ${he(a.status||a.stage)}`,children:ce(a.status||a.stage)})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((Ee=a.project)==null?void 0:Ee.name)&&`Project: ${a.project.name}`}),O(a)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-xs mt-1",children:["Total working hours: ",e.jsx("span",{className:"font-bold",children:a.total_time_hhmmss||"0h 0m"})]}),e.jsx("p",{className:"text-xs mt-1",children:"This task is locked and cannot be modified further."})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Due ",re(a.taskDate||a.dueDate)]}),(()=>{const t=K(a);return t==="pending"?e.jsxs("div",{className:"rounded-lg border border-orange-200 bg-orange-50 p-3 text-sm text-orange-700",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”’ Reassignment Request Pending"}),e.jsx("p",{className:"text-xs",children:"Your manager is reviewing your reassignment request. Task is locked until they respond."})]}):t==="approved"?e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Reassignment Approved"}),e.jsx("p",{className:"text-xs",children:"Your manager has approved your reassignment request."})]}):t==="denied"?e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("p",{className:"font-semibold",children:"âŒ Reassignment Denied"}),e.jsx("p",{className:"text-xs",children:"Your manager has denied your reassignment request."})]}):null})(),pe(a)&&e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-purple-50 p-3 text-sm text-purple-700 mt-3",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”Ž Task Under Review"}),e.jsx("p",{className:"text-xs",children:"Task is under review. No actions are allowed."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:W,disabled:E,className:"flex items-center gap-2 px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(se,{className:`w-4 h-4 ${E?"animate-spin":""}`}),"Refresh Tasks"]})}),b==="employee"&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.status==="Pending"||a.status==="To Do"||a.stage==="PENDING"?e.jsxs("button",{onClick:()=>we(a),disabled:f(a)||K(a)==="pending"||O(a)||Z(a),className:"rounded-full border border-green-200 px-3 py-1 text-green-600 hover:bg-green-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Xt,{className:"w-3 h-3"}),"Start Task"]}):null,a.status==="IN_PROGRESS"||a.status==="In Progress"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ve(a),disabled:f(a)||K(a)==="pending"||O(a)||Z(a),className:"rounded-full border border-orange-200 px-3 py-1 text-orange-600 hover:bg-orange-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Zt,{className:"w-3 h-3"}),"Pause"]}),e.jsx(Jt,{task:a,projectId:S,onSuccess:t=>{w(s=>s.map(n=>(n.id||n._id)===(t.id||t._id)?t:n))}})]}):null,a.status==="ON_HOLD"||a.status==="On Hold"?e.jsxs("button",{onClick:()=>_e(a),disabled:f(a)||K(a)==="pending"||O(a)||Z(a),className:"rounded-full border border-blue-200 px-3 py-1 text-blue-600 hover:bg-blue-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(es,{className:"w-3 h-3"}),"Resume"]}):null,(a.status==="IN_PROGRESS"||a.status==="In Progress")&&e.jsxs("button",{onClick:()=>Ce(a),disabled:f(a)||K(a)==="pending"||O(a)||Z(a)||pe(a),className:"rounded-full border border-green-200 px-3 py-1 text-green-600 hover:bg-green-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(qe,{className:"w-3 h-3"}),"Complete Task"]}),e.jsxs("button",{onClick:()=>mt(a),disabled:f(a)||K(a)==="pending"||O(a),className:"rounded-full border border-indigo-200 px-3 py-1 text-indigo-600 hover:bg-indigo-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($e,{className:"w-3 h-3"}),"Timeline"]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:a.description})]}),b!=="employee"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Reassign Task"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("select",{value:me,onChange:t=>Ye(t.target.value),disabled:ne.length===0||f(a),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Select employee"}),ne.map(t=>{const s=t.internalId||t.id||t.public_id||t._id;return e.jsx("option",{value:s,children:t.name||t.email||"Unnamed"},s)})]}),e.jsx("button",{onClick:xt,disabled:xe||!me||ne.length===0||f(a),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm ${xe||!me||ne.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:xe?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 animate-spin"}),"Reassigning..."]}):"Reassign Task"})]})]}),b==="employee"&&e.jsx("button",{type:"button",onClick:()=>j(a),disabled:f(a)||K(a)==="pending"||O(a),className:"mt-2 rounded-full border border-yellow-300 px-3 py-1 text-yellow-600 hover:bg-yellow-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Request Reassignment"}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Checklist"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[ie.filter(t=>t.status==="Completed").length," / ",ie.length," completed"]})]}),O(a)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 mb-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsx("p",{className:"text-xs mt-1",children:"Checklist is locked. No new items can be added to a completed task."})]}),ie.length===0?e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"No checklist items yet."}):e.jsx("ul",{className:"mt-3 space-y-3",children:ie.map((t,s)=>{const n=t.id||t.public_id||`${s}`,o=F===n,d=re(t.dueDate),g=t.status==="Completed";return o?e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("input",{type:"text",placeholder:"Checklist title",value:D.title,onChange:l=>h(m=>({...m,title:l.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-1.5 text-sm",disabled:O(a)}),e.jsx("input",{type:"date",value:D.dueDate,onChange:l=>h(m=>({...m,dueDate:l.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-1.5 text-sm",disabled:O(a)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{type:"button",onClick:dt,disabled:p,className:"rounded-full bg-indigo-600 px-4 py-1.5 text-white disabled:opacity-60 text-sm",children:p?"Savingâ€¦":"Save"}),e.jsx("button",{type:"button",onClick:Se,className:"rounded-full border border-gray-200 px-4 py-1.5 text-gray-600 text-sm",children:"Cancel"})]})]})},n):e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(qe,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${g?"text-gray-400 line-through":"text-gray-900"}`,children:t.title||"Untitled item"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due ",d]}),t.completedAt&&e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["Completed ",re(t.completedAt)]})]})]}),!g&&!O(a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase text-gray-500",children:[e.jsx("button",{type:"button",onClick:()=>it(t),disabled:f(a),className:"rounded-full border border-gray-200 px-3 py-1 hover:border-blue-300 hover:text-blue-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>ut(t),disabled:f(a)||p,className:"rounded-full border border-emerald-200 px-3 py-1 text-emerald-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Mark complete"}),e.jsx("button",{type:"button",onClick:()=>ct(t),disabled:f(a),className:"rounded-full border border-rose-200 px-3 py-1 text-rose-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]})},n)})}),e.jsxs("form",{onSubmit:ot,className:"mt-4 flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:P.title,onChange:t=>G(s=>({...s,title:t.target.value})),placeholder:"New checklist item",disabled:O(a)||f(a),className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("input",{type:"date",value:P.dueDate,onChange:t=>G(s=>({...s,dueDate:t.target.value})),disabled:O(a)||f(a),className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("button",{type:"submit",disabled:p||O(a)||f(a),className:"rounded-full bg-indigo-600 px-4 py-2 text-white disabled:opacity-60 disabled:cursor-not-allowed text-sm",children:p?"Addingâ€¦":O(a)?"Task Completed - Cannot Add Items":"Add checklist"})]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[e.jsx("p",{children:"Select a task to see richer details and manage its checklist."}),e.jsx("p",{children:"Checklist items live-update and sync with the employee APIs."})]})})]}),e.jsx(Dt,{selectedTask:T,onClose:()=>j(null),onSuccess:t=>{if(t!=null&&t.request&&(t!=null&&t.task)){const s=C(t.task);ue(n=>({...n,[s]:{id:t.request.id,taskId:t.request.task_id,status:t.request.status,requested_at:t.request.requested_at,responded_at:t.request.responded_at}})),te(s,{status:t.task.status||"On Hold",is_locked:!0,lock_info:{is_locked:!0,request_status:"PENDING",request_id:t.request.id}}),u.success((t==null?void 0:t.message)||"Reassignment request submitted successfully")}W()}})]})};export{ys as default};
