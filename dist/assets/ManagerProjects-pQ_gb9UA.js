import{b as je,s as be,r as a,a4 as o,j as e,ao as ye,G as pe,i as Ne}from"./index-CT2igMlm.js";import{V as fe}from"./ViewToggle-DFwV-H2g.js";import{C as ve}from"./Card-Bw0PVUFX.js";const{FolderKanban:se}=pe,ke=()=>{var L,H,M,E,F,D,V,$,U,R,z,B,G,K,W,q,J,Q,X,Y,Z;const m=je(be);m!=null&&m.resources;const[n,te]=a.useState([]),[f,v]=a.useState(!0),[w,S]=a.useState(null),[r,ae]=a.useState({}),[l,le]=a.useState({}),[P,re]=a.useState([]),[ie,C]=a.useState(!0),[we,k]=a.useState(null),[c,ne]=a.useState(""),[h,de]=a.useState("all"),[g,ce]=a.useState("all"),[u,xe]=a.useState("list"),[oe,A]=a.useState(!1),[d,T]=a.useState(null),me=["Planning","Active","On Hold","Completed","Cancelled"],_={Planning:"bg-yellow-100 text-yellow-700",Active:"bg-blue-100 text-blue-700",Completed:"bg-green-100 text-green-700","On Hold":"bg-red-100 text-red-700",Cancelled:"bg-gray-100 text-gray-700"},he=["Low","Medium","High"],j=a.useCallback(async()=>{v(!0);try{const s=await o("/api/manager/projects"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;te(Array.isArray(t)?t:[]),S(null)}catch(s){S(s.message||"Unable to load manager projects")}finally{v(!1)}},[]),b=a.useCallback(async()=>{try{const s=await o("api/projects/stats");ae((s==null?void 0:s.data)||s||{})}catch(s){console.error("Failed to load project stats:",s)}},[]),ge=a.useCallback(async s=>{try{const t=await o(`api/projects/${s}/summary`);le((t==null?void 0:t.data)||t||{})}catch(t){console.error("Failed to load project summary:",t)}},[]),y=a.useCallback(async()=>{C(!0);try{const s=await o("/api/manager/clients"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;re(Array.isArray(t)?t:[]),k(null)}catch(s){k(s.message||"Unable to load clients")}finally{C(!1)}},[]);a.useEffect(()=>{j(),y(),b()},[j,y,b]);const x=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",p=s=>{if(!s)return"-";if(typeof s=="object")return s.name||"-";const t=P.find(i=>(i.public_id||i.id||i._id)===s)||P.find(i=>i.name===s);return(t==null?void 0:t.name)||"-"},O=async s=>{try{const t=s.public_id||s.id||s._id;await ge(t),T(s),A(!0)}catch(t){console.error("Summary error:",t),Ne.error((t==null?void 0:t.message)||"Failed to load project summary")}},N=n.filter(s=>{var I,ee;const t=h==="all"||s.status===h,i=g==="all"||s.priority===g,ue=!c||((I=s.name)==null?void 0:I.toLowerCase().includes(c.toLowerCase()))||((ee=p(s.client||s.client_id))==null?void 0:ee.toLowerCase().includes(c.toLowerCase()));return t&&i&&ue});return e.jsxs("div",{className:"w-full p-6 space-y-6",children:[e.jsx(ye,{title:"Manager Projects",subtitle:"Overview of projects assigned to your clients.",onRefresh:()=>{j(),y(),b()},refreshing:f||ie}),r&&e.jsxs("div",{className:"bg-white rounded-xl border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((L=r.projects)==null?void 0:L.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((H=r.tasks)==null?void 0:H.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[((M=r.tasks)==null?void 0:M.totalHours)||0,"h"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:((E=r.subtasks)==null?void 0:E.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Subtasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-orange-600",children:((D=(F=r.projects)==null?void 0:F.byStatus)==null?void 0:D.Planning)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Planning"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:(($=(V=r.projects)==null?void 0:V.byStatus)==null?void 0:$.Active)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Tasks by Stage"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(((U=r.tasks)==null?void 0:U.byStage)||{}).map(([s,t])=>e.jsx("div",{className:"px-3 py-2 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s,": ",t]})},s))})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-yellow-100 text-yellow-700 font-semibold shadow-sm",children:["Planning: ",n.filter(s=>s.status==="Planning").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-blue-100 text-blue-700 font-semibold shadow-sm",children:["Active: ",n.filter(s=>s.status==="Active").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-green-100 text-green-700 font-semibold shadow-sm",children:["Completed: ",n.filter(s=>s.status==="Completed").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-red-100 text-red-700 font-semibold shadow-sm",children:["On Hold: ",n.filter(s=>s.status==="On Hold").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-semibold shadow-sm",children:["Cancelled: ",n.filter(s=>s.status==="Cancelled").length]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(fe,{mode:u==="list"?"list":"grid",onChange:s=>xe(s==="list"?"list":"card")})}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm",children:[e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-600 shadow-sm",children:["Search",e.jsx("input",{value:c,onChange:s=>ne(s.target.value),placeholder:"Project or client",className:"w-40 bg-transparent px-1 text-xs text-gray-600 outline-none"})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-600 shadow-sm",children:["Status",e.jsxs("select",{value:h,onChange:s=>de(s.target.value),className:"bg-transparent text-xs text-gray-600 outline-none",children:[e.jsx("option",{value:"all",children:"All Status"}),me.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-600 shadow-sm",children:["Priority",e.jsxs("select",{value:g,onChange:s=>ce(s.target.value),className:"bg-transparent text-xs text-gray-600 outline-none",children:[e.jsx("option",{value:"all",children:"All Priority"}),he.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]})]}),f?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-blue-200 border-t-blue-600 rounded-full"})}):w?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"text-red-600 font-semibold",children:"Error Loading Projects"}),e.jsx("div",{className:"text-red-500 mt-2",children:w})]}):e.jsxs(e.Fragment,{children:[u==="list"&&e.jsx("div",{className:"tm-list-container",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"Project"}),e.jsx("th",{className:"p-3 text-left",children:"Client"}),e.jsx("th",{className:"p-3 text-left",children:"Status"}),e.jsx("th",{className:"p-3 text-left",children:"Priority"}),e.jsx("th",{className:"p-3 text-left",children:"Duration"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-sm",children:p(s.client||s.client_id)}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${_[s.status]||"bg-gray-100 text-gray-700"}`,children:s.status||"Planning"})}),e.jsx("td",{className:"p-3 text-sm text-gray-600 uppercase tracking-wide",children:s.priority||"Medium"}),e.jsxs("td",{className:"p-3 text-sm text-gray-600",children:[x(s.start_date)," â†’ ",x(s.end_date)]}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{onClick:()=>O(s),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg",title:"View Summary",children:"ðŸ“Š"})})]},s.id||s._id))})]})}),u==="card"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>e.jsxs(ve,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:p(s.client||s.client_id)})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${_[s.status]||"bg-gray-100 text-gray-700"}`,children:s.status||"Planning"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"flex justify-between text-xs text-gray-600",children:e.jsxs("span",{children:["Priority: ",e.jsx("span",{className:"font-semibold",children:s.priority||"Medium"})]})}),e.jsx("div",{className:"flex justify-between text-xs text-gray-600",children:e.jsxs("span",{children:["Budget: ",e.jsx("span",{className:"font-semibold",children:s.budget?`$${s.budget}`:"N/A"})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t",children:[e.jsxs("span",{children:["ðŸ“… ",x(s.start_date)]}),e.jsx("span",{children:"â†’"}),e.jsx("span",{children:x(s.end_date)})]}),e.jsx("div",{className:"flex items-center justify-between mt-4",children:e.jsx("button",{onClick:()=>O(s),className:"text-purple-600 hover:text-purple-800 text-sm font-medium",children:"View Summary"})})]},s.id||s._id))}),N.length===0&&e.jsxs("div",{className:"bg-white border rounded-xl p-12 text-center",children:[e.jsx(se,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Projects Found"}),e.jsx("p",{className:"text-gray-600",children:"No projects match your current filters."})]})]}),oe&&d&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Project Summary - ",d.name]}),e.jsx("button",{onClick:()=>{A(!1),T(null)},className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Project Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium ml-2",children:((R=l.project)==null?void 0:R.name)||d.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ml-2 px-2 py-1 rounded-full text-xs ${((z=l.project)==null?void 0:z.status)==="Completed"?"bg-green-100 text-green-700":((B=l.project)==null?void 0:B.status)==="Active"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:((G=l.project)==null?void 0:G.status)||d.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Description:"}),e.jsx("span",{className:"font-medium ml-2",children:((K=l.project)==null?void 0:K.description)||d.description})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((W=l.tasks)==null?void 0:W.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((q=l.tasks)==null?void 0:q.completed)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Completed Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:((J=l.tasks)==null?void 0:J.inProgress)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"In Progress"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(((Q=l.tasks)==null?void 0:Q.total)||0)-(((X=l.tasks)==null?void 0:X.completed)||0)-(((Y=l.tasks)==null?void 0:Y.inProgress)||0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pending Tasks"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-purple-600",children:[l.totalHours||0,"h"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-red-600",children:[l.progressPercentage||0,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Progress"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Tasks by Stage"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(((Z=l.tasks)==null?void 0:Z.byStage)||{}).map(([s,t])=>e.jsx("div",{className:"px-3 py-2 bg-white rounded-lg border",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s,": ",t]})},s))})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Project Overview"}),e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("p",{children:"Project summary loaded successfully"}),e.jsx("p",{className:"text-sm mt-2",children:"Activity timeline and detailed logs can be added in future updates"})]})]})]})})]})};export{ke as default};
