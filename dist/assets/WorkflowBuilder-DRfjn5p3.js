import{r as j,j as e,b as N,i as v}from"./index-CT2igMlm.js";import{b as C,c as I,D as k,d as E,S as A,v as R,f as T,P as D,u as W,C as M}from"./sortable.esm-FDZjIYVK.js";const P=({id:i,step:c,onChange:x,onRemove:l})=>{const{attributes:o,listeners:h,setNodeRef:d,transform:m,transition:f}=W({id:i}),g={transform:M.Transform.toString(m),transition:f};return e.jsxs("div",{ref:d,style:g,className:"p-3 bg-white border rounded-lg shadow-sm flex flex-col gap-2 min-w-[220px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("input",{value:c.name||"",onChange:u=>x({...c,name:u.target.value}),className:"w-full bg-transparent outline-none font-medium"}),e.jsx("div",{...o,...h,className:"cursor-grab text-slate-400 ml-2",children:"≡"})]}),e.jsx("input",{value:c.role||"",onChange:u=>x({...c,role:u.target.value}),className:"text-xs bg-transparent outline-none text-slate-500"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:l,className:"text-xs text-red-500",children:"Remove"})})]})},B=({template:i={},onAddStep:c,onSave:x})=>{const[l,o]=j.useState(i.steps?[...i.steps]:[]);j.useEffect(()=>{o(i.steps?[...i.steps]:[])},[i]);const h=C(I(D)),d=s=>{const{active:n,over:t}=s;if(n.id!==(t==null?void 0:t.id)){const a=l.findIndex(r=>r.id===n.id||r._id===n.id||r.tempId===n.id),p=l.findIndex(r=>r.id===t.id||r._id===t.id||r.tempId===t.id);if(a>=0&&p>=0){const r=T(l,a,p);o(r)}}},m=(s,n)=>{const t=[...l];t[s]=n,o(t)},f=s=>{const n=[...l];n.splice(s,1),o(n)},g=()=>{const s={tempId:`t-${Date.now()}`,name:"New Step",role:"Manager"};o(n=>[...n,s]),c&&c()},u=()=>{x&&x(l)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:i.name||"Untitled Workflow"}),e.jsx("p",{className:"text-sm text-slate-500",children:i.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:u,className:"btn-primary",children:"Save"}),e.jsx("button",{onClick:g,className:"btn-secondary",children:"Add Step"})]})]}),e.jsx(k,{sensors:h,collisionDetection:E,onDragEnd:d,children:e.jsx(A,{items:l.map(s=>s.id||s._id||s.tempId),strategy:R,children:e.jsxs("div",{className:"flex gap-3 items-start overflow-auto py-4",children:[l.length===0&&e.jsx("div",{className:"p-6 rounded-xl border border-dashed text-slate-500",children:"No steps yet. Add one to begin."}),l.map((s,n)=>{const t=s.id||s._id||s.tempId||`${n}`;return e.jsx(P,{id:t,step:s,onChange:a=>m(n,a),onRemove:()=>f(n)},t)})]})})})]})},L=()=>{const[i,c]=j.useState([]),[x]=j.useState(!1),l=N(s=>{var n;return(n=s.auth)==null?void 0:n.user}),o=N(s=>s.projects||{}),h=N(s=>s.departments||{}),[d,m]=j.useState(null),f=async()=>{const s=Number(localStorage.getItem("tenantId")||void 0||1),n=(l==null?void 0:l.id)||(l==null?void 0:l._id)||1,t=o.currentProject||o.projects&&o.projects[0],a=h.departments&&h.departments[0]||null,p=(a==null?void 0:a._id)||(a==null?void 0:a.id)||null,r=(a==null?void 0:a.name)||null,y=(t==null?void 0:t._id)||(t==null?void 0:t.id)||null,_=(t==null?void 0:t.name)||(t==null?void 0:t.project_name)||null,w={tenant_id:s,name:"HR Payroll Task Approval",trigger_event:"TASK_REVIEW",department_id:p,department_name:r,project_id:y,project_name:_,active:!0,created_by:n},b={id:Date.now(),...w,steps:[]};c(S=>[...S,b]),m(b),v.success("Template created (local only)")},g=async()=>{var t;if(!d)return;const s={id:Date.now(),step_order:(((t=d.steps)==null?void 0:t.length)||0)+1,role:"MANAGER",action:"REVIEW",rule_id:5,sla_hours:4,notify:["MANAGER"]},n={...d,steps:[...d.steps||[],s]};c(a=>a.map(p=>(p.id||p._id)===(d.id||d._id)?n:p)),m(n),v.success("Step added (local only)")},u=async s=>{if(!d)return v.error("No template selected");const n={...d,steps:s};c(t=>t.map(a=>(a.id||a._id)===(d.id||d._id)?n:a)),m(n),v.success("Workflow order updated (local only)")};return e.jsxs("section",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Workflow Builder"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Create and manage approval/workflow templates"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:f,className:"btn-primary",children:"Create Template"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-1 bg-white border rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium",children:"Templates"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[x&&e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}),i.map(s=>e.jsxs("div",{onClick:()=>m(s),className:`p-2 rounded-lg cursor-pointer ${d===s?"bg-slate-100":"hover:bg-slate-50"}`,children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.trigger_event})]},s.id||s._id))]})]}),e.jsx("div",{className:"col-span-2 bg-slate-50 p-6 rounded-lg",children:d?e.jsx(B,{template:d,onAddStep:g,onSave:u}):e.jsx("div",{className:"text-slate-500",children:"Select a template to view or edit"})})]})]})};export{L as default};
