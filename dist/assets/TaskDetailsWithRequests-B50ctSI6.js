import{D as M,a as U,g as k,r as n,j as e,G as F,ai as G,a4 as C,i as u}from"./index-CT2igMlm.js";const{ArrowLeft:D,Clock:b,AlertCircle:S,CheckCircle:T,XCircle:O,RefreshCw:o,Calendar:z,User:q,ChevronRight:B,Folder:V,Flag:W,MessageSquare:p}=F,$=t=>{if(!t)return"—";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleDateString()},y=t=>{if(!t)return"—";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})},H=()=>{var f,w,v,R;const{taskId:t}=M(),r=U(),g=k(),[s,P]=n.useState(((f=g.state)==null?void 0:f.task)||null),[_,j]=n.useState(!((w=g.state)!=null&&w.task)),[l,h]=n.useState([]),[d,N]=n.useState(!1),[E,c]=n.useState(!1),I=async()=>{if(t){j(!0);try{const a=await C(`/api/tasks/${t}`);a!=null&&a.success?P(a.data):(u.error("Task not found"),r("/employee/tasks"))}catch(a){u.error((a==null?void 0:a.message)||"Failed to load task details"),r("/employee/tasks")}finally{j(!1)}}},x=async()=>{if(t){N(!0);try{const a=await C(`/api/tasks/${t}/reassign-requests`);a!=null&&a.success&&a.requests?h(a.requests):h([])}catch(a){console.error("Failed to load reassignment requests:",a),h([])}finally{N(!1)}}};n.useEffect(()=>{var a;(a=g.state)!=null&&a.task||I(),x()},[t]);const A=async a=>{a!=null&&a.success&&(u.success(a.message||"Reassignment request sent successfully"),c(!1),await x())},L=a=>{switch(a==null?void 0:a.toUpperCase()){case"PENDING":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:e.jsx(S,{className:"w-5 h-5 text-yellow-600"}),label:"Pending Review",badgeClass:"bg-yellow-100 text-yellow-800"};case"APPROVED":return{bg:"bg-green-50",border:"border-green-200",text:"text-green-800",icon:e.jsx(T,{className:"w-5 h-5 text-green-600"}),label:"Approved",badgeClass:"bg-green-100 text-green-800"};case"REJECTED":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:e.jsx(O,{className:"w-5 h-5 text-red-600"}),label:"Rejected",badgeClass:"bg-red-100 text-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",icon:e.jsx(S,{className:"w-5 h-5 text-gray-600"}),label:a||"Unknown",badgeClass:"bg-gray-100 text-gray-800"}}},m=()=>l.some(a=>a.status==="PENDING");return _?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("div",{className:"h-64 bg-gray-200 rounded"}),e.jsx("div",{className:"h-48 bg-gray-200 rounded"})]}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("button",{onClick:()=>r("/employee/tasks"),className:"mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(D,{className:"w-4 h-4"}),"Back to Tasks"]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:(s==null?void 0:s.name)||(s==null?void 0:s.title)||"Task Details"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[((v=s==null?void 0:s.project)==null?void 0:v.name)&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),s.project.name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),"Due: ",$((s==null?void 0:s.due_date)||(s==null?void 0:s.dueDate)||(s==null?void 0:s.taskDate))]}),(s==null?void 0:s.priority)&&e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.priority==="High"?"bg-red-100 text-red-800":s.priority==="Medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[e.jsx(W,{className:"w-3 h-3 inline mr-1"}),s.priority]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(s==null?void 0:s.status)==="completed"?"bg-green-100 text-green-800":(s==null?void 0:s.status)==="in_progress"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:((R=s==null?void 0:s.status)==null?void 0:R.toUpperCase())||"PENDING"})]}),(s==null?void 0:s.description)&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-line",children:s.description})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[(s==null?void 0:s.employee)&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-1",children:"Assigned To"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.employee.name})]})]}),(s==null?void 0:s.manager)&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-1",children:"Manager"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.manager.name})]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-1",children:"Reassignment Requests"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-gray-400"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[l.length," submitted"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),"Reassignment Requests",l.length>0&&e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:l.length})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:x,disabled:d,className:"text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1",children:[e.jsx(o,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]}),e.jsx("button",{onClick:()=>c(!0),disabled:m(),className:`px-4 py-2 text-sm font-medium rounded-lg border ${m()?"border-gray-300 bg-gray-100 text-gray-500 cursor-not-allowed":"border-yellow-300 bg-yellow-50 text-yellow-700 hover:bg-yellow-100"}`,children:m()?"Request Pending":"+ New Request"})]})]}),d?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(o,{className:"w-6 h-6 animate-spin mx-auto mb-2"}),e.jsx("p",{children:"Loading reassignment requests..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(p,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Reassignment Requests Yet"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"You haven't submitted any reassignment requests for this task. If you need this task reassigned, submit your first request."}),e.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 text-sm font-medium rounded-lg border border-yellow-300 bg-yellow-50 text-yellow-700 hover:bg-yellow-100",children:"Submit First Request"})]}):e.jsx("div",{className:"space-y-4",children:l.map(a=>{const i=L(a.status);return e.jsxs("div",{className:`rounded-xl border p-5 ${i.bg} ${i.border}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.icon,e.jsxs("div",{children:[e.jsxs("p",{className:`font-semibold text-lg ${i.text}`,children:["Request #",a.id]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),"Submitted: ",y(a.requested_at)]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${i.badgeClass}`,children:a.status})]}),e.jsxs("div",{className:"space-y-4",children:[a.reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-2",children:"Reason for Reassignment"}),e.jsx("div",{className:"p-3 bg-white/50 rounded-lg border border-gray-100",children:e.jsx("p",{className:"text-gray-700",children:a.reason})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"p-2 bg-white/50 rounded",children:[e.jsx("p",{className:"text-gray-600 mb-1",children:"Request ID"}),e.jsxs("p",{className:"font-medium text-gray-900",children:["#",a.id]})]}),e.jsxs("div",{className:"p-2 bg-white/50 rounded",children:[e.jsx("p",{className:"text-gray-600 mb-1",children:"Task ID"}),e.jsxs("p",{className:"font-medium text-gray-900",children:["#",a.task_id]})]}),e.jsxs("div",{className:"p-2 bg-white/50 rounded",children:[e.jsx("p",{className:"text-gray-600 mb-1",children:"Status"}),e.jsx("p",{className:"font-medium text-gray-900 capitalize",children:a.status})]}),e.jsxs("div",{className:"p-2 bg-white/50 rounded",children:[e.jsx("p",{className:"text-gray-600 mb-1",children:"Response"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.responded_at?"Responded":"Awaiting"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-2",children:e.jsx(b,{className:"w-4 h-4 text-blue-600"})}),e.jsx("p",{className:"text-gray-600",children:"Submitted"}),e.jsx("p",{className:"font-medium text-gray-900",children:y(a.requested_at)})]}),e.jsx("div",{className:"flex-1 h-0.5 bg-gray-200 mx-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center mx-auto mb-2 ${a.responded_at?"bg-green-100":"bg-gray-100"}`,children:a.responded_at?e.jsx(T,{className:"w-4 h-4 text-green-600"}):e.jsx(b,{className:"w-4 h-4 text-gray-400"})}),e.jsx("p",{className:"text-gray-600",children:"Response"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.responded_at?y(a.responded_at):"Pending"})]})]})})]})]},a.id)})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Task Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:(s==null?void 0:s.status)||"Pending"})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Due Date"}),e.jsx("span",{className:"font-medium text-gray-900",children:$((s==null?void 0:s.due_date)||(s==null?void 0:s.dueDate)||(s==null?void 0:s.taskDate))})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Priority"}),e.jsx("span",{className:"font-medium text-gray-900",children:(s==null?void 0:s.priority)||"Medium"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Requests"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.length})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>c(!0),disabled:m(),className:`w-full px-4 py-3 text-left rounded-lg border flex items-center justify-between ${m()?"border-gray-200 bg-gray-50 text-gray-500 cursor-not-allowed":"border-yellow-200 bg-yellow-50 text-yellow-700 hover:bg-yellow-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Request Reassignment"}),e.jsx("p",{className:"text-sm",children:"Submit new request"})]})]}),e.jsx(B,{className:"w-5 h-5"})]}),e.jsx("button",{onClick:x,disabled:d,className:"w-full px-4 py-3 text-left rounded-lg border border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:`w-5 h-5 ${d?"animate-spin":""}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Refresh Requests"}),e.jsx("p",{className:"text-sm",children:"Get latest updates"})]})]})}),e.jsx("button",{onClick:()=>r("/employee/tasks"),className:"w-full px-4 py-3 text-left rounded-lg border border-gray-200 bg-gray-50 text-gray-700 hover:bg-gray-100 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Back to Tasks"}),e.jsx("p",{className:"text-sm",children:"View all tasks"})]})]})})]})]})]})]})]}),E&&e.jsx(G,{selectedTask:s,onClose:()=>c(!1),onSuccess:A})]})};export{H as default};
