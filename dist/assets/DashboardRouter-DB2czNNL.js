import{j as e,G as q,F as U,b as O,s as I,r as j,a4 as M,ao as B,L as $,aB as V,bx as F,by as K,bz as W,bA as Z}from"./index-CV0oviIo.js";const N=({name:m,as:a,className:x,size:d,...c})=>{const i=a||(m?q[m]:null);return i?e.jsx(i,{className:U("tm-icon",x),...c}):null},E=({title:m,data:a,colors:x=[],showValues:d=!0,horizontal:c=!1})=>{const i=Math.max(...a.map(r=>r.value),1);return c?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:m}),a.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"No data available"})}):e.jsx("div",{className:"space-y-3",children:a.map((r,h)=>{const u=r.value/i*100,b=x[h]||"bg-blue-500";return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.label}),d&&e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:r.value})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:`h-8 rounded-lg transition-all duration-300 ${b} hover:opacity-90`,style:{width:`${u}%`},children:e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-xs font-semibold text-white",children:r.value})})})]},r.label)})})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:m}),a.length>0&&e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["Total: ",a.reduce((r,h)=>r+h.value,0)]})]}),a.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:"No data available"})}):e.jsx("div",{className:"flex items-end h-48 space-x-2",children:a.map((r,h)=>{const u=r.value/i*100,b=x[h]||"bg-blue-500",n=`${u}%`;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[e.jsx("div",{className:"relative w-full flex justify-center",children:e.jsx("div",{className:`w-3/4 rounded-t-lg transition-all duration-300 hover:opacity-90 ${b}`,style:{height:n},children:e.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:[r.label,": ",r.value]})})}),e.jsx("span",{className:"mt-2 text-xs font-medium text-gray-600 text-center",children:r.label}),d&&e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:r.value})]},r.label)})})]})},R=({title:m,data:a,size:x=140})=>{const d=a.reduce((u,b)=>u+b.value,0);let c=0;const i=x/2-10,r=x/2,h=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"];return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:m}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative",style:{width:x,height:x},children:[e.jsx("svg",{width:x,height:x,children:a.map((u,b)=>{const T=(d>0?u.value/d*100:0)/100*360,C=c+T,s=c*Math.PI/180,o=C*Math.PI/180,g=r+i*Math.cos(s),p=r+i*Math.sin(s),y=r+i*Math.cos(o),f=r+i*Math.sin(o),v=T>180?1:0,k=[`M ${r} ${r}`,`L ${g} ${p}`,`A ${i} ${i} 0 ${v} 1 ${y} ${f}`,"Z"].join(" "),A=e.jsx("path",{d:k,fill:h[b%h.length],className:"transition-all duration-300 hover:opacity-80"},u.label);return c=C,A})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]})})]}),e.jsx("div",{className:"ml-6 flex-1",children:e.jsx("div",{className:"space-y-2",children:a.map((u,b)=>{const n=d>0?Math.round(u.value/d*100):0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm mr-2",style:{backgroundColor:h[b%h.length]}}),e.jsx("span",{className:"text-sm text-gray-700",children:u.label})]}),e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:[u.value," (",n,"%)"]})]},u.label)})})})]})]})},z=({title:m,data:a,colors:x=[]})=>{const d=a.reduce((c,i)=>c+i.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:m}),e.jsx("div",{className:"space-y-3",children:a.map((c,i)=>{const r=c.value/d*100,h=x[i]||"bg-blue-500";return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[c.label,c.badge&&e.jsxs("span",{className:"ml-2 text-xs px-2 py-0.5 bg-gray-100 text-gray-700 rounded flex items-center gap-1",children:[c.badge.icon&&e.jsx(N,{name:c.badge.icon,className:"w-3 h-3"}),e.jsx("span",{children:c.badge.text})]})]})}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[c.value," (",Math.round(r),"%)"]})]}),e.jsx("div",{className:"h-6 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${h} rounded-full transition-all duration-300`,style:{width:`${r}%`},children:e.jsx("div",{className:"px-3 text-xs font-semibold text-white flex items-center h-full",children:c.value})})})]},c.label)})})]})},J=({title:m,subtitle:a,value:x,icon:d,color:c,trend:i})=>{const h={blue:"primary",green:"success",amber:"warning",red:"danger",purple:"primary",gray:"default"}[c]||"default",u=i&&e.jsxs("span",{className:`font-medium ${i.value>0?"text-green-600":"text-red-600"}`,children:[i.value>0?"↗":"↘"," ",Math.abs(i.value),"% ",i.label]}),b=typeof d=="string"?e.jsx(N,{name:d,className:"w-6 h-6"}):d;return e.jsx(V,{title:m,subtitle:a,value:x,icon:b,tone:h,footer:u,className:"p-4"})},Q=({title:m,data:a})=>{const x=a.reduce((d,c)=>d+c.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:m}),e.jsx("div",{className:"space-y-4",children:a.map((d,c)=>{const i=x>0?Math.round(d.value/x*100):0,r=["bg-gradient-to-r from-blue-500 to-blue-600","bg-gradient-to-r from-green-500 to-green-600","bg-gradient-to-r from-amber-500 to-amber-600","bg-gradient-to-r from-red-500 to-red-600","bg-gradient-to-r from-purple-500 to-purple-600"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d.label}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[d.value," (",i,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${r[c%r.length]} rounded-full transition-all duration-700`,style:{width:`${i}%`}})})]},d.label)})})]})},X=()=>{const m=O(I);m!=null&&m.modules;const[a,x]=j.useState([]),[d,c]=j.useState([]),[i,r]=j.useState(!0),[h,u]=j.useState(null),b=j.useCallback(async()=>{var s;r(!0),u(null);try{const[o,g]=await Promise.all([M("/api/employee/tasks-overview"),M("/api/employee/my-tasks")]),p=(o==null?void 0:o.data)||o||{},y=g||{},f=Array.isArray(y.data)?y.data:Array.isArray(y)?y:[],v=y.kanban||[];x(Array.isArray(f)?f:[]),c(Array.isArray(v)?v:[])}catch(o){const g=(o==null?void 0:o.message)||((s=o==null?void 0:o.data)==null?void 0:s.message)||"Unable to load dashboard";u(g)}finally{r(!1)}},[]);j.useEffect(()=>{b()},[b]);const n=j.useMemo(()=>{const s=d.length>0?d.map(t=>({label:t.status||"Unknown",value:t.count||0})):[],o={HIGH:0,MEDIUM:0,LOW:0};a.forEach(t=>{if(t.priority){const l=t.priority.toUpperCase();o.hasOwnProperty(l)&&(o[l]+=1)}});const g=Object.entries(o).filter(([t,l])=>l>0).map(([t,l])=>({label:t,value:l})),p=a.filter(t=>{var l;return((l=t.status)==null?void 0:l.toLowerCase().includes("complete"))||t.status==="DONE"}).length,y=a.filter(t=>{var l;return(l=t.status)==null?void 0:l.toLowerCase().includes("progress")}).length,f=a.filter(t=>{var l,w;return!((l=t.status)!=null&&l.toLowerCase().includes("complete"))&&!((w=t.status)!=null&&w.toLowerCase().includes("progress"))&&t.status!=="DONE"}).length,v=a.filter(t=>{var l;return t.dueDate?new Date(t.dueDate)<new Date&&!((l=t.status)!=null&&l.toLowerCase().includes("complete"))&&t.status!=="DONE":!1}).length,k=a.filter(t=>{var w;return!((w=t.status)!=null&&w.toLowerCase().includes("complete"))&&t.status!=="DONE"?t.dueDate?new Date(t.dueDate)>=new Date:!0:!1}).length,A=[{label:"Pending",value:a.filter(t=>{var l;return((l=t.lock_info)==null?void 0:l.request_status)==="PENDING"}).length},{label:"Approved",value:a.filter(t=>{var l;return((l=t.lock_info)==null?void 0:l.request_status)==="APPROVED"}).length},{label:"Rejected",value:a.filter(t=>{var l;return((l=t.lock_info)==null?void 0:l.request_status)==="REJECTED"}).length}],L=a.filter(t=>t.is_locked).length,H=a.length-L,_=new Date,S=a.filter(t=>{var l;return!((l=t.status)!=null&&l.toLowerCase().includes("complete"))&&t.status!=="DONE"}),D={Today:0,"1-3 days":0,"3-7 days":0,"> 1 week":0};S.forEach(t=>{const l=t.createdAt||t.updatedAt||t.dueDate;if(!l){D.Today+=1;return}const w=new Date(l),P=(_-w)/(1e3*60*60*24);P<1?D.Today+=1:P<3?D["1-3 days"]+=1:P<7?D["3-7 days"]+=1:D["> 1 week"]+=1});const G=Object.entries(D).map(([t,l])=>({label:t,value:l}));return{status:s,priority:g,completion:{completed:p,inProgress:y,pending:f,total:a.length},overdue:{overdue:v,onTime:k,noDueDate:a.length-v-k},reassignment:A,lockedVsActive:[{label:"Active",value:H},{label:"Locked",value:L}],age:G,totalTasks:a.length,highPriority:o.HIGH,pendingReassign:a.filter(t=>{var l;return((l=t.lock_info)==null?void 0:l.request_status)==="PENDING"}).length,onHold:a.filter(t=>{var l;return(l=t.status)==null?void 0:l.toLowerCase().includes("hold")}).length}},[a,d]),T=j.useMemo(()=>{var s,o,g,p;return[{key:"total",title:"Total Tasks",value:n.totalTasks,color:"blue",icon:"CheckSquare"},{key:"completed",title:"Completed",value:n.completion.completed,color:"green",icon:"CheckCircle"},{key:"in_progress",title:"In Progress",value:n.completion.inProgress,color:"amber",icon:"Clock"},{key:"high_priority",title:"High Priority",value:n.highPriority,color:"red",icon:"AlertTriangle"},{key:"overdue",title:"Overdue",value:n.overdue.overdue,color:"red",icon:"AlertCircle"},{key:"blocked",title:"Blocked",subtitle:`Locked: ${((o=(s=n.lockedVsActive)==null?void 0:s[1])==null?void 0:o.value)||0} • Pending: ${n.pendingReassign||0}`,value:(((p=(g=n.lockedVsActive)==null?void 0:g[1])==null?void 0:p.value)||0)+(n.pendingReassign||0),color:"purple",icon:"Lock"},{key:"on_hold",title:"On Hold",value:n.onHold,color:"gray",icon:"Pause"}]},[n]),C=j.useMemo(()=>a.filter(s=>{var y,f,v;const o=s.dueDate&&new Date(s.dueDate)<new Date&&!((y=s.status)!=null&&y.toLowerCase().includes("complete"))&&s.status!=="DONE",g=((f=s.lock_info)==null?void 0:f.request_status)==="PENDING",p=s.priority==="HIGH"&&!((v=s.status)!=null&&v.toLowerCase().includes("complete"))&&s.status!=="DONE";return o||g||p}).slice(0,5),[a]);return i?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your task dashboard..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{title:"Task Analytics Dashboard",subtitle:"Comprehensive visual analysis of your tasks, progress, and performance",onRefresh:b,refreshing:i}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3",children:T.map(s=>e.jsx(J,{title:s.title,subtitle:s.subtitle,value:s.value,icon:s.icon,color:s.color},s.key))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(E,{title:"Task Status Distribution",data:n.status,colors:["bg-blue-500","bg-green-500","bg-amber-500","bg-red-500","bg-purple-500","bg-gray-500"],showValues:!1,horizontal:!1}),e.jsx(E,{title:"Task Priority Levels",data:n.priority,colors:["bg-red-500","bg-yellow-500","bg-green-500"],horizontal:!0}),e.jsx(z,{title:"Task Deadline Analysis",data:[{label:"Overdue",value:n.overdue.overdue,badge:{icon:"AlertCircle",text:"Urgent"}},{label:"On Time",value:n.overdue.onTime,badge:{icon:"CheckCircle",text:"Good"}},{label:"No Due Date",value:n.overdue.noDueDate,badge:{icon:"Calendar",text:"Set Date"}}],colors:["bg-red-500","bg-green-500","bg-gray-400"]}),e.jsx(R,{title:"Reassignment Requests",data:n.reassignment})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(Q,{title:"Locked vs Active Tasks",data:n.lockedVsActive}),e.jsx(E,{title:"Task Age Analysis (Incomplete Tasks)",data:n.age,colors:["bg-blue-400","bg-blue-500","bg-blue-600","bg-blue-700"],horizontal:!0}),e.jsx(R,{title:"Completion Status",data:[{label:"Completed",value:n.completion.completed},{label:"In Progress",value:n.completion.inProgress},{label:"Pending",value:n.completion.pending}]})]}),C.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-5 border-b border-gray-200",children:[e.jsxs("h2",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(N,{name:"AlertTriangle",className:"w-5 h-5 text-amber-500"}),"Attention Needed"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Tasks requiring immediate attention"})]}),e.jsx("div",{className:"p-5",children:e.jsx("div",{className:"space-y-3",children:C.map(s=>{var y,f,v;const o=s.dueDate&&new Date(s.dueDate)<new Date&&!((y=s.status)!=null&&y.toLowerCase().includes("complete"))&&s.status!=="DONE",g=((f=s.lock_info)==null?void 0:f.request_status)==="PENDING",p=s.priority==="HIGH"&&!((v=s.status)!=null&&v.toLowerCase().includes("complete"))&&s.status!=="DONE";return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-2 h-12 rounded-lg ${o?"bg-red-500":g?"bg-amber-500":p?"bg-red-400":"bg-gray-300"}`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-800 rounded inline-flex items-center gap-1",children:[e.jsx(N,{name:"AlertCircle",className:"w-3 h-3"}),e.jsx("span",{children:"Overdue"})]}),g&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-amber-100 text-amber-800 rounded inline-flex items-center gap-1",children:[e.jsx(N,{name:"RefreshCw",className:"w-3 h-3"}),e.jsx("span",{children:"Pending Reassign"})]}),p&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-red-100 text-red-800 rounded inline-flex items-center gap-1",children:[e.jsx(N,{name:"Zap",className:"w-3 h-3"}),e.jsx("span",{children:"High Priority"})]}),s.dueDate&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Due: ",new Date(s.dueDate).toLocaleDateString()]})]})]})]}),e.jsx($,{to:`/employee/tasks/${s.id||s.public_id||s._id}`,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View Details →"})]},s.id)})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Recent Task Activity"}),e.jsx($,{to:"/employee/tasks",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All Tasks →"})]}),e.jsx("div",{className:"space-y-3",children:a.slice(0,6).map(s=>{var o,g,p;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(o=s.status)!=null&&o.includes("COMPLETE")?"bg-green-500":(g=s.status)!=null&&g.includes("PROGRESS")?"bg-blue-500":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((p=s.status)==null?void 0:p.replace(/_/g," "))||"Unknown"," • Updated ",new Date(s.updatedAt||s.createdAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded ${s.priority==="HIGH"?"bg-red-100 text-red-800":s.priority==="MEDIUM"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:s.priority||"Normal"})})]},s.id)})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-5 text-white",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Efficiency Score"}),e.jsxs("div",{className:"text-4xl font-bold mb-2",children:[n.totalTasks>0?Math.round(n.completion.completed/n.totalTasks*100):0,"%"]}),e.jsx("p",{className:"text-sm text-blue-100",children:"Based on completion rate and timeliness"}),e.jsx("div",{className:"mt-4 h-2 bg-blue-400 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all duration-1000",style:{width:`${Math.min(n.completion.completed/n.totalTasks*100,100)}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{name:"BarChart3",className:"w-5 h-5 mr-3 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Generate Report"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Export all task analytics"})]})]})}),e.jsx("button",{className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:border-green-300 hover:bg-green-50 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{name:"Calendar",className:"w-5 h-5 mr-3 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Set Deadlines"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Update due dates"})]})]})}),e.jsx("button",{className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:border-amber-300 hover:bg-amber-50 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{name:"RefreshCw",className:"w-5 h-5 mr-3 text-gray-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Request Reassign"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Transfer tasks to others"})]})]})})]})]})]})]})]})},Y=m=>(m||"").toString().toLowerCase().replace(/\s|-/g,""),te=()=>{const m=O(I);switch(Y(m==null?void 0:m.role)){case"admin":return e.jsx(Z,{});case"manager":return e.jsx(W,{});case"employee":return e.jsx(X,{});case"clientviewer":case"client":return e.jsx(K,{});default:return e.jsx(F,{})}};export{te as default};
