import{a as R,u as X,r as h,b as W,X as z,Z as V,j as e,bB as L,bC as U,aO as Q,b2 as T,ay as Y}from"./index-CV0oviIo.js";import{u as O}from"./index.esm-D43XoWsD.js";import{M as ee}from"./ModalWrapper-MCmcfSIb.js";const se=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli","Daman and Diu","Lakshadweep","Delhi","Puducherry","Ladakh","Jammu & Kashmir"],le=({open:J=!1,setOpen:c=null,client:a=null,onSuccess:N=null,isModal:p=!1})=>{const S=R(),x=X(),{register:l,handleSubmit:$,formState:{errors:d},reset:I,setValue:t}=O(),[C,b]=h.useState(null),[k,E]=h.useState(null),[A,B]=h.useState([]),_=W(z)||[],m=!!a;h.useEffect(()=>{x(V())},[x]),h.useEffect(()=>{a?(t("name",a.name||""),t("email",a.email||""),t("phone",a.phone||""),t("company",a.company||""),t("address",a.address||""),t("district",a.district||""),t("state",a.state||""),t("pincode",a.pincode||""),t("taxId",a.taxId||""),t("industry",a.industry||""),t("notes",a.notes||""),t("status",a.status||"Active"),t("managerId",a.manager_public_id||a.managerId||"")):I()},[a,t,I]);const G=s=>s?!!((s.role||s.designation||s.title||s.roleName||"").toString().toLowerCase().includes("manager")||Array.isArray(s.roles)&&s.roles.some(j=>(j||"").toString().toLowerCase().includes("manager"))||(s.roleId||s.role_id||s.roleName)&&(""+(s.roleId||s.role_id||s.roleName)).toLowerCase().includes("manager")):!1,Z=Array.isArray(_)?_.filter(G):[],D=s=>{if(!s)return null;if(typeof s=="string")return s;if(s.message)return s.message;if(s.error)return s.error;if(s.data){if(typeof s.data=="string")return s.data;if(s.data.message)return s.data.message;if(s.data.error)return s.data.error}try{return JSON.stringify(s)}catch{return String(s)}},H=async s=>{var y,j;try{b(null),E(null);let n;if(m?n=await x(L({clientId:a.id,clientData:s})):n=await x(U(s)),m?L.fulfilled.match(n):U.fulfilled.match(n)){const o=n.payload;if(o&&(o.success===!1||o.error)){const i=o.error||o.message||"Operation failed";b(i);return}const r=(o==null?void 0:o.data)||o,F=`Client "${(r==null?void 0:r.name)||(r==null?void 0:r.company)||"Updated"}" ${m?"updated":"added"} successfully.`;if(E(F),x(Q()),!m&&A.length>0)try{const i=(r==null?void 0:r.id)||(r==null?void 0:r._id)||(r==null?void 0:r.public_id);if(i)for(const v of A){const f=new FormData;f.append("file",v,v.name),f.append("file_name",v.name);try{const g=localStorage.getItem("userInfo")||localStorage.getItem("user");if(g){const u=JSON.parse(g);u&&(u.id||u._id||u.public_id)&&f.append("uploaded_by",u.id||u._id||u.public_id)}}catch{}const q=localStorage.getItem("tenantId")||"";q&&f.append("tenantId",q);const w=await x(T({clientId:i,document:f}));if(!T.fulfilled.match(w)){const g=D(w.payload)||((y=w.error)==null?void 0:y.message)||"Failed to upload document";b(g);return}}}catch(i){console.warn("Failed to attach documents:",i),b((i==null?void 0:i.message)||"Failed to attach documents");return}p?(c==null||c(!1),N==null||N()):S("/admin/clients",{state:{created:!0,message:F}})}else{const o=D(n.payload)||((j=n.error)==null?void 0:j.message)||"Operation failed";b(o)}}catch(n){console.error("Form submission error:",n),b((n==null?void 0:n.message)||"Unexpected error. Please try again.")}},K=()=>{p&&c?c(!1):S("/admin/clients")},P=e.jsxs("form",{onSubmit:$(H),className:"space-y-12 px-8 pb-8",children:[C&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:C})}),k&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-green-700",children:k})}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h4",{className:"text-2xl font-bold text-gray-900",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Name *"}),e.jsx("input",{...l("name",{required:"Name is required"}),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter client name"}),d.name&&e.jsx("p",{className:"text-red-500 text-sm mt-2 font-medium",children:d.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Email *"}),e.jsx("input",{...l("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email"}}),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter email address",type:"email"}),d.email&&e.jsx("p",{className:"text-red-500 text-sm mt-2 font-medium",children:d.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Phone *"}),e.jsx("input",{...l("phone",{required:"Phone is required",pattern:{value:/^[0-9]{10}$/,message:"10 digits required"}}),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter 10-digit phone"}),d.phone&&e.jsx("p",{className:"text-red-500 text-sm mt-2 font-medium",children:d.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Company"}),e.jsx("input",{...l("company"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter company name"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h4",{className:"text-2xl font-bold text-gray-900",children:"Address"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Street Address"}),e.jsx("textarea",{...l("address"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter street address",rows:"4"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"District"}),e.jsx("input",{...l("district"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter district"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"State"}),e.jsxs("select",{...l("state"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",children:[e.jsx("option",{value:"",children:"Select State"}),se.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Pincode"}),e.jsx("input",{...l("pincode",{pattern:{value:/^[0-9]{6}$/,message:"6 digits"}}),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter pincode"}),d.pincode&&e.jsx("p",{className:"text-red-500 text-sm mt-2 font-medium",children:d.pincode.message})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("h4",{className:"text-2xl font-bold text-gray-900",children:"Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"GST/Tax ID"}),e.jsx("input",{...l("taxId"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter GST ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Industry"}),e.jsx("input",{...l("industry"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter industry"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Notes"}),e.jsx("textarea",{...l("notes"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",placeholder:"Enter additional notes",rows:"4"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Status"}),e.jsxs("select",{...l("status"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"Lead",children:"Lead"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Manager"}),e.jsxs("select",{...l("managerId"),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base",children:[e.jsx("option",{value:"",children:"-- Select Manager (optional) --"}),Z.map(s=>e.jsx("option",{value:s.public_id||s._id||s.id,children:s.name||s.firstName||s.email},s.public_id||s._id||s.id))]})]})]})]}),!m&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Attach Documents"}),e.jsx("input",{type:"file",multiple:!0,onChange:s=>B(Array.from(s.target.files||[])),className:"w-full px-5 py-4 border-2 border-gray-300 rounded-xl text-base"}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 font-medium",children:"PDF, DOCX, images"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t-2 border-gray-200",children:[e.jsx("button",{type:"button",onClick:K,className:"px-10 py-4 text-lg rounded-xl font-semibold text-gray-700 border-2 border-gray-300 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-10 py-4 text-lg rounded-xl font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:m?"Update Client":"Add Client"})]})]}),M=e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:m?"Edit Client":"Add New Client"}),p&&e.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Y,{className:"w-5 h-5"})})]});return p?e.jsxs(ee,{open:J,setOpen:c,children:[e.jsx("div",{className:"mb-8 px-8",children:M}),e.jsx("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:P})]}):e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-[90rem] mx-auto bg-white rounded-xl shadow border",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:M}),e.jsx("div",{className:"p-12",children:P})]})})};export{le as default};
