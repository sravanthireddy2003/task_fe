import{r as x,n as A,w as je,U as L,y as q,c2 as Ne,c3 as we,p as C,R as oe,c4 as Se,q as pe,c5 as $,C as B,I as Z,c6 as X,c7 as fe,c8 as Ie,c9 as ge,ca as _e,x as j,cb as Ce,M as ce,cc as De,T as Te,O as de,t as Re,cd as Ee,u as G,j as e,B as P,ce as Pe,b as M,cf as he,X as Me,H as Oe,a2 as Q,a as Fe,G as Ue,cg as be,a5 as Ae,ch as z,ci as $e,K as Le,F as W,cj as qe,ck as Be,ba as Ge,ac as Ke,aO as He,cl as Qe,cm as ze,cn as We}from"./index-DiCoRx4R.js";import{h as ue}from"./moment-C5S46NFB.js";import{u as ee}from"./index.esm-Cj1Qfi2w.js";import{M as te,_ as se}from"./ModalWrapper-CGR1GoIM.js";import{T as O}from"./Textbox-cyjLHX8O.js";import{C as Ve}from"./Dialogs-0HExq6AA.js";import{s as ke,c as T,u as Ye,f as Je,S as V,I as U}from"./SelectList-CgrA8HLE.js";import{a as me,B as xe}from"./index-pGm2xic7.js";function Xe({container:t,accept:i,walk:o,enabled:s=!0}){let a=x.useRef(i),c=x.useRef(o);x.useEffect(()=>{a.current=i,c.current=o},[i,o]),A(()=>{if(!t||!s)return;let l=je(t);if(!l)return;let n=a.current,u=c.current,p=Object.assign(v=>n(v),{acceptNode:n}),r=l.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,p,!1);for(;r.nextNode();)u(r.currentNode)},[t,s,a,c])}var Ze=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Ze||{}),et=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(et||{}),tt=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItem=5]="RegisterItem",t[t.UnregisterItem=6]="UnregisterItem",t))(tt||{});function k(t,i=o=>o){let o=t.activeItemIndex!==null?t.items[t.activeItemIndex]:null,s=Re(i(t.items.slice()),c=>c.dataRef.current.domRef.current),a=o?s.indexOf(o):null;return a===-1&&(a=null),{items:s,activeItemIndex:a}}let st={1(t){return t.menuState===1?t:{...t,activeItemIndex:null,menuState:1}},0(t){return t.menuState===0?t:{...t,__demoMode:!1,menuState:0}},2:(t,i)=>{var o;let s=k(t),a=Je(i,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:c=>c.id,resolveDisabled:c=>c.dataRef.current.disabled});return{...t,...s,searchQuery:"",activeItemIndex:a,activationTrigger:(o=i.trigger)!=null?o:1}},3:(t,i)=>{let o=t.searchQuery!==""?0:1,s=t.searchQuery+i.value.toLowerCase(),a=(t.activeItemIndex!==null?t.items.slice(t.activeItemIndex+o).concat(t.items.slice(0,t.activeItemIndex+o)):t.items).find(l=>{var n;return((n=l.dataRef.current.textValue)==null?void 0:n.startsWith(s))&&!l.dataRef.current.disabled}),c=a?t.items.indexOf(a):-1;return c===-1||c===t.activeItemIndex?{...t,searchQuery:s}:{...t,searchQuery:s,activeItemIndex:c,activationTrigger:1}},4(t){return t.searchQuery===""?t:{...t,searchQuery:"",searchActiveItemIndex:null}},5:(t,i)=>{let o=k(t,s=>[...s,{id:i.id,dataRef:i.dataRef}]);return{...t,...o}},6:(t,i)=>{let o=k(t,s=>{let a=s.findIndex(c=>c.id===i.id);return a!==-1&&s.splice(a,1),s});return{...t,...o,activationTrigger:1}}},re=x.createContext(null);re.displayName="MenuContext";function K(t){let i=x.useContext(re);if(i===null){let o=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,K),o}return i}function rt(t,i){return pe(i.type,st,t,i)}let at=x.Fragment;function nt(t,i){let{__demoMode:o=!1,...s}=t,a=x.useReducer(rt,{__demoMode:o,menuState:o?0:1,buttonRef:x.createRef(),itemsRef:x.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:c,itemsRef:l,buttonRef:n},u]=a,p=q(i);Ne([n,l],(N,S)=>{var m;u({type:1}),we(S,Ee.Loose)||(N.preventDefault(),(m=n.current)==null||m.focus())},c===0);let r=C(()=>{u({type:1})}),v=x.useMemo(()=>({open:c===0,close:r}),[c,r]),b={ref:p};return oe.createElement(re.Provider,{value:a},oe.createElement(Se,{value:pe(c,{0:$.Open,1:$.Closed})},B({ourProps:b,theirProps:s,slot:v,defaultTag:at,name:"Menu"})))}let it="button";function lt(t,i){var o;let s=Z(),{id:a=`headlessui-menu-button-${s}`,...c}=t,[l,n]=K("Menu.Button"),u=q(l.buttonRef,i),p=ge(),r=C(m=>{switch(m.key){case j.Space:case j.Enter:case j.ArrowDown:m.preventDefault(),m.stopPropagation(),n({type:0}),p.nextFrame(()=>n({type:2,focus:T.First}));break;case j.ArrowUp:m.preventDefault(),m.stopPropagation(),n({type:0}),p.nextFrame(()=>n({type:2,focus:T.Last}));break}}),v=C(m=>{switch(m.key){case j.Space:m.preventDefault();break}}),b=C(m=>{if(De(m.currentTarget))return m.preventDefault();t.disabled||(l.menuState===0?(n({type:1}),p.nextFrame(()=>{var y;return(y=l.buttonRef.current)==null?void 0:y.focus({preventScroll:!0})})):(m.preventDefault(),n({type:0})))}),N=x.useMemo(()=>({open:l.menuState===0}),[l]),S={ref:u,id:a,type:Te(t,l.buttonRef),"aria-haspopup":"menu","aria-controls":(o=l.itemsRef.current)==null?void 0:o.id,"aria-expanded":l.menuState===0,onKeyDown:r,onKeyUp:v,onClick:b};return B({ourProps:S,theirProps:c,slot:N,defaultTag:it,name:"Menu.Button"})}let ot="div",ct=de.RenderStrategy|de.Static;function dt(t,i){var o,s;let a=Z(),{id:c=`headlessui-menu-items-${a}`,...l}=t,[n,u]=K("Menu.Items"),p=q(n.itemsRef,i),r=Ie(n.itemsRef),v=ge(),b=_e(),N=b!==null?(b&$.Open)===$.Open:n.menuState===0;x.useEffect(()=>{let d=n.itemsRef.current;d&&n.menuState===0&&d!==(r==null?void 0:r.activeElement)&&d.focus({preventScroll:!0})},[n.menuState,n.itemsRef,r]),Xe({container:n.itemsRef.current,enabled:n.menuState===0,accept(d){return d.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:d.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(d){d.setAttribute("role","none")}});let S=C(d=>{var I,f;switch(v.dispose(),d.key){case j.Space:if(n.searchQuery!=="")return d.preventDefault(),d.stopPropagation(),u({type:3,value:d.key});case j.Enter:if(d.preventDefault(),d.stopPropagation(),u({type:1}),n.activeItemIndex!==null){let{dataRef:h}=n.items[n.activeItemIndex];(f=(I=h.current)==null?void 0:I.domRef.current)==null||f.click()}fe(n.buttonRef.current);break;case j.ArrowDown:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Next});case j.ArrowUp:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Previous});case j.Home:case j.PageUp:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.First});case j.End:case j.PageDown:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Last});case j.Escape:d.preventDefault(),d.stopPropagation(),u({type:1}),X().nextFrame(()=>{var h;return(h=n.buttonRef.current)==null?void 0:h.focus({preventScroll:!0})});break;case j.Tab:d.preventDefault(),d.stopPropagation(),u({type:1}),X().nextFrame(()=>{Ce(n.buttonRef.current,d.shiftKey?ce.Previous:ce.Next)});break;default:d.key.length===1&&(u({type:3,value:d.key}),v.setTimeout(()=>u({type:4}),350));break}}),m=C(d=>{switch(d.key){case j.Space:d.preventDefault();break}}),y=x.useMemo(()=>({open:n.menuState===0}),[n]),D={"aria-activedescendant":n.activeItemIndex===null||(o=n.items[n.activeItemIndex])==null?void 0:o.id,"aria-labelledby":(s=n.buttonRef.current)==null?void 0:s.id,id:c,onKeyDown:S,onKeyUp:m,role:"menu",tabIndex:0,ref:p};return B({ourProps:D,theirProps:l,slot:y,defaultTag:ot,features:ct,visible:N,name:"Menu.Items"})}let ut=x.Fragment;function mt(t,i){let o=Z(),{id:s=`headlessui-menu-item-${o}`,disabled:a=!1,...c}=t,[l,n]=K("Menu.Item"),u=l.activeItemIndex!==null?l.items[l.activeItemIndex].id===s:!1,p=x.useRef(null),r=q(i,p);A(()=>{if(l.__demoMode||l.menuState!==0||!u||l.activationTrigger===0)return;let h=X();return h.requestAnimationFrame(()=>{var _,R;(R=(_=p.current)==null?void 0:_.scrollIntoView)==null||R.call(_,{block:"nearest"})}),h.dispose},[l.__demoMode,p,u,l.menuState,l.activationTrigger,l.activeItemIndex]);let v=ke(p),b=x.useRef({disabled:a,domRef:p,get textValue(){return v()}});A(()=>{b.current.disabled=a},[b,a]),A(()=>(n({type:5,id:s,dataRef:b}),()=>n({type:6,id:s})),[b,s]);let N=C(()=>{n({type:1})}),S=C(h=>{if(a)return h.preventDefault();n({type:1}),fe(l.buttonRef.current)}),m=C(()=>{if(a)return n({type:2,focus:T.Nothing});n({type:2,focus:T.Specific,id:s})}),y=Ye(),D=C(h=>y.update(h)),d=C(h=>{y.wasMoved(h)&&(a||u||n({type:2,focus:T.Specific,id:s,trigger:0}))}),I=C(h=>{y.wasMoved(h)&&(a||u&&n({type:2,focus:T.Nothing}))}),f=x.useMemo(()=>({active:u,disabled:a,close:N}),[u,a,N]);return B({ourProps:{id:s,ref:r,role:"menuitem",tabIndex:a===!0?void 0:-1,"aria-disabled":a===!0?!0:void 0,disabled:void 0,onClick:S,onFocus:m,onPointerEnter:D,onMouseEnter:D,onPointerMove:d,onMouseMove:d,onPointerLeave:I,onMouseLeave:I},theirProps:c,slot:f,defaultTag:ut,name:"Menu.Item"})}let xt=L(nt),pt=L(lt),ft=L(dt),gt=L(mt),F=Object.assign(xt,{Button:pt,Items:ft,Item:gt});const ve=({open:t,setOpen:i,id:o})=>{const{register:s,handleSubmit:a,formState:{errors:c}}=ee(),l=G(),n=async u=>{const p={id:o,title:u.title,due_date:u.date,tag:u.tag};console.log(o),l(Pe(p)),i(!1)};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:i,children:e.jsxs("form",{onSubmit:a(n),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"ADD SUB-TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-6",children:[e.jsx(O,{placeholder:"Sub-Task title",type:"text",name:"title",label:"Title",className:"w-full rounded",register:s("title",{required:"Title is required!"}),error:c.title?c.title.message:""}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:s("date",{required:"Date is required!"}),error:c.date?c.date.message:""}),e.jsx(O,{placeholder:"Tag",type:"text",name:"tag",label:"Tag",className:"w-full rounded",register:s("tag",{required:"Tag is required!"}),error:c.tag?c.tag.message:""})]})]}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Add Task"}),e.jsx(P,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>i(!1),label:"Cancel"})]})]})})})},Y=["TODO","IN PROGRESS","COMPLETED"],J=["HIGH","MEDIUM","LOW"],ht=({open:t,setOpen:i,taskId:o})=>{var ae,ne,ie,le;const s=G(),{register:a,handleSubmit:c,setValue:l,formState:{errors:n},reset:u}=ee(),p=M(g=>he(g,o)),r=M(Me),[v,b]=x.useState([]),[N,S]=x.useState(Y[0]),[m,y]=x.useState(J[2]),[D,d]=x.useState(""),[I,f]=x.useState([]),[h,_]=x.useState(!1);x.useEffect(()=>{var g;p&&(b(p.assigned_to||[]),S(p.stage||Y[0]),y(p.priority||J[2]),d(p.client_id||""),l("title",p.title||""),l("date",((g=p.taskDate)==null?void 0:g.split("T")[0])||""),l("time_alloted",p.time_alloted||""),l("description",p.description||""))},[p,l]),x.useEffect(()=>{(async()=>{try{const w=await Oe("api/clients");f(w)}catch(w){console.error("Error fetching clients:",w)}})()},[]);const R=g=>{b(g.map(w=>w._id))},H=r.filter(g=>v.includes(g._id)),ye=async g=>{if(!o){alert("Task ID is missing. Please try again.");return}const w={stage:N,title:g.title,priority:m,description:g.description,assigned_to:v,client_id:D,taskDate:new Date(g.date).toISOString(),time_alloted:g.time_alloted};_(!0);try{const E=await s(Q({id:o,updatedTaskData:w}));Q.fulfilled.match(E)?(i(!1),u()):Q.rejected.match(E)&&alert(`Update failed: ${E.payload||E.error}`)}catch(E){console.error("Update error:",E),alert("Failed to update task")}finally{_(!1)}};return p?e.jsx(te,{open:t,setOpen:i,children:e.jsxs("form",{onSubmit:c(ye),children:[e.jsx(se.Title,{className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-4",children:[e.jsx(V,{label:"Select Client",lists:I.map(g=>g.name),selected:D&&((ae=I.find(g=>g._id===D))==null?void 0:ae.name)||"",setSelected:g=>{const w=I.find(E=>E.name===g);d(w?w._id:"")}}),e.jsx(O,{placeholder:"Task Title",type:"text",name:"title",label:"Task Title",className:"w-full rounded",register:a("title",{required:"Title is required"}),error:(ne=n.title)==null?void 0:ne.message}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(V,{label:"Priority Level",lists:J,selected:m,setSelected:y})}),e.jsx("div",{className:"w-1/2",children:e.jsx(V,{label:"Task Stage",lists:Y,selected:N,setSelected:S})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(O,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:a("date",{required:"Date is required"}),error:(ie=n.date)==null?void 0:ie.message})}),e.jsx("div",{className:"w-1/2",children:e.jsx(O,{placeholder:"Time Alloted",type:"number",name:"time_alloted",label:"Time Alloted",className:"w-full rounded",register:a("time_alloted",{valueAsNumber:!0,min:{value:0,message:"Must be a positive number"}}),error:(le=n.time_alloted)==null?void 0:le.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Users"}),e.jsx(U,{value:H,onChange:R,multiple:!0,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs(U.Button,{className:"relative w-full cursor-default rounded-lg border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("span",{className:"block truncate",children:H.length>0?H.map(g=>g.name).join(", "):"Select users"}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400",children:"▼"})]}),e.jsx(U.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:r.map(g=>e.jsx(U.Option,{value:g,className:({active:w})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${w?"bg-indigo-600 text-white":"text-gray-900"}`,children:({selected:w})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${w?"font-medium":"font-normal"}`,children:g.name||"Unnamed User"}),w&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-green-600",children:"✓"})]})},g._id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter task description (optional)",className:"w-full rounded border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",rows:"3",...a("description")})]}),e.jsxs("div",{className:"bg-gray-50 py-4 sm:flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{label:h?"Updating...":"Update",type:"submit",className:`${h?"opacity-50 cursor-not-allowed":""} bg-green-600 px-8 text-sm font-semibold text-white hover:bg-green-700 sm:w-auto`,disabled:h}),e.jsx(P,{type:"button",className:"bg-white px-5 text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>i(!1),label:"Cancel"})]})]})]})}):null},{FolderOpen:bt,MoreVertical:vt,Plus:yt,Trash2:jt}=Ue,Nt=({task:t})=>{const[i,o]=x.useState(!1),[s,a]=x.useState(!1),[c,l]=x.useState(!1),[n,u]=x.useState(null),p=Fe(),r=G(),v=()=>{n!==null&&(r(Ae({id:n})),u(null),l(!1))},b=m=>{u(m),l(!0)},N=()=>{const m=(t==null?void 0:t._id)||(t==null?void 0:t.task_id);m?p(`/task/${m}`):console.error("No valid task ID available for navigation")},S=[{label:"Open Task",icon:e.jsx(bt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:N},{label:"Edit",icon:e.jsx(yt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:()=>{t!=null&&t.task_id?a(!0):console.error("No task ID available for editing")}}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs(F,{as:"div",className:"relative inline-block text-left",children:[e.jsx(F.Button,{className:"inline-flex w-full justify-center rounded-md px-4 py-2 text-sm font-medium text-gray-600",children:e.jsx(vt,{className:"tm-icon"})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsxs(F.Items,{className:"absolute right-0 z-50 mt-2 w-56 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",children:[e.jsx("div",{className:"px-1 py-1 space-y-2",children:S.map(m=>e.jsx(F.Item,{children:({active:y})=>e.jsxs("button",{onClick:m.onClick,className:`${y?"bg-blue-500 text-white":"text-gray-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[m.icon,m.label]})},m.label))}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(F.Item,{children:({active:m})=>e.jsxs("button",{onClick:()=>b((t==null?void 0:t._id)||(t==null?void 0:t.task_id)),className:`${m?"bg-blue-500 text-white":"text-red-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[e.jsx(jt,{className:"tm-icon mr-2 text-red-400","aria-hidden":"true"}),"Delete"]})})})]})})]})}),s&&(t==null?void 0:t.task_id)&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(ht,{open:s,setOpen:a,taskId:t.task_id},t.task_id)})}),e.jsx(ve,{open:i,setOpen:o}),e.jsx(Ve,{open:c,setOpen:l,onClick:v})]})},wt=({user:t})=>e.jsx("div",{className:"px-4",children:e.jsx(z,{className:"relative",children:({open:i})=>e.jsxs(e.Fragment,{children:[e.jsx(z.Button,{className:"group inline-flex items-center outline-none",children:e.jsx("span",{children:me(t==null?void 0:t.user_name)})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(z.Panel,{className:"absolute left-1/2 z-10 mt-3 w-80 max-w-sm -translate-x-1/2 transform px-4 sm:px-0 ",children:e.jsxs("div",{className:"flex items-center gap-4 rounded-lg shadow-lg bg-white p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full text-white flex items-center justify-center text-2xl ",children:e.jsx("span",{className:"text-center font-bold",children:me(t==null?void 0:t.user_name)})}),e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-black text-xl font-bold",children:t==null?void 0:t.user_name}),e.jsx("span",{className:"text-blue-500",children:(t==null?void 0:t.user_role)??"email@example.com"})]})]})})})]})})}),St=({openStage:t,setOpenStage:i,id:o,onStatusUpdate:s})=>{const{register:a,handleSubmit:c,formState:{errors:l}}=ee(),n=u=>{u.status&&(s(u.status),i(!1))};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:i,children:e.jsxs("form",{onSubmit:c(n),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK STATUS"}),e.jsx("div",{className:"mt-2 flex flex-col gap-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"status",className:"font-semibold",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"w-full rounded border-gray-300",...a("status",{required:"Status is required!"}),children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"IN PROGRESS",children:"IN PROGRESS"}),e.jsx("option",{value:"COMPLETED",children:"COMPLETED"}),e.jsx("option",{value:"TODO",children:"TODO"})]}),l.status&&e.jsx("span",{className:"text-red-600",children:l.status.message})]})}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Update Status"}),e.jsx(P,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>i(!1),label:"Cancel"})]})]})})})},It={HIGH:e.jsx(ze,{className:"w-4 h-4"}),MEDIUM:e.jsx(Qe,{className:"w-4 h-4"}),LOW:e.jsx(He,{className:"w-4 h-4"})},_t=({taskId:t,task:i})=>{var y,D,d,I;const o=M(f=>he(f,t)),s=i||o,a=G(),{user:c}=M(f=>f.auth),[l,n]=x.useState(!1),[u,p]=x.useState(!1),[r,v]=x.useState(s),b=M($e);x.useEffect(()=>{if(s!=null&&s.task_id||s!=null&&s.id||s!=null&&s.public_id){const f=(s==null?void 0:s.task_id)||(s==null?void 0:s.id)||(s==null?void 0:s.public_id);a(Le(f)),v(s)}},[a,s==null?void 0:s.task_id,s==null?void 0:s.id,s==null?void 0:s.public_id]);const N=async f=>{const h=(s==null?void 0:s.task_id)??(s==null?void 0:s.id)??(s==null?void 0:s._id);if(h)try{await a(We({id:h.toString(),data:{stage:f}})).unwrap()&&v(R=>({...R,stage:f}))}catch(_){console.error("Update failed:",_),v(R=>({...R}))}},S=f=>{switch(f==null?void 0:f.toLowerCase()){case"todo":case"to do":return"bg-gray-100 text-gray-800 border-gray-200";case"in progress":case"in_progress":return"bg-primary-100 text-primary-800 border-primary-200";case"review":return"bg-warning-100 text-warning-800 border-warning-200";case"completed":case"done":return"bg-success-100 text-success-800 border-success-200";case"blocked":return"bg-error-100 text-error-800 border-error-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},m=f=>{switch(f==null?void 0:f.toLowerCase()){case"high":return"text-error-600";case"medium":return"text-warning-600";case"low":return"text-success-600";default:return"text-gray-600"}};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full h-fit card cursor-pointer",children:[e.jsxs("div",{className:"w-full flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:W("px-2 py-1 text-xs font-medium rounded-full border",S(r==null?void 0:r.stage)),children:(r==null?void 0:r.stage)||"To Do"}),e.jsxs("div",{className:W("flex items-center gap-1 text-sm font-medium",m(r==null?void 0:r.priority)),children:[e.jsx("span",{className:"text-base",children:It[r==null?void 0:r.priority]}),e.jsx("span",{className:"uppercase",children:(r==null?void 0:r.priority)||"N/A"})]})]}),c&&e.jsx(Nt,{task:r})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 line-clamp-2 mb-1",children:(r==null?void 0:r.title)||"Untitled Task"}),(r==null?void 0:r.description)&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:r.description})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["Created ",r!=null&&r.createdAt?ue(r.createdAt).fromNow():"recently"]}),(r==null?void 0:r.due_date)&&e.jsxs("span",{className:"text-warning-600 font-medium",children:["Due ",ue(r.due_date).fromNow()]})]}),e.jsx("div",{className:"w-full border-t border-gray-100 my-3"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:((y=r==null?void 0:r.activities)==null?void 0:y.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:((D=r==null?void 0:r.assets)==null?void 0:D.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsxs("span",{children:["0/",(b==null?void 0:b.length)||0]})]})]}),e.jsxs("div",{className:"flex flex-row-reverse",children:[(d=r==null?void 0:r.assigned_users)==null?void 0:d.slice(0,3).map((f,h)=>{var _;return e.jsx("div",{className:W("w-8 h-8 rounded-full text-white flex items-center justify-center text-sm -mr-2 border-2 border-white",xe[h%((_=xe)==null?void 0:_.length)]),children:e.jsx(wt,{user:f})},(f==null?void 0:f._id)||h)}),((I=r==null?void 0:r.assigned_users)==null?void 0:I.length)>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-medium -mr-2 border-2 border-white",children:["+",r.assigned_users.length-3]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{onClick:()=>n(!0),variant:"secondary",size:"sm",icon:Ke,label:"Add Subtask",className:"flex-1"}),e.jsx(P,{onClick:()=>p(!0),variant:"secondary",size:"sm",label:"Update Status",className:"flex-1"})]})]}),e.jsx(ve,{open:l,setOpen:n,id:(r==null?void 0:r.task_id)??(r==null?void 0:r.id)??(r==null?void 0:r._id)}),e.jsx(St,{openStage:u,setOpenStage:p,id:(r==null?void 0:r.task_id)??(r==null?void 0:r.id)??(r==null?void 0:r._id),onStatusUpdate:N})]}):e.jsx("div",{className:"w-full h-fit card",children:"Task not found."})},Ct=t=>{var a,c;const i=(a=t==null?void 0:t.resources)==null?void 0:a.mappedClient,o=(c=t==null?void 0:t.metrics)==null?void 0:c.mappedClient,s=(t==null?void 0:t.clientId)||(t==null?void 0:t.client_id);return i??o??s},Ut=()=>{const t=M(a=>a.auth.user),{tasks:i=[]}=M(a=>a.tasks||{}),o=Ct(t),s=i.filter(a=>[a==null?void 0:a.clientId,a==null?void 0:a.client_id,a==null?void 0:a.client].some(l=>l&&o&&l.toString()===o.toString()));return e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-blue-500",children:"Assigned Tasks"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Your active work"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-3xl",children:"These tasks are mapped to the client profile that arrived with your login token."})]}),s.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/50 p-6 text-sm text-gray-500",children:"No tasks are currently assigned to you."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.map((a,c)=>e.jsx(_t,{task:a},a.id||a._id||c))})]})};export{Ut as default};
