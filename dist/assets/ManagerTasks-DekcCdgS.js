import{b as ke,s as Se,r as n,a3 as w,i as x,j as e,an as De,G as Te,ao as _e}from"./index-7TXHU69M.js";import{b,g as T}from"./taskHelpers-CsgoO_-X.js";import{V as Ee}from"./ViewToggle-CXZN4qWu.js";import{C as oe}from"./Card-C2SNu2XC.js";const{RefreshCw:_,AlertCircle:M,Calendar:xe,User:O,Plus:me,Filter:Ie,Clock:ge,CheckCircle:Ae}=Te,Fe=()=>{var de;const L=ke(Se);L!=null&&L.resources;const[u,E]=n.useState([]),[p,R]=n.useState(!0),[Pe,H]=n.useState(null),[g,ue]=n.useState([]),[B,J]=n.useState(!0),[d,h]=n.useState({title:"",description:"",priority:"MEDIUM",stage:"PENDING",taskDate:"",assignedUsers:[],projectId:"",timeAlloted:8}),[F,Q]=n.useState(!1),[l,X]=n.useState(""),[r,N]=n.useState(null),[C,pe]=n.useState([]),[Ue,Y]=n.useState(!0),[y,Z]=n.useState(""),[$,ee]=n.useState(!1),[he,k]=n.useState(!1),[I,be]=n.useState("all"),[q,fe]=n.useState("list"),[se,te]=n.useState(!1),[m,G]=n.useState(null),re=["PENDING","IN_PROGRESS","COMPLETED","ON_HOLD"],A=s=>s?s.public_id||s.id||s._id||s.internalId||s.project_id:null,v=s=>{var t;return s?s.name||s.title||`Project ${(t=A(s))==null?void 0:t.slice(0,8)}...`:"Unknown Project"},je=s=>{var t;return s&&(((t=s.client)==null?void 0:t.name)||s.client_name)||"No Client"},P=s=>{if(!s)return"Unknown";const t=s.status||s.project_status;return{ACTIVE:"Active",IN_PROGRESS:"In Progress",COMPLETED:"Completed",ON_HOLD:"On Hold",PENDING:"Pending",active:"Active",in_progress:"In Progress",completed:"Completed",on_hold:"On Hold",pending:"Pending"}[t]||t||"Unknown"},ye=s=>!s||s.length===0?{valid:!1,error:"Task must be assigned to one employee"}:s.length>1?{valid:!1,error:"Only one employee can be assigned to a task"}:{valid:!0,error:null},S=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",Ne=s=>s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",ae=s=>Array.isArray(s.assignedUsers)&&s.assignedUsers.length?s.assignedUsers.map(t=>t.name).join(", "):Array.isArray(s.assigned_to)&&s.assigned_to.length?s.assigned_to.join(", "):"Unassigned",U=n.useMemo(()=>I==="all"?u:u.filter(s=>{const t=b(s).toUpperCase(),a=I.toUpperCase();return t===a}),[u,I]),K=()=>{const s={pending:0,in_progress:0,completed:0,on_hold:0,request_approved:0,locked:0};return u.forEach(t=>{const a=b(t).toLowerCase();a==="request approved"?s.request_approved++:a==="locked"?s.locked++:s.hasOwnProperty(a)&&s[a]++}),s},f=n.useCallback(async(s="")=>{if(!s){E([]),H(null),R(!1);return}R(!0);try{const t=await w(`/api/tasks?projectId=${encodeURIComponent(s)}`);if(t&&t.error)throw t.error.includes("assigned_to")&&console.warn("Backend assignment error:",t.error),new Error(t.error||"Failed to load tasks");const a=Array.isArray(t==null?void 0:t.data)?t.data:[],c=g.find(o=>[o.public_id,o.id,o._id,o.internalId,o.project_id].includes(s)),i=a.map(o=>!o.project_id&&!o.projectId&&!o.project?{...o,project_id:s,projectId:s,project:c||{name:v(c),id:s}}:o);E(i),H(null)}catch(t){H(t.message||"Failed to load tasks for the project"),x.error("Failed to load tasks")}finally{R(!1)}},[g]),le=n.useCallback(async()=>{Y(!0);try{const s=await w("/api/manager/employees/all"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;pe(Array.isArray(t)?t:[])}catch{}finally{Y(!1)}},[]),ne=n.useCallback(async()=>{J(!0);try{const s=await w("/api/manager/projects"),t=Array.isArray(s==null?void 0:s.data)?s.data:s,a=Array.isArray(t)?t:[];ue(a)}catch{x.error("Failed to load projects")}finally{J(!1)}},[]),V=n.useCallback(s=>{if(!s||g.length===0){G(null);return}const t=g.find(a=>[a.public_id,a.id,a._id,a.internalId,a.project_id].some(i=>i&&i.toString()===s.toString()))||null;G(t)},[g]);n.useEffect(()=>{if(g.length>0&&!l){const s=g[0],t=A(s);t&&X(t)}},[g]),n.useEffect(()=>{ne()},[ne]),n.useEffect(()=>{l&&(f(l),V(l))},[f,l,V]),n.useEffect(()=>{N(null)},[l]),n.useEffect(()=>{le()},[le]);const ie=s=>{X(s),N(null),E([]),s?V(s):G(null)},ve=async s=>{var a,c;if(s.preventDefault(),!d.title||!l){x.error("Title and project are required");return}const t=ye(d.assignedUsers);if(!t.valid){x.error(t.error);return}Q(!0);try{const i=g.find(D=>[D.public_id,D.id,D._id,D.internalId,D.project_id].includes(l)),o=d.assignedUsers[0],ce={title:d.title,description:d.description,priority:d.priority,stage:d.stage,taskDate:d.taskDate?new Date(d.taskDate).toISOString():void 0,timeAlloted:Number(d.timeAlloted)||0,projectId:l,client_id:((a=i==null?void 0:i.client)==null?void 0:a.public_id)||((c=i==null?void 0:i.client)==null?void 0:c.id)||(i==null?void 0:i.client_id),assigned_to:o},j=await w("api/projects/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ce)});if(j&&j.error){if(j.error.includes("assigned_to")&&j.error.includes("exactly one")){x.error("Error: Task must be assigned to exactly one user");return}throw new Error(j.error||"Unable to create task")}const Ce=(j==null?void 0:j.message)||"Task created successfully";x.success(Ce),h({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:l}),k(!1),f(l)}catch(i){console.error("Error creating task:",i),i.response&&i.response.message&&i.response.message.includes("successfully")?(x.success(i.response.message||"Task created successfully"),h({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:l}),k(!1),f(l)):x.error((i==null?void 0:i.message)||"Unable to create task")}finally{Q(!1)}},z=()=>{if(!l){x.error("Please select a project first");return}k(!0)},W=async s=>{if(!s)return;const t=s.id||s.public_id||s._id||s.internalId;if(!t){N(s);return}te(!0);try{const a=await w("/api/tasks/selected-details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:[t]})});if(a&&a.error)throw new Error(a.error||"Failed to fetch task details");const c=(a==null?void 0:a.data)??a,i=Array.isArray(c)?c[0]:c;N(i||s)}catch(a){console.error("Failed to load task details:",a),x.error((a==null?void 0:a.message)||"Failed to load task details"),N(s)}finally{te(!1)}},we=async()=>{if(!r||!y)return;const s=r.id||r.public_id||r._id;if(!s){x.error("Task ID not found");return}ee(!0);try{const t=await w(`/api/tasks/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({assigned_to:y})});if(t&&t.error)throw new Error(t.error||"Failed to reassign task");x.success("Task reassigned successfully"),E(a=>a.map(c=>(c.id||c.public_id||c._id)===s?{...c,assigned_to:[y]}:c)),r&&(r.id||r.public_id||r._id)===s&&N(a=>a?{...a,assigned_to:[y]}:null),Z(""),l&&f(l)}catch(t){console.error("Failed to reassign task:",t),x.error((t==null?void 0:t.message)||"Failed to reassign task")}finally{ee(!1)}};return e.jsxs("div",{className:"p-8 bg-gray-50 min-h-screen",children:[e.jsx(De,{title:"Tasks",subtitle:"Manage and track all your tasks",onRefresh:()=>l&&f(l),refreshing:p,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l||"",onChange:s=>ie(s.target.value),disabled:B,className:"border border-gray-300 rounded-lg px-4 py-2 pr-8 bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none min-w-[200px]",children:[e.jsx("option",{value:"",children:"Select a project"}),g.map(s=>{const t=A(s),a=v(s);return e.jsx("option",{value:t,children:a},t)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),e.jsx(Ee,{mode:q,onChange:fe,className:"ml-1"}),e.jsxs("button",{onClick:z,disabled:!l||p,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${!l||p?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[e.jsx(me,{className:"tm-icon"}),"Add Task"]})]})}),p&&l&&e.jsxs("div",{className:"flex items-center justify-center p-4 mb-6 bg-blue-50 rounded-lg",children:[e.jsx(_,{className:"tm-icon mr-2 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Loading tasks..."})]}),l&&m&&e.jsx("div",{className:"bg-white rounded-xl border p-6 mb-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("div",{className:"text-blue-600 font-bold text-lg",children:v(m).charAt(0)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:v(m)}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"tm-icon text-gray-500"}),e.jsxs("span",{className:"text-gray-700",children:["Client: ",e.jsx("span",{className:"font-medium",children:je(m)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${P(m)==="Active"||P(m)==="In Progress"?"bg-green-500":P(m)==="Completed"?"bg-blue-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-gray-700",children:["Status: ",e.jsx("span",{className:"font-medium",children:P(m)})]})]})]})]})]}),m.description&&e.jsx("p",{className:"text-gray-600 mb-4",children:m.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:K().pending})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:K().in_progress})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:K().completed})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:w-auto w-full",children:[e.jsxs("button",{onClick:z,className:"flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors",children:[e.jsx(me,{className:"tm-icon"}),"Add New Task"]}),e.jsx(_e,{onClick:()=>f(l),loading:p,className:"px-4 py-3"})]})]})}),l&&u.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"tm-icon text-gray-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Filters:"})]}),e.jsxs("select",{value:I,onChange:s=>be(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p,children:[e.jsx("option",{value:"all",children:"All Status"}),re.map(s=>e.jsx("option",{value:s,children:T(s)},s)),e.jsx("option",{value:"Request Approved",children:"Request Approved"}),e.jsx("option",{value:"LOCKED",children:"Locked"})]})]}),!l&&!B&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(M,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Project"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please select a project from the dropdown above to view and manage tasks."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:g.slice(0,5).map(s=>{const t=A(s),a=v(s);return e.jsx("button",{onClick:()=>ie(t),className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",children:a},t)})})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:`${r?"lg:w-3/5":"flex-1"}`,children:[l&&!p&&u.length===0&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(M,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Tasks Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No tasks found for this project. Create your first task or try refreshing."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:z,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create First Task"}),e.jsx("button",{onClick:()=>f(l),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors border border-gray-300",children:"Refresh"})]})]}),l&&!p&&u.length>0&&q==="list"&&e.jsx("div",{className:"tm-list-container",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left",children:"Task"}),e.jsx("th",{className:"p-4 text-left",children:"Assigned To"}),e.jsx("th",{className:"p-4 text-left",children:"Status"}),e.jsx("th",{className:"p-4 text-left",children:"Priority"}),e.jsx("th",{className:"p-4 text-left",children:"Due Date"}),e.jsx("th",{className:"p-4 text-left",children:"Estimated Hours"})]})}),e.jsx("tbody",{children:U.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:[e.jsx(M,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks found for the selected filters"})]})}):U.map(s=>{const t=(r==null?void 0:r.id)===s.id||(r==null?void 0:r.public_id)===s.public_id,a=b(s);return e.jsxs("tr",{onClick:()=>W(s),className:`border-b transition-colors cursor-pointer ${t?"bg-gray-50":"hover:bg-gray-50"}`,children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.title||s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:s.description})]}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:ae(r||s)})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a==="LOCKED"?"bg-red-100 text-red-800":a==="COMPLETED"||a==="Completed"?"bg-green-100 text-green-800":a==="IN_PROGRESS"||a==="In Progress"?"bg-blue-100 text-blue-800":a==="ON_HOLD"||a==="On Hold"?"bg-red-100 text-red-800":a==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:T(a)})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:S(s.taskDate||s.dueDate)})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"tm-icon text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[s.estimatedHours||s.timeAlloted||0,"h"]})]})})]},s.id||s.public_id||s._id||s.internalId)})})]})}),l&&!p&&u.length>0&&q==="grid"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:U.length===0?e.jsxs(oe,{className:"col-span-full text-center",children:[e.jsx(M,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"No tasks found for the selected filters"})]}):U.map(s=>{const t=b(s);return e.jsxs(oe,{onClick:()=>W(s),role:"button",className:"cursor-pointer",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description})]})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t==="LOCKED"?"bg-red-100 text-red-800":t==="COMPLETED"||t==="Completed"?"bg-green-100 text-green-800":t==="IN_PROGRESS"||t==="In Progress"?"bg-blue-100 text-blue-800":t==="ON_HOLD"||t==="On Hold"?"bg-red-100 text-red-800":t==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:T(t)}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:ae(s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:S(s.taskDate||s.dueDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"tm-icon text-gray-400"}),e.jsxs("span",{children:[s.estimatedHours||s.timeAlloted||0," hours estimated"]})]})]})]},s.id||s.public_id||s._id||s.internalId)})})]}),r&&e.jsx("div",{className:"lg:w-2/5",children:e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm sticky top-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r.title}),e.jsx("span",{className:`rounded-full border px-3 py-1 text-xs font-semibold ${b(r)==="LOCKED"?"bg-red-100 text-red-800 border-red-200":getTaskStatus(r)==="COMPLETED"||getTaskStatus(r)==="Completed"?"bg-green-100 text-green-800 border-green-200":getTaskStatus(r)==="IN_PROGRESS"||getTaskStatus(r)==="In Progress"?"bg-blue-100 text-blue-800 border-blue-200":getTaskStatus(r)==="ON_HOLD"||getTaskStatus(r)==="On Hold"?"bg-red-100 text-red-800 border-red-200":getTaskStatus(r)==="Request Approved"?"bg-purple-100 text-purple-800 border-purple-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:T(getTaskStatus(r))})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((de=r.project)==null?void 0:de.name)&&`Project: ${r.project.name}`}),(b(r)==="COMPLETED"||b(r)==="Completed")&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-xs mt-1",children:["Total working hours: ",e.jsx("span",{className:"font-bold",children:r.total_time_hhmmss||"0h 0m"})]}),e.jsx("p",{className:"text-xs mt-1",children:"This task is locked and cannot be modified further."})]}),b(r)==="LOCKED"&&e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”’ Task Locked - Pending Approval"}),e.jsx("p",{className:"text-xs",children:"Task is locked pending manager approval for reassignment request."})]}),b(r)==="Request Approved"&&e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-purple-50 p-3 text-sm text-purple-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Reassignment Approved"}),e.jsx("p",{className:"text-xs",children:"Employee reassignment request has been approved."})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Due ",S(r.taskDate||r.dueDate)]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>W(r),disabled:se,className:"flex items-center gap-2 px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(_,{className:`w-4 h-4 ${se?"animate-spin":""}`}),"Refresh Task"]})}),r.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:r.description})]}),r.assignedUsers&&r.assignedUsers.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Assigned To"}),e.jsx("div",{className:"mt-2 space-y-2",children:r.assignedUsers.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name||s.email||"Unknown User"})]},s.id||s.public_id||t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Reassign Task"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("select",{value:y,onChange:s=>Z(s.target.value),disabled:C.length===0||getTaskStatus(r)==="COMPLETED"||getTaskStatus(r)==="LOCKED",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Select employee"}),C.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("button",{onClick:we,disabled:$||!y||C.length===0||getTaskStatus(r)==="COMPLETED"||getTaskStatus(r)==="LOCKED",className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm ${$||!y||C.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:$?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 animate-spin"}),"Reassigning..."]}):"Reassign Task"})]})]}),r.checklist&&r.checklist.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Checklist"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.checklist.filter(s=>s.status==="Completed").length," / ",r.checklist.length," completed"]})]}),e.jsx("ul",{className:"space-y-3",children:r.checklist.map((s,t)=>{const a=s.id||s.public_id||`${t}`,c=s.status==="Completed";return e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsx("div",{className:"flex items-center justify-between gap-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(Ae,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${c?"text-gray-400 line-through":"text-gray-900"}`,children:s.title||"Untitled item"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due ",S(s.dueDate)]}),s.completedAt&&e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["Completed ",S(s.completedAt)]})]})]})})},a)})})]}),r.activities&&r.activities.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:r.activities.slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.description||s.action}),e.jsx("p",{className:"text-xs text-gray-500",children:Ne(s.createdAt||s.timestamp)})]})]},s.id||t))})]}),r.time_tracking&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Time Tracking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Estimated"}),e.jsxs("p",{className:"text-sm font-medium",children:[r.estimatedHours||r.timeAlloted||0,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Worked"}),e.jsx("p",{className:"text-sm font-medium",children:r.total_time_hhmmss||"0h 0m"})]})]})]})]})})})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center font-semibold",children:"âž•"}),"Create New Task"]}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{required:!0,value:d.title,onChange:s=>h({...d,title:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:s=>h({...d,description:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Task description (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Project"}),e.jsxs("div",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 font-medium",children:[m?v(m):"Selected Project"," âœ“"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Project selected from dropdown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Priority"}),e.jsxs("select",{value:d.priority,onChange:s=>h({...d,priority:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Status"}),e.jsx("select",{value:d.stage,onChange:s=>h({...d,stage:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:re.map(s=>e.jsx("option",{value:s,children:T(s)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Estimated Hours"}),e.jsx("input",{type:"number",min:"0",step:"0.5",value:d.timeAlloted,onChange:s=>h({...d,timeAlloted:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 8"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:d.taskDate,onChange:s=>h({...d,taskDate:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Assign To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:d.assignedUsers[0]||"",onChange:s=>{const t=s.target.value;h({...d,assignedUsers:t?[t]:[]})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select an employee"}),C.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only one employee can be assigned"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>k(!1),disabled:F,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:F?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"tm-icon animate-spin"}),"Creating..."]}):"Create Task"})]})]})]})})]})};export{Fe as default};
