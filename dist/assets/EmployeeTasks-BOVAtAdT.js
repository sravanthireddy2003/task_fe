import{r as u,j as e,a5 as xs,a6 as gs,a7 as ps,a8 as hs,a9 as bs,aa as fs,ab as Oe,ac as ys,ad as Ns,i as m,u as Ge,b as Fe,s as He,ae as js,af as ws,ag as vs,a as Cs,G as _s,L as Ss,ah as Ts,a3 as Y,_ as Ds,ai as Rs,aj as Es,ak as Is,al as ks,am as Ps}from"./index-7TXHU69M.js";import{i as ge,a as Z,g as de}from"./taskHelpers-CsgoO_-X.js";import{u as Os,C as qs,a as As,S as $s,v as Ls,b as Ms,c as qe,D as Us,d as Gs,e as Fs,s as Hs,K as Vs,P as Bs}from"./sortable.esm-8sHf0gZB.js";const Ve=({task:a,onClick:d,isDragging:h=!1,userRole:M,reassignmentRequests:U={}})=>{const[y,N]=u.useState(a.total_duration||0);u.useEffect(()=>{let r;if((a.status||a.stage)==="In Progress"&&a.started_at){const v=new Date(a.started_at).getTime(),T=a.total_duration||0;r=setInterval(()=>{const C=new Date().getTime(),K=Math.floor((C-v)/1e3);N(T+K)},1e3)}else N(a.total_duration||0);return()=>clearInterval(r)},[a.status,a.stage,a.total_duration,a.started_at]);const{attributes:G,listeners:b,setNodeRef:_,transform:k,transition:j,isDragging:D}=Os({id:a.id||a._id||a.public_id}),O={transform:qs.Transform.toString(k),transition:j},A=r=>{switch(r==null?void 0:r.toLowerCase()){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},E=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"}):null,$=(r=>{const f=r.assignedUsers||r.assigned_users||[];return Array.isArray(f)?f:[]})(a);a.id||a._id||a.public_id;const F=a.lock_info||{},H=a.task_status||{},P=F.request_status||H.request_status||null,V=P==="PENDING",B=P==="APPROVE"||P==="APPROVED",S=P==="DENY"||P==="DENIED"||P==="REJECTED",g=(a.status||"").toLowerCase()==="completed",x=r=>{const f=Math.floor(r/3600),v=Math.floor(r%3600/60),T=r%60;return f>0?`${f}h ${v}m ${T}s`:`${v}m ${T}s`};return e.jsxs("div",{ref:_,style:O,...G,...V||g?{}:{...b},className:`bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow ${h||D?"opacity-50":""} ${g?"border-green-300 bg-green-50 opacity-75 cursor-not-allowed":""} ${V?"border-orange-300 bg-orange-50 opacity-75 cursor-not-allowed":"cursor-pointer"}`,onClick:V||g?void 0:d,children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:a.title||a.name||"Untitled Task"}),a.description&&e.jsx("p",{className:"text-body-small text-gray-600 mb-3 line-clamp-2",children:a.description}),a.project&&e.jsxs("div",{className:"text-meta mb-2",children:["ðŸ“ ",a.project.name||a.project.title||"Project"]}),a.priority&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(xs,{className:`w-3 h-3 ${A(a.priority)}`}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full ${A(a.priority)}`,children:a.priority})]}),$.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(gs,{className:"w-3 h-3 text-gray-400"}),e.jsxs("div",{className:"flex -space-x-1",children:[$.slice(0,3).map((r,f)=>e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white",title:r.name||r.email||"User",children:(r.name||r.email||"U").charAt(0).toUpperCase()},r.id||r._id||f)),$.length>3&&e.jsxs("div",{className:"w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 text-xs font-medium border-2 border-white",children:["+",$.length-3]})]})]}),a.due_date&&e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(ps,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-caption",children:["Due ",E(a.due_date)]})]}),g?e.jsxs("div",{className:"flex items-center gap-2 mt-3 p-2 bg-green-100 rounded-lg",children:[e.jsx(hs,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-caption font-semibold text-green-700",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-caption text-green-600",children:["Total: ",a.total_time_hhmmss||x(a.total_time_seconds||0)]})]})]}):(y>0||(a.status||a.stage)==="In Progress")&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:`w-3 h-3 ${(a.status||a.stage)==="In Progress"?"text-blue-500 animate-pulse":"text-gray-400"}`}),e.jsx("span",{className:`text-caption font-medium ${(a.status||a.stage)==="In Progress"?"text-blue-600":"text-gray-600"}`,children:x(y)})]}),a.checklist&&a.checklist.length>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(fs,{className:"w-3 h-3 text-gray-400"}),e.jsxs("span",{className:"text-caption",children:[a.checklist.filter(r=>r.status==="Completed").length,"/",a.checklist.length," items"]})]}),V&&e.jsx("div",{className:"mt-2 text-xs text-orange-700 bg-orange-100 px-2 py-1 rounded",children:"Reassignment Pending"}),B&&e.jsx("div",{className:"mt-2 text-xs text-green-700 bg-green-100 px-2 py-1 rounded",children:"Reassignment Approved"}),S&&e.jsx("div",{className:"mt-2 text-xs text-red-700 bg-red-100 px-2 py-1 rounded",children:"Reassignment Denied"}),g&&e.jsx("div",{className:"mt-2 text-xs text-green-700 bg-green-100 px-2 py-1 rounded font-semibold",children:"âœ“ Completed - No Further Changes"})]})},Ks=({id:a,title:d,tasks:h,onTaskClick:M,userRole:U,reassignmentRequests:y={},onAddTask:N})=>{const{setNodeRef:G,isOver:b}=As({id:a}),k=(j=>{switch(j){case"PENDING":case"To Do":return{borderColor:"border-amber-200",bgColor:"bg-amber-50/30",headerBg:"bg-gradient-to-r from-amber-500 to-amber-600",headerText:"text-white",accentColor:"text-amber-600"};case"In Progress":return{borderColor:"border-blue-200",bgColor:"bg-blue-50/30",headerBg:"bg-gradient-to-r from-blue-500 to-blue-600",headerText:"text-white",accentColor:"text-blue-600"};case"On Hold":return{borderColor:"border-orange-200",bgColor:"bg-orange-50/30",headerBg:"bg-gradient-to-r from-orange-500 to-orange-600",headerText:"text-white",accentColor:"text-orange-600"};case"Review":return{borderColor:"border-purple-200",bgColor:"bg-purple-50/30",headerBg:"bg-gradient-to-r from-purple-500 to-purple-600",headerText:"text-white",accentColor:"text-purple-600"};case"Completed":return{borderColor:"border-emerald-200",bgColor:"bg-emerald-50/30",headerBg:"bg-gradient-to-r from-emerald-500 to-emerald-600",headerText:"text-white",accentColor:"text-emerald-600"};default:return{borderColor:"border-slate-200",bgColor:"bg-slate-50/30",headerBg:"bg-gradient-to-r from-slate-500 to-slate-600",headerText:"text-white",accentColor:"text-slate-600"}}})(d);return e.jsxs("div",{ref:G,className:`flex-shrink-0 w-80 rounded-xl border-2 transition-all duration-200 shadow-sm hover:shadow-md ${b?"border-blue-400 bg-blue-50/50 shadow-lg scale-[1.02]":`${k.borderColor} ${k.bgColor}`}`,children:[e.jsxs("div",{className:`${k.headerBg} ${k.headerText} p-4 rounded-t-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-h4 font-semibold tracking-tight",children:d}),e.jsx("div",{className:"px-2 py-1 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsx("span",{className:"text-caption font-medium",children:h.length})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsx("button",{onClick:()=>N(d),className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-colors group",title:"Add task",children:e.jsx(Oe,{className:"tm-icon text-white group-hover:scale-110 transition-transform"})}),e.jsx("button",{className:"p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:e.jsx(ys,{className:"tm-icon text-white"})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-white/80",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60"}),e.jsxs("span",{className:"text-caption",children:[h.filter(j=>j.priority==="high").length," high priority"]})]}),h.some(j=>j.due_date)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-white/60"}),e.jsxs("span",{className:"text-caption",children:[h.filter(j=>{if(!j.due_date)return!1;const A=new Date(j.due_date)-new Date,E=Math.ceil(A/(1e3*60*60*24));return E<=3&&E>=0}).length," due soon"]})]})]})]}),e.jsxs("div",{className:"p-4 max-h-[65vh] overflow-y-auto space-y-3",children:[e.jsx($s,{items:h.map(j=>j.id||j._id||j.public_id),strategy:Ls,children:h.map(j=>e.jsx(Ve,{task:j,onClick:()=>M(j),userRole:U,reassignmentRequests:y},j.id||j._id||j.public_id))}),h.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-3",children:e.jsx(Oe,{className:"tm-icon text-slate-400"})}),e.jsx("p",{className:"text-caption text-slate-500 mb-1",children:"No tasks yet"}),e.jsx("p",{className:"text-meta text-slate-400",children:"Drop tasks here or create new ones"})]})]})]})},zs=a=>{const d=(a==null?void 0:a.id)||(a==null?void 0:a.public_id)||(a==null?void 0:a.internal_id);return typeof d=="string"&&/^\d+$/.test(d)?parseInt(d,10):d},Ws=({tasks:a=[],kanbanData:d,onUpdateTask:h,onStartTask:M,onPauseTask:U,onResumeTask:y,onCompleteTask:N,onLoadTasks:G,userRole:b="employee",projectId:_=null,reassignmentRequests:k={},isTaskReadOnly:j=()=>!1})=>{const[D,O]=u.useState(null),[A,E]=u.useState(null),[J,$]=u.useState(!1),F=Ms(qe(Bs),qe(Vs,{coordinateGetter:Hs})),H=u.useMemo(()=>{console.log("KanbanBoard columns useMemo:",{kanbanData:d,tasks:a});const S={"To Do":a.filter(g=>{const x=(g.status||g.stage||"").toUpperCase();return x==="PENDING"||x==="TO_DO"||x==="TODO"}),"In Progress":a.filter(g=>{const x=(g.status||g.stage||"").toUpperCase();return x==="IN_PROGRESS"||x==="IN PROGRESS"}),"On Hold":a.filter(g=>{const x=(g.status||g.stage||"").toUpperCase();return x==="ON_HOLD"||x==="ON HOLD"}),Review:a.filter(g=>(g.status||g.stage||"").toUpperCase()==="REVIEW"),Completed:a.filter(g=>{const x=(g.status||g.stage||"").toUpperCase();return x==="COMPLETED"||x==="COMPLETE"})};return d&&Array.isArray(d)&&d.length>0&&d.forEach(g=>{const x=(g.status||"").toUpperCase();let r="To Do";x==="PENDING"||x==="TO_DO"?r="To Do":x==="IN_PROGRESS"?r="In Progress":x==="ON_HOLD"?r="On Hold":x==="REVIEW"?r="Review":x==="COMPLETED"&&(r="Completed"),g.tasks&&Array.isArray(g.tasks)&&g.tasks.forEach(f=>{a.some(T=>T.id===f.id||T._id===f._id||T.public_id===f.public_id)||(S[r]=[...S[r],f])})}),S},[a,d]),P=S=>{const{active:g}=S,x=a.find(v=>v.id===g.id||v._id===g.id||v.public_id===g.id);if(!x)return;if(x.is_locked===!0){m.error("This task is locked and cannot be moved until your manager responds.");return}if(x.status==="Completed"){m.error("Completed tasks cannot be moved. Task is locked.");return}const r=x.id||x._id||x.public_id,f=k[r];if((f==null?void 0:f.status)==="PENDING"){m.error("You have submitted a reassignment request. Task is locked until manager responds.");return}O(x)},V=async S=>{const{active:g,over:x}=S;if(O(null),!x)return;const r=g.id,f=x.id,v=a.find(L=>L.id===r||L._id===r||L.public_id===r);if(!v)return;if(v.is_locked===!0){m.error("This task is locked and cannot be moved until your manager responds.");return}if(v.status==="Completed"){m.error("Completed tasks cannot be moved. Task is locked.");return}if(j(v)){m.error("You have readonly access to this task and cannot move it.");return}let T=null;if(Object.keys(H).includes(f))T=f;else for(const[L,he]of Object.entries(H))if(he.findIndex(Q=>Q.id===f||Q._id===f||Q.public_id===f)!==-1){T=L;break}if(!T)return;const C=v.status||v.stage,K=zs(v);try{T==="In Progress"?C==="PENDING"||C==="Pending"||C==="To Do"||C==="PENDING"||C==="TO_DO"||C==="TO DO"?await M(K):C==="On Hold"||C==="ON_HOLD"?await y(K):m.error(`Cannot move from ${C} to In Progress`):T==="On Hold"?C==="In Progress"||C==="IN_PROGRESS"?await U(K):m.error(`Cannot move from ${C} to On Hold`):T==="Review"?C==="In Progress"||C==="IN_PROGRESS"?await N(K):m.error(`Cannot move from ${C} to Review`):T==="To Do"&&(C==="In Progress"||C==="IN_PROGRESS"||C==="On Hold"||C==="ON_HOLD"?m.error("Moving back to To Do is not currently supported"):m.error(`Cannot move from ${C} to To Do`))}catch(L){m.error((L==null?void 0:L.message)||"Failed to update task status"),console.error("Drag end error:",L)}},B=S=>{E(S),$(!0)};return e.jsx("div",{className:"h-full w-full",children:e.jsxs(Us,{sensors:F,collisionDetection:Gs,onDragStart:P,onDragEnd:V,children:[e.jsx("div",{className:"flex h-full gap-6 overflow-x-auto pb-6",children:Object.entries(H).map(([S,g])=>e.jsx(Ks,{id:S,title:S,tasks:g,onTaskClick:B,userRole:b,reassignmentRequests:k},S))}),Ns.createPortal(e.jsx(Fs,{children:D?e.jsx(Ve,{task:D,isDragging:!0,userRole:b,reassignmentRequests:k}):null}),document.body)]})})},Ys=({task:a,projectId:d,onSuccess:h})=>{var A;const M=Ge(),U=Fe(He),[y,N]=u.useState(!1),[G,b]=u.useState(!1),[_,k]=u.useState("");if(!(((A=U==null?void 0:U.role)==null?void 0:A.toLowerCase())==="employee"&&(a==null?void 0:a.status)==="IN_PROGRESS"))return null;const O=async()=>{if(!_.trim()){m.error("Please provide a reason for completion request");return}N(!0);try{const E=await M(vs({taskId:a.id||a._id,projectId:d,reason:_.trim()})).unwrap();m.success("Task completion requested successfully"),b(!1),k(""),h&&h({...a,status:"REVIEW"})}catch(E){m.error(E||"Failed to request task completion")}finally{N(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>b(!0),disabled:y,className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 rounded-md transition-colors",children:[y?e.jsx(js,{className:"w-4 h-4 animate-spin"}):e.jsx(ws,{className:"w-4 h-4"}),"Request Completion"]}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Task Completion"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide a reason for requesting completion approval:"}),e.jsx("textarea",{value:_,onChange:E=>k(E.target.value),placeholder:"Explain why this task is ready for completion...",className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,maxLength:500}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:y||!_.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 rounded-md",children:y?"Submitting...":"Submit Request"})]})]})})]})},{AlertCircle:Js,CheckCircle:Ae,Play:Qs,Pause:Xs,RotateCcw:Zs,Clock:$e,Kanban:Le,List:Me,CheckSquare:et,User:st,Calendar:tt,RefreshCw:te,Filter:rt,ChevronDown:at}=_s,w=a=>{if(!a)return"";if(typeof a=="string"||typeof a=="number")return String(a);const d=a.id||a.public_id||a.internal_id||a.internalId||a._id;return d!=null?String(d):""},re=a=>{if(!a)return"â€”";const d=new Date(a);return Number.isNaN(d.getTime())?a:d.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},nt=a=>{if(!a)return"";const d=new Date(a);return Number.isNaN(d.getTime())?"":d.toISOString().split("T")[0]},q=a=>{const d=(a==null?void 0:a.id)||(a==null?void 0:a.public_id)||(a==null?void 0:a.internal_id);return typeof d=="string"&&/^\d+$/.test(d)?parseInt(d,10):d},Ue=a=>typeof a=="string"&&/^\d+$/.test(a)?parseInt(a,10):a,pe=a=>{if(!a)return"bg-gray-100 text-gray-800 border-gray-200";switch(a.toUpperCase()){case"PENDING":case"TO DO":case"TODO":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"IN_PROGRESS":case"IN PROGRESS":return"bg-blue-100 text-blue-800 border-blue-200";case"COMPLETED":return"bg-green-100 text-green-800 border-green-200";case"ON_HOLD":case"ON HOLD":return"bg-red-100 text-red-800 border-red-200";case"REVIEW":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},lt=a=>{switch((a||"MEDIUM").toUpperCase()){case"HIGH":return"bg-red-100 text-red-800 border-red-200";case"MEDIUM":return"bg-amber-100 text-amber-800 border-amber-200";case"LOW":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-amber-100 text-amber-800 border-amber-200"}},ft=()=>{var De,Re,Ee;Cs();const a=Ge(),d=Fe(He),h=(De=d==null?void 0:d.role)==null?void 0:De.toLowerCase(),[M,U]=u.useState([]),y=u.useCallback(s=>{if(!s)return!1;if(s.assignedUsers&&Array.isArray(s.assignedUsers)){const t=s.assignedUsers.find(n=>n.id===(d==null?void 0:d.id)||n._id===(d==null?void 0:d._id)||n.public_id===(d==null?void 0:d.public_id)||n.internalId===(d==null?void 0:d.internal_id));if((t==null?void 0:t.readOnly)===!0)return!0}return ge(s)||Z(s)||W(s)==="pending"},[d]),[N,G]=u.useState(""),[b,_]=u.useState([]),[k,j]=u.useState([]),[D,O]=u.useState(!0),[A,E]=u.useState(null),[J,$]=u.useState("list"),[F,H]=u.useState({title:"",dueDate:""}),[P,V]=u.useState(""),[B,S]=u.useState({title:"",dueDate:""}),[g,x]=u.useState(!1),[r,f]=u.useState(null),[v,T]=u.useState(null),[C,K]=u.useState({}),[L,he]=u.useState(!1),[ce,Q]=u.useState({}),[ot,Be]=u.useState({}),[it,Ke]=u.useState(null),[ae,ze]=u.useState([]),[ue,We]=u.useState(""),[me,be]=u.useState(!1),[ne,Ye]=u.useState("all"),[Je,fe]=u.useState(0),[dt,ct]=u.useState(!1),[ut,mt]=u.useState(""),[xt,Qe]=u.useState(!1),[gt,xe]=u.useState({}),[Xe,le]=u.useState({}),Ze=["all","PENDING","IN_PROGRESS","COMPLETED","ON_HOLD","TO DO","REVIEW"];u.useEffect(()=>{const s=setInterval(()=>{le(t=>{const n={...t};return Object.keys(n).forEach(o=>{n[o]&&(n[o]=n[o]+1)}),n})},1e3);return()=>clearInterval(s)},[]);const es=(s,t=0)=>{const n=s+t,o=Math.floor(n/3600),c=Math.floor(n%3600/60),i=n%60;return`${o.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},ss=s=>{const t=(s==null?void 0:s.total_time_hours)||0,n=(s==null?void 0:s.total_time_hhmmss)||"00:00:00",[o,c,i]=n.split(":").map(Number);return o*3600+c*60+i+t*3600},ts=async()=>{try{const s=await Y("/api/projects?dropdown=1"),t=(s==null?void 0:s.data)||s||[];if(Array.isArray(t)&&(U(t),t.length>0&&!N)){const n=t[0].projectId||t[0].id||t[0]._id||t[0].public_id;G(n)}}catch(s){console.error("Failed to load projects:",s)}},rs=async s=>{if(s){O(!0),E(null);try{const t=await a(Ds({project_id:s})).unwrap(),n=Array.isArray(t)?t:(t==null?void 0:t.data)||[],o=(t==null?void 0:t.kanban)||[];if(Array.isArray(n)){_(n),j(o);const c={};n.forEach(l=>{const p=w(l);p&&l.checklist&&l.checklist.length>0&&(c[p]=l.checklist)}),K(c);const i={};n.forEach(l=>{const p=w(l);p&&l.lock_info&&l.lock_info.is_locked&&(i[p]={id:l.lock_info.request_id,taskId:l.id||l.internal_id,status:l.lock_info.request_status||"PENDING",requested_at:l.lock_info.requested_at,responded_at:l.lock_info.responded_at,requester_name:l.lock_info.requester_name})}),Q(i)}else _([]),j([])}catch(t){E((t==null?void 0:t.message)||"Failed to load tasks"),_([])}finally{O(!1)}}},ee=async s=>{try{const t=q(s);if(!t){console.warn("Invalid task ID for timeline:",s);return}const n=await a(Ps(t)).unwrap();if(n){const o=w(s);Be(c=>({...c,[o]:n}))}}catch(t){console.error("Failed to load task timeline:",t)}},as=async()=>{try{const s=await Y("/api/manager/employees/all"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;ze(Array.isArray(t)?t:[])}catch(s){console.error("Failed to load employees:",s)}},ns=async()=>{O(!0),E(null);try{const t=await Y("/api/employee/my-tasks")||{},n=Array.isArray(t.data)?t.data:Array.isArray(t)?t:[],o=Array.isArray(t.kanban)?t.kanban:[];if(Array.isArray(n)){_(n),j(o);const c={};n.forEach(l=>{const p=w(l);p&&Array.isArray(l.checklist)&&l.checklist.length>0&&(c[p]=l.checklist)}),K(c);const i={};n.forEach(l=>{const p=w(l),R=l.lock_info||l.task_status||{};p&&(R.is_locked||l.is_locked)&&(i[p]={id:R.request_id||R.requestId||null,taskId:l.id||l.internal_id||l.public_id||l._id||l.internalId,status:R.request_status||R.status||"PENDING",requested_at:R.requested_at||R.requestedAt||null,responded_at:R.responded_at||R.respondedAt||null,requester_name:R.requester_name||R.requesterName||null})}),Q(i)}else _([]),j([])}catch(s){E((s==null?void 0:s.message)||"Failed to load tasks"),_([])}finally{O(!1)}};u.useEffect(()=>{ts(),h!=="employee"&&as()},[]),u.useEffect(()=>{const s=setTimeout(()=>{if(h==="employee"){ns();return}N&&rs(Ue(N))},100);return()=>clearTimeout(s)},[N,h,Je]);const ye=u.useMemo(()=>ne==="all"?b:b.filter(s=>{const t=(s.status||s.stage||"").toUpperCase(),n=ne.toUpperCase();return n==="TO DO"?t==="TO DO"||t==="PENDING"||t==="TODO":n==="IN_PROGRESS"||n==="IN PROGRESS"?t==="IN_PROGRESS"||t==="IN PROGRESS":n==="ON_HOLD"||n==="ON HOLD"?t==="ON_HOLD"||t==="ON HOLD"||t==="On Hold":t===n}),[b,ne]),Ne=()=>{const s={pending:0,in_progress:0,completed:0,on_hold:0,review:0,to_do:0};return b.forEach(t=>{const n=(t.status||"").toLowerCase();if(n==="pending"||n==="to do")s.pending++;else if(n==="in progress"||n==="in_progress")s.in_progress++;else if(n==="completed")s.completed++;else if(n==="on hold"||n==="on_hold")s.on_hold++;else if(n==="review")s.review++;else{const o=(t.stage||"").toLowerCase();s.pending++}}),s},je=u.useMemo(()=>{const s=Ne(),t=[],n=Date.now();return b.forEach(o=>{const c=new Date(o.taskDate||o.dueDate||o.due_date||null),l=(o.status||"").toLowerCase()==="completed";!Number.isNaN(c.getTime())&&c.getTime()<n&&!l&&t.push(o)}),{total:b.length,overdue:t.length,stageCounters:s}},[b]),se=(s,t)=>{_(n=>{const o=n.findIndex(p=>w(p)===s);if(o===-1)return n;const c=n[o],i={...c,...t,status:t.status||c.status||c.stage,stage:t.stage||c.stage||c.status},l=[...n];return l[o]=i,l}),r&&w(r)===s&&f(n=>({...n,...t}))},z=()=>{fe(s=>s+1)},we=async s=>{try{const t=typeof s=="object"?q(s):s,n=typeof s=="object"?s:b.find(i=>q(i)===s);if(!t){m.error("Task not found");return}const o=await a(ks(t)).unwrap();m.success("Task started");const c={status:"IN_PROGRESS",started_at:(o==null?void 0:o.started_at)||new Date().toISOString(),is_locked:!1};xe(i=>({...i,[t]:!0})),le(i=>({...i,[t]:0})),se(w(n),c),n&&ee(n),setTimeout(()=>z(),500)}catch(t){m.error((t==null?void 0:t.message)||"Failed to start task"),console.error("Start task error:",t)}},ve=async s=>{try{const t=typeof s=="object"?q(s):s,n=typeof s=="object"?s:b.find(i=>q(i)===s);if(!t){m.error("Task not found");return}const o=await a(Is(t)).unwrap();m.success("Task paused"),xe(i=>({...i,[t]:!1})),le(i=>{const l={...i};return delete l[t],l});const c={status:"ON_HOLD",is_locked:!1};se(w(n),c),n&&ee(n),setTimeout(()=>z(),500)}catch(t){m.error((t==null?void 0:t.message)||"Failed to pause task"),console.error("Pause task error:",t)}},Ce=async s=>{try{const t=typeof s=="object"?q(s):s,n=typeof s=="object"?s:b.find(i=>q(i)===s);if(!t){m.error("Task not found");return}const o=await a(Es(t)).unwrap();m.success("Task resumed"),xe(i=>({...i,[t]:!0})),le(i=>({...i,[t]:0}));const c={status:"IN_PROGRESS",is_locked:!1};se(w(n),c),n&&ee(n),setTimeout(()=>z(),500)}catch(t){m.error((t==null?void 0:t.message)||"Failed to resume task"),console.error("Resume task error:",t)}},_e=async s=>{const t=typeof s=="object"?s:b.find(n=>q(n)===s);if(t&&y(t)){m.error("Task is under review. No actions are allowed.");return}try{if(((t==null?void 0:t.status)||(t==null?void 0:t.stage)||"").toString().toUpperCase()==="REVIEW"){m.error("Task is in review and cannot be completed directly");return}const o=typeof s=="object"?q(s):s;if(!o){m.error("Task not found");return}const c=Ue((t==null?void 0:t.projectId)||(t==null?void 0:t.project_id)||N),i=await a(Rs({taskId:o,projectId:c})).unwrap();m.success("Review requested â€” sent for manager approval");const l={status:"REVIEW",is_locked:!1,lock_info:{is_locked:!1,request_status:"PENDING"}};se(w(t),l),r&&w(r)===w(t)&&f(p=>({...p,...l})),ee(t),setTimeout(()=>z(),500)}catch(n){m.error((n==null?void 0:n.message)||"Failed to request task completion"),console.error("Request task completion error:",n)}},ls=async s=>{if(s.preventDefault(),!r){m.error("Select a task before adding checklist items");return}if(!F.title.trim()){m.error("Checklist title is required");return}x(!0);try{const n={taskId:q(r),title:F.title.trim(),dueDate:F.dueDate||void 0},o=await Y("/api/employee/subtask",{method:"POST",body:JSON.stringify(n)}),c=o.data;m.success((o==null?void 0:o.message)||"Checklist item added"),H({title:"",dueDate:""});const i=w(r);_(l=>l.map(p=>w(p)===i?{...p,checklist:[...p.checklist||[],c]}:p)),r&&f(l=>({...l,checklist:[...l.checklist||[],c]}))}catch(t){m.error((t==null?void 0:t.message)||"Unable to add checklist item")}finally{x(!1)}},os=s=>{const t=(s==null?void 0:s.id)||(s==null?void 0:s.public_id);t&&(V(t),S({title:s.title||"",dueDate:nt(s.dueDate)}))},Se=()=>{V(""),S({title:"",dueDate:""})},is=async()=>{if(!(!P||!r)){if(!B.title.trim()){m.error("Checklist title cannot be empty");return}x(!0);try{const s=q(r),t={title:B.title.trim(),dueDate:B.dueDate||void 0,taskId:s},n=await Y(`/api/employee/subtask/${P}`,{method:"PUT",body:JSON.stringify(t)}),o=n.data;m.success((n==null?void 0:n.message)||"Checklist item updated"),Se();const c=w(r);_(i=>i.map(l=>w(l)===c?{...l,checklist:(l.checklist||[]).map(p=>(p.id||p.public_id)===P?o:p)}:l)),r&&f(i=>({...i,checklist:(i.checklist||[]).map(l=>(l.id||l.public_id)===P?o:l)}))}catch(s){m.error((s==null?void 0:s.message)||"Unable to update checklist item")}finally{x(!1)}}},ds=async s=>{const t=(s==null?void 0:s.id)||(s==null?void 0:s.public_id);if(!(!t||!r)&&window.confirm("Remove this checklist item?")){x(!0);try{const n=await Y(`/api/employee/subtask/${t}`,{method:"DELETE"});m.success((n==null?void 0:n.message)||"Checklist item removed");const o=w(r);_(c=>c.map(i=>w(i)===o?{...i,checklist:(i.checklist||[]).filter(l=>(l.id||l.public_id)!==t)}:i)),r&&f(c=>({...c,checklist:(c.checklist||[]).filter(i=>(i.id||i.public_id)!==t)}))}catch(n){m.error((n==null?void 0:n.message)||"Unable to delete checklist item")}finally{x(!1)}}},cs=async s=>{const t=(s==null?void 0:s.id)||(s==null?void 0:s.public_id);if(!(!t||!r)){x(!0);try{const n=await Y(`/api/employee/subtask/${t}/complete`,{method:"POST"}),o=n.data;m.success((n==null?void 0:n.message)||"Checklist marked complete");const c=w(r);_(i=>i.map(l=>{if(w(l)===c){const p=(l.checklist||[]).map(R=>(R.id||R.public_id)===t?o:R);return{...l,checklist:p}}return l})),r&&f(i=>({...i,checklist:(i.checklist||[]).map(l=>(l.id||l.public_id)===t?o:l)}))}catch(n){m.error((n==null?void 0:n.message)||"Unable to update checklist status")}finally{x(!1)}}},us=s=>{Ke(s),ee(s),Qe(!0)},ms=async()=>{if(v){if(y(v)){m.error("Task is under review. No actions are allowed.");return}be(!0);try{const s=q(v),t=await Y(`/api/tasks/${s}/request-reassignment`,{method:"POST",body:JSON.stringify({reason:v.reassignReason||"Requesting reassignment"})});t.success?(m.success(t.message||"Reassignment request sent"),fe(n=>n+1),T(null)):m.error(t.error||"Failed to request reassignment")}catch(s){m.error(s.message||"Failed to request reassignment")}finally{be(!1)}}},Te=M.find(s=>(s.id||s._id||s.public_id)===N),oe=u.useMemo(()=>r?r.checklist||[]:[],[r]);r!=null&&r.project||((Re=r==null?void 0:r.meta)==null||Re.project),u.useMemo(()=>{if(!r)return"â€”";const s=r.taskDate||r.dueDate;return s?re(s):"â€”"},[r]);const X=u.useMemo(()=>Ne(),[b]),W=s=>{var c;if(!s)return null;const t=s.lock_info||{},n=s.task_status||{},o=t.request_status||n.request_status||((c=ce[w(s)])==null?void 0:c.status)||null;return o==="PENDING"?"pending":o==="APPROVE"||o==="APPROVED"?"approved":o==="DENY"||o==="DENIED"||o==="REJECTED"?"denied":null},I=s=>(s.status||"").toLowerCase()==="completed";return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:h==="employee"?"My Tasks":"Tasks"}),e.jsx("p",{className:"text-gray-600",children:h==="employee"?"Track your assignments and keep checklists aligned with manager expectations.":"Manage and track all tasks across projects."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h!=="employee"&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:N||"",onChange:s=>G(s.target.value),className:"border border-gray-300 rounded-lg px-4 py-2 pr-8 bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none min-w-[200px]",children:[e.jsx("option",{value:"",children:"Select a project"}),M.map(s=>{const t=s.public_id||s.id||s._id;return e.jsx("option",{value:t,children:s.name},t)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx(at,{className:"w-4 h-4"})})]}),h==="employee"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>$("list"),className:`px-3 py-2 rounded-lg border ${J==="list"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Me,{className:"tm-icon mr-2 inline"}),"List"]}),e.jsxs("button",{onClick:()=>$("kanban"),className:`px-3 py-2 rounded-lg border ${J==="kanban"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(Le,{className:"tm-icon mr-2 inline"}),"Kanban"]})]}),e.jsx("button",{onClick:z,disabled:D||h!=="employee"&&!N,className:`p-2 rounded-lg border ${D||h!=="employee"&&!N?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-blue-600 hover:bg-blue-50 border-blue-200"}`,title:"Refresh tasks",children:e.jsx(te,{className:`w-5 h-5 ${D?"animate-spin":""}`})})]})]}),(h==="employee"||N&&b.length>0)&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3 mb-6",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-gray-500",children:"Total"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:je.total}),e.jsx("p",{className:"text-xs text-gray-500",children:"Current assignments"})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-amber-500",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-semibold text-amber-500",children:je.overdue}),e.jsx("p",{className:"text-xs text-gray-500",children:"Need immediate attention"})]}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white p-4 text-sm shadow-sm",children:[e.jsx("p",{className:"text-[10px] uppercase tracking-[0.3em] text-blue-500",children:"In progress"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-500",children:X.in_progress}),e.jsx("p",{className:"text-xs text-gray-500",children:"Work you are handling"})]})]}),(h==="employee"&&b.length>0||N&&b.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-yellow-100 text-yellow-800 font-semibold shadow-sm border border-yellow-200",children:["Pending: ",X.pending]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-blue-100 text-blue-800 font-semibold shadow-sm border border-blue-200",children:["In Progress: ",X.in_progress]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-green-100 text-green-800 font-semibold shadow-sm border border-green-200",children:["Completed: ",X.completed]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-red-100 text-red-800 font-semibold shadow-sm border border-red-200",children:["On Hold: ",X.on_hold]}),X.review>0&&e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-purple-100 text-purple-800 font-semibold shadow-sm border border-purple-200",children:["Review: ",X.review]})]}),N&&b.length>0&&Te&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:[Te.name," - Tasks (",b.length,")"]}),e.jsx("p",{className:"text-gray-600",children:"Showing tasks for selected project"})]}),(h==="employee"&&b.length>0||N&&b.length>0)&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Filters:"})]}),e.jsxs("select",{value:ne,onChange:s=>Ye(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:D,children:[e.jsx("option",{value:"all",children:"All Status"}),Ze.filter(s=>s!=="all").map(s=>e.jsx("option",{value:s,children:de(s)},s))]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("span",{className:"text-gray-700 font-medium text-sm",children:"View:"}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>$("list"),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${J==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Me,{className:"w-4 h-4 inline mr-1"}),"List"]}),e.jsxs("button",{onClick:()=>$("kanban"),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${J==="kanban"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Le,{className:"w-4 h-4 inline mr-1"}),"Kanban"]})]})]})]}),h!=="employee"&&!N&&!D&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(Js,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Project"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please select a project from the dropdown above to view and manage tasks."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:M.slice(0,5).map(s=>{const t=s.public_id||s.id||s._id;return e.jsx("button",{onClick:()=>G(t),className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",children:s.name},t)})})]}),J==="kanban"?e.jsx(Ws,{tasks:ye,kanbanData:k,onStartTask:we,onPauseTask:ve,onResumeTask:Ce,onCompleteTask:_e,onLoadTasks:z,userRole:h,projectId:N,reassignmentRequests:ce,isTaskReadOnly:y}):e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,1.8fr)_minmax(0,1.2fr)]",children:[e.jsxs("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Assigned tasks"}),e.jsx("p",{className:"text-xs text-gray-500",children:D?"Refreshing tasksâ€¦":`${b.length} total tasks`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("button",{type:"button",onClick:z,disabled:D||h!=="employee"&&!N,className:"rounded-full border border-gray-200 bg-gray-50 px-3 py-1 hover:bg-gray-100 disabled:opacity-50 flex items-center gap-1",children:[e.jsx(te,{className:`w-3 h-3 ${D?"animate-spin":""}`}),"Refresh"]}),h==="employee"&&e.jsx(Ss,{to:"/employee/tasks",className:"text-blue-600 hover:underline",children:"Full task view"})]})]}),D?e.jsx("div",{className:"mt-6 text-sm text-gray-500",children:"Loading tasksâ€¦"}):A?e.jsxs("div",{className:"mt-6 text-sm text-red-500",children:["Error: ",A]}):b.length===0?e.jsx("div",{className:"mt-6 text-sm text-gray-500",children:"No tasks assigned yet."}):e.jsx("div",{className:"mt-4 space-y-3",children:ye.map(s=>{var ke,Pe;const t=w(s),n=t===w(r),o=W(s),c=o==="pending",i=o==="approved",l=o==="denied",p=I(s),R=s.checklist?s.checklist.filter(ie=>ie.status==="Completed").length:0,Ie=s.checklist?s.checklist.length:0;return e.jsxs("button",{type:"button",disabled:c||p||Z(s),onClick:()=>f(s),className:`w-full rounded-2xl border px-4 py-3 text-left shadow-sm transition ${p?"border-green-300 bg-green-50 opacity-75 cursor-not-allowed":c?"border-orange-300 bg-orange-50 opacity-75 cursor-not-allowed":`hover:border-blue-300 hover:bg-blue-50 ${n?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-base font-semibold text-gray-900 truncate",children:s.title||"Untitled task"}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Priority: ",e.jsx("span",{className:`font-medium ${lt(s.priority)}`,children:s.priority||"Medium"})]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Status: ",e.jsx("span",{className:`font-medium ${pe(s.status||s.stage)}`,children:de(s.status||s.stage)})]})]}),s.taskDate&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(tt,{className:"w-3 h-3"}),e.jsxs("span",{children:[re(s.taskDate)," (",s.dayName||"Unknown day",")"]})]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500 flex flex-col gap-1",children:[s.assignedUsers&&s.assignedUsers.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"}),e.jsx("span",{children:s.assignedUsers.map(ie=>ie.name||ie.email).join(", ")})]}),s.client&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Client: ",s.client.name||s.client.company]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsxs("span",{children:["Est: ",s.timeAlloted||s.estimatedHours||0,"h"]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Actual: ",es(ss(s),Xe[t]||0)]})}),((ke=s.summary)==null?void 0:ke.dueStatus)&&e.jsx("div",{className:`text-xs font-medium ${s.summary.dueStatus==="overdue"?"text-red-600":"text-orange-600"}`,children:s.summary.dueStatus==="overdue"?"Overdue":"Due Soon"})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs font-semibold",children:[e.jsx("span",{className:`rounded-full border px-3 py-0.5 ${pe(s.status||s.stage)}`,children:de(s.status||s.stage)}),e.jsx("span",{className:"rounded-full border border-gray-200 px-3 py-0.5 text-gray-600",children:((Pe=s.client)==null?void 0:Pe.name)||"Client not available"}),Ie>0&&e.jsxs("span",{className:"rounded-full border border-blue-200 bg-blue-50 px-3 py-0.5 text-blue-600 flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3"}),R,"/",Ie]}),p&&e.jsx("span",{className:"rounded-full border border-green-200 bg-green-50 px-3 py-0.5 text-green-600 font-medium",children:"âœ“ No Further Changes"}),c&&e.jsx("span",{className:"rounded-full border border-orange-200 bg-orange-50 px-3 py-0.5 text-orange-600 font-medium",children:"ðŸ”’ Reassignment Pending"}),i&&e.jsx("span",{className:"rounded-full border border-green-200 bg-green-50 px-3 py-0.5 text-green-600 font-medium",children:"âœ… Reassignment Approved"}),l&&e.jsx("span",{className:"rounded-full border border-red-200 bg-red-50 px-3 py-0.5 text-red-600 font-medium",children:"âŒ Reassignment Denied"})]})]},t||s.title)})})]}),e.jsx("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r.title}),e.jsx("span",{className:`rounded-full border px-3 py-1 text-xs font-semibold ${pe(r.status||r.stage)}`,children:de(r.status||r.stage)})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((Ee=r.project)==null?void 0:Ee.name)&&`Project: ${r.project.name}`}),I(r)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-xs mt-1",children:["Total working hours: ",e.jsx("span",{className:"font-bold",children:r.total_time_hhmmss||"0h 0m"})]}),e.jsx("p",{className:"text-xs mt-1",children:"This task is locked and cannot be modified further."})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Due ",re(r.taskDate||r.dueDate)]}),(()=>{const s=W(r);return s==="pending"?e.jsxs("div",{className:"rounded-lg border border-orange-200 bg-orange-50 p-3 text-sm text-orange-700",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”’ Reassignment Request Pending"}),e.jsx("p",{className:"text-xs",children:"Your manager is reviewing your reassignment request. Task is locked until they respond."})]}):s==="approved"?e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Reassignment Approved"}),e.jsx("p",{className:"text-xs",children:"Your manager has approved your reassignment request."})]}):s==="denied"?e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("p",{className:"font-semibold",children:"âŒ Reassignment Denied"}),e.jsx("p",{className:"text-xs",children:"Your manager has denied your reassignment request."})]}):null})(),ge(r)&&e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-purple-50 p-3 text-sm text-purple-700 mt-3",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”Ž Task Under Review"}),e.jsx("p",{className:"text-xs",children:"Task is under review. No actions are allowed."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:z,disabled:D,className:"flex items-center gap-2 px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(te,{className:`w-4 h-4 ${D?"animate-spin":""}`}),"Refresh Tasks"]})}),h==="employee"&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.status==="Pending"||r.status==="To Do"||r.stage==="PENDING"?e.jsxs("button",{onClick:()=>we(r),disabled:y(r)||W(r)==="pending"||I(r)||Z(r),className:"rounded-full border border-green-200 px-3 py-1 text-green-600 hover:bg-green-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Qs,{className:"w-3 h-3"}),"Start Task"]}):null,r.status==="IN_PROGRESS"||r.status==="In Progress"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ve(r),disabled:y(r)||W(r)==="pending"||I(r)||Z(r),className:"rounded-full border border-orange-200 px-3 py-1 text-orange-600 hover:bg-orange-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Xs,{className:"w-3 h-3"}),"Pause"]}),e.jsx(Ys,{task:r,projectId:N,onSuccess:s=>{_(t=>t.map(n=>(n.id||n._id)===(s.id||s._id)?s:n))}})]}):null,r.status==="ON_HOLD"||r.status==="On Hold"?e.jsxs("button",{onClick:()=>Ce(r),disabled:y(r)||W(r)==="pending"||I(r)||Z(r),className:"rounded-full border border-blue-200 px-3 py-1 text-blue-600 hover:bg-blue-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Zs,{className:"w-3 h-3"}),"Resume"]}):null,(r.status==="IN_PROGRESS"||r.status==="In Progress")&&e.jsxs("button",{onClick:()=>_e(r),disabled:y(r)||W(r)==="pending"||I(r)||Z(r)||ge(r),className:"rounded-full border border-green-200 px-3 py-1 text-green-600 hover:bg-green-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ae,{className:"w-3 h-3"}),"Complete Task"]}),e.jsxs("button",{onClick:()=>us(r),disabled:y(r)||W(r)==="pending"||I(r),className:"rounded-full border border-indigo-200 px-3 py-1 text-indigo-600 hover:bg-indigo-50 flex items-center gap-1 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx($e,{className:"w-3 h-3"}),"Timeline"]})]}),r.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:r.description})]}),h!=="employee"&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Reassign Task"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("select",{value:ue,onChange:s=>We(s.target.value),disabled:ae.length===0||y(r),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Select employee"}),ae.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("button",{onClick:ms,disabled:me||!ue||ae.length===0||y(r),className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm ${me||!ue||ae.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:me?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 animate-spin"}),"Reassigning..."]}):"Reassign Task"})]})]}),h==="employee"&&e.jsx("button",{type:"button",onClick:()=>T(r),disabled:y(r)||W(r)==="pending"||I(r),className:"mt-2 rounded-full border border-yellow-300 px-3 py-1 text-yellow-600 hover:bg-yellow-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Request Reassignment"}),e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Checklist"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[oe.filter(s=>s.status==="Completed").length," / ",oe.length," completed"]})]}),I(r)&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 mb-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsx("p",{className:"text-xs mt-1",children:"Checklist is locked. No new items can be added to a completed task."})]}),oe.length===0?e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"No checklist items yet."}):e.jsx("ul",{className:"mt-3 space-y-3",children:oe.map((s,t)=>{const n=s.id||s.public_id||`${t}`,o=P===n,c=re(s.dueDate),i=s.status==="Completed";return o?e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("input",{type:"text",placeholder:"Checklist title",value:B.title,onChange:l=>S(p=>({...p,title:l.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-1.5 text-sm",disabled:I(r)}),e.jsx("input",{type:"date",value:B.dueDate,onChange:l=>S(p=>({...p,dueDate:l.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-1.5 text-sm",disabled:I(r)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{type:"button",onClick:is,disabled:g,className:"rounded-full bg-indigo-600 px-4 py-1.5 text-white disabled:opacity-60 text-sm",children:g?"Savingâ€¦":"Save"}),e.jsx("button",{type:"button",onClick:Se,className:"rounded-full border border-gray-200 px-4 py-1.5 text-gray-600 text-sm",children:"Cancel"})]})]})},n):e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i?e.jsx(Ae,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${i?"text-gray-400 line-through":"text-gray-900"}`,children:s.title||"Untitled item"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due ",c]}),s.completedAt&&e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["Completed ",re(s.completedAt)]})]})]}),!i&&!I(r)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase text-gray-500",children:[e.jsx("button",{type:"button",onClick:()=>os(s),disabled:y(r),className:"rounded-full border border-gray-200 px-3 py-1 hover:border-blue-300 hover:text-blue-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>cs(s),disabled:y(r)||g,className:"rounded-full border border-emerald-200 px-3 py-1 text-emerald-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Mark complete"}),e.jsx("button",{type:"button",onClick:()=>ds(s),disabled:y(r),className:"rounded-full border border-rose-200 px-3 py-1 text-rose-600 text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]})]})},n)})}),e.jsxs("form",{onSubmit:ls,className:"mt-4 flex flex-col gap-2",children:[e.jsx("input",{type:"text",value:F.title,onChange:s=>H(t=>({...t,title:s.target.value})),placeholder:"New checklist item",disabled:I(r)||y(r),className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("input",{type:"date",value:F.dueDate,onChange:s=>H(t=>({...t,dueDate:s.target.value})),disabled:I(r)||y(r),className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm disabled:opacity-60 disabled:cursor-not-allowed"}),e.jsx("button",{type:"submit",disabled:g||I(r)||y(r),className:"rounded-full bg-indigo-600 px-4 py-2 text-white disabled:opacity-60 disabled:cursor-not-allowed text-sm",children:g?"Addingâ€¦":I(r)?"Task Completed - Cannot Add Items":"Add checklist"})]})]})]}):e.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[e.jsx("p",{children:"Select a task to see richer details and manage its checklist."}),e.jsx("p",{children:"Checklist items live-update and sync with the employee APIs."})]})})]}),e.jsx(Ts,{selectedTask:v,onClose:()=>T(null),onSuccess:s=>{if(s!=null&&s.request&&(s!=null&&s.task)){const t=w(s.task);Q(n=>({...n,[t]:{id:s.request.id,taskId:s.request.task_id,status:s.request.status,requested_at:s.request.requested_at,responded_at:s.request.responded_at}})),se(t,{status:s.task.status||"On Hold",is_locked:!0,lock_info:{is_locked:!0,request_status:"PENDING",request_id:s.request.id}}),m.success((s==null?void 0:s.message)||"Reassignment request submitted successfully")}z()}})]})};export{ft as default};
