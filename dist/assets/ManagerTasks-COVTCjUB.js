import{u as Te,b as Ie,s as Ue,r as l,a4 as C,i as m,ap as Oe,j as e,ao as Le,G as Me}from"./index-BNLOVeat.js";import{b as o,g as S}from"./taskHelpers-CsgoO_-X.js";import{V as Re}from"./ViewToggle-CKq8-IaW.js";import{C as he}from"./Card-0W8YT4oS.js";const{RefreshCw:P,AlertCircle:M,Calendar:be,User:R,Plus:He,Filter:Fe,Lock:fe,Clock:je,AlertTriangle:$e,CheckCircle:qe}=Me,Ze=()=>{var ue;const B=Te(),H=Ie(Ue);H!=null&&H.resources;const[u,k]=l.useState([]),[b,F]=l.useState(!0),[Q,T]=l.useState(null),[p,ye]=l.useState([]),[X,Y]=l.useState(!0),[Ge,Z]=l.useState([]),[Ke,ee]=l.useState(!1),[Ve,We]=l.useState(!1),[d,f]=l.useState({title:"",description:"",priority:"MEDIUM",stage:"TODO",taskDate:"",assignedUsers:[],projectId:"",timeAlloted:8}),[$,se]=l.useState(!1),[n,te]=l.useState(""),[r,y]=l.useState(null),[D,Ne]=l.useState([]),[ze,re]=l.useState(!0),[N,ae]=l.useState(""),[q,le]=l.useState(!1),[ve,A]=l.useState(!1),[I,we]=l.useState("all"),[G,Ce]=l.useState("list"),[ne,ie]=l.useState(!1),[g,K]=l.useState(null),[h,V]=l.useState(!1),de=["TODO","IN_PROGRESS","REVIEW","COMPLETED","ON_HOLD"],U=s=>s?s.public_id||s.id||s._id||s.internalId||s.project_id:null,w=s=>{var t;return s?s.name||s.title||`Project ${(t=U(s))==null?void 0:t.slice(0,8)}...`:"Unknown Project"},ke=s=>{var t;return s&&(((t=s.client)==null?void 0:t.name)||s.client_name)||"No Client"},O=s=>{if(!s)return"Unknown";const t=s.status||s.project_status;return{ACTIVE:"Active",IN_PROGRESS:"In Progress",COMPLETED:"Completed",ON_HOLD:"On Hold",PENDING:"Pending",active:"Active",in_progress:"In Progress",completed:"Completed",on_hold:"On Hold",pending:"Pending"}[t]||t||"Unknown"},De=s=>!s||s.length===0?{valid:!1,error:"Task must be assigned to one employee"}:s.length>1?{valid:!1,error:"Only one employee can be assigned to a task"}:{valid:!0,error:null},_=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",Ae=s=>s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",ce=s=>Array.isArray(s.assignedUsers)&&s.assignedUsers.length?s.assignedUsers.map(t=>t.name).join(", "):Array.isArray(s.assigned_to)&&s.assigned_to.length?s.assigned_to.join(", "):"Unassigned",L=l.useMemo(()=>I==="all"?u:u.filter(s=>{const t=o(s).toUpperCase(),a=I.toUpperCase();return t===a}),[u,I]),W=()=>{const s={pending:0,in_progress:0,completed:0,on_hold:0,request_approved:0,locked:0};return u.forEach(t=>{const a=o(t).toLowerCase();a==="request approved"?s.request_approved++:a==="locked"?s.locked++:s.hasOwnProperty(a)&&s[a]++}),s},v=l.useCallback(async(s="")=>{if(!s){k([]),T(null),V(!1),F(!1);return}F(!0),V(!1);try{const t=await C(`/api/tasks?projectId=${encodeURIComponent(s)}`);if(t&&t.success===!1&&t.message&&(t.message.includes("Project is closed")||t.message.includes("Tasks are locked"))){V(!0),T(t.message),k([]),y(null);return}if(t&&t.error)throw t.error.includes("assigned_to")&&console.warn("Backend assignment error:",t.error),new Error(t.error||"Failed to load tasks");const a=Array.isArray(t==null?void 0:t.data)?t.data:[],c=p.find(x=>[x.public_id,x.id,x._id,x.internalId,x.project_id].includes(s)),i=a.map(x=>!x.project_id&&!x.projectId&&!x.project?{...x,project_id:s,projectId:s,project:c||{name:w(c),id:s}}:x);k(i),T(null)}catch(t){T(t.message||"Failed to load tasks for the project"),m.error(t.message||"Failed to load tasks")}finally{F(!1)}},[p]),oe=l.useCallback(async()=>{re(!0);try{const s=await C("/api/manager/employees/all"),t=Array.isArray(s==null?void 0:s.data)?s.data:s;Ne(Array.isArray(t)?t:[])}catch{}finally{re(!1)}},[]),xe=l.useCallback(async()=>{Y(!0);try{const s=await C("/api/manager/projects"),t=Array.isArray(s==null?void 0:s.data)?s.data:s,c=(Array.isArray(t)?t:[]).filter(i=>{var x;return!((x=i.project_status_info)!=null&&x.is_closed)});ye(c)}catch{m.error("Failed to load projects")}finally{Y(!1)}},[]),_e=l.useCallback(async()=>{ee(!0);try{const s=await B(Oe("MANAGER")).unwrap(),t=(s==null?void 0:s.approvals)||(s==null?void 0:s.data)||[];Z(Array.isArray(t)?t:[])}catch(s){console.error("Failed to load pending approvals:",s),Z([])}finally{ee(!1)}},[B]),z=l.useCallback(s=>{if(!s||p.length===0){K(null);return}const t=p.find(a=>[a.public_id,a.id,a._id,a.internalId,a.project_id].some(i=>i&&i.toString()===s.toString()))||null;K(t)},[p]);l.useEffect(()=>{if(p.length>0&&!n){const s=p[0],t=U(s);t&&te(t)}},[p]),l.useEffect(()=>{xe(),_e()},[xe]),l.useEffect(()=>{n&&(v(n),z(n))},[v,n,z]),l.useEffect(()=>{y(null)},[n]),l.useEffect(()=>{oe()},[oe]);const me=s=>{te(s),y(null),k([]),s?z(s):K(null)},Ee=async s=>{var a,c;if(s.preventDefault(),!d.title||!n){m.error("Title and project are required");return}const t=De(d.assignedUsers);if(!t.valid){m.error(t.error);return}se(!0);try{const i=p.find(E=>[E.public_id,E.id,E._id,E.internalId,E.project_id].includes(n)),x=d.assignedUsers[0],pe={title:d.title,description:d.description,priority:d.priority,stage:d.stage,taskDate:d.taskDate?new Date(d.taskDate).toISOString():void 0,timeAlloted:Number(d.timeAlloted)||0,projectId:n,client_id:((a=i==null?void 0:i.client)==null?void 0:a.public_id)||((c=i==null?void 0:i.client)==null?void 0:c.id)||(i==null?void 0:i.client_id),assigned_to:x},j=await C("api/projects/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)});if(j&&j.error){if(j.error.includes("assigned_to")&&j.error.includes("exactly one")){m.error("Error: Task must be assigned to exactly one user");return}throw new Error(j.error||"Unable to create task")}const Pe=(j==null?void 0:j.message)||"Task created successfully";m.success(Pe),f({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:n}),A(!1),v(n)}catch(i){console.error("Error creating task:",i),i.response&&i.response.message&&i.response.message.includes("successfully")?(m.success(i.response.message||"Task created successfully"),f({title:"",description:"",assignedUsers:[],priority:"MEDIUM",stage:"PENDING",taskDate:"",timeAlloted:8,projectId:n}),A(!1),v(n)):m.error((i==null?void 0:i.message)||"Unable to create task")}finally{se(!1)}},ge=()=>{if(!n){m.error("Please select a project first");return}A(!0)},J=async s=>{if(!s)return;const t=s.id||s.public_id||s._id||s.internalId;if(!t){y(s);return}ie(!0);try{const a=await C("/api/tasks/selected-details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:[t]})});if(a&&a.error)throw new Error(a.error||"Failed to fetch task details");const c=(a==null?void 0:a.data)??a,i=Array.isArray(c)?c[0]:c;y(i||s)}catch(a){console.error("Failed to load task details:",a),m.error((a==null?void 0:a.message)||"Failed to load task details"),y(s)}finally{ie(!1)}},Se=async()=>{if(!r||!N)return;const s=r.id||r.public_id||r._id;if(!s){m.error("Task ID not found");return}le(!0);try{const t=await C(`/api/tasks/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({assigned_to:N})});if(t&&t.error)throw new Error(t.error||"Failed to reassign task");m.success("Task reassigned successfully"),k(a=>a.map(c=>(c.id||c.public_id||c._id)===s?{...c,assigned_to:[N]}:c)),r&&(r.id||r.public_id||r._id)===s&&y(a=>a?{...a,assigned_to:[N]}:null),ae(""),n&&v(n)}catch(t){console.error("Failed to reassign task:",t),m.error((t==null?void 0:t.message)||"Failed to reassign task")}finally{le(!1)}};return e.jsxs("div",{className:"p-8 bg-gray-50 min-h-screen",children:[e.jsx(Le,{title:"Tasks",subtitle:"Manage and track all your tasks",onRefresh:()=>n&&v(n),refreshing:b,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:n||"",onChange:s=>me(s.target.value),disabled:X,className:"border border-gray-300 rounded-lg px-4 py-2 pr-8 bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none min-w-[200px]",children:[e.jsx("option",{value:"",children:"Select a project"}),p.map(s=>{const t=U(s),a=w(s);return e.jsx("option",{value:t,children:a},t)})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),e.jsx(Re,{mode:G,onChange:Ce,className:"ml-1"}),n&&!b&&Array.isArray(u)&&u.length>0&&e.jsxs("button",{onClick:ge,disabled:!n||b||h,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${!n||b||h?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[h?e.jsx(fe,{className:"tm-icon"}):e.jsx(He,{className:"tm-icon"}),h?"Locked":"Add Task"]})]})}),b&&n&&e.jsxs("div",{className:"flex items-center justify-center p-4 mb-6 bg-blue-50 rounded-lg",children:[e.jsx(P,{className:"tm-icon mr-2 animate-spin text-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Loading tasks..."})]}),(Q||h)&&!b&&e.jsxs("div",{className:"flex items-start gap-3 p-4 mb-6 bg-red-50 border border-red-200 rounded-xl text-red-800 animate-fadeIn",children:[e.jsx($e,{className:"tm-icon-md flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:h?"Project Locked":"Error"}),e.jsx("p",{className:"text-red-700 mt-1",children:Q}),h&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"This project is currently closed or pending approval. Creating or modifying tasks is disabled."})]})]}),n&&g&&e.jsx("div",{className:"bg-white rounded-xl border p-6 mb-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("div",{className:"text-blue-600 font-bold text-lg",children:w(g).charAt(0)})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:w(g)}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"tm-icon text-gray-500"}),e.jsxs("span",{className:"text-gray-700",children:["Client: ",e.jsx("span",{className:"font-medium",children:ke(g)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${O(g)==="Active"||O(g)==="In Progress"?"bg-green-500":O(g)==="Completed"?"bg-blue-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-gray-700",children:["Status: ",e.jsx("span",{className:"font-medium",children:O(g)})]})]})]})]})]}),g.description&&e.jsx("p",{className:"text-gray-600 mb-4",children:g.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:u.length})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:W().pending})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:W().in_progress})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:W().completed})]})]})]}),e.jsx("div",{className:"flex flex-col gap-3 md:w-auto w-full"})]})}),n&&u.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"tm-icon text-gray-600"}),e.jsx("span",{className:"text-gray-700 font-medium",children:"Filters:"})]}),e.jsxs("select",{value:I,onChange:s=>we(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:b,children:[e.jsx("option",{value:"all",children:"All Status"}),de.map(s=>e.jsx("option",{value:s,children:S(s)},s)),e.jsx("option",{value:"Request Approved",children:"Request Approved"}),e.jsx("option",{value:"LOCKED",children:"Locked"})]})]}),!n&&!X&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(M,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Project"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Please select a project from the dropdown above to view and manage tasks."}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:p.slice(0,5).map(s=>{const t=U(s),a=w(s);return e.jsx("button",{onClick:()=>me(t),className:"px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors border border-blue-200",children:a},t)})})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:`${r?"lg:w-3/5":"flex-1"}`,children:[n&&!b&&u.length===0&&e.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[e.jsx(M,{className:"tm-icon-hero mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Tasks Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No tasks found for this project. Create your first task or try refreshing."}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:ge,disabled:h,className:`px-4 py-2 rounded-lg transition-colors flex items-center gap-2 ${h?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[h?e.jsx(fe,{className:"tm-icon"}):null,h?"Project Locked":"Create First Task"]}),e.jsx("button",{onClick:()=>v(n),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors border border-gray-300",children:"Refresh"})]})]}),n&&!b&&u.length>0&&G==="list"&&e.jsx("div",{className:"tm-list-container",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-left",children:"Task"}),e.jsx("th",{className:"p-4 text-left",children:"Assigned To"}),e.jsx("th",{className:"p-4 text-left",children:"Status"}),e.jsx("th",{className:"p-4 text-left",children:"Priority"}),e.jsx("th",{className:"p-4 text-left",children:"Due Date"}),e.jsx("th",{className:"p-4 text-left",children:"Estimated Hours"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"p-8 text-center text-gray-500",children:[e.jsx(M,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks found for the selected filters"})]})}):L.map(s=>{const t=(r==null?void 0:r.id)===s.id||(r==null?void 0:r.public_id)===s.public_id,a=o(s);return e.jsxs("tr",{onClick:()=>J(s),className:`border-b transition-colors cursor-pointer ${t?"bg-gray-50":"hover:bg-gray-50"}`,children:[e.jsxs("td",{className:"p-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.title||s.name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:s.description})]}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:ce(r||s)})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a==="LOCKED"?"bg-red-100 text-red-800":a==="COMPLETED"||a==="Completed"?"bg-green-100 text-green-800":a==="IN_PROGRESS"||a==="In Progress"?"bg-blue-100 text-blue-800":a==="ON_HOLD"||a==="On Hold"?"bg-red-100 text-red-800":a==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:S(a)})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"tm-icon text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:_(s.taskDate||s.dueDate)})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"tm-icon text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-700",children:[s.estimatedHours||s.timeAlloted||0,"h"]})]})})]},s.id||s.public_id||s._id||s.internalId)})})]})}),n&&!b&&u.length>0&&G==="grid"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.length===0?e.jsxs(he,{className:"col-span-full text-center",children:[e.jsx(M,{className:"tm-icon-xl mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-gray-500",children:"No tasks found for the selected filters"})]}):L.map(s=>{const t=o(s);return e.jsxs(he,{onClick:()=>J(s),role:"button",className:"cursor-pointer",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title||s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-3",children:s.description})]})}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t==="LOCKED"?"bg-red-100 text-red-800":t==="COMPLETED"||t==="Completed"?"bg-green-100 text-green-800":t==="IN_PROGRESS"||t==="In Progress"?"bg-blue-100 text-blue-800":t==="ON_HOLD"||t==="On Hold"?"bg-red-100 text-red-800":t==="Request Approved"?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"}`,children:S(t)}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${(s.priority||"MEDIUM").toUpperCase()==="HIGH"?"bg-red-100 text-red-800":(s.priority||"MEDIUM").toUpperCase()==="MEDIUM"?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"}`,children:(s.priority||"MEDIUM").toUpperCase()})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:ce(s)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"tm-icon text-gray-400"}),e.jsx("span",{children:_(s.taskDate||s.dueDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"tm-icon text-gray-400"}),e.jsxs("span",{children:[s.estimatedHours||s.timeAlloted||0," hours estimated"]})]})]})]},s.id||s.public_id||s._id||s.internalId)})})]}),r&&e.jsx("div",{className:"lg:w-2/5",children:e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm sticky top-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r.title}),e.jsx("span",{className:`rounded-full border px-3 py-1 text-xs font-semibold ${o(r)==="LOCKED"?"bg-red-100 text-red-800 border-red-200":o(r)==="COMPLETED"||o(r)==="Completed"?"bg-green-100 text-green-800 border-green-200":o(r)==="IN_PROGRESS"||o(r)==="In Progress"?"bg-blue-100 text-blue-800 border-blue-200":o(r)==="ON_HOLD"||o(r)==="On Hold"?"bg-red-100 text-red-800 border-red-200":o(r)==="Request Approved"?"bg-purple-100 text-purple-800 border-purple-200":"bg-yellow-100 text-yellow-800 border-yellow-200"}`,children:S(o(r))})]}),e.jsx("p",{className:"text-sm text-gray-500",children:((ue=r.project)==null?void 0:ue.name)&&`Project: ${r.project.name}`}),(o(r)==="COMPLETED"||o(r)==="Completed")&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ“ Task Completed"}),e.jsxs("p",{className:"text-xs mt-1",children:["Total working hours: ",e.jsx("span",{className:"font-bold",children:r.total_time_hhmmss||"0h 0m"})]}),e.jsx("p",{className:"text-xs mt-1",children:"This task is locked and cannot be modified further."})]}),o(r)==="LOCKED"&&e.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ”’ Task Locked - Pending Approval"}),e.jsx("p",{className:"text-xs",children:"Task is locked pending manager approval for reassignment request."})]}),o(r)==="Request Approved"&&e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-purple-50 p-3 text-sm text-purple-700",children:[e.jsx("p",{className:"font-semibold",children:"âœ… Reassignment Approved"}),e.jsx("p",{className:"text-xs",children:"Employee reassignment request has been approved."})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Due ",_(r.taskDate||r.dueDate)]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>J(r),disabled:ne,className:"flex items-center gap-2 px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(P,{className:`w-4 h-4 ${ne?"animate-spin":""}`}),"Refresh Task"]})}),r.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:r.description})]}),r.assignedUsers&&r.assignedUsers.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Assigned To"}),e.jsx("div",{className:"mt-2 space-y-2",children:r.assignedUsers.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name||s.email||"Unknown User"})]},s.id||s.public_id||t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Reassign Task"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("select",{value:N,onChange:s=>ae(s.target.value),disabled:D.length===0||o(r)==="COMPLETED"||o(r)==="LOCKED",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-sm",children:[e.jsx("option",{value:"",children:"Select employee"}),D.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("button",{onClick:Se,disabled:q||!N||D.length===0||o(r)==="COMPLETED"||o(r)==="LOCKED",className:`px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm ${q||!N||D.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:q?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 animate-spin"}),"Reassigning..."]}):"Reassign Task"})]})]}),r.checklist&&r.checklist.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Checklist"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.checklist.filter(s=>s.status==="Completed").length," / ",r.checklist.length," completed"]})]}),e.jsx("ul",{className:"space-y-3",children:r.checklist.map((s,t)=>{const a=s.id||s.public_id||`${t}`,c=s.status==="Completed";return e.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-3",children:e.jsx("div",{className:"flex items-center justify-between gap-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c?e.jsx(qe,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${c?"text-gray-400 line-through":"text-gray-900"}`,children:s.title||"Untitled item"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Due ",_(s.dueDate)]}),s.completedAt&&e.jsxs("p",{className:"text-[10px] text-emerald-600",children:["Completed ",_(s.completedAt)]})]})]})})},a)})})]}),r.activities&&r.activities.length>0&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:r.activities.slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.description||s.action}),e.jsx("p",{className:"text-xs text-gray-500",children:Ae(s.createdAt||s.timestamp)})]})]},s.id||t))})]}),r.time_tracking&&e.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-gray-50 p-4 text-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500 mb-3",children:"Time Tracking"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Estimated"}),e.jsxs("p",{className:"text-sm font-medium",children:[r.estimatedHours||r.timeAlloted||0,"h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total Worked"}),e.jsx("p",{className:"text-sm font-medium",children:r.total_time_hhmmss||"0h 0m"})]})]})]})]})})})]}),ve&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center font-semibold",children:"âž•"}),"Create New Task"]}),e.jsx("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Task Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{required:!0,value:d.title,onChange:s=>f({...d,title:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter task title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:s=>f({...d,description:s.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Task description (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Project"}),e.jsxs("div",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 font-medium",children:[g?w(g):"Selected Project"," âœ“"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Project selected from dropdown"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Priority"}),e.jsxs("select",{value:d.priority,onChange:s=>f({...d,priority:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"LOW",children:"Low"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"HIGH",children:"High"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Status"}),e.jsx("select",{value:d.stage,onChange:s=>f({...d,stage:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:de.map(s=>e.jsx("option",{value:s,children:S(s)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Estimated Hours"}),e.jsx("input",{type:"number",min:"0",step:"0.5",value:d.timeAlloted,onChange:s=>f({...d,timeAlloted:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 8"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Due Date"}),e.jsx("input",{type:"date",value:d.taskDate,onChange:s=>f({...d,taskDate:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Assign To ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:d.assignedUsers[0]||"",onChange:s=>{const t=s.target.value;f({...d,assignedUsers:t?[t]:[]})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select an employee"}),D.map(s=>{const t=s.internalId||s.id||s.public_id||s._id;return e.jsx("option",{value:t,children:s.name||s.email||"Unnamed"},t)})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Only one employee can be assigned"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>A(!1),disabled:$,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:$,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:$?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"tm-icon animate-spin"}),"Creating..."]}):"Create Task"})]})]})]})})]})};export{Ze as default};
