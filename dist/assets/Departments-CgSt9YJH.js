import{u as H,b as y,at as O,bM as Q,bN as V,X,R as q,r as i,au as F,Z as R,j as e,aH as D,B as C,ao as G,ac as I,aN as B,aS as k,bO as W,aA as Y,F as Z,aG as P,bP as $,i as u,az as J,bQ as K,bR as ee}from"./index-DiCoRx4R.js";import{V as te}from"./ViewToggle-GXIcrMYi.js";import{C as ae}from"./Card-Dhv6RRIF.js";function se({show:r,onClose:c,form:l,setForm:o,onSubmit:m,editing:d,managers:N=[]}){return r?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsx("div",{className:"absolute inset-0",onClick:c}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),a.stopPropagation(),m(a)},className:"relative bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-gray-900 text-xl font-bold",children:d?"Edit Department":"Add Department"}),e.jsx("button",{type:"button",onClick:c,className:"text-gray-400 hover:text-gray-600 p-1 rounded-lg hover:bg-gray-100",children:e.jsx(J,{className:"tm-icon"})})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm",children:"Name"}),e.jsx("input",{required:!0,value:l.name,onChange:a=>o({...l,name:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter department name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm",children:"Manager (optional)"}),e.jsxs("select",{value:l.managerId||"",onChange:a=>o({...l,managerId:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white",children:[e.jsx("option",{value:"",children:"-- Select manager --"}),N.map(a=>e.jsxs("option",{value:a.public_id||a._id||a.id,children:[a.name," ",a.role?`(${a.role})`:""]},a.public_id||a._id||a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2 text-sm",children:"Head Department ID (optional)"}),e.jsx("input",{value:l.headId,onChange:a=>o({...l,headId:a.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter parent department ID"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 justify-end",children:[e.jsx("button",{type:"button",onClick:c,className:"px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium shadow-lg hover:shadow-xl transition-all",children:d?"Update Department":"Create Department"})]})]})]}):null}const de=()=>{const r=H(),c=y(O),l=y(Q),o=y(V),m=y(X)||[],d=q.useMemo(()=>m.filter(t=>((t==null?void 0:t.role)||"").toLowerCase()==="manager"),[m]),[N,a]=i.useState(!1),[v,S]=i.useState(null),[w,b]=i.useState({name:"",managerId:"",headId:""}),[A,T]=i.useState("list"),[x,M]=i.useState("");i.useEffect(()=>{r(F()),r(R())},[r]);const p=c.map((t,s)=>{const n=t.manager_id||t.managerId||t.manager||t.managerId;let f=null;n&&(f=m.find(g=>g.public_id===n||g._id===n||g.id===n||g.email===n||g.name===n));const z=(f==null?void 0:f.name)||t.manager_name||t.managerName||t.manager||"Unassigned";return{...t,displayId:s+1,actualId:t.public_id||t._id||t.id,managerName:z,createdAt:t.createdAt||t.created_at||"N/A",name:t.name||"Unnamed Department",color:["#6366F1","#10B981","#F59E0B","#EF4444","#8B5CF6"][s%5]}}),h=p.filter(t=>{var s,n;return((s=t.name)==null?void 0:s.toLowerCase().includes(x.toLowerCase()))||((n=t.managerName)==null?void 0:n.toLowerCase().includes(x.toLowerCase()))}),L=async t=>{t&&(t.preventDefault(),t.stopPropagation());try{v?(await r(K({departmentId:v.actualId,data:w})).unwrap(),u.success("✅ Department updated")):(await r(ee(w)).unwrap(),u.success("✅ Department created"),b({name:"",managerId:"",headId:""})),a(!1)}catch(s){console.error("Submit error:",s),u.error(s.message||"❌ Operation failed")}},E=async t=>{if(window.confirm("Are you sure you want to delete this department?"))try{await r($(t)).unwrap(),u.success("Department deleted successfully")}catch(s){u.error((s==null?void 0:s.message)||"Delete failed")}},j=()=>{S(null),b({name:"",managerId:"",headId:""}),a(!0)},_=t=>{S(t),b({name:t.name||"",managerId:t.managerId||t.manager_id||"",headId:t.headId||""}),a(!0)},U=()=>{r(F()),r(R())};return l==="loading"?e.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-blue-200 border-t-blue-600 rounded-full"})}):l==="failed"?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-8 text-center max-w-2xl mx-auto",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"tm-icon"})}),e.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"Failed to load departments"}),e.jsx("p",{className:"text-red-600 mb-6",children:o||"An error occurred"}),e.jsx(C,{label:"Try Again",onClick:U,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2.5 rounded-xl font-semibold"})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx(G,{title:"Department Management",subtitle:"Organize and manage your company departments",onRefresh:U,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 mr-2",children:["Managers found: ",d.length]}),e.jsx(te,{mode:A,onChange:T}),e.jsx(C,{label:"Add Department",icon:e.jsx(I,{className:"ml-2"}),onClick:j,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-5 py-2.5 rounded-xl flex items-center gap-2 font-semibold text-sm"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Total Departments"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:p.length})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(B,{className:"tm-icon"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"With Managers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:p.filter(t=>t.managerName!=="Unassigned").length})]}),e.jsx("div",{className:"w-10 h-10 bg-emerald-100 text-emerald-600 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"tm-icon"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Filtered"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:h.length})]}),e.jsx("div",{className:"w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"tm-icon"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Total Managers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d.length})]}),e.jsx("div",{className:"w-10 h-10 bg-amber-100 text-amber-600 rounded-lg flex items-center justify-center",children:e.jsx(k,{className:"tm-icon"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:[e.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 tm-icon"}),e.jsx("input",{type:"text",placeholder:"Search departments by name or manager...",value:x,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold text-gray-900",children:h.length})," of"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:p.length})," departments"]}),x&&e.jsx("button",{onClick:()=>M(""),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Clear search"})]})]}),h.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-dashed border-gray-300 rounded-2xl p-12 text-center",children:[e.jsx(B,{className:"w-16 h-16 text-gray-400 mx-auto mb-6"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"No departments found"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-md mx-auto text-sm",children:x?"No departments match your search. Try different keywords.":"Your department list is empty. Create your first department to get started."}),e.jsx(C,{label:"Create First Department",onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl text-sm"})]}):A==="grid"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[h.map(t=>e.jsxs(ae,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-sm shadow-sm",style:{backgroundColor:t.color},children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-gray-900 text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.displayId]})]})]}),e.jsx("span",{className:Z("px-3 py-1 rounded-full text-xs font-semibold",t.managerName==="Unassigned"?"bg-gray-100 text-gray-800":"bg-emerald-100 text-emerald-800"),children:t.managerName==="Unassigned"?"No Manager":"Has Manager"})]}),e.jsx("div",{className:"space-y-2 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(k,{className:"tm-icon text-gray-400"}),e.jsxs("span",{children:["Manager: ",t.managerName]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",t.createdAt]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>_(t),className:"p-2 rounded-lg hover:bg-blue-50 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all duration-200",title:"Edit Department",children:e.jsx(P,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>E(t.actualId),className:"p-2 rounded-lg hover:bg-red-50 text-gray-500 hover:text-red-600 hover:shadow-md transition-all duration-200",title:"Delete Department",children:e.jsx(D,{className:"tm-icon"})})]})]})]},t.actualId)),e.jsxs("div",{onClick:j,className:"bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center hover:border-blue-300 hover:bg-blue-50 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center min-h-[280px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white border-2 border-dashed border-gray-300 flex items-center justify-center mb-4 shadow-sm",children:e.jsx(I,{className:"tm-icon text-gray-400"})}),e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Add New Department"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Create a new department"})]})]}):e.jsxs("div",{className:"tm-list-container",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-gray-200",children:e.jsxs("tr",{className:"text-left text-gray-700 font-semibold text-sm",children:[e.jsx("th",{className:"py-4 pl-6 pr-4",children:"Department"}),e.jsx("th",{className:"py-4 px-4",children:"Manager"}),e.jsx("th",{className:"py-4 px-4",children:"Created"}),e.jsx("th",{className:"py-4 pr-6 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-4 pl-6 pr-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-sm shadow-sm",style:{backgroundColor:t.color},children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.displayId]})]})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:t.managerName})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:t.createdAt})}),e.jsx("td",{className:"py-4 pr-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>_(t),className:"p-2.5 rounded-xl hover:bg-blue-50 text-gray-500 hover:text-blue-600 hover:shadow-md transition-all duration-200 icon-center",title:"Edit Department",children:e.jsx(P,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>E(t.actualId),className:"p-2.5 rounded-xl hover:bg-red-50 text-gray-500 hover:text-red-600 hover:shadow-md transition-all duration-200 icon-center",title:"Delete Department",children:e.jsx(D,{className:"tm-icon"})})]})})]},t.actualId))})]})}),e.jsx("div",{onClick:j,className:"border-t border-gray-100 p-6 text-center hover:bg-gray-50 transition-colors duration-200 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:"Add New Department"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click to add a new department"})]})]})})]}),e.jsx(se,{show:N,onClose:()=>a(!1),form:w,setForm:b,onSubmit:L,editing:!!v,managers:d})]})})};export{de as default};
