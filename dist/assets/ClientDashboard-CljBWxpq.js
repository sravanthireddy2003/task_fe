import{u as F,r as w,j as e,B as D,ac as Q,az as ee,a7 as R,aU as se,aV as te,aW as ae,aH as K,aX as re,aY as le,aZ as ne,a_ as ie,a as Z,a$ as X,b0 as V,e as oe,b1 as de,b2 as O,b3 as ce,b4 as _,b5 as I,b6 as me,b7 as xe,b8 as ge,b9 as he,ba as ue,aD as $,aa as M,bb as pe,bc as be,bd as W,be as fe,bf as je,F as P,aS as q,bg as Ne,D as ye,b as we,ao as ve,bh as H,aB as Ce,bi as Pe,aN as Te,aE as ke,aR as Se,bj as Ee,bk as Ae,bl as Ue,bm as De}from"./index-DiCoRx4R.js";import{f as Ie,r as Y}from"./fileHelpers-B07Cx-tv.js";import{C as L}from"./Chart-COUBEq73.js";const Oe=({client:u})=>{const b=F(),[j,x]=w.useState(!1),[l,N]=w.useState(null),[g,f]=w.useState({name:"",email:"",phone:"",position:"",department:""}),S=(u==null?void 0:u.contacts)||[],U=async s=>{s.preventDefault();try{l?(await b(re({clientId:u.id,contactId:l.id,contact:g})).unwrap(),N(null)):(await b(le({clientId:u.id,contact:g})).unwrap(),x(!1)),f({name:"",email:"",phone:"",position:"",department:""})}catch(n){console.error("Failed to save contact:",n)}},E=s=>{N(s),f({name:s.name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",department:s.department||""})},t=async s=>{if(window.confirm("Are you sure you want to delete this contact?"))try{await b(ie({clientId:u.id,contactId:s})).unwrap()}catch(n){console.error("Failed to delete contact:",n)}},m=async s=>{try{await b(ne({clientId:u.id,contactId:s})).unwrap()}catch(n){console.error("Failed to set primary contact:",n)}},a=()=>{x(!1),N(null),f({name:"",email:"",phone:"",position:"",department:""})};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Contacts"}),e.jsx(D,{label:"Add Contact",icon:e.jsx(Q,{}),onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"})]}),(j||l)&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6 border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:l?"Edit Contact":"Add New Contact"}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 icon-center",children:e.jsx(ee,{className:"tm-icon"})})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:s=>f({...g,name:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:g.email,onChange:s=>f({...g,email:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:g.phone,onChange:s=>f({...g,phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position"}),e.jsx("input",{type:"text",value:g.position,onChange:s=>f({...g,position:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsx("input",{type:"text",value:g.department,onChange:s=>f({...g,department:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(D,{label:"Cancel",onClick:a,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"}),e.jsx(D,{label:l?"Update Contact":"Add Contact",type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"})]})]})]}),e.jsx("div",{className:"space-y-4",children:S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No contacts added yet"})]}):S.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"tm-icon text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),s.isPrimary&&e.jsx(se,{className:"tm-icon text-yellow-500"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[s.email&&e.jsx("p",{children:s.email}),s.phone&&e.jsx("p",{children:s.phone}),(s.position||s.department)&&e.jsx("p",{children:[s.position,s.department].filter(Boolean).join(", ")})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!s.isPrimary&&e.jsx("button",{onClick:()=>m(s.id||s._id),className:"text-yellow-500 hover:text-yellow-600 p-1 icon-center",title:"Set as primary contact",children:e.jsx(te,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>E(s),className:"text-blue-500 hover:text-blue-600 p-1 icon-center",title:"Edit contact",children:e.jsx(ae,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>t(s.id||s._id),className:"text-red-500 hover:text-red-600 p-1 icon-center",title:"Delete contact",children:e.jsx(K,{className:"tm-icon"})})]})]},s.id||s._id))})]})},Le=({client:u})=>{const b=Z(),j=F(),x=w.useRef(null),[l,N]=w.useState(!1),g=(u==null?void 0:u.documents)||[],f=a=>{if(!a)return e.jsx(I,{className:"tm-icon text-gray-400"});const s=a.toLowerCase();return s.includes("pdf")?e.jsx(I,{className:"tm-icon text-red-500"}):s.includes("image")?e.jsx(me,{className:"tm-icon text-green-500"}):s.includes("word")||s.includes("doc")?e.jsx(xe,{className:"tm-icon text-blue-500"}):s.includes("excel")||s.includes("xls")?e.jsx(ge,{className:"tm-icon text-green-600"}):e.jsx(I,{className:"tm-icon text-gray-400"})},S=a=>Ie(a),U=async a=>{const s=Array.from(a.target.files);if(s.length!==0){N(!0);try{for(const n of s){const o=new FormData;o.append("document",n),o.append("entityType","CLIENT"),o.append("entityId",u.id);const h=O(),p=await fetch("/api/documents/upload",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:o});if(!p.ok)throw new Error(`Upload failed: ${p.status}`);const i=await p.json();await j(ce({clientId:u.id,document:{id:i.data.documentId,file_name:i.data.fileName,file_type:i.data.mimeType,file_size:i.data.fileSize,file_url:i.data.publicUrl,uploaded_at:new Date().toISOString()}})).unwrap()}u!=null&&u.id&&await j(_(u.id)).unwrap()}catch(n){console.error("Failed to upload document:",n),alert("Upload failed: "+n.message)}finally{N(!1),x.current&&(x.current.value="")}}},E=async a=>{try{const s=a.file_url||a.publicUrl;if(!s){alert("No file URL available");return}const n=Y(s),o=O(),h=await fetch(n,{method:"GET",headers:o?{Authorization:`Bearer ${o}`}:{}});if(!h.ok)throw new Error(`Failed to download (${h.status})`);const p=await h.blob(),i=window.URL.createObjectURL(p),c=document.createElement("a");c.href=i,c.download=a.file_name||a.fileName||"document",document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout(()=>window.URL.revokeObjectURL(i),5e3)}catch(s){console.error("Download failed",s),alert("Download failed: "+(s.message||s))}},t=async a=>{try{const s=a.file_url||a.publicUrl;if(!s){alert("No file URL available");return}const n=Y(s),o=O(),h=await fetch(n,{method:"GET",headers:o?{Authorization:`Bearer ${o}`}:{}});if(!h.ok)throw new Error(`Failed to fetch document (${h.status})`);const p=await h.blob(),i=window.URL.createObjectURL(p);window.open(i,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(i),5e3)}catch(s){console.error("View failed",s),alert("Unable to open document: "+(s.message||s))}},m=async a=>{if(window.confirm("Are you sure you want to delete this document?"))try{await j(he({clientId:u.id,documentId:a})).unwrap()}catch(s){console.error("Failed to delete document:",s)}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>b(-1),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 font-medium transition",title:"Go back to previous page",children:[e.jsx(X,{className:"tm-icon"}),"Back"]}),e.jsx("div",{className:"flex-1",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Documents"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"file",ref:x,onChange:U,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",className:"hidden"}),e.jsx(D,{label:l?"Uploading...":"Upload Documents",icon:e.jsx(V,{}),onClick:()=>{var a;return(a=x.current)==null?void 0:a.click()},disabled:l,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg disabled:opacity-50"})]})]}),e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(V,{className:"tm-icon mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg mb-2",children:"No documents uploaded yet"}),e.jsx("p",{className:"text-sm",children:'Click "Upload Documents" to add files'})]}):g.map(a=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[f(a.file_type||a.mimeType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a.file_name||a.fileName||"Unnamed Document"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Type: ",a.file_type||a.mimeType||"Unknown"]}),a.file_size&&e.jsxs("p",{children:["Size: ",S(a.file_size)]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(a),className:"text-blue-500 hover:text-blue-600 p-2 icon-center",title:"View document",children:e.jsx(oe,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>E(a),className:"text-green-500 hover:text-green-600 p-2 icon-center",title:"Download document",children:e.jsx(de,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>m(a.id||a.documentId||a._id),className:"text-red-500 hover:text-red-600 p-2 icon-center",title:"Delete document",children:e.jsx(K,{className:"tm-icon"})})]})]},a.id||a.documentId||a._id))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Supported File Types"}),e.jsx("p",{className:"text-sm text-blue-700",children:"You can upload PDF, Word documents (.doc, .docx), Excel files (.xls, .xlsx), and images (.jpg, .jpeg, .png). Maximum file size: 10MB per file."})]})]})},Re=({client:u,projects:b=[],dashboard:j={}})=>{const x=w.useMemo(()=>{const t=[];return Array.isArray(b)&&b.forEach(m=>{Array.isArray(m.tasks)&&m.tasks.forEach(a=>{t.push({...a,projectName:m.name,projectId:m.id})})}),t},[b]),l=w.useMemo(()=>{const t=x.length,m=x.filter(i=>{var c,T;return((c=i.status)==null?void 0:c.toLowerCase())==="completed"||((T=i.stage)==null?void 0:T.toUpperCase())==="COMPLETED"}).length,a=x.filter(i=>{var c,T;return((c=i.status)==null?void 0:c.toLowerCase())==="pending"||((T=i.stage)==null?void 0:T.toUpperCase())==="PENDING"}).length,s=x.filter(i=>{var c,T;return((c=i.stage)==null?void 0:c.toUpperCase())==="IN PROGRESS"||((T=i.stage)==null?void 0:T.toUpperCase())==="IN_PROGRESS"}).length,n=x.filter(i=>{var c;return((c=i.priority)==null?void 0:c.toUpperCase())==="HIGH"}).length,o=x.filter(i=>{var c;return((c=i.priority)==null?void 0:c.toUpperCase())==="MEDIUM"}).length,h=x.filter(i=>{var c;return((c=i.priority)==null?void 0:c.toUpperCase())==="LOW"}).length,p=x.reduce((i,c)=>i+(c.time_alloted||c.estimated_hours||0),0);return{total:t,completed:m,pending:a,inProgress:s,highPriority:n,mediumPriority:o,lowPriority:h,totalHours:p}},[x]),N=w.useMemo(()=>b.map(t=>{const m=Array.isArray(t.tasks)?t.tasks:[],a=m.filter(o=>{var h,p;return((h=o.status)==null?void 0:h.toLowerCase())==="completed"||((p=o.stage)==null?void 0:p.toUpperCase())==="COMPLETED"}).length,s=m.filter(o=>{var h,p;return((h=o.status)==null?void 0:h.toLowerCase())==="pending"||((p=o.stage)==null?void 0:p.toUpperCase())==="PENDING"}).length,n=m.filter(o=>{var h,p;return((h=o.stage)==null?void 0:h.toUpperCase())==="IN PROGRESS"||((p=o.stage)==null?void 0:p.toUpperCase())==="IN_PROGRESS"}).length;return{name:t.name,id:t.id,totalTasks:m.length,completed:a,pending:s,inProgress:n,progressPercentage:m.length>0?Math.round(a/m.length*100):0}}),[b]),g=l.total>0,f=b.length>0,S=w.useMemo(()=>{const t=x.filter(s=>{var n,o;return((n=s.stage)==null?void 0:n.toUpperCase())==="TODO"||((o=s.stage)==null?void 0:o.toUpperCase())==="PENDING"}).length,m=x.filter(s=>{var n,o;return((n=s.stage)==null?void 0:n.toUpperCase())==="IN PROGRESS"||((o=s.stage)==null?void 0:o.toUpperCase())==="IN_PROGRESS"}).length,a=x.filter(s=>{var n;return((n=s.stage)==null?void 0:n.toUpperCase())==="COMPLETED"}).length;return[{name:"To Do",value:t,color:"#fbbf24"},{name:"In Progress",value:m,color:"#3b82f6"},{name:"Completed",value:a,color:"#10b981"}]},[x]),U=w.useMemo(()=>[{name:"High",value:l.highPriority,color:"#ef4444"},{name:"Medium",value:l.mediumPriority,color:"#f59e0b"},{name:"Low",value:l.lowPriority,color:"#10b981"}],[l]),E=w.useMemo(()=>N.map(t=>({name:t.name.substring(0,12),value:t.progressPercentage,color:"#06b6d4"})),[N]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg shadow border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Total Tasks"}),e.jsx(ue,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:l.total}),e.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["Across ",b.length," projects"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg shadow border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Completed"}),e.jsx($,{className:"w-5 h-5 text-green-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:l.completed}),e.jsx("div",{className:"mt-2 bg-green-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${l.total>0?l.completed/l.total*100:0}%`}})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg shadow border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"In Progress"}),e.jsx(M,{className:"w-5 h-5 text-purple-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:l.inProgress}),e.jsxs("p",{className:"text-xs text-purple-600 mt-2",children:[l.pending," pending"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 p-6 rounded-lg shadow border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-orange-700",children:"Total Hours"}),e.jsx(pe,{className:"w-5 h-5 text-orange-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-orange-900",children:[l.totalHours,"h"]}),e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"Allocated time"})]})]}),g?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),"Task Status Distribution"]}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsx(L,{type:"pie",data:S,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{font:{size:13},padding:15,usePointStyle:!0}}}}})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-amber-600"}),"Priority Distribution"]}),e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsx(L,{type:"bar",data:U,options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{font:{size:12}}},y:{ticks:{font:{size:12}}}}}})})]})]}):null,f&&E.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-cyan-600"}),"Project Progress Overview"]}),e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsx(L,{type:"bar",data:E,options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"x",plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,max:100,ticks:{callback:function(t){return t+"%"},font:{size:11}}},x:{ticks:{font:{size:12}}}}}})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{label:"Completed",value:l.completed,color:"from-green-400 to-green-600",icon:$,bgColor:"bg-green-50",textColor:"text-green-700"},{label:"In Progress",value:l.inProgress,color:"from-blue-400 to-blue-600",icon:M,bgColor:"bg-blue-50",textColor:"text-blue-700"},{label:"Pending",value:l.pending,color:"from-amber-400 to-amber-600",icon:je,bgColor:"bg-amber-50",textColor:"text-amber-700"}].map((t,m)=>{const a=t.icon;return e.jsxs("div",{className:P("p-4 rounded-lg border",t.bgColor,`border-${t.color.split("-")[1]}-200`),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:P("text-sm font-medium",t.textColor),children:t.label}),e.jsx("div",{className:P("p-2 rounded-lg bg-white/50"),children:e.jsx(a,{className:P("w-4 h-4",t.textColor)})})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.value})]},m)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[j.assignedManager&&e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-lg shadow border border-indigo-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-indigo-900 mb-6 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-indigo-600"}),"Assigned Manager"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(q,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-indigo-900 text-lg",children:j.assignedManager.name}),e.jsx("p",{className:"text-sm text-indigo-600",children:"Project Manager"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 p-6 rounded-lg shadow border border-emerald-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-emerald-900 mb-6 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-emerald-600"}),"Projects Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:"Total Projects"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-900",children:b.length})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-700",children:"Total Tasks"}),e.jsx("span",{className:"text-2xl font-bold text-emerald-900",children:l.total})]})]})]})]}),!g&&e.jsxs("div",{className:"bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg p-12 text-center",children:[e.jsx(W,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Analytics Data Available"}),e.jsx("p",{className:"text-gray-600",children:"Tasks and projects assigned to this client will appear here with detailed visualizations"})]})]})},y={OVERVIEW:"overview",CONTACTS:"contacts",DOCUMENTS:"documents",ANALYTICS:"analytics"},Ge=()=>{const u=Z(),b=ye(),j=b.clientId||b.id||b.clientId,x=F(),[l,N]=w.useState(y.OVERVIEW),g=we(r=>r.clients),{status:f,error:S,selectedClient:U,currentClient:E}=g||{},t=U||E||((g==null?void 0:g.clients)||[]).find(r=>((r==null?void 0:r.id)||(r==null?void 0:r._id)||(r==null?void 0:r.public_id)||(r==null?void 0:r.client_id))==j);w.useEffect(()=>{j&&x(_(j))},[j,x]);const m=(t==null?void 0:t.projects)||[],a=m.reduce((r,v)=>{const k=Array.isArray(v==null?void 0:v.tasks)?v.tasks:[];return r.total+=k.length,k.forEach(d=>{const C=(d.stage||"").toString().toUpperCase(),A=(d.status||"").toString().toUpperCase();(A==="COMPLETED"||C==="COMPLETED")&&(r.completed+=1),(A==="PENDING"||C==="PENDING"||C==="TODO")&&(r.pending+=1),(C==="IN PROGRESS"||C==="IN_PROGRESS")&&(r.inProgress+=1)}),r},{total:0,completed:0,pending:0,inProgress:0}),s=(t==null?void 0:t.dashboard)||{},n=s.projectCount??m.length,o=s.taskCount??a.total,h=s.completedTasks??a.completed,p=s.pendingTasks??a.pending,i=[{_id:"1",label:"TOTAL PROJECTS",total:n,icon:e.jsx(Ue,{}),bg:"bg-[#7c3aed]",thought:"Active Projects"},{_id:"2",label:"TOTAL TASKS",total:o,icon:e.jsx(H,{}),bg:"bg-[#1d4ed8]",thought:"Assigned Overall"},{_id:"3",label:"COMPLETED TASKS",total:h,icon:e.jsx(De,{}),bg:"bg-[#0f766e]",thought:"Well Done"},{_id:"4",label:"PENDING TASKS",total:p,icon:e.jsx(M,{}),bg:"bg-[#f59e0b]",thought:"Remaining"}],c=({label:r,count:v,bg:k,icon:d,thought:C})=>e.jsxs("div",{className:"w-full h-32 bg-white p-5 shadow-md rounded-md flex items-center justify-between",children:[e.jsxs("div",{className:"h-full flex flex-1 flex-col justify-between",children:[e.jsx("p",{className:"text-base text-gray-600",children:r}),e.jsx("span",{className:"text-2xl font-semibold",children:v}),e.jsx("span",{className:"text-sm text-gray-400",children:C})]}),e.jsx("div",{className:P("w-10 h-10 rounded-full flex items-center justify-center text-white",k),children:d})]}),T=()=>{switch(l){case y.OVERVIEW:return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:i.map(({icon:r,bg:v,label:k,total:d,thought:C},A)=>e.jsx(c,{icon:r,bg:v,label:k,count:d,thought:C},A))}),s.assignedManager&&e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Assigned Manager"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.assignedManager.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manager"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Company"}),e.jsx("p",{className:"font-medium text-gray-900",children:(t==null?void 0:t.company)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-medium text-gray-900",children:(t==null?void 0:t.email)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"font-medium text-gray-900",children:(t==null?void 0:t.phone)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium text-gray-900",children:[t==null?void 0:t.district,t==null?void 0:t.state,t==null?void 0:t.pincode].filter(Boolean).join(", ")||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white p-4 shadow-md rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Projects & Tasks"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[n," projects"]})]}),m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ae,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No projects assigned yet"})]}):e.jsx("div",{className:"space-y-4",children:m.map((r,v)=>{const k=Array.isArray(r==null?void 0:r.tasks)?r.tasks:[];return e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:r.name||"Untitled Project"}),e.jsx("p",{className:"text-xs text-gray-500",children:r.status||"Unknown Status"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[k.length," tasks"]})]}),k.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No tasks for this project"}):e.jsx("div",{className:"space-y-3",children:k.map((d,C)=>{var G,z,B;const A=Array.isArray(d.subtasks)?d.subtasks:[];return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:d.title||d.name||"Untitled Task"}),e.jsxs("div",{className:"flex gap-2",children:[d.priority&&e.jsx("span",{className:P("text-xs px-2 py-0.5 rounded",d.priority.toLowerCase()==="high"&&"bg-red-100 text-red-700",d.priority.toLowerCase()==="medium"&&"bg-yellow-100 text-yellow-700",d.priority.toLowerCase()==="low"&&"bg-green-100 text-green-700"),children:d.priority}),d.status&&e.jsx("span",{className:P("text-xs px-2 py-0.5 rounded",(d.status.toLowerCase()==="completed"||((G=d.stage)==null?void 0:G.toLowerCase())==="completed")&&"bg-green-100 text-green-700",(d.status.toLowerCase()==="in progress"||((z=d.stage)==null?void 0:z.toLowerCase())==="in progress")&&"bg-blue-100 text-blue-700",(d.status.toLowerCase()==="pending"||((B=d.stage)==null?void 0:B.toLowerCase())==="pending")&&"bg-gray-100 text-gray-700"),children:d.status})]})]}),d.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:d.description}),e.jsx("div",{className:"text-xs text-gray-500",children:A.length>0?e.jsxs("span",{children:[A.length," subtask",A.length!==1?"s":""]}):e.jsx("span",{children:"No subtasks"})})]},d.id||d.public_id||d._id||C)})})]},r.id||r.public_id||v)})})]})]});case y.CONTACTS:return e.jsx(Oe,{client:t,contacts:(t==null?void 0:t.contacts)||[]});case y.DOCUMENTS:return e.jsx(Le,{client:t,documents:(t==null?void 0:t.documents)||[]});case y.ANALYTICS:return e.jsx(Re,{client:t,tasks:(t==null?void 0:t.tasks)||[],projects:m,dashboard:s});default:return null}};if(f==="loading")return e.jsx("div",{children:"Loading..."});if(f==="failed")return e.jsxs("div",{children:["Error: ",S||"Failed to load dashboard"]});const J=()=>{j&&x(_(j))};return e.jsxs("div",{className:"h-full py-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:()=>u(-1),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 font-medium transition mb-4",title:"Go back to previous page",children:[e.jsx(X,{className:"tm-icon"}),"Back"]}),e.jsx(ve,{title:`Client: ${(t==null?void 0:t.name)||"..."}`,subtitle:"Client workspace overview",onRefresh:J,refreshing:f==="loading",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>N(y.OVERVIEW),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",l===y.OVERVIEW?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(H,{className:"tm-icon"}),"Overview"]}),e.jsxs("button",{onClick:()=>N(y.CONTACTS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",l===y.CONTACTS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(Ce,{className:"tm-icon"}),"Contacts"]}),e.jsxs("button",{onClick:()=>N(y.DOCUMENTS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",l===y.DOCUMENTS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(I,{className:"tm-icon"}),"Documents"]}),e.jsxs("button",{onClick:()=>N(y.ANALYTICS),className:P("flex items-center gap-2 px-4 py-2 rounded-md transition",l===y.ANALYTICS?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(Pe,{className:"tm-icon"}),"Analytics"]})]})})]}),T()]})};export{Ge as default};
