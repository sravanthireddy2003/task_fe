import{a as C,u as _,r as b,j as e,a_ as F,B as T,a$ as g,f as L,b0 as R,aG as z,b1 as u,b2 as E,b3 as I,b4 as x,b5 as S,b6 as $,b7 as B,b8 as A}from"./index-CV0oviIo.js";import{f as O,r as w}from"./fileHelpers-B8PrZ_Ea.js";const V=({client:l})=>{const j=C(),m=_(),d=b.useRef(null),[p,f]=b.useState(!1),h=(l==null?void 0:l.documents)||[],y=t=>{if(!t)return e.jsx(x,{className:"tm-icon text-gray-400"});const a=t.toLowerCase();return a.includes("pdf")?e.jsx(x,{className:"tm-icon text-red-500"}):a.includes("image")?e.jsx(S,{className:"tm-icon text-green-500"}):a.includes("word")||a.includes("doc")?e.jsx($,{className:"tm-icon text-blue-500"}):a.includes("excel")||a.includes("xls")?e.jsx(B,{className:"tm-icon text-green-600"}):e.jsx(x,{className:"tm-icon text-gray-400"})},N=t=>O(t),U=async t=>{const a=Array.from(t.target.files);if(a.length!==0){f(!0);try{for(const n of a){const o=new FormData;o.append("document",n),o.append("entityType","CLIENT"),o.append("entityId",l.id);const r=u(),i=await fetch("/api/documents/upload",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:o});if(!i.ok)throw new Error(`Upload failed: ${i.status}`);const s=await i.json();await m(E({clientId:l.id,document:{id:s.data.documentId,file_name:s.data.fileName,file_type:s.data.mimeType,file_size:s.data.fileSize,file_url:s.data.publicUrl,uploaded_at:new Date().toISOString()}})).unwrap()}l!=null&&l.id&&await m(I(l.id)).unwrap()}catch(n){console.error("Failed to upload document:",n),alert("Upload failed: "+n.message)}finally{f(!1),d.current&&(d.current.value="")}}},v=async t=>{try{const a=t.file_url||t.publicUrl;if(!a){alert("No file URL available");return}const n=w(a),o=u(),r=await fetch(n,{method:"GET",headers:o?{Authorization:`Bearer ${o}`}:{}});if(!r.ok)throw new Error(`Failed to download (${r.status})`);const i=await r.blob(),s=window.URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download=t.file_name||t.fileName||"document",document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout(()=>window.URL.revokeObjectURL(s),5e3)}catch(a){console.error("Download failed",a),alert("Download failed: "+(a.message||a))}},k=async t=>{try{const a=t.file_url||t.publicUrl;if(!a)return;const n=w(a),o=u(),r=await fetch(n,{method:"GET",headers:o?{Authorization:`Bearer ${o}`}:{}});if(!r.ok)throw new Error(`Failed to fetch document (${r.status})`);const i=await r.blob(),s=window.URL.createObjectURL(i);window.open(s,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(s),5e3)}catch(a){console.error("View failed",a),alert("Unable to open document: "+(a.message||a))}},D=async t=>{if(window.confirm("Are you sure you want to delete this document?"))try{await m(A({clientId:l.id,documentId:t})).unwrap()}catch(a){console.error("Failed to delete document:",a)}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>j(-1),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700 font-medium transition",title:"Go back to previous page",children:[e.jsx(F,{className:"tm-icon"}),"Back"]}),e.jsx("div",{className:"flex-1",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Documents"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("input",{type:"file",ref:d,onChange:U,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",className:"hidden"}),e.jsx(T,{label:p?"Uploading...":"Upload Documents",icon:e.jsx(g,{}),onClick:()=>{var t;return(t=d.current)==null?void 0:t.click()},disabled:p,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg disabled:opacity-50"})]})]}),e.jsx("div",{className:"space-y-4",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(g,{className:"tm-icon text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg mb-2",children:"No documents uploaded yet"}),e.jsx("p",{className:"text-sm",children:'Click "Upload Documents" to add files'})]}):h.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[y(t.file_type||t.mimeType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.file_name||t.fileName||"Unnamed Document"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Type: ",t.file_type||t.mimeType||"Unknown"]}),t.file_size&&e.jsxs("p",{children:["Size: ",N(t.file_size)]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>k(t),className:"text-blue-500 hover:text-blue-600 p-2 icon-center",title:"View document",children:e.jsx(L,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>v(t),className:"text-green-500 hover:text-green-600 p-2 icon-center",title:"Download document",children:e.jsx(R,{className:"tm-icon"})}),e.jsx("button",{onClick:()=>D(t.id||t.documentId||t._id),className:"text-red-500 hover:text-red-600 p-2 icon-center",title:"Delete document",children:e.jsx(z,{className:"tm-icon"})})]})]},t.id||t.documentId||t._id))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Supported File Types"}),e.jsx("p",{className:"text-sm text-blue-700",children:"You can upload PDF, Word documents (.doc, .docx), Excel files (.xls, .xlsx), and images (.jpg, .jpeg, .png). Maximum file size: 10MB per file."})]})]})};export{V as default};
