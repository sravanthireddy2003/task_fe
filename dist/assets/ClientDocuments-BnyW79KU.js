import{u as v,r as h,j as t,B as D,aZ as b,e as k,a_ as _,aF as F,a$ as d,b0 as C,b1 as m,b2 as T,b3 as z,b4 as E,b5 as I}from"./index-7TXHU69M.js";const B=({client:r})=>{const u=v(),c=h.useRef(null),[x,p]=h.useState(!1),f=(r==null?void 0:r.documents)||[],w=e=>{if(!e)return t.jsx(m,{className:"tm-icon text-gray-400"});const s=e.toLowerCase();return s.includes("pdf")?t.jsx(m,{className:"tm-icon text-red-500"}):s.includes("image")?t.jsx(T,{className:"tm-icon text-green-500"}):s.includes("word")||s.includes("doc")?t.jsx(z,{className:"tm-icon text-blue-500"}):s.includes("excel")||s.includes("xls")?t.jsx(E,{className:"tm-icon text-green-600"}):t.jsx(m,{className:"tm-icon text-gray-400"})},j=e=>{if(!e)return"";const s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+s[a]},g=async e=>{const s=Array.from(e.target.files);if(s.length!==0){p(!0);try{for(const a of s){const l=new FormData;l.append("document",a),l.append("entityType","CLIENT"),l.append("entityId",r.id);const i=d(),n=await fetch("/api/documents/upload",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:l});if(!n.ok)throw new Error(`Upload failed: ${n.status}`);const o=await n.json();await u(C({clientId:r.id,document:{id:o.data.documentId,file_name:o.data.fileName,file_type:o.data.mimeType,file_size:o.data.fileSize,file_url:o.data.publicUrl,uploaded_at:new Date().toISOString()}})).unwrap()}}catch(a){console.error("Failed to upload document:",a),alert("Upload failed: "+a.message)}finally{p(!1),c.current&&(c.current.value="")}}},y=async e=>{try{const s=e.publicUrl||e.file_url;if(!s)return;const a=d(),l=await fetch(s,{method:"GET",headers:a?{Authorization:`Bearer ${a}`}:{}});if(!l.ok)throw new Error(`Failed to download (${l.status})`);const i=await l.blob(),n=window.URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=e.file_name||e.fileName||"document",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>window.URL.revokeObjectURL(n),5e3)}catch(s){console.error("Download failed",s),alert("Download failed: "+(s.message||s))}},N=async e=>{try{const s=e.publicUrl||e.file_url;if(!s)return;const a=d(),l=await fetch(s,{method:"GET",headers:a?{Authorization:`Bearer ${a}`}:{}});if(!l.ok)throw new Error(`Failed to fetch document (${l.status})`);const i=await l.blob(),n=window.URL.createObjectURL(i);window.open(n,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(n),5e3)}catch(s){console.error("View failed",s),alert("Unable to open document: "+(s.message||s))}},U=async e=>{if(window.confirm("Are you sure you want to delete this document?"))try{await u(I({clientId:r.id,documentId:e})).unwrap()}catch(s){console.error("Failed to delete document:",s)}};return t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Client Documents"}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("input",{type:"file",ref:c,onChange:g,multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",className:"hidden"}),t.jsx(D,{label:x?"Uploading...":"Upload Documents",icon:t.jsx(b,{}),onClick:()=>{var e;return(e=c.current)==null?void 0:e.click()},disabled:x,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg disabled:opacity-50"})]})]}),t.jsx("div",{className:"space-y-4",children:f.length===0?t.jsxs("div",{className:"text-center py-12 text-gray-500 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[t.jsx(b,{className:"tm-icon text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-lg mb-2",children:"No documents uploaded yet"}),t.jsx("p",{className:"text-sm",children:'Click "Upload Documents" to add files'})]}):f.map(e=>t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[w(e.file_type||e.mimeType),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900",children:e.file_name||e.fileName||"Unnamed Document"}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Type: ",e.file_type||e.mimeType||"Unknown"]}),e.file_size&&t.jsxs("p",{children:["Size: ",j(e.file_size)]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>N(e),className:"text-blue-500 hover:text-blue-600 p-2 icon-center",title:"View document",children:t.jsx(k,{className:"tm-icon"})}),t.jsx("button",{onClick:()=>y(e),className:"text-green-500 hover:text-green-600 p-2 icon-center",title:"Download document",children:t.jsx(_,{className:"tm-icon"})}),t.jsx("button",{onClick:()=>U(e.id||e.documentId||e._id),className:"text-red-500 hover:text-red-600 p-2 icon-center",title:"Delete document",children:t.jsx(F,{className:"tm-icon"})})]})]},e.id||e.documentId||e._id))}),t.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[t.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Supported File Types"}),t.jsx("p",{className:"text-sm text-blue-700",children:"You can upload PDF, Word documents (.doc, .docx), Excel files (.xls, .xlsx), and images (.jpg, .jpeg, .png). Maximum file size: 10MB per file."})]})]})};export{B as default};
