import{r as x,n as A,w as je,U as L,y as q,c1 as Ne,c2 as we,p as C,R as oe,c3 as Se,q as pe,c4 as $,C as B,I as Z,c5 as X,c6 as fe,c7 as Ie,c8 as ge,c9 as _e,x as N,ca as Ce,M as ce,cb as De,T as Te,O as de,t as Re,cc as Ee,u as G,j as e,B as P,cd as Pe,b as M,ce as he,X as Me,H as Oe,a2 as Q,a as Fe,G as Ue,cf as be,a5 as Ae,cg as z,ch as $e,K as Le,F as W,ci as qe,cj as Be,b9 as Ge,ac as Ke,aN as He,ck as Qe,cl as ze,cm as We}from"./index-BNLOVeat.js";import{h as ue}from"./moment-C5S46NFB.js";import{u as ee}from"./index.esm-Bh1owRo4.js";import{M as te,_ as se}from"./ModalWrapper-uW5TDbhN.js";import{T as O}from"./Textbox-B28Y-Bdj.js";import{C as Ve}from"./Dialogs-DP5GMH0R.js";import{s as ke,c as T,u as Ye,f as Je,S as V,I as U}from"./SelectList-Bkq-s9kR.js";import{a as me,B as xe}from"./index-pGm2xic7.js";function Xe({container:t,accept:l,walk:c,enabled:s=!0}){let a=x.useRef(l),n=x.useRef(c);x.useEffect(()=>{a.current=l,n.current=c},[l,c]),A(()=>{if(!t||!s)return;let o=je(t);if(!o)return;let i=a.current,u=n.current,p=Object.assign(y=>i(y),{acceptNode:i}),r=o.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,p,!1);for(;r.nextNode();)u(r.currentNode)},[t,s,a,n])}var Ze=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(Ze||{}),et=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(et||{}),tt=(t=>(t[t.OpenMenu=0]="OpenMenu",t[t.CloseMenu=1]="CloseMenu",t[t.GoToItem=2]="GoToItem",t[t.Search=3]="Search",t[t.ClearSearch=4]="ClearSearch",t[t.RegisterItem=5]="RegisterItem",t[t.UnregisterItem=6]="UnregisterItem",t))(tt||{});function k(t,l=c=>c){let c=t.activeItemIndex!==null?t.items[t.activeItemIndex]:null,s=Re(l(t.items.slice()),n=>n.dataRef.current.domRef.current),a=c?s.indexOf(c):null;return a===-1&&(a=null),{items:s,activeItemIndex:a}}let st={1(t){return t.menuState===1?t:{...t,activeItemIndex:null,menuState:1}},0(t){return t.menuState===0?t:{...t,__demoMode:!1,menuState:0}},2:(t,l)=>{var c;let s=k(t),a=Je(l,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:n=>n.id,resolveDisabled:n=>n.dataRef.current.disabled});return{...t,...s,searchQuery:"",activeItemIndex:a,activationTrigger:(c=l.trigger)!=null?c:1}},3:(t,l)=>{let c=t.searchQuery!==""?0:1,s=t.searchQuery+l.value.toLowerCase(),a=(t.activeItemIndex!==null?t.items.slice(t.activeItemIndex+c).concat(t.items.slice(0,t.activeItemIndex+c)):t.items).find(o=>{var i;return((i=o.dataRef.current.textValue)==null?void 0:i.startsWith(s))&&!o.dataRef.current.disabled}),n=a?t.items.indexOf(a):-1;return n===-1||n===t.activeItemIndex?{...t,searchQuery:s}:{...t,searchQuery:s,activeItemIndex:n,activationTrigger:1}},4(t){return t.searchQuery===""?t:{...t,searchQuery:"",searchActiveItemIndex:null}},5:(t,l)=>{let c=k(t,s=>[...s,{id:l.id,dataRef:l.dataRef}]);return{...t,...c}},6:(t,l)=>{let c=k(t,s=>{let a=s.findIndex(n=>n.id===l.id);return a!==-1&&s.splice(a,1),s});return{...t,...c,activationTrigger:1}}},re=x.createContext(null);re.displayName="MenuContext";function K(t){let l=x.useContext(re);if(l===null){let c=new Error(`<${t} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(c,K),c}return l}function rt(t,l){return pe(l.type,st,t,l)}let at=x.Fragment;function nt(t,l){let{__demoMode:c=!1,...s}=t,a=x.useReducer(rt,{__demoMode:c,menuState:c?0:1,buttonRef:x.createRef(),itemsRef:x.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:n,itemsRef:o,buttonRef:i},u]=a,p=q(l);Ne([i,o],(w,I)=>{var m;u({type:1}),we(I,Ee.Loose)||(w.preventDefault(),(m=i.current)==null||m.focus())},n===0);let r=C(()=>{u({type:1})}),y=x.useMemo(()=>({open:n===0,close:r}),[n,r]),v={ref:p};return oe.createElement(re.Provider,{value:a},oe.createElement(Se,{value:pe(n,{0:$.Open,1:$.Closed})},B({ourProps:v,theirProps:s,slot:y,defaultTag:at,name:"Menu"})))}let it="button";function lt(t,l){var c;let s=Z(),{id:a=`headlessui-menu-button-${s}`,...n}=t,[o,i]=K("Menu.Button"),u=q(o.buttonRef,l),p=ge(),r=C(m=>{switch(m.key){case N.Space:case N.Enter:case N.ArrowDown:m.preventDefault(),m.stopPropagation(),i({type:0}),p.nextFrame(()=>i({type:2,focus:T.First}));break;case N.ArrowUp:m.preventDefault(),m.stopPropagation(),i({type:0}),p.nextFrame(()=>i({type:2,focus:T.Last}));break}}),y=C(m=>{switch(m.key){case N.Space:m.preventDefault();break}}),v=C(m=>{if(De(m.currentTarget))return m.preventDefault();t.disabled||(o.menuState===0?(i({type:1}),p.nextFrame(()=>{var j;return(j=o.buttonRef.current)==null?void 0:j.focus({preventScroll:!0})})):(m.preventDefault(),i({type:0})))}),w=x.useMemo(()=>({open:o.menuState===0}),[o]),I={ref:u,id:a,type:Te(t,o.buttonRef),"aria-haspopup":"menu","aria-controls":(c=o.itemsRef.current)==null?void 0:c.id,"aria-expanded":o.menuState===0,onKeyDown:r,onKeyUp:y,onClick:v};return B({ourProps:I,theirProps:n,slot:w,defaultTag:it,name:"Menu.Button"})}let ot="div",ct=de.RenderStrategy|de.Static;function dt(t,l){var c,s;let a=Z(),{id:n=`headlessui-menu-items-${a}`,...o}=t,[i,u]=K("Menu.Items"),p=q(i.itemsRef,l),r=Ie(i.itemsRef),y=ge(),v=_e(),w=v!==null?(v&$.Open)===$.Open:i.menuState===0;x.useEffect(()=>{let d=i.itemsRef.current;d&&i.menuState===0&&d!==(r==null?void 0:r.activeElement)&&d.focus({preventScroll:!0})},[i.menuState,i.itemsRef,r]),Xe({container:i.itemsRef.current,enabled:i.menuState===0,accept(d){return d.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:d.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(d){d.setAttribute("role","none")}});let I=C(d=>{var _,f;switch(y.dispose(),d.key){case N.Space:if(i.searchQuery!=="")return d.preventDefault(),d.stopPropagation(),u({type:3,value:d.key});case N.Enter:if(d.preventDefault(),d.stopPropagation(),u({type:1}),i.activeItemIndex!==null){let{dataRef:g}=i.items[i.activeItemIndex];(f=(_=g.current)==null?void 0:_.domRef.current)==null||f.click()}fe(i.buttonRef.current);break;case N.ArrowDown:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Next});case N.ArrowUp:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Previous});case N.Home:case N.PageUp:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.First});case N.End:case N.PageDown:return d.preventDefault(),d.stopPropagation(),u({type:2,focus:T.Last});case N.Escape:d.preventDefault(),d.stopPropagation(),u({type:1}),X().nextFrame(()=>{var g;return(g=i.buttonRef.current)==null?void 0:g.focus({preventScroll:!0})});break;case N.Tab:d.preventDefault(),d.stopPropagation(),u({type:1}),X().nextFrame(()=>{Ce(i.buttonRef.current,d.shiftKey?ce.Previous:ce.Next)});break;default:d.key.length===1&&(u({type:3,value:d.key}),y.setTimeout(()=>u({type:4}),350));break}}),m=C(d=>{switch(d.key){case N.Space:d.preventDefault();break}}),j=x.useMemo(()=>({open:i.menuState===0}),[i]),D={"aria-activedescendant":i.activeItemIndex===null||(c=i.items[i.activeItemIndex])==null?void 0:c.id,"aria-labelledby":(s=i.buttonRef.current)==null?void 0:s.id,id:n,onKeyDown:I,onKeyUp:m,role:"menu",tabIndex:0,ref:p};return B({ourProps:D,theirProps:o,slot:j,defaultTag:ot,features:ct,visible:w,name:"Menu.Items"})}let ut=x.Fragment;function mt(t,l){let c=Z(),{id:s=`headlessui-menu-item-${c}`,disabled:a=!1,...n}=t,[o,i]=K("Menu.Item"),u=o.activeItemIndex!==null?o.items[o.activeItemIndex].id===s:!1,p=x.useRef(null),r=q(l,p);A(()=>{if(o.__demoMode||o.menuState!==0||!u||o.activationTrigger===0)return;let g=X();return g.requestAnimationFrame(()=>{var b,R;(R=(b=p.current)==null?void 0:b.scrollIntoView)==null||R.call(b,{block:"nearest"})}),g.dispose},[o.__demoMode,p,u,o.menuState,o.activationTrigger,o.activeItemIndex]);let y=ke(p),v=x.useRef({disabled:a,domRef:p,get textValue(){return y()}});A(()=>{v.current.disabled=a},[v,a]),A(()=>(i({type:5,id:s,dataRef:v}),()=>i({type:6,id:s})),[v,s]);let w=C(()=>{i({type:1})}),I=C(g=>{if(a)return g.preventDefault();i({type:1}),fe(o.buttonRef.current)}),m=C(()=>{if(a)return i({type:2,focus:T.Nothing});i({type:2,focus:T.Specific,id:s})}),j=Ye(),D=C(g=>j.update(g)),d=C(g=>{j.wasMoved(g)&&(a||u||i({type:2,focus:T.Specific,id:s,trigger:0}))}),_=C(g=>{j.wasMoved(g)&&(a||u&&i({type:2,focus:T.Nothing}))}),f=x.useMemo(()=>({active:u,disabled:a,close:w}),[u,a,w]);return B({ourProps:{id:s,ref:r,role:"menuitem",tabIndex:a===!0?void 0:-1,"aria-disabled":a===!0?!0:void 0,disabled:void 0,onClick:I,onFocus:m,onPointerEnter:D,onMouseEnter:D,onPointerMove:d,onMouseMove:d,onPointerLeave:_,onMouseLeave:_},theirProps:n,slot:f,defaultTag:ut,name:"Menu.Item"})}let xt=L(nt),pt=L(lt),ft=L(dt),gt=L(mt),F=Object.assign(xt,{Button:pt,Items:ft,Item:gt});const ve=({open:t,setOpen:l,id:c})=>{const{register:s,handleSubmit:a,formState:{errors:n}}=ee(),o=G(),i=async u=>{const p={id:c,title:u.title,due_date:u.date,tag:u.tag};console.log(c),o(Pe(p)),l(!1)};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:l,children:e.jsxs("form",{onSubmit:a(i),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"ADD SUB-TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-6",children:[e.jsx(O,{placeholder:"Sub-Task title",type:"text",name:"title",label:"Title",className:"w-full rounded",register:s("title",{required:"Title is required!"}),error:n.title?n.title.message:""}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(O,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:s("date",{required:"Date is required!"}),error:n.date?n.date.message:""}),e.jsx(O,{placeholder:"Tag",type:"text",name:"tag",label:"Tag",className:"w-full rounded",register:s("tag",{required:"Tag is required!"}),error:n.tag?n.tag.message:""})]})]}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Add Task"}),e.jsx(P,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>l(!1),label:"Cancel"})]})]})})})},Y=["TODO","IN PROGRESS","COMPLETED"],J=["HIGH","MEDIUM","LOW"],ht=({open:t,setOpen:l,taskId:c})=>{var ae,ne,ie,le;const s=G(),{register:a,handleSubmit:n,setValue:o,formState:{errors:i},reset:u}=ee(),p=M(h=>he(h,c)),r=M(Me),[y,v]=x.useState([]),[w,I]=x.useState(Y[0]),[m,j]=x.useState(J[2]),[D,d]=x.useState(""),[_,f]=x.useState([]),[g,b]=x.useState(!1);x.useEffect(()=>{var h;p&&(v(p.assigned_to||[]),I(p.stage||Y[0]),j(p.priority||J[2]),d(p.client_id||""),o("title",p.title||""),o("date",((h=p.taskDate)==null?void 0:h.split("T")[0])||""),o("time_alloted",p.time_alloted||""),o("description",p.description||""))},[p,o]),x.useEffect(()=>{(async()=>{try{const S=await Oe("api/clients");f(S)}catch(S){console.error("Error fetching clients:",S)}})()},[]);const R=h=>{v(h.map(S=>S._id))},H=r.filter(h=>y.includes(h._id)),ye=async h=>{if(!c){alert("Task ID is missing. Please try again.");return}const S={stage:w,title:h.title,priority:m,description:h.description,assigned_to:y,client_id:D,taskDate:new Date(h.date).toISOString(),time_alloted:h.time_alloted};b(!0);try{const E=await s(Q({id:c,updatedTaskData:S}));Q.fulfilled.match(E)?(l(!1),u()):Q.rejected.match(E)&&alert(`Update failed: ${E.payload||E.error}`)}catch(E){console.error("Update error:",E),alert("Failed to update task")}finally{b(!1)}};return p?e.jsx(te,{open:t,setOpen:l,children:e.jsxs("form",{onSubmit:n(ye),children:[e.jsx(se.Title,{className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-4",children:[e.jsx(V,{label:"Select Client",lists:_.map(h=>h.name),selected:D&&((ae=_.find(h=>h._id===D))==null?void 0:ae.name)||"",setSelected:h=>{const S=_.find(E=>E.name===h);d(S?S._id:"")}}),e.jsx(O,{placeholder:"Task Title",type:"text",name:"title",label:"Task Title",className:"w-full rounded",register:a("title",{required:"Title is required"}),error:(ne=i.title)==null?void 0:ne.message}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(V,{label:"Priority Level",lists:J,selected:m,setSelected:j})}),e.jsx("div",{className:"w-1/2",children:e.jsx(V,{label:"Task Stage",lists:Y,selected:w,setSelected:I})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-1/2",children:e.jsx(O,{placeholder:"Date",type:"date",name:"date",label:"Task Date",className:"w-full rounded",register:a("date",{required:"Date is required"}),error:(ie=i.date)==null?void 0:ie.message})}),e.jsx("div",{className:"w-1/2",children:e.jsx(O,{placeholder:"Time Alloted",type:"number",name:"time_alloted",label:"Time Alloted",className:"w-full rounded",register:a("time_alloted",{valueAsNumber:!0,min:{value:0,message:"Must be a positive number"}}),error:(le=i.time_alloted)==null?void 0:le.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Users"}),e.jsx(U,{value:H,onChange:R,multiple:!0,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs(U.Button,{className:"relative w-full cursor-default rounded-lg border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 sm:text-sm",children:[e.jsx("span",{className:"block truncate",children:H.length>0?H.map(h=>h.name).join(", "):"Select users"}),e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400",children:"▼"})]}),e.jsx(U.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:r.map(h=>e.jsx(U.Option,{value:h,className:({active:S})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${S?"bg-indigo-600 text-white":"text-gray-900"}`,children:({selected:S})=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`block truncate ${S?"font-medium":"font-normal"}`,children:h.name||"Unnamed User"}),S&&e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-green-600",children:"✓"})]})},h._id))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Task Description"}),e.jsx("textarea",{id:"description",placeholder:"Enter task description (optional)",className:"w-full rounded border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",rows:"3",...a("description")})]}),e.jsxs("div",{className:"bg-gray-50 py-4 sm:flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{label:g?"Updating...":"Update",type:"submit",className:`${g?"opacity-50 cursor-not-allowed":""} bg-green-600 px-8 text-sm font-semibold text-white hover:bg-green-700 sm:w-auto`,disabled:g}),e.jsx(P,{type:"button",className:"bg-white px-5 text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>l(!1),label:"Cancel"})]})]})]})}):null},{FolderOpen:bt,MoreVertical:vt,Plus:yt,Trash2:jt}=Ue,Nt=({task:t})=>{const[l,c]=x.useState(!1),[s,a]=x.useState(!1),[n,o]=x.useState(!1),[i,u]=x.useState(null),p=Fe(),r=G(),y=()=>{i!==null&&(r(Ae({id:i})),u(null),o(!1))},v=m=>{u(m),o(!0)},w=()=>{const m=(t==null?void 0:t._id)||(t==null?void 0:t.task_id);m?p(`/task/${m}`):console.error("No valid task ID available for navigation")},I=[{label:"Open Task",icon:e.jsx(bt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:w},{label:"Edit",icon:e.jsx(yt,{className:"tm-icon mr-2","aria-hidden":"true"}),onClick:()=>{t!=null&&t.task_id?a(!0):console.error("No task ID available for editing")}}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs(F,{as:"div",className:"relative inline-block text-left",children:[e.jsx(F.Button,{className:"inline-flex w-full justify-center rounded-md px-4 py-2 text-sm font-medium text-gray-600",children:e.jsx(vt,{className:"tm-icon"})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:e.jsxs(F.Items,{className:"absolute right-0 z-50 mt-2 w-56 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",children:[e.jsx("div",{className:"px-1 py-1 space-y-2",children:I.map(m=>e.jsx(F.Item,{children:({active:j})=>e.jsxs("button",{onClick:m.onClick,className:`${j?"bg-blue-500 text-white":"text-gray-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[m.icon,m.label]})},m.label))}),e.jsx("div",{className:"px-1 py-1",children:e.jsx(F.Item,{children:({active:m})=>e.jsxs("button",{onClick:()=>v((t==null?void 0:t._id)||(t==null?void 0:t.task_id)),className:`${m?"bg-blue-500 text-white":"text-red-900"} group flex w-full items-center rounded-md px-2 py-2 text-sm`,children:[e.jsx(jt,{className:"tm-icon mr-2 text-red-400","aria-hidden":"true"}),"Delete"]})})})]})})]})}),s&&(t==null?void 0:t.task_id)&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(ht,{open:s,setOpen:a,taskId:t.task_id},t.task_id)})}),e.jsx(ve,{open:l,setOpen:c}),e.jsx(Ve,{open:n,setOpen:o,onClick:y})]})},wt=({user:t})=>e.jsx("div",{className:"px-4",children:e.jsx(z,{className:"relative",children:({open:l})=>e.jsxs(e.Fragment,{children:[e.jsx(z.Button,{className:"group inline-flex items-center outline-none",children:e.jsx("span",{children:me(t==null?void 0:t.user_name)})}),e.jsx(be,{as:x.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:e.jsx(z.Panel,{className:"absolute left-1/2 z-10 mt-3 w-80 max-w-sm -translate-x-1/2 transform px-4 sm:px-0 ",children:e.jsxs("div",{className:"flex items-center gap-4 rounded-lg shadow-lg bg-white p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full text-white flex items-center justify-center text-2xl ",children:e.jsx("span",{className:"text-center font-bold",children:me(t==null?void 0:t.user_name)})}),e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsx("p",{className:"text-black text-xl font-bold",children:t==null?void 0:t.user_name}),e.jsx("span",{className:"text-blue-500",children:(t==null?void 0:t.user_role)??"email@example.com"})]})]})})})]})})}),St=({openStage:t,setOpenStage:l,id:c,onStatusUpdate:s})=>{const{register:a,handleSubmit:n,formState:{errors:o}}=ee(),i=u=>{u.status&&(s(u.status),l(!1))};return e.jsx(e.Fragment,{children:e.jsx(te,{open:t,setOpen:l,children:e.jsxs("form",{onSubmit:n(i),className:"",children:[e.jsx(se.Title,{as:"h2",className:"text-base font-bold leading-6 text-gray-900 mb-4",children:"UPDATE TASK STATUS"}),e.jsx("div",{className:"mt-2 flex flex-col gap-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"status",className:"font-semibold",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"w-full rounded border-gray-300",...a("status",{required:"Status is required!"}),children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"IN PROGRESS",children:"IN PROGRESS"}),e.jsx("option",{value:"COMPLETED",children:"COMPLETED"}),e.jsx("option",{value:"TODO",children:"TODO"})]}),o.status&&e.jsx("span",{className:"text-red-600",children:o.status.message})]})}),e.jsxs("div",{className:"py-3 mt-4 flex sm:flex-row-reverse gap-4",children:[e.jsx(P,{type:"submit",className:"bg-blue-600 text-sm font-semibold text-white hover:bg-blue-700 sm:ml-3 sm:w-auto",label:"Update Status"}),e.jsx(P,{type:"button",className:"bg-white border text-sm font-semibold text-gray-900 sm:w-auto",onClick:()=>l(!1),label:"Cancel"})]})]})})})},It={HIGH:e.jsx(ze,{className:"w-4 h-4"}),MEDIUM:e.jsx(Qe,{className:"w-4 h-4"}),LOW:e.jsx(He,{className:"w-4 h-4"})},_t=({taskId:t,task:l})=>{var j,D,d,_;const c=M(f=>he(f,t)),s=l||c,a=G(),{user:n}=M(f=>f.auth),[o,i]=x.useState(!1),[u,p]=x.useState(!1),[r,y]=x.useState(s),v=M($e);x.useEffect(()=>{if(s!=null&&s.task_id||s!=null&&s.id||s!=null&&s.public_id){const f=(s==null?void 0:s.task_id)||(s==null?void 0:s.id)||(s==null?void 0:s.public_id);a(Le(f)),y(s)}},[a,s==null?void 0:s.task_id,s==null?void 0:s.id,s==null?void 0:s.public_id]);const w=async f=>{const g=(s==null?void 0:s.task_id)??(s==null?void 0:s.id)??(s==null?void 0:s._id);if(g)try{await a(We({id:g.toString(),data:{stage:f}})).unwrap()&&y(R=>({...R,stage:f}))}catch(b){console.error("Update failed:",b),y(R=>({...R}))}},I=f=>{switch(f==null?void 0:f.toLowerCase()){case"todo":case"to do":return"bg-gray-100 text-gray-800 border-gray-200";case"in progress":case"in_progress":return"bg-primary-100 text-primary-800 border-primary-200";case"review":return"bg-warning-100 text-warning-800 border-warning-200";case"completed":case"done":return"bg-success-100 text-success-800 border-success-200";case"blocked":return"bg-error-100 text-error-800 border-error-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},m=f=>{switch(f==null?void 0:f.toLowerCase()){case"high":return"text-error-600";case"medium":return"text-warning-600";case"low":return"text-success-600";default:return"text-gray-600"}};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full h-fit card cursor-pointer",children:[e.jsxs("div",{className:"w-full flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:W("px-2 py-1 text-xs font-medium rounded-full border",I(r==null?void 0:r.stage)),children:(r==null?void 0:r.stage)||"To Do"}),e.jsxs("div",{className:W("flex items-center gap-1 text-sm font-medium",m(r==null?void 0:r.priority)),children:[e.jsx("span",{className:"text-base",children:It[r==null?void 0:r.priority]}),e.jsx("span",{className:"uppercase",children:(r==null?void 0:r.priority)||"N/A"})]})]}),n&&e.jsx(Nt,{task:r})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 line-clamp-2 mb-1",children:(r==null?void 0:r.title)||"Untitled Task"}),(r==null?void 0:r.description)&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:r.description})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["Created ",r!=null&&r.createdAt?ue(r.createdAt).fromNow():"recently"]}),(r==null?void 0:r.due_date)&&e.jsxs("span",{className:"text-warning-600 font-medium",children:["Due ",ue(r.due_date).fromNow()]})]}),e.jsx("div",{className:"w-full border-t border-gray-100 my-3"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:((j=r==null?void 0:r.activities)==null?void 0:j.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:((D=r==null?void 0:r.assets)==null?void 0:D.length)||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsxs("span",{children:["0/",(v==null?void 0:v.length)||0]})]})]}),e.jsxs("div",{className:"flex flex-row-reverse",children:[(d=r==null?void 0:r.assigned_users)==null?void 0:d.slice(0,3).map((f,g)=>{var b;return e.jsx("div",{className:W("w-8 h-8 rounded-full text-white flex items-center justify-center text-sm -mr-2 border-2 border-white",xe[g%((b=xe)==null?void 0:b.length)]),children:e.jsx(wt,{user:f})},(f==null?void 0:f._id)||g)}),((_=r==null?void 0:r.assigned_users)==null?void 0:_.length)>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-medium -mr-2 border-2 border-white",children:["+",r.assigned_users.length-3]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{onClick:()=>i(!0),variant:"secondary",size:"sm",icon:Ke,label:"Add Subtask",className:"flex-1"}),e.jsx(P,{onClick:()=>{const f=r.assignedUsers||r.assigned_users||[],g=Array.isArray(f)?f.find(b=>String(b.id||b._id||b.internalId||b.public_id)===String((n==null?void 0:n.id)||(n==null?void 0:n._id)||(n==null?void 0:n.internal_id)||(n==null?void 0:n.public_id))):null;(g==null?void 0:g.readOnly)!==!0&&p(!0)},variant:"secondary",size:"sm",label:"Update Status",className:"flex-1",disabled:(()=>{const f=r.assignedUsers||r.assigned_users||[],g=Array.isArray(f)?f.find(b=>String(b.id||b._id||b.internalId||b.public_id)===String((n==null?void 0:n.id)||(n==null?void 0:n._id)||(n==null?void 0:n.internal_id)||(n==null?void 0:n.public_id))):null;return(g==null?void 0:g.readOnly)===!0})()})]})]}),e.jsx(ve,{open:o,setOpen:i,id:(r==null?void 0:r.task_id)??(r==null?void 0:r.id)??(r==null?void 0:r._id)}),e.jsx(St,{openStage:u,setOpenStage:p,id:(r==null?void 0:r.task_id)??(r==null?void 0:r.id)??(r==null?void 0:r._id),onStatusUpdate:w})]}):e.jsx("div",{className:"w-full h-fit card",children:"Task not found."})},Ct=t=>{var a,n;const l=(a=t==null?void 0:t.resources)==null?void 0:a.mappedClient,c=(n=t==null?void 0:t.metrics)==null?void 0:n.mappedClient,s=(t==null?void 0:t.clientId)||(t==null?void 0:t.client_id);return l??c??s},Ut=()=>{const t=M(a=>a.auth.user),{tasks:l=[]}=M(a=>a.tasks||{}),c=Ct(t),s=l.filter(a=>[a==null?void 0:a.clientId,a==null?void 0:a.client_id,a==null?void 0:a.client].some(o=>o&&c&&o.toString()===c.toString()));return e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-blue-500",children:"Assigned Tasks"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Your active work"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-3xl",children:"These tasks are mapped to the client profile that arrived with your login token."})]}),s.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/50 p-6 text-sm text-gray-500",children:"No tasks are currently assigned to you."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:s.map((a,n)=>e.jsx(_t,{task:a},a.id||a._id||n))})]})};export{Ut as default};
