import{u as Se,b as p,s as Te,r as c,j as e,af as Me,a1 as $,bJ as ke,i as m,bK as qe,W as Fe,bL as Re,bM as He,bN as $e,bO as Ue,at as Ve,aK as ze,X as Be,Y as k,au as fe,aQ as Ne,Z as je,bP as ye,ao as Ge,G as Ke,R as Je,bQ as ve,bR as Qe,bS as We,bT as Xe}from"./index-CT2igMlm.js";import{V as Ye}from"./ViewToggle-DFwV-H2g.js";import{C as Ze}from"./Card-Bw0PVUFX.js";const we=({project:a,tasks:o=[],taskSummary:j})=>{var b;const O=Se(),x=p(Te),[n,C]=c.useState(!1),[D,_]=c.useState(!1),[y,f]=c.useState(""),P=((b=x==null?void 0:x.role)==null?void 0:b.toLowerCase())==="manager",S=c.useMemo(()=>{if(!P||!a)return!1;const d=a.status==="ACTIVE"||a.status==="active";let h=!1;if(j){const v=j.total||0,E=j.completed||0,F=j.inProgress||0;h=v>0&&v===E&&F===0}else h=o.length>0&&o.every(v=>v.status==="COMPLETED"||v.status==="completed");return d&&h},[P,a,o,j]),g=(a==null?void 0:a.status)==="PENDING_FINAL_APPROVAL"||(a==null?void 0:a.status)==="pending_final_approval",M=(a==null?void 0:a.status)==="CLOSED"||(a==null?void 0:a.status)==="closed";if(!P||M)return null;const q=async()=>{if(!y.trim()){m.error("Please provide a reason for project closure");return}C(!0);try{const d=await O(qe({projectId:a.id||a._id,reason:y.trim()})).unwrap();if(d&&d.success)m.warning(d.message||"Project closure requested successfully"),d.data&&d.data.projectStatus,_(!1),f("");else throw new Error((d==null?void 0:d.message)||"Failed to request project closure")}catch(d){m.error((d==null?void 0:d.message)||d||"Failed to request project closure")}finally{C(!1)}},I=()=>{if(g)return"Closure Request Pending Admin Approval";if(!S){const d=o.filter(h=>h.status!=="COMPLETED"&&h.status!=="completed").length;return`Complete ${d} task${d!==1?"s":""} to close project`}return"Request Project Closure"};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>!g&&_(!0),disabled:!S||n||g,className:`inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors ${g?"text-gray-500 bg-gray-200 cursor-not-allowed":S?"text-white bg-orange-600 hover:bg-orange-700 disabled:bg-orange-400":"text-gray-500 bg-gray-200 cursor-not-allowed"}`,title:g?"Project closure request is pending admin approval. You cannot send another request at this time.":S?"":"All tasks must be completed before closing the project",children:[n?e.jsx(Me,{className:"w-4 h-4 animate-spin"}):g?e.jsx($,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"}),I()]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ke,{className:"w-6 h-6 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Request Project Closure"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:['This will request administrative approval to close the project "',a.name||a.title,'".']}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please provide a reason for closing this project:"})]}),e.jsx("textarea",{value:y,onChange:d=>f(d.target.value),placeholder:"Explain why this project should be closed...",className:"w-full p-3 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",rows:4,maxLength:500}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{_(!1),f("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:n||!y.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 disabled:bg-orange-400 rounded-md",children:n?"Submitting...":"Request Closure"})]})]})})]})},Ce=({project:a})=>(a==null?void 0:a.status)==="CLOSED"||(a==null?void 0:a.status)==="closed"?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx($,{className:"w-5 h-5 text-red-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Project is Closed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"This project has been closed and all tasks are locked. No further modifications are allowed."})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ke,{className:"w-5 h-5 text-red-500"})})]})}):null,{Plus:es,Edit2:_e,Trash2:Pe,FolderKanban:ss,Filter:ts,X:as,ClipboardList:ls,BarChart3:rs,Activity:ns,User:ds,CalendarDays:is,FileText:cs}=Ke;function gs(){var X,Y,Z,ee,se,te,ae,le,re,ne,de,ie,ce,oe,me,xe,ue,ge,he,be;const a=Se(),o=p(Fe)||[],j=p(Re),O=p(He),x=p($e),n=p(Ue),C=p(Ve)||[],D=p(ze)||[],_=p(Be)||[],y=j==="loading",f=["Planning","Active","On Hold","Completed","Cancelled"],P={Planning:"bg-yellow-100 text-yellow-700",Active:"bg-blue-100 text-blue-700",Completed:"bg-green-100 text-green-700","On Hold":"bg-red-100 text-red-700",Cancelled:"bg-gray-100 text-gray-700"},S=["Low","Medium","High"],[g,M]=c.useState("list"),[q,I]=c.useState(!1),[b,d]=c.useState(null),[h,v]=c.useState("all"),[E,F]=c.useState("all"),[U,L]=c.useState(null),[De,V]=c.useState(!1),[A,z]=c.useState(null),[r,u]=c.useState({name:"",description:"",clientId:"",departmentIds:[],status:"Planning",priority:"High",start_date:"",end_date:"",budget:"",project_manager_id:""}),Ee=((s,t)=>{if(!s||!t)return 0;const l=new Date(s),i=new Date(t);let N=0;const w=new Date(l);for(;w<=i;){const pe=w.getDay();pe!==0&&pe!==6&&N++,w.setDate(w.getDate()+1)}return N*8})(r.start_date,r.end_date),T=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",B=s=>{if(!s)return"-";if(typeof s=="object")return s.name||"-";const t=D.find(l=>(l.public_id||l.id||l._id)===s)||D.find(l=>l.name===s);return(t==null?void 0:t.name)||"-"},Ae=(s,t)=>{if(t!=null&&t.name)return t.name;if(!s)return"-";const l=_.find(i=>(i.public_id||i.id||i._id)===s);return(l==null?void 0:l.name)||"-"},G=_.filter(s=>s.role==="Manager");c.useEffect(()=>{a(k()),a(fe()),a(Ne()),a(je()),a(ye())},[a]);const Oe=c.useCallback(()=>{a(k()),a(fe()),a(Ne()),a(je()),a(ye())},[a]),R=(s=null)=>{var t,l;s?(d(s),u({name:s.name||"",description:s.description||"",clientId:((t=s.client)==null?void 0:t.public_id)||s.client_id||s.clientId||"",departmentIds:s.departments&&Array.isArray(s.departments)?s.departments.map(i=>i.public_id||i.id||i._id):s.departmentIds||[],status:s.status||"Planning",priority:s.priority||"High",start_date:s.start_date?new Date(s.start_date).toISOString().split("T")[0]:"",end_date:s.end_date?new Date(s.end_date).toISOString().split("T")[0]:"",budget:s.budget||"",project_manager_id:((l=s.project_manager)==null?void 0:l.public_id)||s.project_manager_id||s.projectManagerId||""})):(d(null),u({name:"",description:"",clientId:"",departmentIds:[],status:"Planning",priority:"High",start_date:"",end_date:"",budget:"",project_manager_id:""})),I(!0)},K=()=>{I(!1),d(null),L(null)},Ie=async s=>{s.preventDefault();try{if(!r.clientId){m.error("Please select a client");return}if(!r.departmentIds||r.departmentIds.length===0){m.error("Please select at least one department");return}if(!r.start_date||!r.end_date){m.error("Please select both start and end dates");return}const t={projectName:r.name,clientPublicId:r.clientId,department_ids:r.departmentIds,projectManagerPublicId:r.project_manager_id||null,project_manager_id:r.project_manager_id||null,startDate:r.start_date,endDate:r.end_date,priority:r.priority,description:r.description,budget:r.budget||null};if(r.project_manager_id){const l=G.find(i=>(i.public_id||i.id)===r.project_manager_id);l&&(t.projectManagerName=l.name)}if(b){const l=b.public_id||b.id||b._id;await a(ve({projectId:l,data:t})).unwrap(),m.success("Project updated successfully")}else await a(Qe(t)).unwrap(),m.success("Project created successfully");K(),await a(k()).unwrap()}catch(t){m.error((t==null?void 0:t.message)||"Operation failed")}},J=async s=>{if(window.confirm("Delete this project?"))try{const t=s.public_id||s.id||s._id;await a(We(t)).unwrap(),m.success("Project deleted"),await a(k()).unwrap()}catch(t){m.error((t==null?void 0:t.message)||"Delete failed")}},Q=async s=>{try{const t=s.public_id||s.id||s._id;await a(Xe(t)).unwrap(),z(s),V(!0)}catch(t){console.error("Summary error:",t),m.error((t==null?void 0:t.message)||"Failed to load project summary")}},W=async(s,t)=>{if(t)try{const l=s.id||s._id;await a(ve({projectId:l,data:{status:t}})).unwrap(),L(null),await a(k()).unwrap()}catch(l){m.error((l==null?void 0:l.message)||"Status update failed")}},H=o.filter(s=>{let t=[];s.departments&&Array.isArray(s.departments)?t=s.departments.map(N=>N.id||N.public_id||N._id):s.departmentIds&&(t=s.departmentIds);const l=h==="all"||t.includes(h),i=E==="all"||s.status===E;return l&&i}),Le=s=>!s||!Array.isArray(s)||s.length===0?"-":s.map(t=>t.name).join(", ");return y&&o.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-blue-200 border-t-blue-600 rounded-full"})}):O&&o.length===0?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-8 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-red-800 mb-2",children:"Failed to load projects"}),e.jsx("p",{className:"text-red-600 mb-6",children:O}),e.jsx("button",{onClick:()=>a(k()),className:"bg-red-600 hover:bg-red-700 text-white px-8 py-2 rounded-lg",children:"Retry"})]}):e.jsxs("div",{className:"p-8",children:[e.jsx(Ge,{title:"Projects",subtitle:"Manage and track all your projects",onRefresh:Oe,refreshing:y,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{mode:g==="list"?"list":"grid",onChange:s=>M(s==="list"?"list":"card")}),e.jsxs("button",{onClick:()=>R(),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(es,{className:"tm-icon"}),"Add Project"]})]})}),x&&e.jsxs(Ze,{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Project Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((X=x.projects)==null?void 0:X.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Projects"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((Y=x.tasks)==null?void 0:Y.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Tasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[((Z=x.tasks)==null?void 0:Z.totalHours)||0,"h"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Hours"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:((ee=x.subtasks)==null?void 0:ee.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Subtasks"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-orange-600",children:((te=(se=x.projects)==null?void 0:se.byStatus)==null?void 0:te.Planning)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Planning"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:((le=(ae=x.projects)==null?void 0:ae.byStatus)==null?void 0:le.Active)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Tasks by Stage"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(((re=x.tasks)==null?void 0:re.byStage)||{}).map(([s,t])=>e.jsx("div",{className:"px-3 py-2 bg-gray-100 rounded-lg",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s,": ",t]})},s))})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-yellow-100 text-yellow-700 font-semibold shadow-sm",children:["Planning: ",o.filter(s=>s.status==="Planning").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-blue-100 text-blue-700 font-semibold shadow-sm",children:["Active: ",o.filter(s=>s.status==="Active").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-green-100 text-green-700 font-semibold shadow-sm",children:["Completed: ",o.filter(s=>s.status==="Completed").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-red-100 text-red-700 font-semibold shadow-sm",children:["On Hold: ",o.filter(s=>s.status==="On Hold").length]}),e.jsxs("div",{className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 font-semibold shadow-sm",children:["Cancelled: ",o.filter(s=>s.status==="Cancelled").length]})]}),e.jsxs("div",{className:"bg-white rounded-xl border p-4 mb-6 flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-gray-700",children:"Filters:"})]}),e.jsxs("select",{value:h,onChange:s=>v(s.target.value),className:"px-4 py-2 border rounded-lg",children:[e.jsx("option",{value:"all",children:"All Departments"}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:E,onChange:s=>F(s.target.value),className:"px-4 py-2 border rounded-lg",children:[e.jsx("option",{value:"all",children:"All Status"}),f.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),g==="list"&&e.jsx("div",{className:"bg-white border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"Project"}),e.jsx("th",{className:"p-3 text-left",children:"Department"}),e.jsx("th",{className:"p-3 text-left",children:"Client"}),e.jsx("th",{className:"p-3 text-left",children:"Status"}),e.jsx("th",{className:"p-3 text-left",children:"Duration"}),e.jsx("th",{className:"p-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:H.map(s=>{var t;return e.jsxs(Je.Fragment,{children:[e.jsx(Ce,{project:s}),e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-sm",children:Le(s.departments)}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:B(s.client||s.client_id)}),e.jsx("td",{className:"p-3",children:U===(s.id||s._id)?e.jsx("select",{value:s.status,onChange:l=>W(s,l.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:f.map(l=>e.jsx("option",{value:l,children:l},l))}):e.jsx("span",{onClick:()=>{s.status!=="CLOSED"&&L(s.id||s._id)},className:`px-3 py-1 rounded-full text-sm font-medium ${P[s.status]||"bg-gray-100 text-gray-800"} ${s.status==="CLOSED"?"cursor-not-allowed opacity-75":"cursor-pointer"}`,children:s.status})}),e.jsxs("td",{className:"p-3 text-sm text-gray-600",children:[T(s.start_date)," â†’ ",T(s.end_date)]}),e.jsx("td",{className:"p-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[e.jsx(we,{project:s,taskSummary:(t=n==null?void 0:n[s.id||s._id])==null?void 0:t.tasks}),e.jsx("button",{onClick:()=>Q(s),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg",title:"View Summary",children:"ðŸ“Š"}),e.jsx("button",{onClick:()=>{s.status!=="CLOSED"&&R(s)},disabled:s.status==="CLOSED",className:`p-2 rounded-lg ${s.status==="CLOSED"?"text-gray-300 cursor-not-allowed":"text-gray-600 hover:bg-gray-200"}`,title:s.status==="CLOSED"?"Project Closed":"Edit Project",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(Pe,{className:"tm-icon"})})]})})]})]},s.id||s._id)})})]})}),g==="card"&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:H.length===0?e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx(ss,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No projects found"})]}):H.map(s=>{var t;return e.jsxs("div",{className:"bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(Ce,{project:s}),e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:s.description||"No description"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(we,{project:s,taskSummary:(t=n==null?void 0:n[s.id||s._id])==null?void 0:t.tasks}),e.jsx("button",{onClick:()=>Q(s),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"View Summary",children:"ðŸ“Š"}),e.jsx("button",{onClick:()=>{s.status!=="CLOSED"&&R(s)},disabled:s.status==="CLOSED",className:`p-2 rounded-lg transition-colors ${s.status==="CLOSED"?"text-gray-300 cursor-not-allowed":"hover:bg-blue-100 hover:text-blue-600"}`,title:s.status==="CLOSED"?"Project Closed":"Edit",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Client"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:B(s.client||s.client_id)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Manager"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ae(s.project_manager_id,s.project_manager)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Departments"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.departments&&s.departments.length>0?s.departments.map((l,i)=>e.jsx("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:l.name},l.public_id||l.id||l._id||i)):e.jsx("span",{className:"text-xs text-gray-500",children:"No departments"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 px-2 py-1 rounded",children:"Budget"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.budget?`$${parseFloat(s.budget).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-gray-600 text-sm font-medium",children:"Status"}),U===(s.id||s._id)?e.jsx("select",{value:s.status,onChange:l=>W(s,l.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:f.map(l=>e.jsx("option",{value:l,children:l},l))}):e.jsx("span",{className:`ml-2 px-3 py-1 rounded-full cursor-pointer text-sm ${P[s.status]}`,onClick:()=>L(s.id||s._id),children:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3",children:[e.jsxs("span",{children:["ðŸ“… ",T(s.start_date)]}),e.jsx("span",{children:"â†’"}),e.jsx("span",{children:T(s.end_date)})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-700 mt-2 pt-2 border-t",children:e.jsxs("span",{className:"font-semibold",children:["Priority: ",e.jsx("span",{className:"font-bold text-sm",children:s.priority||"-"})]})})]})]},s.id||s._id)})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:b?"Edit Project":"Add Project"}),e.jsxs("form",{onSubmit:Ie,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Project Name"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:s=>u({...r,name:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:s=>u({...r,description:s.target.value}),rows:3,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Client ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:r.clientId,onChange:s=>u({...r,clientId:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-- Select a Client --"}),D.map(s=>e.jsx("option",{value:s.public_id||s._id||s.id,children:s.name},s.public_id||s._id||s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Project Manager"}),e.jsxs("select",{value:r.project_manager_id,onChange:s=>u({...r,project_manager_id:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"-- Select a Manager --"}),G.map(s=>e.jsx("option",{value:s.public_id||s.id||s._id,children:s.name},s.public_id||s.id||s._id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional field"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-2",children:["Departments ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{multiple:!0,required:!0,value:r.departmentIds||[],onChange:s=>{const t=Array.from(s.target.selectedOptions,l=>l.value);u({...r,departmentIds:t})},className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",size:Math.min(5,C.length),children:C.map(s=>e.jsx("option",{value:s.public_id||s._id||s.id,children:s.name},s.public_id||s._id||s.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple departments"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Status"}),e.jsx("select",{value:r.status,onChange:s=>u({...r,status:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:f.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Start Date"}),e.jsx("input",{type:"date",value:r.start_date,onChange:s=>u({...r,start_date:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"End Date"}),e.jsx("input",{type:"date",value:r.end_date,onChange:s=>u({...r,end_date:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Budget(optional)"}),e.jsx("input",{type:"number",step:"0.01",value:r.budget,onChange:s=>u({...r,budget:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Project budget"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Total Duration"}),e.jsx("div",{className:"w-full px-4 py-2 border rounded-lg bg-gray-50 flex items-center",children:e.jsxs("span",{className:"text-gray-700 font-medium",children:[Ee," hours"]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-calculated from dates"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Priority"}),e.jsx("select",{value:r.priority,onChange:s=>u({...r,priority:s.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:S.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:K,className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50 font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium",children:b?"Update":"Create"})]})]})]})}),De&&A&&n&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg max-w-sm sm:max-w-md md:max-w-2xl lg:max-w-4xl w-full max-h-[90vh] overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"bg-gray-800 px-3 sm:px-4 py-2.5 sm:py-3 text-white border-b border-gray-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(ls,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold truncate",children:A.name}),e.jsx("p",{className:"text-blue-50 text-xs hidden sm:block",children:A.name})]})]}),e.jsx("button",{onClick:()=>{V(!1),z(null)},className:"p-1 sm:p-1.5 hover:bg-white/20 rounded-md transition-all ml-2 flex-shrink-0",children:e.jsx(as,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-90px)] p-3 sm:p-4",children:[e.jsxs("div",{className:"bg-gray-25 border border-gray-100 rounded-md p-3 sm:p-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ds,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-gray-500 font-medium text-xs sm:text-sm",children:"ASSIGNED"}),e.jsx("div",{className:"font-semibold text-gray-800 truncate",children:"John C."})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(is,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 font-medium text-xs sm:text-sm",children:"STATUS"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold inline-flex items-center gap-1 ${((ne=n.project)==null?void 0:ne.status)==="Completed"?"bg-green-50 text-green-700 border border-green-100":((de=n.project)==null?void 0:de.status)==="Active"?"bg-blue-50 text-blue-700 border border-blue-100":"bg-yellow-50 text-yellow-700 border border-yellow-100"}`,children:((ie=n.project)==null?void 0:ie.status)||A.status})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-xs sm:text-sm lg:col-span-1",children:[e.jsx(cs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-600 line-clamp-2 text-xs sm:text-sm",children:((ce=n.project)==null?void 0:ce.description)||A.description})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 pt-2 sm:pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between text-xs sm:text-sm text-gray-500 mb-1.5 sm:mb-2",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{className:"font-semibold text-gray-800",children:[n.progressPercentage||0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded h-1.5 sm:h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-indigo-500 h-1.5 sm:h-2 rounded transition-all",style:{width:`${n.progressPercentage||0}%`}})})]}),e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-indigo-500 whitespace-nowrap flex-shrink-0",children:[n.totalHours||0,"h"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-md p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900",children:((oe=n.tasks)==null?void 0:oe.total)||0}),e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Total"})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-md p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-500",children:((me=n.tasks)==null?void 0:me.completed)||0}),e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Done"})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-md p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-orange-500",children:((xe=n.tasks)==null?void 0:xe.inProgress)||0}),e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Active"})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-md p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-red-500",children:(((ue=n.tasks)==null?void 0:ue.total)||0)-(((ge=n.tasks)==null?void 0:ge.completed)||0)-(((he=n.tasks)==null?void 0:he.inProgress)||0)}),e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wide",children:"Pending"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-md overflow-hidden mb-4",children:[e.jsx("div",{className:"bg-gray-50 px-3 sm:px-4 py-2 border-b border-gray-100",children:e.jsxs("h3",{className:"text-sm font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx(rs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),"Tasks by Stage"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm min-w-[280px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-100",children:[e.jsx("th",{className:"px-3 sm:px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Stage"}),e.jsx("th",{className:"px-3 sm:px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Count"}),e.jsx("th",{className:"px-3 sm:px-4 py-2 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"%"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:Object.entries(((be=n.tasks)==null?void 0:be.byStatus)||{}).map(([s,t],l)=>{var w;const i=((w=n.tasks)==null?void 0:w.total)||0,N=i>0?Math.round(t/i*100):0;return e.jsxs("tr",{className:"hover:bg-gray-25 transition-colors",children:[e.jsx("td",{className:"px-3 sm:px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full ${s.toLowerCase().includes("complete")?"bg-green-400":s.toLowerCase().includes("progress")?"bg-orange-400":"bg-red-400"}`}),e.jsx("span",{className:"font-medium text-gray-800 capitalize truncate max-w-[120px] sm:max-w-none",children:s})]})}),e.jsx("td",{className:"px-3 sm:px-4 py-2.5 text-right hidden sm:table-cell",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t})}),e.jsx("td",{className:"px-3 sm:px-4 py-2.5 text-right hidden sm:table-cell",children:e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-50 text-blue-600 text-xs rounded font-medium",children:[N,"%"]})}),e.jsx("td",{className:"px-3 sm:px-4 py-2.5 text-right sm:hidden",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t})})]},s)})})]})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-emerald-25 to-green-25 border border-emerald-100 rounded-md p-3 sm:p-4",children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-bold text-gray-800 mb-2 flex items-center gap-1.5",children:[e.jsx(ns,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-emerald-500 flex-shrink-0"}),"Recent Activity"]}),e.jsx("div",{className:"bg-white border border-gray-100 rounded p-2 sm:p-2.5 text-xs",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Summary loaded successfully"})]})})]})]})]})})]})}export{gs as default};
