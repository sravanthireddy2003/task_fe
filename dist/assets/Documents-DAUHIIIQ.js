import{b as Ge,s as Be,r as c,H as O,i as m,j as s,an as ze,G as Je,P as J}from"./index-hc4IkIQj.js";const{FileText:Q,Upload:be,Download:he,Eye:Qe,Search:Ye,X:Y,AlertCircle:He,User:Ke,Calendar:qe,File:H,Shield:fe}=Je,as=()=>{var xe;const h=Ge(Be),p=((xe=h==null?void 0:h.role)==null?void 0:xe.toLowerCase())||"employee",j=(h==null?void 0:h.id)??(h==null?void 0:h.userId)??(h==null?void 0:h.user_id)??(h==null?void 0:h.publicId)??"",K=e=>{if(e===null||typeof e>"u")throw new Error("Invalid access type: empty. Allowed values: VIEW, EDIT, OWNER");const a=String(e).trim().toLowerCase(),r=["view","read","preview","download","none"],n=["edit","write","delete"],t=["owner","admin"];if(r.includes(a))return"VIEW";if(n.includes(a))return"EDIT";if(t.includes(a))return"OWNER";throw new Error(`Invalid access type: ${e}. Allowed values: VIEW, EDIT, OWNER`)},[W,q]=c.useState([]),[_,X]=c.useState(!1),[Z,V]=c.useState(null),[A,ye]=c.useState(""),[D,je]=c.useState("all"),[L,Ne]=c.useState([]),[ee,se]=c.useState(!0),[u,$]=c.useState(""),[Xe,Ze]=c.useState(null),[we,k]=c.useState(!1),[es,ss]=c.useState(!1),[te,ae]=c.useState(!1),[re,ne]=c.useState(null),[ve,M]=c.useState(!1),[U,Ie]=c.useState(null),[le,G]=c.useState([]),[oe,ce]=c.useState(!1),[Se,B]=c.useState(!1),[ie,Ae]=c.useState([]),[I,de]=c.useState([]),[R,ue]=c.useState("VIEW"),[E,z]=c.useState(!1),[b,F]=c.useState({file:null,entityType:"PROJECT",entityId:"",accessType:"READ"}),Ee=()=>{switch(p){case"admin":return[{value:"PROJECT",label:"Project"},{value:"CLIENT",label:"Client"},{value:"GENERAL",label:"General"}];case"manager":return[{value:"PROJECT",label:"Project"},{value:"CLIENT",label:"Client"}];default:return[{value:"TASK",label:"Task"}]}},Ce=c.useMemo(()=>Ee(),[p]),v=c.useCallback(async(e="",a=1,r=25)=>{var n;try{X(!0),V(null);const t=L.find(i=>i.id===e||i._id===e||i.public_id===e||i.projectId===e);let o="";t&&(t.projectId||t.public_id)?o=t.projectId||t.public_id:e&&(o=e);const g=new URLSearchParams;g.set("page",String(a)),g.set("limit",String(r)),o&&g.set("projectId",o);const f=p==="employee"&&!o?"documents/my":`documents?${g.toString()}`;console.debug("[Documents] loading documents",{path:f});const y=await O(f),C=Array.isArray(y==null?void 0:y.data)?y.data:Array.isArray(y)?y:(y==null?void 0:y.documents)||((n=y==null?void 0:y.data)==null?void 0:n.documents)||[];Array.isArray(C)?q(C):(q([]),V("Failed to load documents"))}catch(t){console.error("Error loading documents:",t),V(t.message||"Failed to load documents"),m.error("Failed to load documents")}finally{X(!1)}},[L,p]),De=c.useCallback(async()=>{se(!0);try{const e=await O("projects?dropdown=1"),a=Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:e==null?void 0:e.data,r=Array.isArray(a)?a:[];if(Ne(r),r&&r.length>0){const n=r[0],t=n.projectId??n.public_id??n.id??n._id??"";t&&($(t),await v(t,1,25))}}catch(e){console.error("Error loading projects:",e),m.error("Failed to load projects")}finally{se(!1)}},[v]),Le=async e=>{var a;if(e.preventDefault(),!b.file){m.error("Please select a file to upload");return}if(!b.entityId&&b.entityType!=="GENERAL"){m.error("Please provide an entity ID");return}ae(!0);try{const r=new FormData;r.append("document",b.file),r.append("projectId",u||""),b.taskId&&r.append("taskId",b.taskId),b.clientId&&r.append("clientId",b.clientId),r.append("fileName",b.file.name||"");const n=await J("documents/upload",r);if(n&&(n.success||((a=n==null?void 0:n.data)==null?void 0:a.success))||(n==null?void 0:n.status)>=200&&(n==null?void 0:n.status)<300)m.success("Document uploaded successfully!"),k(!1),F({file:null,entityType:"PROJECT",entityId:"",accessType:"READ"}),v(u,1,25);else throw new Error(n&&n.error||"Upload failed")}catch(r){console.error("Upload error:",r),m.error(r.message||"Failed to upload document")}finally{ae(!1)}},ke=async e=>{try{const a=L.find(o=>o.projectId===u||o.public_id===u||o.id===u||o._id===u),r=a&&(a.projectId||a.public_id)?`?projectId=${encodeURIComponent(a.projectId||a.public_id)}`:u?`?projectId=${encodeURIComponent(u)}`:"",n=await O(`documents/${e}/preview${r}`),t=(n==null?void 0:n.data)??n;if(t&&t.previewUrl)window.open(t.previewUrl,"_blank");else if(t&&t.blob){const o=window.URL.createObjectURL(t.blob);window.open(o,"_blank"),setTimeout(()=>window.URL.revokeObjectURL(o),1e4)}else m.info("Preview not available for this document type")}catch(a){console.error("Preview error:",a),m.error("Failed to preview document")}},Me=async(e,a)=>{ne(e);try{const r=L.find(o=>o.projectId===u||o.public_id===u||o.id===u||o._id===u),n=r&&(r.projectId||r.public_id)?`?projectId=${encodeURIComponent(r.projectId||r.public_id)}`:u?`?projectId=${encodeURIComponent(u)}`:"",t=await O(`documents/${e}/download${n}`,{responseType:"blob"});if(t){const o=window.URL.createObjectURL(t),g=document.createElement("a");g.href=o,g.download=a,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(o),document.body.removeChild(g),m.success("Document downloaded successfully!")}else throw new Error("Download failed")}catch(r){console.error("Download error:",r),m.error("Failed to download document")}finally{ne(null)}},Ue=async e=>{var a,r;ce(!0),G([]);try{if(!e){m.error("Project identifier missing for fetching members");return}const n=`documents/project/${encodeURIComponent(e)}/members`,t=await O(n);if(t&&(t.success||((a=t==null?void 0:t.data)==null?void 0:a.success))||(t==null?void 0:t.status)>=200&&(t==null?void 0:t.status)<300){const g=(t==null?void 0:t.data)??t,f=g&&(g.members||((r=g.data)==null?void 0:r.members))||g||[];G(Array.isArray(f)?f:[])}else throw new Error((t==null?void 0:t.error)||"Failed to load members")}catch(n){console.error("Failed to load project members:",n),m.error("Failed to load project members")}finally{ce(!1)}},Re=async e=>{try{const r=(e==null?void 0:e.projectId)||(e==null?void 0:e.project_public_id)||(e==null?void 0:e.project)||u||u;Ie((e==null?void 0:e.documentId)||(e==null?void 0:e.id)||null),de([]),ue("VIEW"),M(!0),r&&await Ue(r)}catch(a){console.error("openManageAccess error:",a),m.error("Unable to open access manager")}},Pe=e=>{de(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},Te=async()=>{var r,n,t;if(!U){m.error("No document selected");return}if(!I||I.length===0){m.error("Select at least one user to assign access");return}const e=W.find(o=>o.documentId===U||o.id===U),a=(e==null?void 0:e.projectId)||(e==null?void 0:e.project_public_id)||(e==null?void 0:e.project)||u;z(!0);try{let o;try{o=K(R||"VIEW")}catch(i){m.error(i.message),z(!1);return}const g={documentId:U,assigneeIds:Array.isArray(I)?I:[I],accessType:o,projectId:a||void 0};console.debug("[Documents] submitAssignAccess bulk payload:",g);let f=[],y=null,C=!1;try{const i=await J("documents/access",g);console.debug("[Documents] API raw response:",i);const l=(i==null?void 0:i.data)??i;console.debug("[Documents] API response data:",l);const N=(i==null?void 0:i.status)||(i==null?void 0:i.statusCode)||200,w=N>=200&&N<300,S=(l==null?void 0:l.success)===!0||(l==null?void 0:l.status)==="success";if(console.debug("[Documents] Status check:",{httpStatus:N,isHttpSuccess:w,hasSuccessFlag:S,resultSuccess:l==null?void 0:l.success,resultStatus:l==null?void 0:l.status}),w||S){C=!0,y=(l==null?void 0:l.message)||((r=l==null?void 0:l.data)==null?void 0:r.message)||"Access assigned successfully";const x=((n=l==null?void 0:l.data)==null?void 0:n.assignments)||(l==null?void 0:l.assignments)||((t=l==null?void 0:l.data)==null?void 0:t.results)||(l==null?void 0:l.results)||[];console.debug("[Documents] Assignments found:",x),Array.isArray(x)&&x.length>0?f=x.map(d=>{const P=d.accessType??d.permissionLevel??d.action??d.access_type??R;let T;try{T=K(P)}catch{console.warn("[Documents] Invalid accessType from server, defaulting to VIEW:",P),T=R||"VIEW"}return{assigneeId:d.userId??d.assigneeId??d.id??d.user_id,permissionLevel:T}}):f=I.map(d=>({assigneeId:d,permissionLevel:o||"VIEW"})),console.debug("[Documents] Aggregated results:",f),m.success(y),M(!1)}else{const x=(l==null?void 0:l.error)||(l==null?void 0:l.message)||"Failed to assign access";throw console.error("[Documents] API returned error:",x),new Error(x)}}catch(i){if(console.error("[Documents] Bulk assign failed:",i.message||i),C)console.log("[Documents] Already succeeded, skipping fallback");else{console.log("[Documents] Falling back to individual assignments...");let l=0,N=0;for(const w of I)try{const S={documentId:U,assigneeId:w,accessType:o||"VIEW",projectId:a||void 0};console.debug("[Documents] Individual payload:",S);const x=await J("documents/access",S),d=(x==null?void 0:x.data)??x;console.debug("[Documents] Individual response:",d);const P=(x==null?void 0:x.status)||(x==null?void 0:x.statusCode)||200,T=P>=200&&P<300,pe=(d==null?void 0:d.success)===!0||(d==null?void 0:d.status)==="success";T||pe?(f.push({assigneeId:w,permissionLevel:o||"VIEW"}),l++):(f.push({assigneeId:w,error:(d==null?void 0:d.error)||(d==null?void 0:d.message)||"failed"}),N++)}catch(S){console.error(`[Documents] Failed for assignee ${w}:`,S),f.push({assigneeId:w,error:S.message||"failed"}),N++}l>0?(m.success(`Successfully assigned access to ${l} users${N>0?`, ${N} failed`:""}`),M(!1)):m.error("Failed to assign access to any users")}}f.length>0&&G(i=>i.map(l=>{const N=f.find(w=>String(w.assigneeId)===String(l.id)||String(w.assigneeId)===String(l.publicId)||String(w.assigneeId)===String(l.userId));return N&&!N.error?{...l,permissionLevel:N.permissionLevel||R}:l})),(C||f.some(i=>!i.error))&&v(u,1,25)}catch(o){console.error("[Documents] submitAssignAccess error:",o),m.error(o.message||"Failed to assign access")}finally{z(!1)}};c.useCallback(e=>{if(!e||["admin","manager"].includes(p))return!1;const r=(e.accessMembers||[]).find(t=>String(t.userId)===String(j)||String(t.id)===String(j));if(!r)return p==="employee";const n=(r.accessType||r.permissionLevel||"").toString().toUpperCase();return["VIEWONLY","READONLY","NONE"].includes(n)},[p,j]);const Oe=c.useCallback(e=>{if(!e)return!1;if(["admin","manager"].includes(p))return!0;const r=(e.accessMembers||[]).find(t=>String(t.userId)===String(j)||String(t.id)===String(j));if(!r)return String(e.uploadedById)===String(j)||String(e.uploadedBy)===String(j)||p!=="employee";const n=(r.accessType||r.permissionLevel||"").toString().toUpperCase();return["VIEW","DOWNLOAD","EDIT","OWNER"].includes(n)},[p,j]),Fe=c.useCallback(e=>Array.isArray(e)?p==="employee"?e.filter(a=>(a.accessType||a.permissionLevel||"").toString().toUpperCase()!=="OWNER"):e:[],[p]),We=c.useCallback(e=>{if(!e)return"NONE";if(p==="admin")return"ADMIN";if(p==="manager")return"MANAGER";const r=(e.accessMembers||[]).find(t=>String(t.userId)===String(j)||String(t.id)===String(j));return r?(r.accessType||r.permissionLevel||"").toString().toUpperCase()||"VIEW":String(e.uploadedById)===String(j)||String(e.uploadedBy)===String(j)?"OWNER":"NONE"},[p,j]),me=c.useMemo(()=>W.filter(e=>{var n,t,o;const a=((n=e.fileName)==null?void 0:n.toLowerCase().includes(A.toLowerCase()))||((t=e.uploadedBy)==null?void 0:t.toLowerCase().includes(A.toLowerCase()))||((o=e.entityType)==null?void 0:o.toLowerCase().includes(A.toLowerCase())),r=D==="all"||e.entityType===D;return a&&r}),[W,A,D]),_e=e=>e!=null&&e.includes("pdf")?s.jsx(Q,{className:"w-5 h-5 text-red-500"}):e!=null&&e.includes("image")?s.jsx(H,{className:"w-5 h-5 text-green-500"}):e!=null&&e.includes("word")||e!=null&&e.includes("doc")?s.jsx(Q,{className:"w-5 h-5 text-blue-500"}):e!=null&&e.includes("excel")||e!=null&&e.includes("xls")?s.jsx(H,{className:"w-5 h-5 text-green-600"}):s.jsx(H,{className:"w-5 h-5 text-gray-500"}),Ve=e=>{if(!e)return"Unknown";const a=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,r)*100)/100+" "+a[r]},ge=()=>["admin","manager"].includes(p),$e=()=>p==="admin";return c.useEffect(()=>{De()},[]),s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx(ze,{title:"Documents",subtitle:"Manage and organize project documents, files, and resources",onRefresh:()=>v(u,1,25),children:ge()&&s.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(be,{className:"w-5 h-5"}),"Upload Document"]})}),s.jsx("div",{className:"bg-white rounded-xl border p-6 mb-8",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Search documents by name, type, or uploader...",value:A,onChange:e=>ye(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("select",{value:D,onChange:e=>je(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"All Types"}),s.jsx("option",{value:"PROJECT",children:"Projects"}),s.jsx("option",{value:"CLIENT",children:"Clients"}),s.jsx("option",{value:"TASK",children:"Tasks"}),s.jsx("option",{value:"GENERAL",children:"General"})]}),s.jsxs("select",{value:u,onChange:e=>{const a=e.target.value;console.log("Project selected:",a),$(a),v(a,1,25)},disabled:ee,className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:[s.jsx("option",{value:"",children:ee?"Loading projects...":"All Projects"}),L.map(e=>{const a=e.projectId??e.public_id??e.id??e._id,r=e.projectName??e.name??e.title??e.project_name??`Project ${a??""}`;return s.jsx("option",{value:a,children:r},a)})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>v(u,1,25),disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:"Load Documents"}),s.jsx("button",{onClick:()=>{$(""),v("",1,25)},disabled:_,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 transition-colors",children:"Clear Filter"})]})]})]})}),_?s.jsxs("div",{className:"bg-white rounded-xl border p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading documents..."})]}):Z?s.jsxs("div",{className:"bg-white rounded-xl border p-8 text-center",children:[s.jsx(He,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Documents"}),s.jsx("p",{className:"text-gray-600 mb-4",children:Z}),s.jsx("button",{onClick:()=>v(u,1,25),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]}):me.length===0?s.jsxs("div",{className:"bg-white rounded-xl border p-12 text-center",children:[s.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Documents Found"}),s.jsx("p",{className:"text-gray-600 mb-6",children:u?A||D!=="all"?"No documents match your search criteria.":"No documents have been uploaded for this project yet.":"Please select a project from the dropdown above to view its documents."}),ge()&&s.jsx("button",{onClick:()=>k(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Upload Your First Document"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:me.map(e=>{const a=We(e),r=Oe(e),n=Fe(e.accessMembers||[]);return s.jsxs("div",{className:"bg-white rounded-xl border hover:shadow-lg transition-shadow p-6",children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[_e(e.mimeType),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 truncate max-w-[200px]",title:e.fileName,children:e.fileName}),s.jsx("p",{className:"text-sm text-gray-500",children:Ve(e.fileSize)})]})]}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${e.entityType==="PROJECT"?"bg-blue-100 text-blue-800":e.entityType==="CLIENT"?"bg-green-100 text-green-800":e.entityType==="TASK"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:e.entityType})]}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(Ke,{className:"w-4 h-4"}),s.jsx("span",{children:e.uploadedBy||"Unknown"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(qe,{className:"w-4 h-4"}),s.jsx("span",{children:new Date(e.uploadedAt).toLocaleDateString()})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(fe,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:`font-medium ${a==="OWNER"?"text-green-600":a==="ADMIN"?"text-red-600":a==="MANAGER"?"text-blue-600":a==="EDIT"?"text-purple-600":a==="DOWNLOAD"?"text-blue-500":"text-gray-600"}`,children:["Your access: ",a]})]}),n.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-xs text-gray-500 mb-1",children:[n.length," member",n.length!==1?"s":""]}),s.jsx("button",{onClick:()=>{Ae(n),B(!0)},className:"text-xs text-blue-600 hover:underline",children:"View Members"})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.slice(0,3).map(t=>s.jsxs("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded-md text-gray-700",children:[s.jsx("strong",{className:"mr-1",children:t.name||`User ${t.userId}`}),s.jsx("span",{className:"uppercase",children:t.accessType&&t.accessType!==""?t.accessType:"VIEW"}),t.role&&s.jsxs("span",{className:"ml-1 text-gray-400",children:["(",t.role,")"]})]},t.userId)),n.length>3&&s.jsxs("div",{className:"text-xs bg-gray-100 px-2 py-1 rounded-md text-gray-700",children:["+",n.length-3," more"]})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>ke(e.documentId||e.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors",children:[s.jsx(Qe,{className:"w-4 h-4"}),"Preview"]}),r?s.jsxs("button",{onClick:()=>Me(e.documentId||e.id,e.fileName),disabled:re===(e.documentId||e.id),className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 disabled:opacity-50 transition-colors",children:[re===(e.documentId||e.id)?s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-700"}):s.jsx(he,{className:"w-4 h-4"}),"Download"]}):s.jsxs("button",{disabled:!0,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-gray-100 text-gray-500 rounded-lg cursor-not-allowed",title:"You don't have permission to download this document",children:[s.jsx(he,{className:"w-4 h-4"}),"No Download"]})]}),$e()&&s.jsx("div",{className:"mt-3 pt-3 border-t",children:s.jsxs("button",{onClick:()=>Re(e),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:[s.jsx(fe,{className:"w-4 h-4"}),"Manage Access"]})})]},e.documentId||e.id)})}),we&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Upload Document"}),s.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600",children:s.jsx(Y,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:Le,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document File *"}),s.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.xls,.xlsx,.txt,.jpg,.jpeg,.png",onChange:e=>F({...b,file:e.target.files[0]}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entity Type"}),s.jsx("select",{value:b.entityType,onChange:e=>F({...b,entityType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Ce.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),b.entityType!=="GENERAL"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Entity ID *"}),s.jsx("input",{type:"text",value:b.entityId,onChange:e=>F({...b,entityId:e.target.value}),placeholder:`Enter ${b.entityType.toLowerCase()} ID`,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsx("button",{type:"button",onClick:()=>k(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:te,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center justify-center gap-2",children:te?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Uploading..."]}):s.jsxs(s.Fragment,{children:[s.jsx(be,{className:"w-4 h-4"}),"Upload"]})})]})]})]})}),ve&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-lg w-full p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Manage Document Access"}),s.jsx("button",{onClick:()=>M(!1),className:"text-gray-500 hover:text-gray-700",disabled:E,children:s.jsx(Y,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Members"}),oe?s.jsx("div",{className:"text-sm text-gray-500",children:"Loading members..."}):le.length===0?s.jsx("div",{className:"text-sm text-gray-500",children:"No members found for this project."}):s.jsx("div",{className:"max-h-48 overflow-auto border rounded-md p-2",children:le.map(e=>s.jsxs("label",{className:"flex items-center gap-2 py-1",children:[s.jsx("input",{type:"checkbox",checked:I.includes(e.id||e.publicId),onChange:()=>Pe(e.id||e.publicId),disabled:E}),s.jsxs("span",{className:"text-sm",children:[e.name," ",s.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.role,")"]})]})]},e.id||e.publicId))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permission Level"}),s.jsxs("select",{value:R,onChange:e=>ue(e.target.value),className:"w-full px-3 py-2 border rounded-md",disabled:E,children:[s.jsx("option",{value:"VIEW",children:"View"}),s.jsx("option",{value:"DOWNLOAD",children:"Download"}),s.jsx("option",{value:"EDIT",children:"Edit"}),s.jsx("option",{value:"OWNER",children:"Owner"}),s.jsx("option",{value:"NONE",children:"Revoke"})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[s.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 border rounded-md",disabled:E,children:"Cancel"}),s.jsx("button",{disabled:E||oe,onClick:Te,className:"px-4 py-2 bg-blue-600 text-white rounded-md disabled:opacity-50",children:E?"Assigning...":"Assign Access"})]})]})]})}),Se&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"Document Members"}),s.jsx("button",{onClick:()=>B(!1),className:"text-gray-500 hover:text-gray-700",children:s.jsx(Y,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"space-y-3 max-h-64 overflow-auto",children:ie.length===0?s.jsx("div",{className:"text-sm text-gray-500",children:"No members available."}):ie.map(e=>{const a=(e.accessType||e.permissionLevel||"").toString().toUpperCase();return s.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-md",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium",children:e.name||`User ${e.userId}`}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",e.userId]}),e.role&&s.jsxs("div",{className:"text-xs text-gray-500",children:["Role: ",e.role]})]}),s.jsx("div",{className:`text-sm font-semibold uppercase px-2 py-1 rounded ${a==="OWNER"?"bg-green-100 text-green-800":a==="ADMIN"?"bg-red-100 text-red-800":a==="MANAGER"?"bg-blue-100 text-blue-800":a==="EDIT"?"bg-purple-100 text-purple-800":a==="DOWNLOAD"?"bg-blue-50 text-blue-700":"bg-gray-100 text-gray-800"}`,children:a||"VIEW"})]},e.userId)})}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx("button",{onClick:()=>B(!1),className:"px-4 py-2 bg-gray-200 rounded-md",children:"Close"})})]})})]})};export{as as default};
